(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))f(g);new MutationObserver(g=>{for(const S of g)if(S.type==="childList")for(const I of S.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&f(I)}).observe(document,{childList:!0,subtree:!0});function h(g){const S={};return g.integrity&&(S.integrity=g.integrity),g.referrerPolicy&&(S.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?S.credentials="include":g.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function f(g){if(g.ep)return;g.ep=!0;const S=h(g);fetch(g.href,S)}})();var _m=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qx(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Xx={exports:{}},SE={},Jx={exports:{}},At={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sp=Symbol.for("react.element"),pQ=Symbol.for("react.portal"),fQ=Symbol.for("react.fragment"),_Q=Symbol.for("react.strict_mode"),mQ=Symbol.for("react.profiler"),EQ=Symbol.for("react.provider"),gQ=Symbol.for("react.context"),SQ=Symbol.for("react.forward_ref"),TQ=Symbol.for("react.suspense"),vQ=Symbol.for("react.memo"),RQ=Symbol.for("react.lazy"),PU=Symbol.iterator;function yQ(o){return o===null||typeof o!="object"?null:(o=PU&&o[PU]||o["@@iterator"],typeof o=="function"?o:null)}var Qx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Zx=Object.assign,$x={};function Fl(o,c,h){this.props=o,this.context=c,this.refs=$x,this.updater=h||Qx}Fl.prototype.isReactComponent={};Fl.prototype.setState=function(o,c){if(typeof o!="object"&&typeof o!="function"&&o!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,o,c,"setState")};Fl.prototype.forceUpdate=function(o){this.updater.enqueueForceUpdate(this,o,"forceUpdate")};function eV(){}eV.prototype=Fl.prototype;function IC(o,c,h){this.props=o,this.context=c,this.refs=$x,this.updater=h||Qx}var wC=IC.prototype=new eV;wC.constructor=IC;Zx(wC,Fl.prototype);wC.isPureReactComponent=!0;var kU=Array.isArray,tV=Object.prototype.hasOwnProperty,AC={current:null},nV={key:!0,ref:!0,__self:!0,__source:!0};function rV(o,c,h){var f,g={},S=null,I=null;if(c!=null)for(f in c.ref!==void 0&&(I=c.ref),c.key!==void 0&&(S=""+c.key),c)tV.call(c,f)&&!nV.hasOwnProperty(f)&&(g[f]=c[f]);var L=arguments.length-2;if(L===1)g.children=h;else if(1<L){for(var M=Array(L),F=0;F<L;F++)M[F]=arguments[F+2];g.children=M}if(o&&o.defaultProps)for(f in L=o.defaultProps,L)g[f]===void 0&&(g[f]=L[f]);return{$$typeof:sp,type:o,key:S,ref:I,props:g,_owner:AC.current}}function CQ(o,c){return{$$typeof:sp,type:o.type,key:c,ref:o.ref,props:o.props,_owner:o._owner}}function bC(o){return typeof o=="object"&&o!==null&&o.$$typeof===sp}function IQ(o){var c={"=":"=0",":":"=2"};return"$"+o.replace(/[=:]/g,function(h){return c[h]})}var LU=/\/+/g;function ty(o,c){return typeof o=="object"&&o!==null&&o.key!=null?IQ(""+o.key):c.toString(36)}function Lm(o,c,h,f,g){var S=typeof o;(S==="undefined"||S==="boolean")&&(o=null);var I=!1;if(o===null)I=!0;else switch(S){case"string":case"number":I=!0;break;case"object":switch(o.$$typeof){case sp:case pQ:I=!0}}if(I)return I=o,g=g(I),o=f===""?"."+ty(I,0):f,kU(g)?(h="",o!=null&&(h=o.replace(LU,"$&/")+"/"),Lm(g,c,h,"",function(F){return F})):g!=null&&(bC(g)&&(g=CQ(g,h+(!g.key||I&&I.key===g.key?"":(""+g.key).replace(LU,"$&/")+"/")+o)),c.push(g)),1;if(I=0,f=f===""?".":f+":",kU(o))for(var L=0;L<o.length;L++){S=o[L];var M=f+ty(S,L);I+=Lm(S,c,h,M,g)}else if(M=yQ(o),typeof M=="function")for(o=M.call(o),L=0;!(S=o.next()).done;)S=S.value,M=f+ty(S,L++),I+=Lm(S,c,h,M,g);else if(S==="object")throw c=String(o),Error("Objects are not valid as a React child (found: "+(c==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.");return I}function mm(o,c,h){if(o==null)return o;var f=[],g=0;return Lm(o,f,"","",function(S){return c.call(h,S,g++)}),f}function wQ(o){if(o._status===-1){var c=o._result;c=c(),c.then(function(h){(o._status===0||o._status===-1)&&(o._status=1,o._result=h)},function(h){(o._status===0||o._status===-1)&&(o._status=2,o._result=h)}),o._status===-1&&(o._status=0,o._result=c)}if(o._status===1)return o._result.default;throw o._result}var jr={current:null},Mm={transition:null},AQ={ReactCurrentDispatcher:jr,ReactCurrentBatchConfig:Mm,ReactCurrentOwner:AC};function iV(){throw Error("act(...) is not supported in production builds of React.")}At.Children={map:mm,forEach:function(o,c,h){mm(o,function(){c.apply(this,arguments)},h)},count:function(o){var c=0;return mm(o,function(){c++}),c},toArray:function(o){return mm(o,function(c){return c})||[]},only:function(o){if(!bC(o))throw Error("React.Children.only expected to receive a single React element child.");return o}};At.Component=Fl;At.Fragment=fQ;At.Profiler=mQ;At.PureComponent=IC;At.StrictMode=_Q;At.Suspense=TQ;At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AQ;At.act=iV;At.cloneElement=function(o,c,h){if(o==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+o+".");var f=Zx({},o.props),g=o.key,S=o.ref,I=o._owner;if(c!=null){if(c.ref!==void 0&&(S=c.ref,I=AC.current),c.key!==void 0&&(g=""+c.key),o.type&&o.type.defaultProps)var L=o.type.defaultProps;for(M in c)tV.call(c,M)&&!nV.hasOwnProperty(M)&&(f[M]=c[M]===void 0&&L!==void 0?L[M]:c[M])}var M=arguments.length-2;if(M===1)f.children=h;else if(1<M){L=Array(M);for(var F=0;F<M;F++)L[F]=arguments[F+2];f.children=L}return{$$typeof:sp,type:o.type,key:g,ref:S,props:f,_owner:I}};At.createContext=function(o){return o={$$typeof:gQ,_currentValue:o,_currentValue2:o,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},o.Provider={$$typeof:EQ,_context:o},o.Consumer=o};At.createElement=rV;At.createFactory=function(o){var c=rV.bind(null,o);return c.type=o,c};At.createRef=function(){return{current:null}};At.forwardRef=function(o){return{$$typeof:SQ,render:o}};At.isValidElement=bC;At.lazy=function(o){return{$$typeof:RQ,_payload:{_status:-1,_result:o},_init:wQ}};At.memo=function(o,c){return{$$typeof:vQ,type:o,compare:c===void 0?null:c}};At.startTransition=function(o){var c=Mm.transition;Mm.transition={};try{o()}finally{Mm.transition=c}};At.unstable_act=iV;At.useCallback=function(o,c){return jr.current.useCallback(o,c)};At.useContext=function(o){return jr.current.useContext(o)};At.useDebugValue=function(){};At.useDeferredValue=function(o){return jr.current.useDeferredValue(o)};At.useEffect=function(o,c){return jr.current.useEffect(o,c)};At.useId=function(){return jr.current.useId()};At.useImperativeHandle=function(o,c,h){return jr.current.useImperativeHandle(o,c,h)};At.useInsertionEffect=function(o,c){return jr.current.useInsertionEffect(o,c)};At.useLayoutEffect=function(o,c){return jr.current.useLayoutEffect(o,c)};At.useMemo=function(o,c){return jr.current.useMemo(o,c)};At.useReducer=function(o,c,h){return jr.current.useReducer(o,c,h)};At.useRef=function(o){return jr.current.useRef(o)};At.useState=function(o){return jr.current.useState(o)};At.useSyncExternalStore=function(o,c,h){return jr.current.useSyncExternalStore(o,c,h)};At.useTransition=function(){return jr.current.useTransition()};At.version="18.3.1";Jx.exports=At;var le=Jx.exports;const bQ=qx(le);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OQ=le,NQ=Symbol.for("react.element"),DQ=Symbol.for("react.fragment"),PQ=Object.prototype.hasOwnProperty,kQ=OQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,LQ={key:!0,ref:!0,__self:!0,__source:!0};function oV(o,c,h){var f,g={},S=null,I=null;h!==void 0&&(S=""+h),c.key!==void 0&&(S=""+c.key),c.ref!==void 0&&(I=c.ref);for(f in c)PQ.call(c,f)&&!LQ.hasOwnProperty(f)&&(g[f]=c[f]);if(o&&o.defaultProps)for(f in c=o.defaultProps,c)g[f]===void 0&&(g[f]=c[f]);return{$$typeof:NQ,type:o,key:S,ref:I,props:g,_owner:kQ.current}}SE.Fragment=DQ;SE.jsx=oV;SE.jsxs=oV;Xx.exports=SE;var et=Xx.exports,Ny={},sV={exports:{}},Ai={},aV={exports:{}},cV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(o){function c(xe,dt){var Et=xe.length;xe.push(dt);e:for(;0<Et;){var Tn=Et-1>>>1,tn=xe[Tn];if(0<g(tn,dt))xe[Tn]=dt,xe[Et]=tn,Et=Tn;else break e}}function h(xe){return xe.length===0?null:xe[0]}function f(xe){if(xe.length===0)return null;var dt=xe[0],Et=xe.pop();if(Et!==dt){xe[0]=Et;e:for(var Tn=0,tn=xe.length,as=tn>>>1;Tn<as;){var vr=2*(Tn+1)-1,Hl=xe[vr],cs=vr+1,Bs=xe[cs];if(0>g(Hl,Et))cs<tn&&0>g(Bs,Hl)?(xe[Tn]=Bs,xe[cs]=Et,Tn=cs):(xe[Tn]=Hl,xe[vr]=Et,Tn=vr);else if(cs<tn&&0>g(Bs,Et))xe[Tn]=Bs,xe[cs]=Et,Tn=cs;else break e}}return dt}function g(xe,dt){var Et=xe.sortIndex-dt.sortIndex;return Et!==0?Et:xe.id-dt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var S=performance;o.unstable_now=function(){return S.now()}}else{var I=Date,L=I.now();o.unstable_now=function(){return I.now()-L}}var M=[],F=[],X=1,H=null,J=3,ce=!1,se=!1,pe=!1,we=typeof setTimeout=="function"?setTimeout:null,z=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function K(xe){for(var dt=h(F);dt!==null;){if(dt.callback===null)f(F);else if(dt.startTime<=xe)f(F),dt.sortIndex=dt.expirationTime,c(M,dt);else break;dt=h(F)}}function Ee(xe){if(pe=!1,K(xe),!se)if(h(M)!==null)se=!0,Fs(Ie);else{var dt=h(F);dt!==null&&un(Ee,dt.startTime-xe)}}function Ie(xe,dt){se=!1,pe&&(pe=!1,z(je),je=-1),ce=!0;var Et=J;try{for(K(dt),H=h(M);H!==null&&(!(H.expirationTime>dt)||xe&&!bt());){var Tn=H.callback;if(typeof Tn=="function"){H.callback=null,J=H.priorityLevel;var tn=Tn(H.expirationTime<=dt);dt=o.unstable_now(),typeof tn=="function"?H.callback=tn:H===h(M)&&f(M),K(dt)}else f(M);H=h(M)}if(H!==null)var as=!0;else{var vr=h(F);vr!==null&&un(Ee,vr.startTime-dt),as=!1}return as}finally{H=null,J=Et,ce=!1}}var Le=!1,be=null,je=-1,Bt=5,ge=-1;function bt(){return!(o.unstable_now()-ge<Bt)}function ct(){if(be!==null){var xe=o.unstable_now();ge=xe;var dt=!0;try{dt=be(!0,xe)}finally{dt?Hn():(Le=!1,be=null)}}else Le=!1}var Hn;if(typeof W=="function")Hn=function(){W(ct)};else if(typeof MessageChannel<"u"){var en=new MessageChannel,xE=en.port2;en.port1.onmessage=ct,Hn=function(){xE.postMessage(null)}}else Hn=function(){we(ct,0)};function Fs(xe){be=xe,Le||(Le=!0,Hn())}function un(xe,dt){je=we(function(){xe(o.unstable_now())},dt)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(xe){xe.callback=null},o.unstable_continueExecution=function(){se||ce||(se=!0,Fs(Ie))},o.unstable_forceFrameRate=function(xe){0>xe||125<xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Bt=0<xe?Math.floor(1e3/xe):5},o.unstable_getCurrentPriorityLevel=function(){return J},o.unstable_getFirstCallbackNode=function(){return h(M)},o.unstable_next=function(xe){switch(J){case 1:case 2:case 3:var dt=3;break;default:dt=J}var Et=J;J=dt;try{return xe()}finally{J=Et}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=function(){},o.unstable_runWithPriority=function(xe,dt){switch(xe){case 1:case 2:case 3:case 4:case 5:break;default:xe=3}var Et=J;J=xe;try{return dt()}finally{J=Et}},o.unstable_scheduleCallback=function(xe,dt,Et){var Tn=o.unstable_now();switch(typeof Et=="object"&&Et!==null?(Et=Et.delay,Et=typeof Et=="number"&&0<Et?Tn+Et:Tn):Et=Tn,xe){case 1:var tn=-1;break;case 2:tn=250;break;case 5:tn=1073741823;break;case 4:tn=1e4;break;default:tn=5e3}return tn=Et+tn,xe={id:X++,callback:dt,priorityLevel:xe,startTime:Et,expirationTime:tn,sortIndex:-1},Et>Tn?(xe.sortIndex=Et,c(F,xe),h(M)===null&&xe===h(F)&&(pe?(z(je),je=-1):pe=!0,un(Ee,Et-Tn))):(xe.sortIndex=tn,c(M,xe),se||ce||(se=!0,Fs(Ie))),xe},o.unstable_shouldYield=bt,o.unstable_wrapCallback=function(xe){var dt=J;return function(){var Et=J;J=dt;try{return xe.apply(this,arguments)}finally{J=Et}}}})(cV);aV.exports=cV;var MQ=aV.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UQ=le,wi=MQ;function ve(o){for(var c="https://reactjs.org/docs/error-decoder.html?invariant="+o,h=1;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dV=new Set,Gh={};function Hc(o,c){Pl(o,c),Pl(o+"Capture",c)}function Pl(o,c){for(Gh[o]=c,o=0;o<c.length;o++)dV.add(c[o])}var Ps=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dy=Object.prototype.hasOwnProperty,xQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,MU={},UU={};function VQ(o){return Dy.call(UU,o)?!0:Dy.call(MU,o)?!1:xQ.test(o)?UU[o]=!0:(MU[o]=!0,!1)}function FQ(o,c,h,f){if(h!==null&&h.type===0)return!1;switch(typeof c){case"function":case"symbol":return!0;case"boolean":return f?!1:h!==null?!h.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function BQ(o,c,h,f){if(c===null||typeof c>"u"||FQ(o,c,h,f))return!0;if(f)return!1;if(h!==null)switch(h.type){case 3:return!c;case 4:return c===!1;case 5:return isNaN(c);case 6:return isNaN(c)||1>c}return!1}function Gr(o,c,h,f,g,S,I){this.acceptsBooleans=c===2||c===3||c===4,this.attributeName=f,this.attributeNamespace=g,this.mustUseProperty=h,this.propertyName=o,this.type=c,this.sanitizeURL=S,this.removeEmptyString=I}var Tr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){Tr[o]=new Gr(o,0,!1,o,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var c=o[0];Tr[c]=new Gr(c,1,!1,o[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(o){Tr[o]=new Gr(o,2,!1,o.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){Tr[o]=new Gr(o,2,!1,o,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){Tr[o]=new Gr(o,3,!1,o.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(o){Tr[o]=new Gr(o,3,!0,o,null,!1,!1)});["capture","download"].forEach(function(o){Tr[o]=new Gr(o,4,!1,o,null,!1,!1)});["cols","rows","size","span"].forEach(function(o){Tr[o]=new Gr(o,6,!1,o,null,!1,!1)});["rowSpan","start"].forEach(function(o){Tr[o]=new Gr(o,5,!1,o.toLowerCase(),null,!1,!1)});var OC=/[\-:]([a-z])/g;function NC(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var c=o.replace(OC,NC);Tr[c]=new Gr(c,1,!1,o,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var c=o.replace(OC,NC);Tr[c]=new Gr(c,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(o){var c=o.replace(OC,NC);Tr[c]=new Gr(c,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(o){Tr[o]=new Gr(o,1,!1,o.toLowerCase(),null,!1,!1)});Tr.xlinkHref=new Gr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(o){Tr[o]=new Gr(o,1,!1,o.toLowerCase(),null,!0,!0)});function DC(o,c,h,f){var g=Tr.hasOwnProperty(c)?Tr[c]:null;(g!==null?g.type!==0:f||!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(BQ(c,h,g,f)&&(h=null),f||g===null?VQ(c)&&(h===null?o.removeAttribute(c):o.setAttribute(c,""+h)):g.mustUseProperty?o[g.propertyName]=h===null?g.type===3?!1:"":h:(c=g.attributeName,f=g.attributeNamespace,h===null?o.removeAttribute(c):(g=g.type,h=g===3||g===4&&h===!0?"":""+h,f?o.setAttributeNS(f,c,h):o.setAttribute(c,h))))}var xs=UQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Em=Symbol.for("react.element"),fl=Symbol.for("react.portal"),_l=Symbol.for("react.fragment"),PC=Symbol.for("react.strict_mode"),Py=Symbol.for("react.profiler"),lV=Symbol.for("react.provider"),uV=Symbol.for("react.context"),kC=Symbol.for("react.forward_ref"),ky=Symbol.for("react.suspense"),Ly=Symbol.for("react.suspense_list"),LC=Symbol.for("react.memo"),Ca=Symbol.for("react.lazy"),hV=Symbol.for("react.offscreen"),xU=Symbol.iterator;function Sh(o){return o===null||typeof o!="object"?null:(o=xU&&o[xU]||o["@@iterator"],typeof o=="function"?o:null)}var On=Object.assign,ny;function bh(o){if(ny===void 0)try{throw Error()}catch(h){var c=h.stack.trim().match(/\n( *(at )?)/);ny=c&&c[1]||""}return`
`+ny+o}var ry=!1;function iy(o,c){if(!o||ry)return"";ry=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(c)if(c=function(){throw Error()},Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(c,[])}catch(F){var f=F}Reflect.construct(o,[],c)}else{try{c.call()}catch(F){f=F}o.call(c.prototype)}else{try{throw Error()}catch(F){f=F}o()}}catch(F){if(F&&f&&typeof F.stack=="string"){for(var g=F.stack.split(`
`),S=f.stack.split(`
`),I=g.length-1,L=S.length-1;1<=I&&0<=L&&g[I]!==S[L];)L--;for(;1<=I&&0<=L;I--,L--)if(g[I]!==S[L]){if(I!==1||L!==1)do if(I--,L--,0>L||g[I]!==S[L]){var M=`
`+g[I].replace(" at new "," at ");return o.displayName&&M.includes("<anonymous>")&&(M=M.replace("<anonymous>",o.displayName)),M}while(1<=I&&0<=L);break}}}finally{ry=!1,Error.prepareStackTrace=h}return(o=o?o.displayName||o.name:"")?bh(o):""}function jQ(o){switch(o.tag){case 5:return bh(o.type);case 16:return bh("Lazy");case 13:return bh("Suspense");case 19:return bh("SuspenseList");case 0:case 2:case 15:return o=iy(o.type,!1),o;case 11:return o=iy(o.type.render,!1),o;case 1:return o=iy(o.type,!0),o;default:return""}}function My(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case _l:return"Fragment";case fl:return"Portal";case Py:return"Profiler";case PC:return"StrictMode";case ky:return"Suspense";case Ly:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case uV:return(o.displayName||"Context")+".Consumer";case lV:return(o._context.displayName||"Context")+".Provider";case kC:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case LC:return c=o.displayName||null,c!==null?c:My(o.type)||"Memo";case Ca:c=o._payload,o=o._init;try{return My(o(c))}catch{}}return null}function GQ(o){var c=o.type;switch(o.tag){case 24:return"Cache";case 9:return(c.displayName||"Context")+".Consumer";case 10:return(c._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=c.render,o=o.displayName||o.name||"",c.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return c;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return My(c);case 8:return c===PC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c}return null}function Va(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function pV(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function WQ(o){var c=pV(o)?"checked":"value",h=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),f=""+o[c];if(!o.hasOwnProperty(c)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,S=h.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return g.call(this)},set:function(I){f=""+I,S.call(this,I)}}),Object.defineProperty(o,c,{enumerable:h.enumerable}),{getValue:function(){return f},setValue:function(I){f=""+I},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function gm(o){o._valueTracker||(o._valueTracker=WQ(o))}function fV(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var h=c.getValue(),f="";return o&&(f=pV(o)?o.checked?"true":"false":o.value),o=f,o!==h?(c.setValue(o),!0):!1}function qm(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function Uy(o,c){var h=c.checked;return On({},c,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??o._wrapperState.initialChecked})}function VU(o,c){var h=c.defaultValue==null?"":c.defaultValue,f=c.checked!=null?c.checked:c.defaultChecked;h=Va(c.value!=null?c.value:h),o._wrapperState={initialChecked:f,initialValue:h,controlled:c.type==="checkbox"||c.type==="radio"?c.checked!=null:c.value!=null}}function _V(o,c){c=c.checked,c!=null&&DC(o,"checked",c,!1)}function xy(o,c){_V(o,c);var h=Va(c.value),f=c.type;if(h!=null)f==="number"?(h===0&&o.value===""||o.value!=h)&&(o.value=""+h):o.value!==""+h&&(o.value=""+h);else if(f==="submit"||f==="reset"){o.removeAttribute("value");return}c.hasOwnProperty("value")?Vy(o,c.type,h):c.hasOwnProperty("defaultValue")&&Vy(o,c.type,Va(c.defaultValue)),c.checked==null&&c.defaultChecked!=null&&(o.defaultChecked=!!c.defaultChecked)}function FU(o,c,h){if(c.hasOwnProperty("value")||c.hasOwnProperty("defaultValue")){var f=c.type;if(!(f!=="submit"&&f!=="reset"||c.value!==void 0&&c.value!==null))return;c=""+o._wrapperState.initialValue,h||c===o.value||(o.value=c),o.defaultValue=c}h=o.name,h!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,h!==""&&(o.name=h)}function Vy(o,c,h){(c!=="number"||qm(o.ownerDocument)!==o)&&(h==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+h&&(o.defaultValue=""+h))}var Oh=Array.isArray;function wl(o,c,h,f){if(o=o.options,c){c={};for(var g=0;g<h.length;g++)c["$"+h[g]]=!0;for(h=0;h<o.length;h++)g=c.hasOwnProperty("$"+o[h].value),o[h].selected!==g&&(o[h].selected=g),g&&f&&(o[h].defaultSelected=!0)}else{for(h=""+Va(h),c=null,g=0;g<o.length;g++){if(o[g].value===h){o[g].selected=!0,f&&(o[g].defaultSelected=!0);return}c!==null||o[g].disabled||(c=o[g])}c!==null&&(c.selected=!0)}}function Fy(o,c){if(c.dangerouslySetInnerHTML!=null)throw Error(ve(91));return On({},c,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function BU(o,c){var h=c.value;if(h==null){if(h=c.children,c=c.defaultValue,h!=null){if(c!=null)throw Error(ve(92));if(Oh(h)){if(1<h.length)throw Error(ve(93));h=h[0]}c=h}c==null&&(c=""),h=c}o._wrapperState={initialValue:Va(h)}}function mV(o,c){var h=Va(c.value),f=Va(c.defaultValue);h!=null&&(h=""+h,h!==o.value&&(o.value=h),c.defaultValue==null&&o.defaultValue!==h&&(o.defaultValue=h)),f!=null&&(o.defaultValue=""+f)}function jU(o){var c=o.textContent;c===o._wrapperState.initialValue&&c!==""&&c!==null&&(o.value=c)}function EV(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function By(o,c){return o==null||o==="http://www.w3.org/1999/xhtml"?EV(c):o==="http://www.w3.org/2000/svg"&&c==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var Sm,gV=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(c,h,f,g){MSApp.execUnsafeLocalFunction(function(){return o(c,h,f,g)})}:o}(function(o,c){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=c;else{for(Sm=Sm||document.createElement("div"),Sm.innerHTML="<svg>"+c.valueOf().toString()+"</svg>",c=Sm.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;c.firstChild;)o.appendChild(c.firstChild)}});function Wh(o,c){if(c){var h=o.firstChild;if(h&&h===o.lastChild&&h.nodeType===3){h.nodeValue=c;return}}o.textContent=c}var kh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},HQ=["Webkit","ms","Moz","O"];Object.keys(kh).forEach(function(o){HQ.forEach(function(c){c=c+o.charAt(0).toUpperCase()+o.substring(1),kh[c]=kh[o]})});function SV(o,c,h){return c==null||typeof c=="boolean"||c===""?"":h||typeof c!="number"||c===0||kh.hasOwnProperty(o)&&kh[o]?(""+c).trim():c+"px"}function TV(o,c){o=o.style;for(var h in c)if(c.hasOwnProperty(h)){var f=h.indexOf("--")===0,g=SV(h,c[h],f);h==="float"&&(h="cssFloat"),f?o.setProperty(h,g):o[h]=g}}var KQ=On({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function jy(o,c){if(c){if(KQ[o]&&(c.children!=null||c.dangerouslySetInnerHTML!=null))throw Error(ve(137,o));if(c.dangerouslySetInnerHTML!=null){if(c.children!=null)throw Error(ve(60));if(typeof c.dangerouslySetInnerHTML!="object"||!("__html"in c.dangerouslySetInnerHTML))throw Error(ve(61))}if(c.style!=null&&typeof c.style!="object")throw Error(ve(62))}}function Gy(o,c){if(o.indexOf("-")===-1)return typeof c.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wy=null;function MC(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Hy=null,Al=null,bl=null;function GU(o){if(o=dp(o)){if(typeof Hy!="function")throw Error(ve(280));var c=o.stateNode;c&&(c=CE(c),Hy(o.stateNode,o.type,c))}}function vV(o){Al?bl?bl.push(o):bl=[o]:Al=o}function RV(){if(Al){var o=Al,c=bl;if(bl=Al=null,GU(o),c)for(o=0;o<c.length;o++)GU(c[o])}}function yV(o,c){return o(c)}function CV(){}var oy=!1;function IV(o,c,h){if(oy)return o(c,h);oy=!0;try{return yV(o,c,h)}finally{oy=!1,(Al!==null||bl!==null)&&(CV(),RV())}}function Hh(o,c){var h=o.stateNode;if(h===null)return null;var f=CE(h);if(f===null)return null;h=f[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(o=o.type,f=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!f;break e;default:o=!1}if(o)return null;if(h&&typeof h!="function")throw Error(ve(231,c,typeof h));return h}var Ky=!1;if(Ps)try{var Th={};Object.defineProperty(Th,"passive",{get:function(){Ky=!0}}),window.addEventListener("test",Th,Th),window.removeEventListener("test",Th,Th)}catch{Ky=!1}function zQ(o,c,h,f,g,S,I,L,M){var F=Array.prototype.slice.call(arguments,3);try{c.apply(h,F)}catch(X){this.onError(X)}}var Lh=!1,Xm=null,Jm=!1,zy=null,YQ={onError:function(o){Lh=!0,Xm=o}};function qQ(o,c,h,f,g,S,I,L,M){Lh=!1,Xm=null,zQ.apply(YQ,arguments)}function XQ(o,c,h,f,g,S,I,L,M){if(qQ.apply(this,arguments),Lh){if(Lh){var F=Xm;Lh=!1,Xm=null}else throw Error(ve(198));Jm||(Jm=!0,zy=F)}}function Kc(o){var c=o,h=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,c.flags&4098&&(h=c.return),o=c.return;while(o)}return c.tag===3?h:null}function wV(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function WU(o){if(Kc(o)!==o)throw Error(ve(188))}function JQ(o){var c=o.alternate;if(!c){if(c=Kc(o),c===null)throw Error(ve(188));return c!==o?null:o}for(var h=o,f=c;;){var g=h.return;if(g===null)break;var S=g.alternate;if(S===null){if(f=g.return,f!==null){h=f;continue}break}if(g.child===S.child){for(S=g.child;S;){if(S===h)return WU(g),o;if(S===f)return WU(g),c;S=S.sibling}throw Error(ve(188))}if(h.return!==f.return)h=g,f=S;else{for(var I=!1,L=g.child;L;){if(L===h){I=!0,h=g,f=S;break}if(L===f){I=!0,f=g,h=S;break}L=L.sibling}if(!I){for(L=S.child;L;){if(L===h){I=!0,h=S,f=g;break}if(L===f){I=!0,f=S,h=g;break}L=L.sibling}if(!I)throw Error(ve(189))}}if(h.alternate!==f)throw Error(ve(190))}if(h.tag!==3)throw Error(ve(188));return h.stateNode.current===h?o:c}function AV(o){return o=JQ(o),o!==null?bV(o):null}function bV(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var c=bV(o);if(c!==null)return c;o=o.sibling}return null}var OV=wi.unstable_scheduleCallback,HU=wi.unstable_cancelCallback,QQ=wi.unstable_shouldYield,ZQ=wi.unstable_requestPaint,Wn=wi.unstable_now,$Q=wi.unstable_getCurrentPriorityLevel,UC=wi.unstable_ImmediatePriority,NV=wi.unstable_UserBlockingPriority,Qm=wi.unstable_NormalPriority,eZ=wi.unstable_LowPriority,DV=wi.unstable_IdlePriority,TE=null,os=null;function tZ(o){if(os&&typeof os.onCommitFiberRoot=="function")try{os.onCommitFiberRoot(TE,o,void 0,(o.current.flags&128)===128)}catch{}}var No=Math.clz32?Math.clz32:iZ,nZ=Math.log,rZ=Math.LN2;function iZ(o){return o>>>=0,o===0?32:31-(nZ(o)/rZ|0)|0}var Tm=64,vm=4194304;function Nh(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function Zm(o,c){var h=o.pendingLanes;if(h===0)return 0;var f=0,g=o.suspendedLanes,S=o.pingedLanes,I=h&268435455;if(I!==0){var L=I&~g;L!==0?f=Nh(L):(S&=I,S!==0&&(f=Nh(S)))}else I=h&~g,I!==0?f=Nh(I):S!==0&&(f=Nh(S));if(f===0)return 0;if(c!==0&&c!==f&&!(c&g)&&(g=f&-f,S=c&-c,g>=S||g===16&&(S&4194240)!==0))return c;if(f&4&&(f|=h&16),c=o.entangledLanes,c!==0)for(o=o.entanglements,c&=f;0<c;)h=31-No(c),g=1<<h,f|=o[h],c&=~g;return f}function oZ(o,c){switch(o){case 1:case 2:case 4:return c+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sZ(o,c){for(var h=o.suspendedLanes,f=o.pingedLanes,g=o.expirationTimes,S=o.pendingLanes;0<S;){var I=31-No(S),L=1<<I,M=g[I];M===-1?(!(L&h)||L&f)&&(g[I]=oZ(L,c)):M<=c&&(o.expiredLanes|=L),S&=~L}}function Yy(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function PV(){var o=Tm;return Tm<<=1,!(Tm&4194240)&&(Tm=64),o}function sy(o){for(var c=[],h=0;31>h;h++)c.push(o);return c}function ap(o,c,h){o.pendingLanes|=c,c!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,c=31-No(c),o[c]=h}function aZ(o,c){var h=o.pendingLanes&~c;o.pendingLanes=c,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=c,o.mutableReadLanes&=c,o.entangledLanes&=c,c=o.entanglements;var f=o.eventTimes;for(o=o.expirationTimes;0<h;){var g=31-No(h),S=1<<g;c[g]=0,f[g]=-1,o[g]=-1,h&=~S}}function xC(o,c){var h=o.entangledLanes|=c;for(o=o.entanglements;h;){var f=31-No(h),g=1<<f;g&c|o[f]&c&&(o[f]|=c),h&=~g}}var Jt=0;function kV(o){return o&=-o,1<o?4<o?o&268435455?16:536870912:4:1}var LV,VC,MV,UV,xV,qy=!1,Rm=[],Na=null,Da=null,Pa=null,Kh=new Map,zh=new Map,wa=[],cZ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function KU(o,c){switch(o){case"focusin":case"focusout":Na=null;break;case"dragenter":case"dragleave":Da=null;break;case"mouseover":case"mouseout":Pa=null;break;case"pointerover":case"pointerout":Kh.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":zh.delete(c.pointerId)}}function vh(o,c,h,f,g,S){return o===null||o.nativeEvent!==S?(o={blockedOn:c,domEventName:h,eventSystemFlags:f,nativeEvent:S,targetContainers:[g]},c!==null&&(c=dp(c),c!==null&&VC(c)),o):(o.eventSystemFlags|=f,c=o.targetContainers,g!==null&&c.indexOf(g)===-1&&c.push(g),o)}function dZ(o,c,h,f,g){switch(c){case"focusin":return Na=vh(Na,o,c,h,f,g),!0;case"dragenter":return Da=vh(Da,o,c,h,f,g),!0;case"mouseover":return Pa=vh(Pa,o,c,h,f,g),!0;case"pointerover":var S=g.pointerId;return Kh.set(S,vh(Kh.get(S)||null,o,c,h,f,g)),!0;case"gotpointercapture":return S=g.pointerId,zh.set(S,vh(zh.get(S)||null,o,c,h,f,g)),!0}return!1}function VV(o){var c=Lc(o.target);if(c!==null){var h=Kc(c);if(h!==null){if(c=h.tag,c===13){if(c=wV(h),c!==null){o.blockedOn=c,xV(o.priority,function(){MV(h)});return}}else if(c===3&&h.stateNode.current.memoizedState.isDehydrated){o.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Um(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var h=Xy(o.domEventName,o.eventSystemFlags,c[0],o.nativeEvent);if(h===null){h=o.nativeEvent;var f=new h.constructor(h.type,h);Wy=f,h.target.dispatchEvent(f),Wy=null}else return c=dp(h),c!==null&&VC(c),o.blockedOn=h,!1;c.shift()}return!0}function zU(o,c,h){Um(o)&&h.delete(c)}function lZ(){qy=!1,Na!==null&&Um(Na)&&(Na=null),Da!==null&&Um(Da)&&(Da=null),Pa!==null&&Um(Pa)&&(Pa=null),Kh.forEach(zU),zh.forEach(zU)}function Rh(o,c){o.blockedOn===c&&(o.blockedOn=null,qy||(qy=!0,wi.unstable_scheduleCallback(wi.unstable_NormalPriority,lZ)))}function Yh(o){function c(g){return Rh(g,o)}if(0<Rm.length){Rh(Rm[0],o);for(var h=1;h<Rm.length;h++){var f=Rm[h];f.blockedOn===o&&(f.blockedOn=null)}}for(Na!==null&&Rh(Na,o),Da!==null&&Rh(Da,o),Pa!==null&&Rh(Pa,o),Kh.forEach(c),zh.forEach(c),h=0;h<wa.length;h++)f=wa[h],f.blockedOn===o&&(f.blockedOn=null);for(;0<wa.length&&(h=wa[0],h.blockedOn===null);)VV(h),h.blockedOn===null&&wa.shift()}var Ol=xs.ReactCurrentBatchConfig,$m=!0;function uZ(o,c,h,f){var g=Jt,S=Ol.transition;Ol.transition=null;try{Jt=1,FC(o,c,h,f)}finally{Jt=g,Ol.transition=S}}function hZ(o,c,h,f){var g=Jt,S=Ol.transition;Ol.transition=null;try{Jt=4,FC(o,c,h,f)}finally{Jt=g,Ol.transition=S}}function FC(o,c,h,f){if($m){var g=Xy(o,c,h,f);if(g===null)my(o,c,f,eE,h),KU(o,f);else if(dZ(g,o,c,h,f))f.stopPropagation();else if(KU(o,f),c&4&&-1<cZ.indexOf(o)){for(;g!==null;){var S=dp(g);if(S!==null&&LV(S),S=Xy(o,c,h,f),S===null&&my(o,c,f,eE,h),S===g)break;g=S}g!==null&&f.stopPropagation()}else my(o,c,f,null,h)}}var eE=null;function Xy(o,c,h,f){if(eE=null,o=MC(f),o=Lc(o),o!==null)if(c=Kc(o),c===null)o=null;else if(h=c.tag,h===13){if(o=wV(c),o!==null)return o;o=null}else if(h===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null);return eE=o,null}function FV(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($Q()){case UC:return 1;case NV:return 4;case Qm:case eZ:return 16;case DV:return 536870912;default:return 16}default:return 16}}var ba=null,BC=null,xm=null;function BV(){if(xm)return xm;var o,c=BC,h=c.length,f,g="value"in ba?ba.value:ba.textContent,S=g.length;for(o=0;o<h&&c[o]===g[o];o++);var I=h-o;for(f=1;f<=I&&c[h-f]===g[S-f];f++);return xm=g.slice(o,1<f?1-f:void 0)}function Vm(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function ym(){return!0}function YU(){return!1}function bi(o){function c(h,f,g,S,I){this._reactName=h,this._targetInst=g,this.type=f,this.nativeEvent=S,this.target=I,this.currentTarget=null;for(var L in o)o.hasOwnProperty(L)&&(h=o[L],this[L]=h?h(S):S[L]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?ym:YU,this.isPropagationStopped=YU,this}return On(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ym)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ym)},persist:function(){},isPersistent:ym}),c}var Bl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jC=bi(Bl),cp=On({},Bl,{view:0,detail:0}),pZ=bi(cp),ay,cy,yh,vE=On({},cp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:GC,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==yh&&(yh&&o.type==="mousemove"?(ay=o.screenX-yh.screenX,cy=o.screenY-yh.screenY):cy=ay=0,yh=o),ay)},movementY:function(o){return"movementY"in o?o.movementY:cy}}),qU=bi(vE),fZ=On({},vE,{dataTransfer:0}),_Z=bi(fZ),mZ=On({},cp,{relatedTarget:0}),dy=bi(mZ),EZ=On({},Bl,{animationName:0,elapsedTime:0,pseudoElement:0}),gZ=bi(EZ),SZ=On({},Bl,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),TZ=bi(SZ),vZ=On({},Bl,{data:0}),XU=bi(vZ),RZ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yZ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CZ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IZ(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=CZ[o])?!!c[o]:!1}function GC(){return IZ}var wZ=On({},cp,{key:function(o){if(o.key){var c=RZ[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=Vm(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?yZ[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:GC,charCode:function(o){return o.type==="keypress"?Vm(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Vm(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),AZ=bi(wZ),bZ=On({},vE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),JU=bi(bZ),OZ=On({},cp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:GC}),NZ=bi(OZ),DZ=On({},Bl,{propertyName:0,elapsedTime:0,pseudoElement:0}),PZ=bi(DZ),kZ=On({},vE,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),LZ=bi(kZ),MZ=[9,13,27,32],WC=Ps&&"CompositionEvent"in window,Mh=null;Ps&&"documentMode"in document&&(Mh=document.documentMode);var UZ=Ps&&"TextEvent"in window&&!Mh,jV=Ps&&(!WC||Mh&&8<Mh&&11>=Mh),QU=String.fromCharCode(32),ZU=!1;function GV(o,c){switch(o){case"keyup":return MZ.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function WV(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var ml=!1;function xZ(o,c){switch(o){case"compositionend":return WV(c);case"keypress":return c.which!==32?null:(ZU=!0,QU);case"textInput":return o=c.data,o===QU&&ZU?null:o;default:return null}}function VZ(o,c){if(ml)return o==="compositionend"||!WC&&GV(o,c)?(o=BV(),xm=BC=ba=null,ml=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return jV&&c.locale!=="ko"?null:c.data;default:return null}}var FZ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $U(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!FZ[o.type]:c==="textarea"}function HV(o,c,h,f){vV(f),c=tE(c,"onChange"),0<c.length&&(h=new jC("onChange","change",null,h,f),o.push({event:h,listeners:c}))}var Uh=null,qh=null;function BZ(o){tF(o,0)}function RE(o){var c=Sl(o);if(fV(c))return o}function jZ(o,c){if(o==="change")return c}var KV=!1;if(Ps){var ly;if(Ps){var uy="oninput"in document;if(!uy){var ex=document.createElement("div");ex.setAttribute("oninput","return;"),uy=typeof ex.oninput=="function"}ly=uy}else ly=!1;KV=ly&&(!document.documentMode||9<document.documentMode)}function tx(){Uh&&(Uh.detachEvent("onpropertychange",zV),qh=Uh=null)}function zV(o){if(o.propertyName==="value"&&RE(qh)){var c=[];HV(c,qh,o,MC(o)),IV(BZ,c)}}function GZ(o,c,h){o==="focusin"?(tx(),Uh=c,qh=h,Uh.attachEvent("onpropertychange",zV)):o==="focusout"&&tx()}function WZ(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return RE(qh)}function HZ(o,c){if(o==="click")return RE(c)}function KZ(o,c){if(o==="input"||o==="change")return RE(c)}function zZ(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var Po=typeof Object.is=="function"?Object.is:zZ;function Xh(o,c){if(Po(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var h=Object.keys(o),f=Object.keys(c);if(h.length!==f.length)return!1;for(f=0;f<h.length;f++){var g=h[f];if(!Dy.call(c,g)||!Po(o[g],c[g]))return!1}return!0}function nx(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function rx(o,c){var h=nx(o);o=0;for(var f;h;){if(h.nodeType===3){if(f=o+h.textContent.length,o<=c&&f>=c)return{node:h,offset:c-o};o=f}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=nx(h)}}function YV(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?YV(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function qV(){for(var o=window,c=qm();c instanceof o.HTMLIFrameElement;){try{var h=typeof c.contentWindow.location.href=="string"}catch{h=!1}if(h)o=c.contentWindow;else break;c=qm(o.document)}return c}function HC(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}function YZ(o){var c=qV(),h=o.focusedElem,f=o.selectionRange;if(c!==h&&h&&h.ownerDocument&&YV(h.ownerDocument.documentElement,h)){if(f!==null&&HC(h)){if(c=f.start,o=f.end,o===void 0&&(o=c),"selectionStart"in h)h.selectionStart=c,h.selectionEnd=Math.min(o,h.value.length);else if(o=(c=h.ownerDocument||document)&&c.defaultView||window,o.getSelection){o=o.getSelection();var g=h.textContent.length,S=Math.min(f.start,g);f=f.end===void 0?S:Math.min(f.end,g),!o.extend&&S>f&&(g=f,f=S,S=g),g=rx(h,S);var I=rx(h,f);g&&I&&(o.rangeCount!==1||o.anchorNode!==g.node||o.anchorOffset!==g.offset||o.focusNode!==I.node||o.focusOffset!==I.offset)&&(c=c.createRange(),c.setStart(g.node,g.offset),o.removeAllRanges(),S>f?(o.addRange(c),o.extend(I.node,I.offset)):(c.setEnd(I.node,I.offset),o.addRange(c)))}}for(c=[],o=h;o=o.parentNode;)o.nodeType===1&&c.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<c.length;h++)o=c[h],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var qZ=Ps&&"documentMode"in document&&11>=document.documentMode,El=null,Jy=null,xh=null,Qy=!1;function ix(o,c,h){var f=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Qy||El==null||El!==qm(f)||(f=El,"selectionStart"in f&&HC(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),xh&&Xh(xh,f)||(xh=f,f=tE(Jy,"onSelect"),0<f.length&&(c=new jC("onSelect","select",null,c,h),o.push({event:c,listeners:f}),c.target=El)))}function Cm(o,c){var h={};return h[o.toLowerCase()]=c.toLowerCase(),h["Webkit"+o]="webkit"+c,h["Moz"+o]="moz"+c,h}var gl={animationend:Cm("Animation","AnimationEnd"),animationiteration:Cm("Animation","AnimationIteration"),animationstart:Cm("Animation","AnimationStart"),transitionend:Cm("Transition","TransitionEnd")},hy={},XV={};Ps&&(XV=document.createElement("div").style,"AnimationEvent"in window||(delete gl.animationend.animation,delete gl.animationiteration.animation,delete gl.animationstart.animation),"TransitionEvent"in window||delete gl.transitionend.transition);function yE(o){if(hy[o])return hy[o];if(!gl[o])return o;var c=gl[o],h;for(h in c)if(c.hasOwnProperty(h)&&h in XV)return hy[o]=c[h];return o}var JV=yE("animationend"),QV=yE("animationiteration"),ZV=yE("animationstart"),$V=yE("transitionend"),eF=new Map,ox="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ba(o,c){eF.set(o,c),Hc(c,[o])}for(var py=0;py<ox.length;py++){var fy=ox[py],XZ=fy.toLowerCase(),JZ=fy[0].toUpperCase()+fy.slice(1);Ba(XZ,"on"+JZ)}Ba(JV,"onAnimationEnd");Ba(QV,"onAnimationIteration");Ba(ZV,"onAnimationStart");Ba("dblclick","onDoubleClick");Ba("focusin","onFocus");Ba("focusout","onBlur");Ba($V,"onTransitionEnd");Pl("onMouseEnter",["mouseout","mouseover"]);Pl("onMouseLeave",["mouseout","mouseover"]);Pl("onPointerEnter",["pointerout","pointerover"]);Pl("onPointerLeave",["pointerout","pointerover"]);Hc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QZ=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dh));function sx(o,c,h){var f=o.type||"unknown-event";o.currentTarget=h,XQ(f,c,void 0,o),o.currentTarget=null}function tF(o,c){c=(c&4)!==0;for(var h=0;h<o.length;h++){var f=o[h],g=f.event;f=f.listeners;e:{var S=void 0;if(c)for(var I=f.length-1;0<=I;I--){var L=f[I],M=L.instance,F=L.currentTarget;if(L=L.listener,M!==S&&g.isPropagationStopped())break e;sx(g,L,F),S=M}else for(I=0;I<f.length;I++){if(L=f[I],M=L.instance,F=L.currentTarget,L=L.listener,M!==S&&g.isPropagationStopped())break e;sx(g,L,F),S=M}}}if(Jm)throw o=zy,Jm=!1,zy=null,o}function fn(o,c){var h=c[nC];h===void 0&&(h=c[nC]=new Set);var f=o+"__bubble";h.has(f)||(nF(c,o,2,!1),h.add(f))}function _y(o,c,h){var f=0;c&&(f|=4),nF(h,o,f,c)}var Im="_reactListening"+Math.random().toString(36).slice(2);function Jh(o){if(!o[Im]){o[Im]=!0,dV.forEach(function(h){h!=="selectionchange"&&(QZ.has(h)||_y(h,!1,o),_y(h,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[Im]||(c[Im]=!0,_y("selectionchange",!1,c))}}function nF(o,c,h,f){switch(FV(c)){case 1:var g=uZ;break;case 4:g=hZ;break;default:g=FC}h=g.bind(null,c,h,o),g=void 0,!Ky||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(g=!0),f?g!==void 0?o.addEventListener(c,h,{capture:!0,passive:g}):o.addEventListener(c,h,!0):g!==void 0?o.addEventListener(c,h,{passive:g}):o.addEventListener(c,h,!1)}function my(o,c,h,f,g){var S=f;if(!(c&1)&&!(c&2)&&f!==null)e:for(;;){if(f===null)return;var I=f.tag;if(I===3||I===4){var L=f.stateNode.containerInfo;if(L===g||L.nodeType===8&&L.parentNode===g)break;if(I===4)for(I=f.return;I!==null;){var M=I.tag;if((M===3||M===4)&&(M=I.stateNode.containerInfo,M===g||M.nodeType===8&&M.parentNode===g))return;I=I.return}for(;L!==null;){if(I=Lc(L),I===null)return;if(M=I.tag,M===5||M===6){f=S=I;continue e}L=L.parentNode}}f=f.return}IV(function(){var F=S,X=MC(h),H=[];e:{var J=eF.get(o);if(J!==void 0){var ce=jC,se=o;switch(o){case"keypress":if(Vm(h)===0)break e;case"keydown":case"keyup":ce=AZ;break;case"focusin":se="focus",ce=dy;break;case"focusout":se="blur",ce=dy;break;case"beforeblur":case"afterblur":ce=dy;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ce=qU;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ce=_Z;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ce=NZ;break;case JV:case QV:case ZV:ce=gZ;break;case $V:ce=PZ;break;case"scroll":ce=pZ;break;case"wheel":ce=LZ;break;case"copy":case"cut":case"paste":ce=TZ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ce=JU}var pe=(c&4)!==0,we=!pe&&o==="scroll",z=pe?J!==null?J+"Capture":null:J;pe=[];for(var W=F,K;W!==null;){K=W;var Ee=K.stateNode;if(K.tag===5&&Ee!==null&&(K=Ee,z!==null&&(Ee=Hh(W,z),Ee!=null&&pe.push(Qh(W,Ee,K)))),we)break;W=W.return}0<pe.length&&(J=new ce(J,se,null,h,X),H.push({event:J,listeners:pe}))}}if(!(c&7)){e:{if(J=o==="mouseover"||o==="pointerover",ce=o==="mouseout"||o==="pointerout",J&&h!==Wy&&(se=h.relatedTarget||h.fromElement)&&(Lc(se)||se[ks]))break e;if((ce||J)&&(J=X.window===X?X:(J=X.ownerDocument)?J.defaultView||J.parentWindow:window,ce?(se=h.relatedTarget||h.toElement,ce=F,se=se?Lc(se):null,se!==null&&(we=Kc(se),se!==we||se.tag!==5&&se.tag!==6)&&(se=null)):(ce=null,se=F),ce!==se)){if(pe=qU,Ee="onMouseLeave",z="onMouseEnter",W="mouse",(o==="pointerout"||o==="pointerover")&&(pe=JU,Ee="onPointerLeave",z="onPointerEnter",W="pointer"),we=ce==null?J:Sl(ce),K=se==null?J:Sl(se),J=new pe(Ee,W+"leave",ce,h,X),J.target=we,J.relatedTarget=K,Ee=null,Lc(X)===F&&(pe=new pe(z,W+"enter",se,h,X),pe.target=K,pe.relatedTarget=we,Ee=pe),we=Ee,ce&&se)t:{for(pe=ce,z=se,W=0,K=pe;K;K=hl(K))W++;for(K=0,Ee=z;Ee;Ee=hl(Ee))K++;for(;0<W-K;)pe=hl(pe),W--;for(;0<K-W;)z=hl(z),K--;for(;W--;){if(pe===z||z!==null&&pe===z.alternate)break t;pe=hl(pe),z=hl(z)}pe=null}else pe=null;ce!==null&&ax(H,J,ce,pe,!1),se!==null&&we!==null&&ax(H,we,se,pe,!0)}}e:{if(J=F?Sl(F):window,ce=J.nodeName&&J.nodeName.toLowerCase(),ce==="select"||ce==="input"&&J.type==="file")var Ie=jZ;else if($U(J))if(KV)Ie=KZ;else{Ie=WZ;var Le=GZ}else(ce=J.nodeName)&&ce.toLowerCase()==="input"&&(J.type==="checkbox"||J.type==="radio")&&(Ie=HZ);if(Ie&&(Ie=Ie(o,F))){HV(H,Ie,h,X);break e}Le&&Le(o,J,F),o==="focusout"&&(Le=J._wrapperState)&&Le.controlled&&J.type==="number"&&Vy(J,"number",J.value)}switch(Le=F?Sl(F):window,o){case"focusin":($U(Le)||Le.contentEditable==="true")&&(El=Le,Jy=F,xh=null);break;case"focusout":xh=Jy=El=null;break;case"mousedown":Qy=!0;break;case"contextmenu":case"mouseup":case"dragend":Qy=!1,ix(H,h,X);break;case"selectionchange":if(qZ)break;case"keydown":case"keyup":ix(H,h,X)}var be;if(WC)e:{switch(o){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else ml?GV(o,h)&&(je="onCompositionEnd"):o==="keydown"&&h.keyCode===229&&(je="onCompositionStart");je&&(jV&&h.locale!=="ko"&&(ml||je!=="onCompositionStart"?je==="onCompositionEnd"&&ml&&(be=BV()):(ba=X,BC="value"in ba?ba.value:ba.textContent,ml=!0)),Le=tE(F,je),0<Le.length&&(je=new XU(je,o,null,h,X),H.push({event:je,listeners:Le}),be?je.data=be:(be=WV(h),be!==null&&(je.data=be)))),(be=UZ?xZ(o,h):VZ(o,h))&&(F=tE(F,"onBeforeInput"),0<F.length&&(X=new XU("onBeforeInput","beforeinput",null,h,X),H.push({event:X,listeners:F}),X.data=be))}tF(H,c)})}function Qh(o,c,h){return{instance:o,listener:c,currentTarget:h}}function tE(o,c){for(var h=c+"Capture",f=[];o!==null;){var g=o,S=g.stateNode;g.tag===5&&S!==null&&(g=S,S=Hh(o,h),S!=null&&f.unshift(Qh(o,S,g)),S=Hh(o,c),S!=null&&f.push(Qh(o,S,g))),o=o.return}return f}function hl(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function ax(o,c,h,f,g){for(var S=c._reactName,I=[];h!==null&&h!==f;){var L=h,M=L.alternate,F=L.stateNode;if(M!==null&&M===f)break;L.tag===5&&F!==null&&(L=F,g?(M=Hh(h,S),M!=null&&I.unshift(Qh(h,M,L))):g||(M=Hh(h,S),M!=null&&I.push(Qh(h,M,L)))),h=h.return}I.length!==0&&o.push({event:c,listeners:I})}var ZZ=/\r\n?/g,$Z=/\u0000|\uFFFD/g;function cx(o){return(typeof o=="string"?o:""+o).replace(ZZ,`
`).replace($Z,"")}function wm(o,c,h){if(c=cx(c),cx(o)!==c&&h)throw Error(ve(425))}function nE(){}var Zy=null,$y=null;function eC(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var tC=typeof setTimeout=="function"?setTimeout:void 0,e$=typeof clearTimeout=="function"?clearTimeout:void 0,dx=typeof Promise=="function"?Promise:void 0,t$=typeof queueMicrotask=="function"?queueMicrotask:typeof dx<"u"?function(o){return dx.resolve(null).then(o).catch(n$)}:tC;function n$(o){setTimeout(function(){throw o})}function Ey(o,c){var h=c,f=0;do{var g=h.nextSibling;if(o.removeChild(h),g&&g.nodeType===8)if(h=g.data,h==="/$"){if(f===0){o.removeChild(g),Yh(c);return}f--}else h!=="$"&&h!=="$?"&&h!=="$!"||f++;h=g}while(h);Yh(c)}function ka(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?")break;if(c==="/$")return null}}return o}function lx(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var h=o.data;if(h==="$"||h==="$!"||h==="$?"){if(c===0)return o;c--}else h==="/$"&&c++}o=o.previousSibling}return null}var jl=Math.random().toString(36).slice(2),is="__reactFiber$"+jl,Zh="__reactProps$"+jl,ks="__reactContainer$"+jl,nC="__reactEvents$"+jl,r$="__reactListeners$"+jl,i$="__reactHandles$"+jl;function Lc(o){var c=o[is];if(c)return c;for(var h=o.parentNode;h;){if(c=h[ks]||h[is]){if(h=c.alternate,c.child!==null||h!==null&&h.child!==null)for(o=lx(o);o!==null;){if(h=o[is])return h;o=lx(o)}return c}o=h,h=o.parentNode}return null}function dp(o){return o=o[is]||o[ks],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Sl(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(ve(33))}function CE(o){return o[Zh]||null}var rC=[],Tl=-1;function ja(o){return{current:o}}function _n(o){0>Tl||(o.current=rC[Tl],rC[Tl]=null,Tl--)}function ln(o,c){Tl++,rC[Tl]=o.current,o.current=c}var Fa={},Pr=ja(Fa),si=ja(!1),Fc=Fa;function kl(o,c){var h=o.type.contextTypes;if(!h)return Fa;var f=o.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===c)return f.__reactInternalMemoizedMaskedChildContext;var g={},S;for(S in h)g[S]=c[S];return f&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=c,o.__reactInternalMemoizedMaskedChildContext=g),g}function ai(o){return o=o.childContextTypes,o!=null}function rE(){_n(si),_n(Pr)}function ux(o,c,h){if(Pr.current!==Fa)throw Error(ve(168));ln(Pr,c),ln(si,h)}function rF(o,c,h){var f=o.stateNode;if(c=c.childContextTypes,typeof f.getChildContext!="function")return h;f=f.getChildContext();for(var g in f)if(!(g in c))throw Error(ve(108,GQ(o)||"Unknown",g));return On({},h,f)}function iE(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Fa,Fc=Pr.current,ln(Pr,o),ln(si,si.current),!0}function hx(o,c,h){var f=o.stateNode;if(!f)throw Error(ve(169));h?(o=rF(o,c,Fc),f.__reactInternalMemoizedMergedChildContext=o,_n(si),_n(Pr),ln(Pr,o)):_n(si),ln(si,h)}var As=null,IE=!1,gy=!1;function iF(o){As===null?As=[o]:As.push(o)}function o$(o){IE=!0,iF(o)}function Ga(){if(!gy&&As!==null){gy=!0;var o=0,c=Jt;try{var h=As;for(Jt=1;o<h.length;o++){var f=h[o];do f=f(!0);while(f!==null)}As=null,IE=!1}catch(g){throw As!==null&&(As=As.slice(o+1)),OV(UC,Ga),g}finally{Jt=c,gy=!1}}return null}var vl=[],Rl=0,oE=null,sE=0,Zi=[],$i=0,Bc=null,bs=1,Os="";function Dc(o,c){vl[Rl++]=sE,vl[Rl++]=oE,oE=o,sE=c}function oF(o,c,h){Zi[$i++]=bs,Zi[$i++]=Os,Zi[$i++]=Bc,Bc=o;var f=bs;o=Os;var g=32-No(f)-1;f&=~(1<<g),h+=1;var S=32-No(c)+g;if(30<S){var I=g-g%5;S=(f&(1<<I)-1).toString(32),f>>=I,g-=I,bs=1<<32-No(c)+g|h<<g|f,Os=S+o}else bs=1<<S|h<<g|f,Os=o}function KC(o){o.return!==null&&(Dc(o,1),oF(o,1,0))}function zC(o){for(;o===oE;)oE=vl[--Rl],vl[Rl]=null,sE=vl[--Rl],vl[Rl]=null;for(;o===Bc;)Bc=Zi[--$i],Zi[$i]=null,Os=Zi[--$i],Zi[$i]=null,bs=Zi[--$i],Zi[$i]=null}var Ii=null,Ci=null,Sn=!1,Oo=null;function sF(o,c){var h=eo(5,null,null,0);h.elementType="DELETED",h.stateNode=c,h.return=o,c=o.deletions,c===null?(o.deletions=[h],o.flags|=16):c.push(h)}function px(o,c){switch(o.tag){case 5:var h=o.type;return c=c.nodeType!==1||h.toLowerCase()!==c.nodeName.toLowerCase()?null:c,c!==null?(o.stateNode=c,Ii=o,Ci=ka(c.firstChild),!0):!1;case 6:return c=o.pendingProps===""||c.nodeType!==3?null:c,c!==null?(o.stateNode=c,Ii=o,Ci=null,!0):!1;case 13:return c=c.nodeType!==8?null:c,c!==null?(h=Bc!==null?{id:bs,overflow:Os}:null,o.memoizedState={dehydrated:c,treeContext:h,retryLane:1073741824},h=eo(18,null,null,0),h.stateNode=c,h.return=o,o.child=h,Ii=o,Ci=null,!0):!1;default:return!1}}function iC(o){return(o.mode&1)!==0&&(o.flags&128)===0}function oC(o){if(Sn){var c=Ci;if(c){var h=c;if(!px(o,c)){if(iC(o))throw Error(ve(418));c=ka(h.nextSibling);var f=Ii;c&&px(o,c)?sF(f,h):(o.flags=o.flags&-4097|2,Sn=!1,Ii=o)}}else{if(iC(o))throw Error(ve(418));o.flags=o.flags&-4097|2,Sn=!1,Ii=o}}}function fx(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;Ii=o}function Am(o){if(o!==Ii)return!1;if(!Sn)return fx(o),Sn=!0,!1;var c;if((c=o.tag!==3)&&!(c=o.tag!==5)&&(c=o.type,c=c!=="head"&&c!=="body"&&!eC(o.type,o.memoizedProps)),c&&(c=Ci)){if(iC(o))throw aF(),Error(ve(418));for(;c;)sF(o,c),c=ka(c.nextSibling)}if(fx(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(ve(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8){var h=o.data;if(h==="/$"){if(c===0){Ci=ka(o.nextSibling);break e}c--}else h!=="$"&&h!=="$!"&&h!=="$?"||c++}o=o.nextSibling}Ci=null}}else Ci=Ii?ka(o.stateNode.nextSibling):null;return!0}function aF(){for(var o=Ci;o;)o=ka(o.nextSibling)}function Ll(){Ci=Ii=null,Sn=!1}function YC(o){Oo===null?Oo=[o]:Oo.push(o)}var s$=xs.ReactCurrentBatchConfig;function Ch(o,c,h){if(o=h.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(ve(309));var f=h.stateNode}if(!f)throw Error(ve(147,o));var g=f,S=""+o;return c!==null&&c.ref!==null&&typeof c.ref=="function"&&c.ref._stringRef===S?c.ref:(c=function(I){var L=g.refs;I===null?delete L[S]:L[S]=I},c._stringRef=S,c)}if(typeof o!="string")throw Error(ve(284));if(!h._owner)throw Error(ve(290,o))}return o}function bm(o,c){throw o=Object.prototype.toString.call(c),Error(ve(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o))}function _x(o){var c=o._init;return c(o._payload)}function cF(o){function c(z,W){if(o){var K=z.deletions;K===null?(z.deletions=[W],z.flags|=16):K.push(W)}}function h(z,W){if(!o)return null;for(;W!==null;)c(z,W),W=W.sibling;return null}function f(z,W){for(z=new Map;W!==null;)W.key!==null?z.set(W.key,W):z.set(W.index,W),W=W.sibling;return z}function g(z,W){return z=xa(z,W),z.index=0,z.sibling=null,z}function S(z,W,K){return z.index=K,o?(K=z.alternate,K!==null?(K=K.index,K<W?(z.flags|=2,W):K):(z.flags|=2,W)):(z.flags|=1048576,W)}function I(z){return o&&z.alternate===null&&(z.flags|=2),z}function L(z,W,K,Ee){return W===null||W.tag!==6?(W=Iy(K,z.mode,Ee),W.return=z,W):(W=g(W,K),W.return=z,W)}function M(z,W,K,Ee){var Ie=K.type;return Ie===_l?X(z,W,K.props.children,Ee,K.key):W!==null&&(W.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===Ca&&_x(Ie)===W.type)?(Ee=g(W,K.props),Ee.ref=Ch(z,W,K),Ee.return=z,Ee):(Ee=Km(K.type,K.key,K.props,null,z.mode,Ee),Ee.ref=Ch(z,W,K),Ee.return=z,Ee)}function F(z,W,K,Ee){return W===null||W.tag!==4||W.stateNode.containerInfo!==K.containerInfo||W.stateNode.implementation!==K.implementation?(W=wy(K,z.mode,Ee),W.return=z,W):(W=g(W,K.children||[]),W.return=z,W)}function X(z,W,K,Ee,Ie){return W===null||W.tag!==7?(W=Vc(K,z.mode,Ee,Ie),W.return=z,W):(W=g(W,K),W.return=z,W)}function H(z,W,K){if(typeof W=="string"&&W!==""||typeof W=="number")return W=Iy(""+W,z.mode,K),W.return=z,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case Em:return K=Km(W.type,W.key,W.props,null,z.mode,K),K.ref=Ch(z,null,W),K.return=z,K;case fl:return W=wy(W,z.mode,K),W.return=z,W;case Ca:var Ee=W._init;return H(z,Ee(W._payload),K)}if(Oh(W)||Sh(W))return W=Vc(W,z.mode,K,null),W.return=z,W;bm(z,W)}return null}function J(z,W,K,Ee){var Ie=W!==null?W.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return Ie!==null?null:L(z,W,""+K,Ee);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case Em:return K.key===Ie?M(z,W,K,Ee):null;case fl:return K.key===Ie?F(z,W,K,Ee):null;case Ca:return Ie=K._init,J(z,W,Ie(K._payload),Ee)}if(Oh(K)||Sh(K))return Ie!==null?null:X(z,W,K,Ee,null);bm(z,K)}return null}function ce(z,W,K,Ee,Ie){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return z=z.get(K)||null,L(W,z,""+Ee,Ie);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Em:return z=z.get(Ee.key===null?K:Ee.key)||null,M(W,z,Ee,Ie);case fl:return z=z.get(Ee.key===null?K:Ee.key)||null,F(W,z,Ee,Ie);case Ca:var Le=Ee._init;return ce(z,W,K,Le(Ee._payload),Ie)}if(Oh(Ee)||Sh(Ee))return z=z.get(K)||null,X(W,z,Ee,Ie,null);bm(W,Ee)}return null}function se(z,W,K,Ee){for(var Ie=null,Le=null,be=W,je=W=0,Bt=null;be!==null&&je<K.length;je++){be.index>je?(Bt=be,be=null):Bt=be.sibling;var ge=J(z,be,K[je],Ee);if(ge===null){be===null&&(be=Bt);break}o&&be&&ge.alternate===null&&c(z,be),W=S(ge,W,je),Le===null?Ie=ge:Le.sibling=ge,Le=ge,be=Bt}if(je===K.length)return h(z,be),Sn&&Dc(z,je),Ie;if(be===null){for(;je<K.length;je++)be=H(z,K[je],Ee),be!==null&&(W=S(be,W,je),Le===null?Ie=be:Le.sibling=be,Le=be);return Sn&&Dc(z,je),Ie}for(be=f(z,be);je<K.length;je++)Bt=ce(be,z,je,K[je],Ee),Bt!==null&&(o&&Bt.alternate!==null&&be.delete(Bt.key===null?je:Bt.key),W=S(Bt,W,je),Le===null?Ie=Bt:Le.sibling=Bt,Le=Bt);return o&&be.forEach(function(bt){return c(z,bt)}),Sn&&Dc(z,je),Ie}function pe(z,W,K,Ee){var Ie=Sh(K);if(typeof Ie!="function")throw Error(ve(150));if(K=Ie.call(K),K==null)throw Error(ve(151));for(var Le=Ie=null,be=W,je=W=0,Bt=null,ge=K.next();be!==null&&!ge.done;je++,ge=K.next()){be.index>je?(Bt=be,be=null):Bt=be.sibling;var bt=J(z,be,ge.value,Ee);if(bt===null){be===null&&(be=Bt);break}o&&be&&bt.alternate===null&&c(z,be),W=S(bt,W,je),Le===null?Ie=bt:Le.sibling=bt,Le=bt,be=Bt}if(ge.done)return h(z,be),Sn&&Dc(z,je),Ie;if(be===null){for(;!ge.done;je++,ge=K.next())ge=H(z,ge.value,Ee),ge!==null&&(W=S(ge,W,je),Le===null?Ie=ge:Le.sibling=ge,Le=ge);return Sn&&Dc(z,je),Ie}for(be=f(z,be);!ge.done;je++,ge=K.next())ge=ce(be,z,je,ge.value,Ee),ge!==null&&(o&&ge.alternate!==null&&be.delete(ge.key===null?je:ge.key),W=S(ge,W,je),Le===null?Ie=ge:Le.sibling=ge,Le=ge);return o&&be.forEach(function(ct){return c(z,ct)}),Sn&&Dc(z,je),Ie}function we(z,W,K,Ee){if(typeof K=="object"&&K!==null&&K.type===_l&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case Em:e:{for(var Ie=K.key,Le=W;Le!==null;){if(Le.key===Ie){if(Ie=K.type,Ie===_l){if(Le.tag===7){h(z,Le.sibling),W=g(Le,K.props.children),W.return=z,z=W;break e}}else if(Le.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===Ca&&_x(Ie)===Le.type){h(z,Le.sibling),W=g(Le,K.props),W.ref=Ch(z,Le,K),W.return=z,z=W;break e}h(z,Le);break}else c(z,Le);Le=Le.sibling}K.type===_l?(W=Vc(K.props.children,z.mode,Ee,K.key),W.return=z,z=W):(Ee=Km(K.type,K.key,K.props,null,z.mode,Ee),Ee.ref=Ch(z,W,K),Ee.return=z,z=Ee)}return I(z);case fl:e:{for(Le=K.key;W!==null;){if(W.key===Le)if(W.tag===4&&W.stateNode.containerInfo===K.containerInfo&&W.stateNode.implementation===K.implementation){h(z,W.sibling),W=g(W,K.children||[]),W.return=z,z=W;break e}else{h(z,W);break}else c(z,W);W=W.sibling}W=wy(K,z.mode,Ee),W.return=z,z=W}return I(z);case Ca:return Le=K._init,we(z,W,Le(K._payload),Ee)}if(Oh(K))return se(z,W,K,Ee);if(Sh(K))return pe(z,W,K,Ee);bm(z,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,W!==null&&W.tag===6?(h(z,W.sibling),W=g(W,K),W.return=z,z=W):(h(z,W),W=Iy(K,z.mode,Ee),W.return=z,z=W),I(z)):h(z,W)}return we}var Ml=cF(!0),dF=cF(!1),aE=ja(null),cE=null,yl=null,qC=null;function XC(){qC=yl=cE=null}function JC(o){var c=aE.current;_n(aE),o._currentValue=c}function sC(o,c,h){for(;o!==null;){var f=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,f!==null&&(f.childLanes|=c)):f!==null&&(f.childLanes&c)!==c&&(f.childLanes|=c),o===h)break;o=o.return}}function Nl(o,c){cE=o,qC=yl=null,o=o.dependencies,o!==null&&o.firstContext!==null&&(o.lanes&c&&(oi=!0),o.firstContext=null)}function no(o){var c=o._currentValue;if(qC!==o)if(o={context:o,memoizedValue:c,next:null},yl===null){if(cE===null)throw Error(ve(308));yl=o,cE.dependencies={lanes:0,firstContext:o}}else yl=yl.next=o;return c}var Mc=null;function QC(o){Mc===null?Mc=[o]:Mc.push(o)}function lF(o,c,h,f){var g=c.interleaved;return g===null?(h.next=h,QC(c)):(h.next=g.next,g.next=h),c.interleaved=h,Ls(o,f)}function Ls(o,c){o.lanes|=c;var h=o.alternate;for(h!==null&&(h.lanes|=c),h=o,o=o.return;o!==null;)o.childLanes|=c,h=o.alternate,h!==null&&(h.childLanes|=c),h=o,o=o.return;return h.tag===3?h.stateNode:null}var Ia=!1;function ZC(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uF(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Ns(o,c){return{eventTime:o,lane:c,tag:0,payload:null,callback:null,next:null}}function La(o,c,h){var f=o.updateQueue;if(f===null)return null;if(f=f.shared,Ft&2){var g=f.pending;return g===null?c.next=c:(c.next=g.next,g.next=c),f.pending=c,Ls(o,h)}return g=f.interleaved,g===null?(c.next=c,QC(f)):(c.next=g.next,g.next=c),f.interleaved=c,Ls(o,h)}function Fm(o,c,h){if(c=c.updateQueue,c!==null&&(c=c.shared,(h&4194240)!==0)){var f=c.lanes;f&=o.pendingLanes,h|=f,c.lanes=h,xC(o,h)}}function mx(o,c){var h=o.updateQueue,f=o.alternate;if(f!==null&&(f=f.updateQueue,h===f)){var g=null,S=null;if(h=h.firstBaseUpdate,h!==null){do{var I={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};S===null?g=S=I:S=S.next=I,h=h.next}while(h!==null);S===null?g=S=c:S=S.next=c}else g=S=c;h={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:S,shared:f.shared,effects:f.effects},o.updateQueue=h;return}o=h.lastBaseUpdate,o===null?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=c}function dE(o,c,h,f){var g=o.updateQueue;Ia=!1;var S=g.firstBaseUpdate,I=g.lastBaseUpdate,L=g.shared.pending;if(L!==null){g.shared.pending=null;var M=L,F=M.next;M.next=null,I===null?S=F:I.next=F,I=M;var X=o.alternate;X!==null&&(X=X.updateQueue,L=X.lastBaseUpdate,L!==I&&(L===null?X.firstBaseUpdate=F:L.next=F,X.lastBaseUpdate=M))}if(S!==null){var H=g.baseState;I=0,X=F=M=null,L=S;do{var J=L.lane,ce=L.eventTime;if((f&J)===J){X!==null&&(X=X.next={eventTime:ce,lane:0,tag:L.tag,payload:L.payload,callback:L.callback,next:null});e:{var se=o,pe=L;switch(J=c,ce=h,pe.tag){case 1:if(se=pe.payload,typeof se=="function"){H=se.call(ce,H,J);break e}H=se;break e;case 3:se.flags=se.flags&-65537|128;case 0:if(se=pe.payload,J=typeof se=="function"?se.call(ce,H,J):se,J==null)break e;H=On({},H,J);break e;case 2:Ia=!0}}L.callback!==null&&L.lane!==0&&(o.flags|=64,J=g.effects,J===null?g.effects=[L]:J.push(L))}else ce={eventTime:ce,lane:J,tag:L.tag,payload:L.payload,callback:L.callback,next:null},X===null?(F=X=ce,M=H):X=X.next=ce,I|=J;if(L=L.next,L===null){if(L=g.shared.pending,L===null)break;J=L,L=J.next,J.next=null,g.lastBaseUpdate=J,g.shared.pending=null}}while(1);if(X===null&&(M=H),g.baseState=M,g.firstBaseUpdate=F,g.lastBaseUpdate=X,c=g.shared.interleaved,c!==null){g=c;do I|=g.lane,g=g.next;while(g!==c)}else S===null&&(g.shared.lanes=0);Gc|=I,o.lanes=I,o.memoizedState=H}}function Ex(o,c,h){if(o=c.effects,c.effects=null,o!==null)for(c=0;c<o.length;c++){var f=o[c],g=f.callback;if(g!==null){if(f.callback=null,f=h,typeof g!="function")throw Error(ve(191,g));g.call(f)}}}var lp={},ss=ja(lp),$h=ja(lp),ep=ja(lp);function Uc(o){if(o===lp)throw Error(ve(174));return o}function $C(o,c){switch(ln(ep,c),ln($h,o),ln(ss,lp),o=c.nodeType,o){case 9:case 11:c=(c=c.documentElement)?c.namespaceURI:By(null,"");break;default:o=o===8?c.parentNode:c,c=o.namespaceURI||null,o=o.tagName,c=By(c,o)}_n(ss),ln(ss,c)}function Ul(){_n(ss),_n($h),_n(ep)}function hF(o){Uc(ep.current);var c=Uc(ss.current),h=By(c,o.type);c!==h&&(ln($h,o),ln(ss,h))}function e0(o){$h.current===o&&(_n(ss),_n($h))}var An=ja(0);function lE(o){for(var c=o;c!==null;){if(c.tag===13){var h=c.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if(c.flags&128)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var Sy=[];function t0(){for(var o=0;o<Sy.length;o++)Sy[o]._workInProgressVersionPrimary=null;Sy.length=0}var Bm=xs.ReactCurrentDispatcher,Ty=xs.ReactCurrentBatchConfig,jc=0,bn=null,tr=null,dr=null,uE=!1,Vh=!1,tp=0,a$=0;function Or(){throw Error(ve(321))}function n0(o,c){if(c===null)return!1;for(var h=0;h<c.length&&h<o.length;h++)if(!Po(o[h],c[h]))return!1;return!0}function r0(o,c,h,f,g,S){if(jc=S,bn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,Bm.current=o===null||o.memoizedState===null?u$:h$,o=h(f,g),Vh){S=0;do{if(Vh=!1,tp=0,25<=S)throw Error(ve(301));S+=1,dr=tr=null,c.updateQueue=null,Bm.current=p$,o=h(f,g)}while(Vh)}if(Bm.current=hE,c=tr!==null&&tr.next!==null,jc=0,dr=tr=bn=null,uE=!1,c)throw Error(ve(300));return o}function i0(){var o=tp!==0;return tp=0,o}function rs(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dr===null?bn.memoizedState=dr=o:dr=dr.next=o,dr}function ro(){if(tr===null){var o=bn.alternate;o=o!==null?o.memoizedState:null}else o=tr.next;var c=dr===null?bn.memoizedState:dr.next;if(c!==null)dr=c,tr=o;else{if(o===null)throw Error(ve(310));tr=o,o={memoizedState:tr.memoizedState,baseState:tr.baseState,baseQueue:tr.baseQueue,queue:tr.queue,next:null},dr===null?bn.memoizedState=dr=o:dr=dr.next=o}return dr}function np(o,c){return typeof c=="function"?c(o):c}function vy(o){var c=ro(),h=c.queue;if(h===null)throw Error(ve(311));h.lastRenderedReducer=o;var f=tr,g=f.baseQueue,S=h.pending;if(S!==null){if(g!==null){var I=g.next;g.next=S.next,S.next=I}f.baseQueue=g=S,h.pending=null}if(g!==null){S=g.next,f=f.baseState;var L=I=null,M=null,F=S;do{var X=F.lane;if((jc&X)===X)M!==null&&(M=M.next={lane:0,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),f=F.hasEagerState?F.eagerState:o(f,F.action);else{var H={lane:X,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null};M===null?(L=M=H,I=f):M=M.next=H,bn.lanes|=X,Gc|=X}F=F.next}while(F!==null&&F!==S);M===null?I=f:M.next=L,Po(f,c.memoizedState)||(oi=!0),c.memoizedState=f,c.baseState=I,c.baseQueue=M,h.lastRenderedState=f}if(o=h.interleaved,o!==null){g=o;do S=g.lane,bn.lanes|=S,Gc|=S,g=g.next;while(g!==o)}else g===null&&(h.lanes=0);return[c.memoizedState,h.dispatch]}function Ry(o){var c=ro(),h=c.queue;if(h===null)throw Error(ve(311));h.lastRenderedReducer=o;var f=h.dispatch,g=h.pending,S=c.memoizedState;if(g!==null){h.pending=null;var I=g=g.next;do S=o(S,I.action),I=I.next;while(I!==g);Po(S,c.memoizedState)||(oi=!0),c.memoizedState=S,c.baseQueue===null&&(c.baseState=S),h.lastRenderedState=S}return[S,f]}function pF(){}function fF(o,c){var h=bn,f=ro(),g=c(),S=!Po(f.memoizedState,g);if(S&&(f.memoizedState=g,oi=!0),f=f.queue,o0(EF.bind(null,h,f,o),[o]),f.getSnapshot!==c||S||dr!==null&&dr.memoizedState.tag&1){if(h.flags|=2048,rp(9,mF.bind(null,h,f,g,c),void 0,null),lr===null)throw Error(ve(349));jc&30||_F(h,c,g)}return g}function _F(o,c,h){o.flags|=16384,o={getSnapshot:c,value:h},c=bn.updateQueue,c===null?(c={lastEffect:null,stores:null},bn.updateQueue=c,c.stores=[o]):(h=c.stores,h===null?c.stores=[o]:h.push(o))}function mF(o,c,h,f){c.value=h,c.getSnapshot=f,gF(c)&&SF(o)}function EF(o,c,h){return h(function(){gF(c)&&SF(o)})}function gF(o){var c=o.getSnapshot;o=o.value;try{var h=c();return!Po(o,h)}catch{return!0}}function SF(o){var c=Ls(o,1);c!==null&&Do(c,o,1,-1)}function gx(o){var c=rs();return typeof o=="function"&&(o=o()),c.memoizedState=c.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:np,lastRenderedState:o},c.queue=o,o=o.dispatch=l$.bind(null,bn,o),[c.memoizedState,o]}function rp(o,c,h,f){return o={tag:o,create:c,destroy:h,deps:f,next:null},c=bn.updateQueue,c===null?(c={lastEffect:null,stores:null},bn.updateQueue=c,c.lastEffect=o.next=o):(h=c.lastEffect,h===null?c.lastEffect=o.next=o:(f=h.next,h.next=o,o.next=f,c.lastEffect=o)),o}function TF(){return ro().memoizedState}function jm(o,c,h,f){var g=rs();bn.flags|=o,g.memoizedState=rp(1|c,h,void 0,f===void 0?null:f)}function wE(o,c,h,f){var g=ro();f=f===void 0?null:f;var S=void 0;if(tr!==null){var I=tr.memoizedState;if(S=I.destroy,f!==null&&n0(f,I.deps)){g.memoizedState=rp(c,h,S,f);return}}bn.flags|=o,g.memoizedState=rp(1|c,h,S,f)}function Sx(o,c){return jm(8390656,8,o,c)}function o0(o,c){return wE(2048,8,o,c)}function vF(o,c){return wE(4,2,o,c)}function RF(o,c){return wE(4,4,o,c)}function yF(o,c){if(typeof c=="function")return o=o(),c(o),function(){c(null)};if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function CF(o,c,h){return h=h!=null?h.concat([o]):null,wE(4,4,yF.bind(null,c,o),h)}function s0(){}function IF(o,c){var h=ro();c=c===void 0?null:c;var f=h.memoizedState;return f!==null&&c!==null&&n0(c,f[1])?f[0]:(h.memoizedState=[o,c],o)}function wF(o,c){var h=ro();c=c===void 0?null:c;var f=h.memoizedState;return f!==null&&c!==null&&n0(c,f[1])?f[0]:(o=o(),h.memoizedState=[o,c],o)}function AF(o,c,h){return jc&21?(Po(h,c)||(h=PV(),bn.lanes|=h,Gc|=h,o.baseState=!0),c):(o.baseState&&(o.baseState=!1,oi=!0),o.memoizedState=h)}function c$(o,c){var h=Jt;Jt=h!==0&&4>h?h:4,o(!0);var f=Ty.transition;Ty.transition={};try{o(!1),c()}finally{Jt=h,Ty.transition=f}}function bF(){return ro().memoizedState}function d$(o,c,h){var f=Ua(o);if(h={lane:f,action:h,hasEagerState:!1,eagerState:null,next:null},OF(o))NF(c,h);else if(h=lF(o,c,h,f),h!==null){var g=Br();Do(h,o,f,g),DF(h,c,f)}}function l$(o,c,h){var f=Ua(o),g={lane:f,action:h,hasEagerState:!1,eagerState:null,next:null};if(OF(o))NF(c,g);else{var S=o.alternate;if(o.lanes===0&&(S===null||S.lanes===0)&&(S=c.lastRenderedReducer,S!==null))try{var I=c.lastRenderedState,L=S(I,h);if(g.hasEagerState=!0,g.eagerState=L,Po(L,I)){var M=c.interleaved;M===null?(g.next=g,QC(c)):(g.next=M.next,M.next=g),c.interleaved=g;return}}catch{}finally{}h=lF(o,c,g,f),h!==null&&(g=Br(),Do(h,o,f,g),DF(h,c,f))}}function OF(o){var c=o.alternate;return o===bn||c!==null&&c===bn}function NF(o,c){Vh=uE=!0;var h=o.pending;h===null?c.next=c:(c.next=h.next,h.next=c),o.pending=c}function DF(o,c,h){if(h&4194240){var f=c.lanes;f&=o.pendingLanes,h|=f,c.lanes=h,xC(o,h)}}var hE={readContext:no,useCallback:Or,useContext:Or,useEffect:Or,useImperativeHandle:Or,useInsertionEffect:Or,useLayoutEffect:Or,useMemo:Or,useReducer:Or,useRef:Or,useState:Or,useDebugValue:Or,useDeferredValue:Or,useTransition:Or,useMutableSource:Or,useSyncExternalStore:Or,useId:Or,unstable_isNewReconciler:!1},u$={readContext:no,useCallback:function(o,c){return rs().memoizedState=[o,c===void 0?null:c],o},useContext:no,useEffect:Sx,useImperativeHandle:function(o,c,h){return h=h!=null?h.concat([o]):null,jm(4194308,4,yF.bind(null,c,o),h)},useLayoutEffect:function(o,c){return jm(4194308,4,o,c)},useInsertionEffect:function(o,c){return jm(4,2,o,c)},useMemo:function(o,c){var h=rs();return c=c===void 0?null:c,o=o(),h.memoizedState=[o,c],o},useReducer:function(o,c,h){var f=rs();return c=h!==void 0?h(c):c,f.memoizedState=f.baseState=c,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:c},f.queue=o,o=o.dispatch=d$.bind(null,bn,o),[f.memoizedState,o]},useRef:function(o){var c=rs();return o={current:o},c.memoizedState=o},useState:gx,useDebugValue:s0,useDeferredValue:function(o){return rs().memoizedState=o},useTransition:function(){var o=gx(!1),c=o[0];return o=c$.bind(null,o[1]),rs().memoizedState=o,[c,o]},useMutableSource:function(){},useSyncExternalStore:function(o,c,h){var f=bn,g=rs();if(Sn){if(h===void 0)throw Error(ve(407));h=h()}else{if(h=c(),lr===null)throw Error(ve(349));jc&30||_F(f,c,h)}g.memoizedState=h;var S={value:h,getSnapshot:c};return g.queue=S,Sx(EF.bind(null,f,S,o),[o]),f.flags|=2048,rp(9,mF.bind(null,f,S,h,c),void 0,null),h},useId:function(){var o=rs(),c=lr.identifierPrefix;if(Sn){var h=Os,f=bs;h=(f&~(1<<32-No(f)-1)).toString(32)+h,c=":"+c+"R"+h,h=tp++,0<h&&(c+="H"+h.toString(32)),c+=":"}else h=a$++,c=":"+c+"r"+h.toString(32)+":";return o.memoizedState=c},unstable_isNewReconciler:!1},h$={readContext:no,useCallback:IF,useContext:no,useEffect:o0,useImperativeHandle:CF,useInsertionEffect:vF,useLayoutEffect:RF,useMemo:wF,useReducer:vy,useRef:TF,useState:function(){return vy(np)},useDebugValue:s0,useDeferredValue:function(o){var c=ro();return AF(c,tr.memoizedState,o)},useTransition:function(){var o=vy(np)[0],c=ro().memoizedState;return[o,c]},useMutableSource:pF,useSyncExternalStore:fF,useId:bF,unstable_isNewReconciler:!1},p$={readContext:no,useCallback:IF,useContext:no,useEffect:o0,useImperativeHandle:CF,useInsertionEffect:vF,useLayoutEffect:RF,useMemo:wF,useReducer:Ry,useRef:TF,useState:function(){return Ry(np)},useDebugValue:s0,useDeferredValue:function(o){var c=ro();return tr===null?c.memoizedState=o:AF(c,tr.memoizedState,o)},useTransition:function(){var o=Ry(np)[0],c=ro().memoizedState;return[o,c]},useMutableSource:pF,useSyncExternalStore:fF,useId:bF,unstable_isNewReconciler:!1};function Ao(o,c){if(o&&o.defaultProps){c=On({},c),o=o.defaultProps;for(var h in o)c[h]===void 0&&(c[h]=o[h]);return c}return c}function aC(o,c,h,f){c=o.memoizedState,h=h(f,c),h=h==null?c:On({},c,h),o.memoizedState=h,o.lanes===0&&(o.updateQueue.baseState=h)}var AE={isMounted:function(o){return(o=o._reactInternals)?Kc(o)===o:!1},enqueueSetState:function(o,c,h){o=o._reactInternals;var f=Br(),g=Ua(o),S=Ns(f,g);S.payload=c,h!=null&&(S.callback=h),c=La(o,S,g),c!==null&&(Do(c,o,g,f),Fm(c,o,g))},enqueueReplaceState:function(o,c,h){o=o._reactInternals;var f=Br(),g=Ua(o),S=Ns(f,g);S.tag=1,S.payload=c,h!=null&&(S.callback=h),c=La(o,S,g),c!==null&&(Do(c,o,g,f),Fm(c,o,g))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var h=Br(),f=Ua(o),g=Ns(h,f);g.tag=2,c!=null&&(g.callback=c),c=La(o,g,f),c!==null&&(Do(c,o,f,h),Fm(c,o,f))}};function Tx(o,c,h,f,g,S,I){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(f,S,I):c.prototype&&c.prototype.isPureReactComponent?!Xh(h,f)||!Xh(g,S):!0}function PF(o,c,h){var f=!1,g=Fa,S=c.contextType;return typeof S=="object"&&S!==null?S=no(S):(g=ai(c)?Fc:Pr.current,f=c.contextTypes,S=(f=f!=null)?kl(o,g):Fa),c=new c(h,S),o.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,c.updater=AE,o.stateNode=c,c._reactInternals=o,f&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=g,o.__reactInternalMemoizedMaskedChildContext=S),c}function vx(o,c,h,f){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(h,f),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(h,f),c.state!==o&&AE.enqueueReplaceState(c,c.state,null)}function cC(o,c,h,f){var g=o.stateNode;g.props=h,g.state=o.memoizedState,g.refs={},ZC(o);var S=c.contextType;typeof S=="object"&&S!==null?g.context=no(S):(S=ai(c)?Fc:Pr.current,g.context=kl(o,S)),g.state=o.memoizedState,S=c.getDerivedStateFromProps,typeof S=="function"&&(aC(o,c,S,h),g.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(c=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),c!==g.state&&AE.enqueueReplaceState(g,g.state,null),dE(o,h,g,f),g.state=o.memoizedState),typeof g.componentDidMount=="function"&&(o.flags|=4194308)}function xl(o,c){try{var h="",f=c;do h+=jQ(f),f=f.return;while(f);var g=h}catch(S){g=`
Error generating stack: `+S.message+`
`+S.stack}return{value:o,source:c,stack:g,digest:null}}function yy(o,c,h){return{value:o,source:null,stack:h??null,digest:c??null}}function dC(o,c){try{console.error(c.value)}catch(h){setTimeout(function(){throw h})}}var f$=typeof WeakMap=="function"?WeakMap:Map;function kF(o,c,h){h=Ns(-1,h),h.tag=3,h.payload={element:null};var f=c.value;return h.callback=function(){fE||(fE=!0,SC=f),dC(o,c)},h}function LF(o,c,h){h=Ns(-1,h),h.tag=3;var f=o.type.getDerivedStateFromError;if(typeof f=="function"){var g=c.value;h.payload=function(){return f(g)},h.callback=function(){dC(o,c)}}var S=o.stateNode;return S!==null&&typeof S.componentDidCatch=="function"&&(h.callback=function(){dC(o,c),typeof f!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var I=c.stack;this.componentDidCatch(c.value,{componentStack:I!==null?I:""})}),h}function Rx(o,c,h){var f=o.pingCache;if(f===null){f=o.pingCache=new f$;var g=new Set;f.set(c,g)}else g=f.get(c),g===void 0&&(g=new Set,f.set(c,g));g.has(h)||(g.add(h),o=b$.bind(null,o,c,h),c.then(o,o))}function yx(o){do{var c;if((c=o.tag===13)&&(c=o.memoizedState,c=c!==null?c.dehydrated!==null:!0),c)return o;o=o.return}while(o!==null);return null}function Cx(o,c,h,f,g){return o.mode&1?(o.flags|=65536,o.lanes=g,o):(o===c?o.flags|=65536:(o.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(c=Ns(-1,1),c.tag=2,La(h,c,1))),h.lanes|=1),o)}var _$=xs.ReactCurrentOwner,oi=!1;function Fr(o,c,h,f){c.child=o===null?dF(c,null,h,f):Ml(c,o.child,h,f)}function Ix(o,c,h,f,g){h=h.render;var S=c.ref;return Nl(c,g),f=r0(o,c,h,f,S,g),h=i0(),o!==null&&!oi?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~g,Ms(o,c,g)):(Sn&&h&&KC(c),c.flags|=1,Fr(o,c,f,g),c.child)}function wx(o,c,h,f,g){if(o===null){var S=h.type;return typeof S=="function"&&!f0(S)&&S.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(c.tag=15,c.type=S,MF(o,c,S,f,g)):(o=Km(h.type,null,f,c,c.mode,g),o.ref=c.ref,o.return=c,c.child=o)}if(S=o.child,!(o.lanes&g)){var I=S.memoizedProps;if(h=h.compare,h=h!==null?h:Xh,h(I,f)&&o.ref===c.ref)return Ms(o,c,g)}return c.flags|=1,o=xa(S,f),o.ref=c.ref,o.return=c,c.child=o}function MF(o,c,h,f,g){if(o!==null){var S=o.memoizedProps;if(Xh(S,f)&&o.ref===c.ref)if(oi=!1,c.pendingProps=f=S,(o.lanes&g)!==0)o.flags&131072&&(oi=!0);else return c.lanes=o.lanes,Ms(o,c,g)}return lC(o,c,h,f,g)}function UF(o,c,h){var f=c.pendingProps,g=f.children,S=o!==null?o.memoizedState:null;if(f.mode==="hidden")if(!(c.mode&1))c.memoizedState={baseLanes:0,cachePool:null,transitions:null},ln(Il,yi),yi|=h;else{if(!(h&1073741824))return o=S!==null?S.baseLanes|h:h,c.lanes=c.childLanes=1073741824,c.memoizedState={baseLanes:o,cachePool:null,transitions:null},c.updateQueue=null,ln(Il,yi),yi|=o,null;c.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=S!==null?S.baseLanes:h,ln(Il,yi),yi|=f}else S!==null?(f=S.baseLanes|h,c.memoizedState=null):f=h,ln(Il,yi),yi|=f;return Fr(o,c,g,h),c.child}function xF(o,c){var h=c.ref;(o===null&&h!==null||o!==null&&o.ref!==h)&&(c.flags|=512,c.flags|=2097152)}function lC(o,c,h,f,g){var S=ai(h)?Fc:Pr.current;return S=kl(c,S),Nl(c,g),h=r0(o,c,h,f,S,g),f=i0(),o!==null&&!oi?(c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~g,Ms(o,c,g)):(Sn&&f&&KC(c),c.flags|=1,Fr(o,c,h,g),c.child)}function Ax(o,c,h,f,g){if(ai(h)){var S=!0;iE(c)}else S=!1;if(Nl(c,g),c.stateNode===null)Gm(o,c),PF(c,h,f),cC(c,h,f,g),f=!0;else if(o===null){var I=c.stateNode,L=c.memoizedProps;I.props=L;var M=I.context,F=h.contextType;typeof F=="object"&&F!==null?F=no(F):(F=ai(h)?Fc:Pr.current,F=kl(c,F));var X=h.getDerivedStateFromProps,H=typeof X=="function"||typeof I.getSnapshotBeforeUpdate=="function";H||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(L!==f||M!==F)&&vx(c,I,f,F),Ia=!1;var J=c.memoizedState;I.state=J,dE(c,f,I,g),M=c.memoizedState,L!==f||J!==M||si.current||Ia?(typeof X=="function"&&(aC(c,h,X,f),M=c.memoizedState),(L=Ia||Tx(c,h,L,f,J,M,F))?(H||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(c.flags|=4194308)):(typeof I.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=f,c.memoizedState=M),I.props=f,I.state=M,I.context=F,f=L):(typeof I.componentDidMount=="function"&&(c.flags|=4194308),f=!1)}else{I=c.stateNode,uF(o,c),L=c.memoizedProps,F=c.type===c.elementType?L:Ao(c.type,L),I.props=F,H=c.pendingProps,J=I.context,M=h.contextType,typeof M=="object"&&M!==null?M=no(M):(M=ai(h)?Fc:Pr.current,M=kl(c,M));var ce=h.getDerivedStateFromProps;(X=typeof ce=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(L!==H||J!==M)&&vx(c,I,f,M),Ia=!1,J=c.memoizedState,I.state=J,dE(c,f,I,g);var se=c.memoizedState;L!==H||J!==se||si.current||Ia?(typeof ce=="function"&&(aC(c,h,ce,f),se=c.memoizedState),(F=Ia||Tx(c,h,F,f,J,se,M)||!1)?(X||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(f,se,M),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(f,se,M)),typeof I.componentDidUpdate=="function"&&(c.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof I.componentDidUpdate!="function"||L===o.memoizedProps&&J===o.memoizedState||(c.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||L===o.memoizedProps&&J===o.memoizedState||(c.flags|=1024),c.memoizedProps=f,c.memoizedState=se),I.props=f,I.state=se,I.context=M,f=F):(typeof I.componentDidUpdate!="function"||L===o.memoizedProps&&J===o.memoizedState||(c.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||L===o.memoizedProps&&J===o.memoizedState||(c.flags|=1024),f=!1)}return uC(o,c,h,f,S,g)}function uC(o,c,h,f,g,S){xF(o,c);var I=(c.flags&128)!==0;if(!f&&!I)return g&&hx(c,h,!1),Ms(o,c,S);f=c.stateNode,_$.current=c;var L=I&&typeof h.getDerivedStateFromError!="function"?null:f.render();return c.flags|=1,o!==null&&I?(c.child=Ml(c,o.child,null,S),c.child=Ml(c,null,L,S)):Fr(o,c,L,S),c.memoizedState=f.state,g&&hx(c,h,!0),c.child}function VF(o){var c=o.stateNode;c.pendingContext?ux(o,c.pendingContext,c.pendingContext!==c.context):c.context&&ux(o,c.context,!1),$C(o,c.containerInfo)}function bx(o,c,h,f,g){return Ll(),YC(g),c.flags|=256,Fr(o,c,h,f),c.child}var hC={dehydrated:null,treeContext:null,retryLane:0};function pC(o){return{baseLanes:o,cachePool:null,transitions:null}}function FF(o,c,h){var f=c.pendingProps,g=An.current,S=!1,I=(c.flags&128)!==0,L;if((L=I)||(L=o!==null&&o.memoizedState===null?!1:(g&2)!==0),L?(S=!0,c.flags&=-129):(o===null||o.memoizedState!==null)&&(g|=1),ln(An,g&1),o===null)return oC(c),o=c.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?(c.mode&1?o.data==="$!"?c.lanes=8:c.lanes=1073741824:c.lanes=1,null):(I=f.children,o=f.fallback,S?(f=c.mode,S=c.child,I={mode:"hidden",children:I},!(f&1)&&S!==null?(S.childLanes=0,S.pendingProps=I):S=NE(I,f,0,null),o=Vc(o,f,h,null),S.return=c,o.return=c,S.sibling=o,c.child=S,c.child.memoizedState=pC(h),c.memoizedState=hC,o):a0(c,I));if(g=o.memoizedState,g!==null&&(L=g.dehydrated,L!==null))return m$(o,c,I,f,L,g,h);if(S){S=f.fallback,I=c.mode,g=o.child,L=g.sibling;var M={mode:"hidden",children:f.children};return!(I&1)&&c.child!==g?(f=c.child,f.childLanes=0,f.pendingProps=M,c.deletions=null):(f=xa(g,M),f.subtreeFlags=g.subtreeFlags&14680064),L!==null?S=xa(L,S):(S=Vc(S,I,h,null),S.flags|=2),S.return=c,f.return=c,f.sibling=S,c.child=f,f=S,S=c.child,I=o.child.memoizedState,I=I===null?pC(h):{baseLanes:I.baseLanes|h,cachePool:null,transitions:I.transitions},S.memoizedState=I,S.childLanes=o.childLanes&~h,c.memoizedState=hC,f}return S=o.child,o=S.sibling,f=xa(S,{mode:"visible",children:f.children}),!(c.mode&1)&&(f.lanes=h),f.return=c,f.sibling=null,o!==null&&(h=c.deletions,h===null?(c.deletions=[o],c.flags|=16):h.push(o)),c.child=f,c.memoizedState=null,f}function a0(o,c){return c=NE({mode:"visible",children:c},o.mode,0,null),c.return=o,o.child=c}function Om(o,c,h,f){return f!==null&&YC(f),Ml(c,o.child,null,h),o=a0(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function m$(o,c,h,f,g,S,I){if(h)return c.flags&256?(c.flags&=-257,f=yy(Error(ve(422))),Om(o,c,I,f)):c.memoizedState!==null?(c.child=o.child,c.flags|=128,null):(S=f.fallback,g=c.mode,f=NE({mode:"visible",children:f.children},g,0,null),S=Vc(S,g,I,null),S.flags|=2,f.return=c,S.return=c,f.sibling=S,c.child=f,c.mode&1&&Ml(c,o.child,null,I),c.child.memoizedState=pC(I),c.memoizedState=hC,S);if(!(c.mode&1))return Om(o,c,I,null);if(g.data==="$!"){if(f=g.nextSibling&&g.nextSibling.dataset,f)var L=f.dgst;return f=L,S=Error(ve(419)),f=yy(S,f,void 0),Om(o,c,I,f)}if(L=(I&o.childLanes)!==0,oi||L){if(f=lr,f!==null){switch(I&-I){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=g&(f.suspendedLanes|I)?0:g,g!==0&&g!==S.retryLane&&(S.retryLane=g,Ls(o,g),Do(f,o,g,-1))}return p0(),f=yy(Error(ve(421))),Om(o,c,I,f)}return g.data==="$?"?(c.flags|=128,c.child=o.child,c=O$.bind(null,o),g._reactRetry=c,null):(o=S.treeContext,Ci=ka(g.nextSibling),Ii=c,Sn=!0,Oo=null,o!==null&&(Zi[$i++]=bs,Zi[$i++]=Os,Zi[$i++]=Bc,bs=o.id,Os=o.overflow,Bc=c),c=a0(c,f.children),c.flags|=4096,c)}function Ox(o,c,h){o.lanes|=c;var f=o.alternate;f!==null&&(f.lanes|=c),sC(o.return,c,h)}function Cy(o,c,h,f,g){var S=o.memoizedState;S===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:f,tail:h,tailMode:g}:(S.isBackwards=c,S.rendering=null,S.renderingStartTime=0,S.last=f,S.tail=h,S.tailMode=g)}function BF(o,c,h){var f=c.pendingProps,g=f.revealOrder,S=f.tail;if(Fr(o,c,f.children,h),f=An.current,f&2)f=f&1|2,c.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Ox(o,h,c);else if(o.tag===19)Ox(o,h,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}f&=1}if(ln(An,f),!(c.mode&1))c.memoizedState=null;else switch(g){case"forwards":for(h=c.child,g=null;h!==null;)o=h.alternate,o!==null&&lE(o)===null&&(g=h),h=h.sibling;h=g,h===null?(g=c.child,c.child=null):(g=h.sibling,h.sibling=null),Cy(c,!1,g,h,S);break;case"backwards":for(h=null,g=c.child,c.child=null;g!==null;){if(o=g.alternate,o!==null&&lE(o)===null){c.child=g;break}o=g.sibling,g.sibling=h,h=g,g=o}Cy(c,!0,h,null,S);break;case"together":Cy(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Gm(o,c){!(c.mode&1)&&o!==null&&(o.alternate=null,c.alternate=null,c.flags|=2)}function Ms(o,c,h){if(o!==null&&(c.dependencies=o.dependencies),Gc|=c.lanes,!(h&c.childLanes))return null;if(o!==null&&c.child!==o.child)throw Error(ve(153));if(c.child!==null){for(o=c.child,h=xa(o,o.pendingProps),c.child=h,h.return=c;o.sibling!==null;)o=o.sibling,h=h.sibling=xa(o,o.pendingProps),h.return=c;h.sibling=null}return c.child}function E$(o,c,h){switch(c.tag){case 3:VF(c),Ll();break;case 5:hF(c);break;case 1:ai(c.type)&&iE(c);break;case 4:$C(c,c.stateNode.containerInfo);break;case 10:var f=c.type._context,g=c.memoizedProps.value;ln(aE,f._currentValue),f._currentValue=g;break;case 13:if(f=c.memoizedState,f!==null)return f.dehydrated!==null?(ln(An,An.current&1),c.flags|=128,null):h&c.child.childLanes?FF(o,c,h):(ln(An,An.current&1),o=Ms(o,c,h),o!==null?o.sibling:null);ln(An,An.current&1);break;case 19:if(f=(h&c.childLanes)!==0,o.flags&128){if(f)return BF(o,c,h);c.flags|=128}if(g=c.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ln(An,An.current),f)break;return null;case 22:case 23:return c.lanes=0,UF(o,c,h)}return Ms(o,c,h)}var jF,fC,GF,WF;jF=function(o,c){for(var h=c.child;h!==null;){if(h.tag===5||h.tag===6)o.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};fC=function(){};GF=function(o,c,h,f){var g=o.memoizedProps;if(g!==f){o=c.stateNode,Uc(ss.current);var S=null;switch(h){case"input":g=Uy(o,g),f=Uy(o,f),S=[];break;case"select":g=On({},g,{value:void 0}),f=On({},f,{value:void 0}),S=[];break;case"textarea":g=Fy(o,g),f=Fy(o,f),S=[];break;default:typeof g.onClick!="function"&&typeof f.onClick=="function"&&(o.onclick=nE)}jy(h,f);var I;h=null;for(F in g)if(!f.hasOwnProperty(F)&&g.hasOwnProperty(F)&&g[F]!=null)if(F==="style"){var L=g[F];for(I in L)L.hasOwnProperty(I)&&(h||(h={}),h[I]="")}else F!=="dangerouslySetInnerHTML"&&F!=="children"&&F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&F!=="autoFocus"&&(Gh.hasOwnProperty(F)?S||(S=[]):(S=S||[]).push(F,null));for(F in f){var M=f[F];if(L=g!=null?g[F]:void 0,f.hasOwnProperty(F)&&M!==L&&(M!=null||L!=null))if(F==="style")if(L){for(I in L)!L.hasOwnProperty(I)||M&&M.hasOwnProperty(I)||(h||(h={}),h[I]="");for(I in M)M.hasOwnProperty(I)&&L[I]!==M[I]&&(h||(h={}),h[I]=M[I])}else h||(S||(S=[]),S.push(F,h)),h=M;else F==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,L=L?L.__html:void 0,M!=null&&L!==M&&(S=S||[]).push(F,M)):F==="children"?typeof M!="string"&&typeof M!="number"||(S=S||[]).push(F,""+M):F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&(Gh.hasOwnProperty(F)?(M!=null&&F==="onScroll"&&fn("scroll",o),S||L===M||(S=[])):(S=S||[]).push(F,M))}h&&(S=S||[]).push("style",h);var F=S;(c.updateQueue=F)&&(c.flags|=4)}};WF=function(o,c,h,f){h!==f&&(c.flags|=4)};function Ih(o,c){if(!Sn)switch(o.tailMode){case"hidden":c=o.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?o.tail=null:h.sibling=null;break;case"collapsed":h=o.tail;for(var f=null;h!==null;)h.alternate!==null&&(f=h),h=h.sibling;f===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:f.sibling=null}}function Nr(o){var c=o.alternate!==null&&o.alternate.child===o.child,h=0,f=0;if(c)for(var g=o.child;g!==null;)h|=g.lanes|g.childLanes,f|=g.subtreeFlags&14680064,f|=g.flags&14680064,g.return=o,g=g.sibling;else for(g=o.child;g!==null;)h|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=o,g=g.sibling;return o.subtreeFlags|=f,o.childLanes=h,c}function g$(o,c,h){var f=c.pendingProps;switch(zC(c),c.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nr(c),null;case 1:return ai(c.type)&&rE(),Nr(c),null;case 3:return f=c.stateNode,Ul(),_n(si),_n(Pr),t0(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(o===null||o.child===null)&&(Am(c)?c.flags|=4:o===null||o.memoizedState.isDehydrated&&!(c.flags&256)||(c.flags|=1024,Oo!==null&&(RC(Oo),Oo=null))),fC(o,c),Nr(c),null;case 5:e0(c);var g=Uc(ep.current);if(h=c.type,o!==null&&c.stateNode!=null)GF(o,c,h,f,g),o.ref!==c.ref&&(c.flags|=512,c.flags|=2097152);else{if(!f){if(c.stateNode===null)throw Error(ve(166));return Nr(c),null}if(o=Uc(ss.current),Am(c)){f=c.stateNode,h=c.type;var S=c.memoizedProps;switch(f[is]=c,f[Zh]=S,o=(c.mode&1)!==0,h){case"dialog":fn("cancel",f),fn("close",f);break;case"iframe":case"object":case"embed":fn("load",f);break;case"video":case"audio":for(g=0;g<Dh.length;g++)fn(Dh[g],f);break;case"source":fn("error",f);break;case"img":case"image":case"link":fn("error",f),fn("load",f);break;case"details":fn("toggle",f);break;case"input":VU(f,S),fn("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!S.multiple},fn("invalid",f);break;case"textarea":BU(f,S),fn("invalid",f)}jy(h,S),g=null;for(var I in S)if(S.hasOwnProperty(I)){var L=S[I];I==="children"?typeof L=="string"?f.textContent!==L&&(S.suppressHydrationWarning!==!0&&wm(f.textContent,L,o),g=["children",L]):typeof L=="number"&&f.textContent!==""+L&&(S.suppressHydrationWarning!==!0&&wm(f.textContent,L,o),g=["children",""+L]):Gh.hasOwnProperty(I)&&L!=null&&I==="onScroll"&&fn("scroll",f)}switch(h){case"input":gm(f),FU(f,S,!0);break;case"textarea":gm(f),jU(f);break;case"select":case"option":break;default:typeof S.onClick=="function"&&(f.onclick=nE)}f=g,c.updateQueue=f,f!==null&&(c.flags|=4)}else{I=g.nodeType===9?g:g.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=EV(h)),o==="http://www.w3.org/1999/xhtml"?h==="script"?(o=I.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof f.is=="string"?o=I.createElement(h,{is:f.is}):(o=I.createElement(h),h==="select"&&(I=o,f.multiple?I.multiple=!0:f.size&&(I.size=f.size))):o=I.createElementNS(o,h),o[is]=c,o[Zh]=f,jF(o,c,!1,!1),c.stateNode=o;e:{switch(I=Gy(h,f),h){case"dialog":fn("cancel",o),fn("close",o),g=f;break;case"iframe":case"object":case"embed":fn("load",o),g=f;break;case"video":case"audio":for(g=0;g<Dh.length;g++)fn(Dh[g],o);g=f;break;case"source":fn("error",o),g=f;break;case"img":case"image":case"link":fn("error",o),fn("load",o),g=f;break;case"details":fn("toggle",o),g=f;break;case"input":VU(o,f),g=Uy(o,f),fn("invalid",o);break;case"option":g=f;break;case"select":o._wrapperState={wasMultiple:!!f.multiple},g=On({},f,{value:void 0}),fn("invalid",o);break;case"textarea":BU(o,f),g=Fy(o,f),fn("invalid",o);break;default:g=f}jy(h,g),L=g;for(S in L)if(L.hasOwnProperty(S)){var M=L[S];S==="style"?TV(o,M):S==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,M!=null&&gV(o,M)):S==="children"?typeof M=="string"?(h!=="textarea"||M!=="")&&Wh(o,M):typeof M=="number"&&Wh(o,""+M):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(Gh.hasOwnProperty(S)?M!=null&&S==="onScroll"&&fn("scroll",o):M!=null&&DC(o,S,M,I))}switch(h){case"input":gm(o),FU(o,f,!1);break;case"textarea":gm(o),jU(o);break;case"option":f.value!=null&&o.setAttribute("value",""+Va(f.value));break;case"select":o.multiple=!!f.multiple,S=f.value,S!=null?wl(o,!!f.multiple,S,!1):f.defaultValue!=null&&wl(o,!!f.multiple,f.defaultValue,!0);break;default:typeof g.onClick=="function"&&(o.onclick=nE)}switch(h){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(c.flags|=4)}c.ref!==null&&(c.flags|=512,c.flags|=2097152)}return Nr(c),null;case 6:if(o&&c.stateNode!=null)WF(o,c,o.memoizedProps,f);else{if(typeof f!="string"&&c.stateNode===null)throw Error(ve(166));if(h=Uc(ep.current),Uc(ss.current),Am(c)){if(f=c.stateNode,h=c.memoizedProps,f[is]=c,(S=f.nodeValue!==h)&&(o=Ii,o!==null))switch(o.tag){case 3:wm(f.nodeValue,h,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&wm(f.nodeValue,h,(o.mode&1)!==0)}S&&(c.flags|=4)}else f=(h.nodeType===9?h:h.ownerDocument).createTextNode(f),f[is]=c,c.stateNode=f}return Nr(c),null;case 13:if(_n(An),f=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(Sn&&Ci!==null&&c.mode&1&&!(c.flags&128))aF(),Ll(),c.flags|=98560,S=!1;else if(S=Am(c),f!==null&&f.dehydrated!==null){if(o===null){if(!S)throw Error(ve(318));if(S=c.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(ve(317));S[is]=c}else Ll(),!(c.flags&128)&&(c.memoizedState=null),c.flags|=4;Nr(c),S=!1}else Oo!==null&&(RC(Oo),Oo=null),S=!0;if(!S)return c.flags&65536?c:null}return c.flags&128?(c.lanes=h,c):(f=f!==null,f!==(o!==null&&o.memoizedState!==null)&&f&&(c.child.flags|=8192,c.mode&1&&(o===null||An.current&1?nr===0&&(nr=3):p0())),c.updateQueue!==null&&(c.flags|=4),Nr(c),null);case 4:return Ul(),fC(o,c),o===null&&Jh(c.stateNode.containerInfo),Nr(c),null;case 10:return JC(c.type._context),Nr(c),null;case 17:return ai(c.type)&&rE(),Nr(c),null;case 19:if(_n(An),S=c.memoizedState,S===null)return Nr(c),null;if(f=(c.flags&128)!==0,I=S.rendering,I===null)if(f)Ih(S,!1);else{if(nr!==0||o!==null&&o.flags&128)for(o=c.child;o!==null;){if(I=lE(o),I!==null){for(c.flags|=128,Ih(S,!1),f=I.updateQueue,f!==null&&(c.updateQueue=f,c.flags|=4),c.subtreeFlags=0,f=h,h=c.child;h!==null;)S=h,o=f,S.flags&=14680066,I=S.alternate,I===null?(S.childLanes=0,S.lanes=o,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=I.childLanes,S.lanes=I.lanes,S.child=I.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=I.memoizedProps,S.memoizedState=I.memoizedState,S.updateQueue=I.updateQueue,S.type=I.type,o=I.dependencies,S.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),h=h.sibling;return ln(An,An.current&1|2),c.child}o=o.sibling}S.tail!==null&&Wn()>Vl&&(c.flags|=128,f=!0,Ih(S,!1),c.lanes=4194304)}else{if(!f)if(o=lE(I),o!==null){if(c.flags|=128,f=!0,h=o.updateQueue,h!==null&&(c.updateQueue=h,c.flags|=4),Ih(S,!0),S.tail===null&&S.tailMode==="hidden"&&!I.alternate&&!Sn)return Nr(c),null}else 2*Wn()-S.renderingStartTime>Vl&&h!==1073741824&&(c.flags|=128,f=!0,Ih(S,!1),c.lanes=4194304);S.isBackwards?(I.sibling=c.child,c.child=I):(h=S.last,h!==null?h.sibling=I:c.child=I,S.last=I)}return S.tail!==null?(c=S.tail,S.rendering=c,S.tail=c.sibling,S.renderingStartTime=Wn(),c.sibling=null,h=An.current,ln(An,f?h&1|2:h&1),c):(Nr(c),null);case 22:case 23:return h0(),f=c.memoizedState!==null,o!==null&&o.memoizedState!==null!==f&&(c.flags|=8192),f&&c.mode&1?yi&1073741824&&(Nr(c),c.subtreeFlags&6&&(c.flags|=8192)):Nr(c),null;case 24:return null;case 25:return null}throw Error(ve(156,c.tag))}function S$(o,c){switch(zC(c),c.tag){case 1:return ai(c.type)&&rE(),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return Ul(),_n(si),_n(Pr),t0(),o=c.flags,o&65536&&!(o&128)?(c.flags=o&-65537|128,c):null;case 5:return e0(c),null;case 13:if(_n(An),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(ve(340));Ll()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return _n(An),null;case 4:return Ul(),null;case 10:return JC(c.type._context),null;case 22:case 23:return h0(),null;case 24:return null;default:return null}}var Nm=!1,Dr=!1,T$=typeof WeakSet=="function"?WeakSet:Set,Be=null;function Cl(o,c){var h=o.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(f){Un(o,c,f)}else h.current=null}function _C(o,c,h){try{h()}catch(f){Un(o,c,f)}}var Nx=!1;function v$(o,c){if(Zy=$m,o=qV(),HC(o)){if("selectionStart"in o)var h={start:o.selectionStart,end:o.selectionEnd};else e:{h=(h=o.ownerDocument)&&h.defaultView||window;var f=h.getSelection&&h.getSelection();if(f&&f.rangeCount!==0){h=f.anchorNode;var g=f.anchorOffset,S=f.focusNode;f=f.focusOffset;try{h.nodeType,S.nodeType}catch{h=null;break e}var I=0,L=-1,M=-1,F=0,X=0,H=o,J=null;t:for(;;){for(var ce;H!==h||g!==0&&H.nodeType!==3||(L=I+g),H!==S||f!==0&&H.nodeType!==3||(M=I+f),H.nodeType===3&&(I+=H.nodeValue.length),(ce=H.firstChild)!==null;)J=H,H=ce;for(;;){if(H===o)break t;if(J===h&&++F===g&&(L=I),J===S&&++X===f&&(M=I),(ce=H.nextSibling)!==null)break;H=J,J=H.parentNode}H=ce}h=L===-1||M===-1?null:{start:L,end:M}}else h=null}h=h||{start:0,end:0}}else h=null;for($y={focusedElem:o,selectionRange:h},$m=!1,Be=c;Be!==null;)if(c=Be,o=c.child,(c.subtreeFlags&1028)!==0&&o!==null)o.return=c,Be=o;else for(;Be!==null;){c=Be;try{var se=c.alternate;if(c.flags&1024)switch(c.tag){case 0:case 11:case 15:break;case 1:if(se!==null){var pe=se.memoizedProps,we=se.memoizedState,z=c.stateNode,W=z.getSnapshotBeforeUpdate(c.elementType===c.type?pe:Ao(c.type,pe),we);z.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var K=c.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ve(163))}}catch(Ee){Un(c,c.return,Ee)}if(o=c.sibling,o!==null){o.return=c.return,Be=o;break}Be=c.return}return se=Nx,Nx=!1,se}function Fh(o,c,h){var f=c.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var g=f=f.next;do{if((g.tag&o)===o){var S=g.destroy;g.destroy=void 0,S!==void 0&&_C(c,h,S)}g=g.next}while(g!==f)}}function bE(o,c){if(c=c.updateQueue,c=c!==null?c.lastEffect:null,c!==null){var h=c=c.next;do{if((h.tag&o)===o){var f=h.create;h.destroy=f()}h=h.next}while(h!==c)}}function mC(o){var c=o.ref;if(c!==null){var h=o.stateNode;switch(o.tag){case 5:o=h;break;default:o=h}typeof c=="function"?c(o):c.current=o}}function HF(o){var c=o.alternate;c!==null&&(o.alternate=null,HF(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&(delete c[is],delete c[Zh],delete c[nC],delete c[r$],delete c[i$])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function KF(o){return o.tag===5||o.tag===3||o.tag===4}function Dx(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||KF(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function EC(o,c,h){var f=o.tag;if(f===5||f===6)o=o.stateNode,c?h.nodeType===8?h.parentNode.insertBefore(o,c):h.insertBefore(o,c):(h.nodeType===8?(c=h.parentNode,c.insertBefore(o,h)):(c=h,c.appendChild(o)),h=h._reactRootContainer,h!=null||c.onclick!==null||(c.onclick=nE));else if(f!==4&&(o=o.child,o!==null))for(EC(o,c,h),o=o.sibling;o!==null;)EC(o,c,h),o=o.sibling}function gC(o,c,h){var f=o.tag;if(f===5||f===6)o=o.stateNode,c?h.insertBefore(o,c):h.appendChild(o);else if(f!==4&&(o=o.child,o!==null))for(gC(o,c,h),o=o.sibling;o!==null;)gC(o,c,h),o=o.sibling}var gr=null,bo=!1;function Ra(o,c,h){for(h=h.child;h!==null;)zF(o,c,h),h=h.sibling}function zF(o,c,h){if(os&&typeof os.onCommitFiberUnmount=="function")try{os.onCommitFiberUnmount(TE,h)}catch{}switch(h.tag){case 5:Dr||Cl(h,c);case 6:var f=gr,g=bo;gr=null,Ra(o,c,h),gr=f,bo=g,gr!==null&&(bo?(o=gr,h=h.stateNode,o.nodeType===8?o.parentNode.removeChild(h):o.removeChild(h)):gr.removeChild(h.stateNode));break;case 18:gr!==null&&(bo?(o=gr,h=h.stateNode,o.nodeType===8?Ey(o.parentNode,h):o.nodeType===1&&Ey(o,h),Yh(o)):Ey(gr,h.stateNode));break;case 4:f=gr,g=bo,gr=h.stateNode.containerInfo,bo=!0,Ra(o,c,h),gr=f,bo=g;break;case 0:case 11:case 14:case 15:if(!Dr&&(f=h.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){g=f=f.next;do{var S=g,I=S.destroy;S=S.tag,I!==void 0&&(S&2||S&4)&&_C(h,c,I),g=g.next}while(g!==f)}Ra(o,c,h);break;case 1:if(!Dr&&(Cl(h,c),f=h.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=h.memoizedProps,f.state=h.memoizedState,f.componentWillUnmount()}catch(L){Un(h,c,L)}Ra(o,c,h);break;case 21:Ra(o,c,h);break;case 22:h.mode&1?(Dr=(f=Dr)||h.memoizedState!==null,Ra(o,c,h),Dr=f):Ra(o,c,h);break;default:Ra(o,c,h)}}function Px(o){var c=o.updateQueue;if(c!==null){o.updateQueue=null;var h=o.stateNode;h===null&&(h=o.stateNode=new T$),c.forEach(function(f){var g=N$.bind(null,o,f);h.has(f)||(h.add(f),f.then(g,g))})}}function wo(o,c){var h=c.deletions;if(h!==null)for(var f=0;f<h.length;f++){var g=h[f];try{var S=o,I=c,L=I;e:for(;L!==null;){switch(L.tag){case 5:gr=L.stateNode,bo=!1;break e;case 3:gr=L.stateNode.containerInfo,bo=!0;break e;case 4:gr=L.stateNode.containerInfo,bo=!0;break e}L=L.return}if(gr===null)throw Error(ve(160));zF(S,I,g),gr=null,bo=!1;var M=g.alternate;M!==null&&(M.return=null),g.return=null}catch(F){Un(g,c,F)}}if(c.subtreeFlags&12854)for(c=c.child;c!==null;)YF(c,o),c=c.sibling}function YF(o,c){var h=o.alternate,f=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(wo(c,o),ns(o),f&4){try{Fh(3,o,o.return),bE(3,o)}catch(pe){Un(o,o.return,pe)}try{Fh(5,o,o.return)}catch(pe){Un(o,o.return,pe)}}break;case 1:wo(c,o),ns(o),f&512&&h!==null&&Cl(h,h.return);break;case 5:if(wo(c,o),ns(o),f&512&&h!==null&&Cl(h,h.return),o.flags&32){var g=o.stateNode;try{Wh(g,"")}catch(pe){Un(o,o.return,pe)}}if(f&4&&(g=o.stateNode,g!=null)){var S=o.memoizedProps,I=h!==null?h.memoizedProps:S,L=o.type,M=o.updateQueue;if(o.updateQueue=null,M!==null)try{L==="input"&&S.type==="radio"&&S.name!=null&&_V(g,S),Gy(L,I);var F=Gy(L,S);for(I=0;I<M.length;I+=2){var X=M[I],H=M[I+1];X==="style"?TV(g,H):X==="dangerouslySetInnerHTML"?gV(g,H):X==="children"?Wh(g,H):DC(g,X,H,F)}switch(L){case"input":xy(g,S);break;case"textarea":mV(g,S);break;case"select":var J=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!S.multiple;var ce=S.value;ce!=null?wl(g,!!S.multiple,ce,!1):J!==!!S.multiple&&(S.defaultValue!=null?wl(g,!!S.multiple,S.defaultValue,!0):wl(g,!!S.multiple,S.multiple?[]:"",!1))}g[Zh]=S}catch(pe){Un(o,o.return,pe)}}break;case 6:if(wo(c,o),ns(o),f&4){if(o.stateNode===null)throw Error(ve(162));g=o.stateNode,S=o.memoizedProps;try{g.nodeValue=S}catch(pe){Un(o,o.return,pe)}}break;case 3:if(wo(c,o),ns(o),f&4&&h!==null&&h.memoizedState.isDehydrated)try{Yh(c.containerInfo)}catch(pe){Un(o,o.return,pe)}break;case 4:wo(c,o),ns(o);break;case 13:wo(c,o),ns(o),g=o.child,g.flags&8192&&(S=g.memoizedState!==null,g.stateNode.isHidden=S,!S||g.alternate!==null&&g.alternate.memoizedState!==null||(l0=Wn())),f&4&&Px(o);break;case 22:if(X=h!==null&&h.memoizedState!==null,o.mode&1?(Dr=(F=Dr)||X,wo(c,o),Dr=F):wo(c,o),ns(o),f&8192){if(F=o.memoizedState!==null,(o.stateNode.isHidden=F)&&!X&&o.mode&1)for(Be=o,X=o.child;X!==null;){for(H=Be=X;Be!==null;){switch(J=Be,ce=J.child,J.tag){case 0:case 11:case 14:case 15:Fh(4,J,J.return);break;case 1:Cl(J,J.return);var se=J.stateNode;if(typeof se.componentWillUnmount=="function"){f=J,h=J.return;try{c=f,se.props=c.memoizedProps,se.state=c.memoizedState,se.componentWillUnmount()}catch(pe){Un(f,h,pe)}}break;case 5:Cl(J,J.return);break;case 22:if(J.memoizedState!==null){Lx(H);continue}}ce!==null?(ce.return=J,Be=ce):Lx(H)}X=X.sibling}e:for(X=null,H=o;;){if(H.tag===5){if(X===null){X=H;try{g=H.stateNode,F?(S=g.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none"):(L=H.stateNode,M=H.memoizedProps.style,I=M!=null&&M.hasOwnProperty("display")?M.display:null,L.style.display=SV("display",I))}catch(pe){Un(o,o.return,pe)}}}else if(H.tag===6){if(X===null)try{H.stateNode.nodeValue=F?"":H.memoizedProps}catch(pe){Un(o,o.return,pe)}}else if((H.tag!==22&&H.tag!==23||H.memoizedState===null||H===o)&&H.child!==null){H.child.return=H,H=H.child;continue}if(H===o)break e;for(;H.sibling===null;){if(H.return===null||H.return===o)break e;X===H&&(X=null),H=H.return}X===H&&(X=null),H.sibling.return=H.return,H=H.sibling}}break;case 19:wo(c,o),ns(o),f&4&&Px(o);break;case 21:break;default:wo(c,o),ns(o)}}function ns(o){var c=o.flags;if(c&2){try{e:{for(var h=o.return;h!==null;){if(KF(h)){var f=h;break e}h=h.return}throw Error(ve(160))}switch(f.tag){case 5:var g=f.stateNode;f.flags&32&&(Wh(g,""),f.flags&=-33);var S=Dx(o);gC(o,S,g);break;case 3:case 4:var I=f.stateNode.containerInfo,L=Dx(o);EC(o,L,I);break;default:throw Error(ve(161))}}catch(M){Un(o,o.return,M)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function R$(o,c,h){Be=o,qF(o)}function qF(o,c,h){for(var f=(o.mode&1)!==0;Be!==null;){var g=Be,S=g.child;if(g.tag===22&&f){var I=g.memoizedState!==null||Nm;if(!I){var L=g.alternate,M=L!==null&&L.memoizedState!==null||Dr;L=Nm;var F=Dr;if(Nm=I,(Dr=M)&&!F)for(Be=g;Be!==null;)I=Be,M=I.child,I.tag===22&&I.memoizedState!==null?Mx(g):M!==null?(M.return=I,Be=M):Mx(g);for(;S!==null;)Be=S,qF(S),S=S.sibling;Be=g,Nm=L,Dr=F}kx(o)}else g.subtreeFlags&8772&&S!==null?(S.return=g,Be=S):kx(o)}}function kx(o){for(;Be!==null;){var c=Be;if(c.flags&8772){var h=c.alternate;try{if(c.flags&8772)switch(c.tag){case 0:case 11:case 15:Dr||bE(5,c);break;case 1:var f=c.stateNode;if(c.flags&4&&!Dr)if(h===null)f.componentDidMount();else{var g=c.elementType===c.type?h.memoizedProps:Ao(c.type,h.memoizedProps);f.componentDidUpdate(g,h.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var S=c.updateQueue;S!==null&&Ex(c,S,f);break;case 3:var I=c.updateQueue;if(I!==null){if(h=null,c.child!==null)switch(c.child.tag){case 5:h=c.child.stateNode;break;case 1:h=c.child.stateNode}Ex(c,I,h)}break;case 5:var L=c.stateNode;if(h===null&&c.flags&4){h=L;var M=c.memoizedProps;switch(c.type){case"button":case"input":case"select":case"textarea":M.autoFocus&&h.focus();break;case"img":M.src&&(h.src=M.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(c.memoizedState===null){var F=c.alternate;if(F!==null){var X=F.memoizedState;if(X!==null){var H=X.dehydrated;H!==null&&Yh(H)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ve(163))}Dr||c.flags&512&&mC(c)}catch(J){Un(c,c.return,J)}}if(c===o){Be=null;break}if(h=c.sibling,h!==null){h.return=c.return,Be=h;break}Be=c.return}}function Lx(o){for(;Be!==null;){var c=Be;if(c===o){Be=null;break}var h=c.sibling;if(h!==null){h.return=c.return,Be=h;break}Be=c.return}}function Mx(o){for(;Be!==null;){var c=Be;try{switch(c.tag){case 0:case 11:case 15:var h=c.return;try{bE(4,c)}catch(M){Un(c,h,M)}break;case 1:var f=c.stateNode;if(typeof f.componentDidMount=="function"){var g=c.return;try{f.componentDidMount()}catch(M){Un(c,g,M)}}var S=c.return;try{mC(c)}catch(M){Un(c,S,M)}break;case 5:var I=c.return;try{mC(c)}catch(M){Un(c,I,M)}}}catch(M){Un(c,c.return,M)}if(c===o){Be=null;break}var L=c.sibling;if(L!==null){L.return=c.return,Be=L;break}Be=c.return}}var y$=Math.ceil,pE=xs.ReactCurrentDispatcher,c0=xs.ReactCurrentOwner,to=xs.ReactCurrentBatchConfig,Ft=0,lr=null,Xn=null,Sr=0,yi=0,Il=ja(0),nr=0,ip=null,Gc=0,OE=0,d0=0,Bh=null,ii=null,l0=0,Vl=1/0,ws=null,fE=!1,SC=null,Ma=null,Dm=!1,Oa=null,_E=0,jh=0,TC=null,Wm=-1,Hm=0;function Br(){return Ft&6?Wn():Wm!==-1?Wm:Wm=Wn()}function Ua(o){return o.mode&1?Ft&2&&Sr!==0?Sr&-Sr:s$.transition!==null?(Hm===0&&(Hm=PV()),Hm):(o=Jt,o!==0||(o=window.event,o=o===void 0?16:FV(o.type)),o):1}function Do(o,c,h,f){if(50<jh)throw jh=0,TC=null,Error(ve(185));ap(o,h,f),(!(Ft&2)||o!==lr)&&(o===lr&&(!(Ft&2)&&(OE|=h),nr===4&&Aa(o,Sr)),ci(o,f),h===1&&Ft===0&&!(c.mode&1)&&(Vl=Wn()+500,IE&&Ga()))}function ci(o,c){var h=o.callbackNode;sZ(o,c);var f=Zm(o,o===lr?Sr:0);if(f===0)h!==null&&HU(h),o.callbackNode=null,o.callbackPriority=0;else if(c=f&-f,o.callbackPriority!==c){if(h!=null&&HU(h),c===1)o.tag===0?o$(Ux.bind(null,o)):iF(Ux.bind(null,o)),t$(function(){!(Ft&6)&&Ga()}),h=null;else{switch(kV(f)){case 1:h=UC;break;case 4:h=NV;break;case 16:h=Qm;break;case 536870912:h=DV;break;default:h=Qm}h=nB(h,XF.bind(null,o))}o.callbackPriority=c,o.callbackNode=h}}function XF(o,c){if(Wm=-1,Hm=0,Ft&6)throw Error(ve(327));var h=o.callbackNode;if(Dl()&&o.callbackNode!==h)return null;var f=Zm(o,o===lr?Sr:0);if(f===0)return null;if(f&30||f&o.expiredLanes||c)c=mE(o,f);else{c=f;var g=Ft;Ft|=2;var S=QF();(lr!==o||Sr!==c)&&(ws=null,Vl=Wn()+500,xc(o,c));do try{w$();break}catch(L){JF(o,L)}while(1);XC(),pE.current=S,Ft=g,Xn!==null?c=0:(lr=null,Sr=0,c=nr)}if(c!==0){if(c===2&&(g=Yy(o),g!==0&&(f=g,c=vC(o,g))),c===1)throw h=ip,xc(o,0),Aa(o,f),ci(o,Wn()),h;if(c===6)Aa(o,f);else{if(g=o.current.alternate,!(f&30)&&!C$(g)&&(c=mE(o,f),c===2&&(S=Yy(o),S!==0&&(f=S,c=vC(o,S))),c===1))throw h=ip,xc(o,0),Aa(o,f),ci(o,Wn()),h;switch(o.finishedWork=g,o.finishedLanes=f,c){case 0:case 1:throw Error(ve(345));case 2:Pc(o,ii,ws);break;case 3:if(Aa(o,f),(f&130023424)===f&&(c=l0+500-Wn(),10<c)){if(Zm(o,0)!==0)break;if(g=o.suspendedLanes,(g&f)!==f){Br(),o.pingedLanes|=o.suspendedLanes&g;break}o.timeoutHandle=tC(Pc.bind(null,o,ii,ws),c);break}Pc(o,ii,ws);break;case 4:if(Aa(o,f),(f&4194240)===f)break;for(c=o.eventTimes,g=-1;0<f;){var I=31-No(f);S=1<<I,I=c[I],I>g&&(g=I),f&=~S}if(f=g,f=Wn()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*y$(f/1960))-f,10<f){o.timeoutHandle=tC(Pc.bind(null,o,ii,ws),f);break}Pc(o,ii,ws);break;case 5:Pc(o,ii,ws);break;default:throw Error(ve(329))}}}return ci(o,Wn()),o.callbackNode===h?XF.bind(null,o):null}function vC(o,c){var h=Bh;return o.current.memoizedState.isDehydrated&&(xc(o,c).flags|=256),o=mE(o,c),o!==2&&(c=ii,ii=h,c!==null&&RC(c)),o}function RC(o){ii===null?ii=o:ii.push.apply(ii,o)}function C$(o){for(var c=o;;){if(c.flags&16384){var h=c.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var f=0;f<h.length;f++){var g=h[f],S=g.getSnapshot;g=g.value;try{if(!Po(S(),g))return!1}catch{return!1}}}if(h=c.child,c.subtreeFlags&16384&&h!==null)h.return=c,c=h;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Aa(o,c){for(c&=~d0,c&=~OE,o.suspendedLanes|=c,o.pingedLanes&=~c,o=o.expirationTimes;0<c;){var h=31-No(c),f=1<<h;o[h]=-1,c&=~f}}function Ux(o){if(Ft&6)throw Error(ve(327));Dl();var c=Zm(o,0);if(!(c&1))return ci(o,Wn()),null;var h=mE(o,c);if(o.tag!==0&&h===2){var f=Yy(o);f!==0&&(c=f,h=vC(o,f))}if(h===1)throw h=ip,xc(o,0),Aa(o,c),ci(o,Wn()),h;if(h===6)throw Error(ve(345));return o.finishedWork=o.current.alternate,o.finishedLanes=c,Pc(o,ii,ws),ci(o,Wn()),null}function u0(o,c){var h=Ft;Ft|=1;try{return o(c)}finally{Ft=h,Ft===0&&(Vl=Wn()+500,IE&&Ga())}}function Wc(o){Oa!==null&&Oa.tag===0&&!(Ft&6)&&Dl();var c=Ft;Ft|=1;var h=to.transition,f=Jt;try{if(to.transition=null,Jt=1,o)return o()}finally{Jt=f,to.transition=h,Ft=c,!(Ft&6)&&Ga()}}function h0(){yi=Il.current,_n(Il)}function xc(o,c){o.finishedWork=null,o.finishedLanes=0;var h=o.timeoutHandle;if(h!==-1&&(o.timeoutHandle=-1,e$(h)),Xn!==null)for(h=Xn.return;h!==null;){var f=h;switch(zC(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&rE();break;case 3:Ul(),_n(si),_n(Pr),t0();break;case 5:e0(f);break;case 4:Ul();break;case 13:_n(An);break;case 19:_n(An);break;case 10:JC(f.type._context);break;case 22:case 23:h0()}h=h.return}if(lr=o,Xn=o=xa(o.current,null),Sr=yi=c,nr=0,ip=null,d0=OE=Gc=0,ii=Bh=null,Mc!==null){for(c=0;c<Mc.length;c++)if(h=Mc[c],f=h.interleaved,f!==null){h.interleaved=null;var g=f.next,S=h.pending;if(S!==null){var I=S.next;S.next=g,f.next=I}h.pending=f}Mc=null}return o}function JF(o,c){do{var h=Xn;try{if(XC(),Bm.current=hE,uE){for(var f=bn.memoizedState;f!==null;){var g=f.queue;g!==null&&(g.pending=null),f=f.next}uE=!1}if(jc=0,dr=tr=bn=null,Vh=!1,tp=0,c0.current=null,h===null||h.return===null){nr=1,ip=c,Xn=null;break}e:{var S=o,I=h.return,L=h,M=c;if(c=Sr,L.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){var F=M,X=L,H=X.tag;if(!(X.mode&1)&&(H===0||H===11||H===15)){var J=X.alternate;J?(X.updateQueue=J.updateQueue,X.memoizedState=J.memoizedState,X.lanes=J.lanes):(X.updateQueue=null,X.memoizedState=null)}var ce=yx(I);if(ce!==null){ce.flags&=-257,Cx(ce,I,L,S,c),ce.mode&1&&Rx(S,F,c),c=ce,M=F;var se=c.updateQueue;if(se===null){var pe=new Set;pe.add(M),c.updateQueue=pe}else se.add(M);break e}else{if(!(c&1)){Rx(S,F,c),p0();break e}M=Error(ve(426))}}else if(Sn&&L.mode&1){var we=yx(I);if(we!==null){!(we.flags&65536)&&(we.flags|=256),Cx(we,I,L,S,c),YC(xl(M,L));break e}}S=M=xl(M,L),nr!==4&&(nr=2),Bh===null?Bh=[S]:Bh.push(S),S=I;do{switch(S.tag){case 3:S.flags|=65536,c&=-c,S.lanes|=c;var z=kF(S,M,c);mx(S,z);break e;case 1:L=M;var W=S.type,K=S.stateNode;if(!(S.flags&128)&&(typeof W.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(Ma===null||!Ma.has(K)))){S.flags|=65536,c&=-c,S.lanes|=c;var Ee=LF(S,L,c);mx(S,Ee);break e}}S=S.return}while(S!==null)}$F(h)}catch(Ie){c=Ie,Xn===h&&h!==null&&(Xn=h=h.return);continue}break}while(1)}function QF(){var o=pE.current;return pE.current=hE,o===null?hE:o}function p0(){(nr===0||nr===3||nr===2)&&(nr=4),lr===null||!(Gc&268435455)&&!(OE&268435455)||Aa(lr,Sr)}function mE(o,c){var h=Ft;Ft|=2;var f=QF();(lr!==o||Sr!==c)&&(ws=null,xc(o,c));do try{I$();break}catch(g){JF(o,g)}while(1);if(XC(),Ft=h,pE.current=f,Xn!==null)throw Error(ve(261));return lr=null,Sr=0,nr}function I$(){for(;Xn!==null;)ZF(Xn)}function w$(){for(;Xn!==null&&!QQ();)ZF(Xn)}function ZF(o){var c=tB(o.alternate,o,yi);o.memoizedProps=o.pendingProps,c===null?$F(o):Xn=c,c0.current=null}function $F(o){var c=o;do{var h=c.alternate;if(o=c.return,c.flags&32768){if(h=S$(h,c),h!==null){h.flags&=32767,Xn=h;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{nr=6,Xn=null;return}}else if(h=g$(h,c,yi),h!==null){Xn=h;return}if(c=c.sibling,c!==null){Xn=c;return}Xn=c=o}while(c!==null);nr===0&&(nr=5)}function Pc(o,c,h){var f=Jt,g=to.transition;try{to.transition=null,Jt=1,A$(o,c,h,f)}finally{to.transition=g,Jt=f}return null}function A$(o,c,h,f){do Dl();while(Oa!==null);if(Ft&6)throw Error(ve(327));h=o.finishedWork;var g=o.finishedLanes;if(h===null)return null;if(o.finishedWork=null,o.finishedLanes=0,h===o.current)throw Error(ve(177));o.callbackNode=null,o.callbackPriority=0;var S=h.lanes|h.childLanes;if(aZ(o,S),o===lr&&(Xn=lr=null,Sr=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||Dm||(Dm=!0,nB(Qm,function(){return Dl(),null})),S=(h.flags&15990)!==0,h.subtreeFlags&15990||S){S=to.transition,to.transition=null;var I=Jt;Jt=1;var L=Ft;Ft|=4,c0.current=null,v$(o,h),YF(h,o),YZ($y),$m=!!Zy,$y=Zy=null,o.current=h,R$(h),ZQ(),Ft=L,Jt=I,to.transition=S}else o.current=h;if(Dm&&(Dm=!1,Oa=o,_E=g),S=o.pendingLanes,S===0&&(Ma=null),tZ(h.stateNode),ci(o,Wn()),c!==null)for(f=o.onRecoverableError,h=0;h<c.length;h++)g=c[h],f(g.value,{componentStack:g.stack,digest:g.digest});if(fE)throw fE=!1,o=SC,SC=null,o;return _E&1&&o.tag!==0&&Dl(),S=o.pendingLanes,S&1?o===TC?jh++:(jh=0,TC=o):jh=0,Ga(),null}function Dl(){if(Oa!==null){var o=kV(_E),c=to.transition,h=Jt;try{if(to.transition=null,Jt=16>o?16:o,Oa===null)var f=!1;else{if(o=Oa,Oa=null,_E=0,Ft&6)throw Error(ve(331));var g=Ft;for(Ft|=4,Be=o.current;Be!==null;){var S=Be,I=S.child;if(Be.flags&16){var L=S.deletions;if(L!==null){for(var M=0;M<L.length;M++){var F=L[M];for(Be=F;Be!==null;){var X=Be;switch(X.tag){case 0:case 11:case 15:Fh(8,X,S)}var H=X.child;if(H!==null)H.return=X,Be=H;else for(;Be!==null;){X=Be;var J=X.sibling,ce=X.return;if(HF(X),X===F){Be=null;break}if(J!==null){J.return=ce,Be=J;break}Be=ce}}}var se=S.alternate;if(se!==null){var pe=se.child;if(pe!==null){se.child=null;do{var we=pe.sibling;pe.sibling=null,pe=we}while(pe!==null)}}Be=S}}if(S.subtreeFlags&2064&&I!==null)I.return=S,Be=I;else e:for(;Be!==null;){if(S=Be,S.flags&2048)switch(S.tag){case 0:case 11:case 15:Fh(9,S,S.return)}var z=S.sibling;if(z!==null){z.return=S.return,Be=z;break e}Be=S.return}}var W=o.current;for(Be=W;Be!==null;){I=Be;var K=I.child;if(I.subtreeFlags&2064&&K!==null)K.return=I,Be=K;else e:for(I=W;Be!==null;){if(L=Be,L.flags&2048)try{switch(L.tag){case 0:case 11:case 15:bE(9,L)}}catch(Ie){Un(L,L.return,Ie)}if(L===I){Be=null;break e}var Ee=L.sibling;if(Ee!==null){Ee.return=L.return,Be=Ee;break e}Be=L.return}}if(Ft=g,Ga(),os&&typeof os.onPostCommitFiberRoot=="function")try{os.onPostCommitFiberRoot(TE,o)}catch{}f=!0}return f}finally{Jt=h,to.transition=c}}return!1}function xx(o,c,h){c=xl(h,c),c=kF(o,c,1),o=La(o,c,1),c=Br(),o!==null&&(ap(o,1,c),ci(o,c))}function Un(o,c,h){if(o.tag===3)xx(o,o,h);else for(;c!==null;){if(c.tag===3){xx(c,o,h);break}else if(c.tag===1){var f=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ma===null||!Ma.has(f))){o=xl(h,o),o=LF(c,o,1),c=La(c,o,1),o=Br(),c!==null&&(ap(c,1,o),ci(c,o));break}}c=c.return}}function b$(o,c,h){var f=o.pingCache;f!==null&&f.delete(c),c=Br(),o.pingedLanes|=o.suspendedLanes&h,lr===o&&(Sr&h)===h&&(nr===4||nr===3&&(Sr&130023424)===Sr&&500>Wn()-l0?xc(o,0):d0|=h),ci(o,c)}function eB(o,c){c===0&&(o.mode&1?(c=vm,vm<<=1,!(vm&130023424)&&(vm=4194304)):c=1);var h=Br();o=Ls(o,c),o!==null&&(ap(o,c,h),ci(o,h))}function O$(o){var c=o.memoizedState,h=0;c!==null&&(h=c.retryLane),eB(o,h)}function N$(o,c){var h=0;switch(o.tag){case 13:var f=o.stateNode,g=o.memoizedState;g!==null&&(h=g.retryLane);break;case 19:f=o.stateNode;break;default:throw Error(ve(314))}f!==null&&f.delete(c),eB(o,h)}var tB;tB=function(o,c,h){if(o!==null)if(o.memoizedProps!==c.pendingProps||si.current)oi=!0;else{if(!(o.lanes&h)&&!(c.flags&128))return oi=!1,E$(o,c,h);oi=!!(o.flags&131072)}else oi=!1,Sn&&c.flags&1048576&&oF(c,sE,c.index);switch(c.lanes=0,c.tag){case 2:var f=c.type;Gm(o,c),o=c.pendingProps;var g=kl(c,Pr.current);Nl(c,h),g=r0(null,c,f,o,g,h);var S=i0();return c.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(c.tag=1,c.memoizedState=null,c.updateQueue=null,ai(f)?(S=!0,iE(c)):S=!1,c.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,ZC(c),g.updater=AE,c.stateNode=g,g._reactInternals=c,cC(c,f,o,h),c=uC(null,c,f,!0,S,h)):(c.tag=0,Sn&&S&&KC(c),Fr(null,c,g,h),c=c.child),c;case 16:f=c.elementType;e:{switch(Gm(o,c),o=c.pendingProps,g=f._init,f=g(f._payload),c.type=f,g=c.tag=P$(f),o=Ao(f,o),g){case 0:c=lC(null,c,f,o,h);break e;case 1:c=Ax(null,c,f,o,h);break e;case 11:c=Ix(null,c,f,o,h);break e;case 14:c=wx(null,c,f,Ao(f.type,o),h);break e}throw Error(ve(306,f,""))}return c;case 0:return f=c.type,g=c.pendingProps,g=c.elementType===f?g:Ao(f,g),lC(o,c,f,g,h);case 1:return f=c.type,g=c.pendingProps,g=c.elementType===f?g:Ao(f,g),Ax(o,c,f,g,h);case 3:e:{if(VF(c),o===null)throw Error(ve(387));f=c.pendingProps,S=c.memoizedState,g=S.element,uF(o,c),dE(c,f,null,h);var I=c.memoizedState;if(f=I.element,S.isDehydrated)if(S={element:f,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},c.updateQueue.baseState=S,c.memoizedState=S,c.flags&256){g=xl(Error(ve(423)),c),c=bx(o,c,f,h,g);break e}else if(f!==g){g=xl(Error(ve(424)),c),c=bx(o,c,f,h,g);break e}else for(Ci=ka(c.stateNode.containerInfo.firstChild),Ii=c,Sn=!0,Oo=null,h=dF(c,null,f,h),c.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Ll(),f===g){c=Ms(o,c,h);break e}Fr(o,c,f,h)}c=c.child}return c;case 5:return hF(c),o===null&&oC(c),f=c.type,g=c.pendingProps,S=o!==null?o.memoizedProps:null,I=g.children,eC(f,g)?I=null:S!==null&&eC(f,S)&&(c.flags|=32),xF(o,c),Fr(o,c,I,h),c.child;case 6:return o===null&&oC(c),null;case 13:return FF(o,c,h);case 4:return $C(c,c.stateNode.containerInfo),f=c.pendingProps,o===null?c.child=Ml(c,null,f,h):Fr(o,c,f,h),c.child;case 11:return f=c.type,g=c.pendingProps,g=c.elementType===f?g:Ao(f,g),Ix(o,c,f,g,h);case 7:return Fr(o,c,c.pendingProps,h),c.child;case 8:return Fr(o,c,c.pendingProps.children,h),c.child;case 12:return Fr(o,c,c.pendingProps.children,h),c.child;case 10:e:{if(f=c.type._context,g=c.pendingProps,S=c.memoizedProps,I=g.value,ln(aE,f._currentValue),f._currentValue=I,S!==null)if(Po(S.value,I)){if(S.children===g.children&&!si.current){c=Ms(o,c,h);break e}}else for(S=c.child,S!==null&&(S.return=c);S!==null;){var L=S.dependencies;if(L!==null){I=S.child;for(var M=L.firstContext;M!==null;){if(M.context===f){if(S.tag===1){M=Ns(-1,h&-h),M.tag=2;var F=S.updateQueue;if(F!==null){F=F.shared;var X=F.pending;X===null?M.next=M:(M.next=X.next,X.next=M),F.pending=M}}S.lanes|=h,M=S.alternate,M!==null&&(M.lanes|=h),sC(S.return,h,c),L.lanes|=h;break}M=M.next}}else if(S.tag===10)I=S.type===c.type?null:S.child;else if(S.tag===18){if(I=S.return,I===null)throw Error(ve(341));I.lanes|=h,L=I.alternate,L!==null&&(L.lanes|=h),sC(I,h,c),I=S.sibling}else I=S.child;if(I!==null)I.return=S;else for(I=S;I!==null;){if(I===c){I=null;break}if(S=I.sibling,S!==null){S.return=I.return,I=S;break}I=I.return}S=I}Fr(o,c,g.children,h),c=c.child}return c;case 9:return g=c.type,f=c.pendingProps.children,Nl(c,h),g=no(g),f=f(g),c.flags|=1,Fr(o,c,f,h),c.child;case 14:return f=c.type,g=Ao(f,c.pendingProps),g=Ao(f.type,g),wx(o,c,f,g,h);case 15:return MF(o,c,c.type,c.pendingProps,h);case 17:return f=c.type,g=c.pendingProps,g=c.elementType===f?g:Ao(f,g),Gm(o,c),c.tag=1,ai(f)?(o=!0,iE(c)):o=!1,Nl(c,h),PF(c,f,g),cC(c,f,g,h),uC(null,c,f,!0,o,h);case 19:return BF(o,c,h);case 22:return UF(o,c,h)}throw Error(ve(156,c.tag))};function nB(o,c){return OV(o,c)}function D$(o,c,h,f){this.tag=o,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function eo(o,c,h,f){return new D$(o,c,h,f)}function f0(o){return o=o.prototype,!(!o||!o.isReactComponent)}function P$(o){if(typeof o=="function")return f0(o)?1:0;if(o!=null){if(o=o.$$typeof,o===kC)return 11;if(o===LC)return 14}return 2}function xa(o,c){var h=o.alternate;return h===null?(h=eo(o.tag,c,o.key,o.mode),h.elementType=o.elementType,h.type=o.type,h.stateNode=o.stateNode,h.alternate=o,o.alternate=h):(h.pendingProps=c,h.type=o.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=o.flags&14680064,h.childLanes=o.childLanes,h.lanes=o.lanes,h.child=o.child,h.memoizedProps=o.memoizedProps,h.memoizedState=o.memoizedState,h.updateQueue=o.updateQueue,c=o.dependencies,h.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},h.sibling=o.sibling,h.index=o.index,h.ref=o.ref,h}function Km(o,c,h,f,g,S){var I=2;if(f=o,typeof o=="function")f0(o)&&(I=1);else if(typeof o=="string")I=5;else e:switch(o){case _l:return Vc(h.children,g,S,c);case PC:I=8,g|=8;break;case Py:return o=eo(12,h,c,g|2),o.elementType=Py,o.lanes=S,o;case ky:return o=eo(13,h,c,g),o.elementType=ky,o.lanes=S,o;case Ly:return o=eo(19,h,c,g),o.elementType=Ly,o.lanes=S,o;case hV:return NE(h,g,S,c);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case lV:I=10;break e;case uV:I=9;break e;case kC:I=11;break e;case LC:I=14;break e;case Ca:I=16,f=null;break e}throw Error(ve(130,o==null?o:typeof o,""))}return c=eo(I,h,c,g),c.elementType=o,c.type=f,c.lanes=S,c}function Vc(o,c,h,f){return o=eo(7,o,f,c),o.lanes=h,o}function NE(o,c,h,f){return o=eo(22,o,f,c),o.elementType=hV,o.lanes=h,o.stateNode={isHidden:!1},o}function Iy(o,c,h){return o=eo(6,o,null,c),o.lanes=h,o}function wy(o,c,h){return c=eo(4,o.children!==null?o.children:[],o.key,c),c.lanes=h,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}function k$(o,c,h,f,g){this.tag=c,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sy(0),this.expirationTimes=sy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sy(0),this.identifierPrefix=f,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function _0(o,c,h,f,g,S,I,L,M){return o=new k$(o,c,h,L,M),c===1?(c=1,S===!0&&(c|=8)):c=0,S=eo(3,null,null,c),o.current=S,S.stateNode=o,S.memoizedState={element:f,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},ZC(S),o}function L$(o,c,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fl,key:f==null?null:""+f,children:o,containerInfo:c,implementation:h}}function rB(o){if(!o)return Fa;o=o._reactInternals;e:{if(Kc(o)!==o||o.tag!==1)throw Error(ve(170));var c=o;do{switch(c.tag){case 3:c=c.stateNode.context;break e;case 1:if(ai(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break e}}c=c.return}while(c!==null);throw Error(ve(171))}if(o.tag===1){var h=o.type;if(ai(h))return rF(o,h,c)}return c}function iB(o,c,h,f,g,S,I,L,M){return o=_0(h,f,!0,o,g,S,I,L,M),o.context=rB(null),h=o.current,f=Br(),g=Ua(h),S=Ns(f,g),S.callback=c??null,La(h,S,g),o.current.lanes=g,ap(o,g,f),ci(o,f),o}function DE(o,c,h,f){var g=c.current,S=Br(),I=Ua(g);return h=rB(h),c.context===null?c.context=h:c.pendingContext=h,c=Ns(S,I),c.payload={element:o},f=f===void 0?null:f,f!==null&&(c.callback=f),o=La(g,c,I),o!==null&&(Do(o,g,I,S),Fm(o,g,I)),I}function EE(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Vx(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var h=o.retryLane;o.retryLane=h!==0&&h<c?h:c}}function m0(o,c){Vx(o,c),(o=o.alternate)&&Vx(o,c)}function M$(){return null}var oB=typeof reportError=="function"?reportError:function(o){console.error(o)};function E0(o){this._internalRoot=o}PE.prototype.render=E0.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(ve(409));DE(o,c,null,null)};PE.prototype.unmount=E0.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;Wc(function(){DE(null,o,null,null)}),c[ks]=null}};function PE(o){this._internalRoot=o}PE.prototype.unstable_scheduleHydration=function(o){if(o){var c=UV();o={blockedOn:null,target:o,priority:c};for(var h=0;h<wa.length&&c!==0&&c<wa[h].priority;h++);wa.splice(h,0,o),h===0&&VV(o)}};function g0(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function kE(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function Fx(){}function U$(o,c,h,f,g){if(g){if(typeof f=="function"){var S=f;f=function(){var F=EE(I);S.call(F)}}var I=iB(c,f,o,0,null,!1,!1,"",Fx);return o._reactRootContainer=I,o[ks]=I.current,Jh(o.nodeType===8?o.parentNode:o),Wc(),I}for(;g=o.lastChild;)o.removeChild(g);if(typeof f=="function"){var L=f;f=function(){var F=EE(M);L.call(F)}}var M=_0(o,0,!1,null,null,!1,!1,"",Fx);return o._reactRootContainer=M,o[ks]=M.current,Jh(o.nodeType===8?o.parentNode:o),Wc(function(){DE(c,M,h,f)}),M}function LE(o,c,h,f,g){var S=h._reactRootContainer;if(S){var I=S;if(typeof g=="function"){var L=g;g=function(){var M=EE(I);L.call(M)}}DE(c,I,o,g)}else I=U$(h,c,o,g,f);return EE(I)}LV=function(o){switch(o.tag){case 3:var c=o.stateNode;if(c.current.memoizedState.isDehydrated){var h=Nh(c.pendingLanes);h!==0&&(xC(c,h|1),ci(c,Wn()),!(Ft&6)&&(Vl=Wn()+500,Ga()))}break;case 13:Wc(function(){var f=Ls(o,1);if(f!==null){var g=Br();Do(f,o,1,g)}}),m0(o,1)}};VC=function(o){if(o.tag===13){var c=Ls(o,134217728);if(c!==null){var h=Br();Do(c,o,134217728,h)}m0(o,134217728)}};MV=function(o){if(o.tag===13){var c=Ua(o),h=Ls(o,c);if(h!==null){var f=Br();Do(h,o,c,f)}m0(o,c)}};UV=function(){return Jt};xV=function(o,c){var h=Jt;try{return Jt=o,c()}finally{Jt=h}};Hy=function(o,c,h){switch(c){case"input":if(xy(o,h),c=h.name,h.type==="radio"&&c!=null){for(h=o;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+c)+'][type="radio"]'),c=0;c<h.length;c++){var f=h[c];if(f!==o&&f.form===o.form){var g=CE(f);if(!g)throw Error(ve(90));fV(f),xy(f,g)}}}break;case"textarea":mV(o,h);break;case"select":c=h.value,c!=null&&wl(o,!!h.multiple,c,!1)}};yV=u0;CV=Wc;var x$={usingClientEntryPoint:!1,Events:[dp,Sl,CE,vV,RV,u0]},wh={findFiberByHostInstance:Lc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},V$={bundleType:wh.bundleType,version:wh.version,rendererPackageName:wh.rendererPackageName,rendererConfig:wh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xs.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=AV(o),o===null?null:o.stateNode},findFiberByHostInstance:wh.findFiberByHostInstance||M$,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pm.isDisabled&&Pm.supportsFiber)try{TE=Pm.inject(V$),os=Pm}catch{}}Ai.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x$;Ai.createPortal=function(o,c){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g0(c))throw Error(ve(200));return L$(o,c,null,h)};Ai.createRoot=function(o,c){if(!g0(o))throw Error(ve(299));var h=!1,f="",g=oB;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(f=c.identifierPrefix),c.onRecoverableError!==void 0&&(g=c.onRecoverableError)),c=_0(o,1,!1,null,null,h,!1,f,g),o[ks]=c.current,Jh(o.nodeType===8?o.parentNode:o),new E0(c)};Ai.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(ve(188)):(o=Object.keys(o).join(","),Error(ve(268,o)));return o=AV(c),o=o===null?null:o.stateNode,o};Ai.flushSync=function(o){return Wc(o)};Ai.hydrate=function(o,c,h){if(!kE(c))throw Error(ve(200));return LE(null,o,c,!0,h)};Ai.hydrateRoot=function(o,c,h){if(!g0(o))throw Error(ve(405));var f=h!=null&&h.hydratedSources||null,g=!1,S="",I=oB;if(h!=null&&(h.unstable_strictMode===!0&&(g=!0),h.identifierPrefix!==void 0&&(S=h.identifierPrefix),h.onRecoverableError!==void 0&&(I=h.onRecoverableError)),c=iB(c,null,o,1,h??null,g,!1,S,I),o[ks]=c.current,Jh(o),f)for(o=0;o<f.length;o++)h=f[o],g=h._getVersion,g=g(h._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[h,g]:c.mutableSourceEagerHydrationData.push(h,g);return new PE(c)};Ai.render=function(o,c,h){if(!kE(c))throw Error(ve(200));return LE(null,o,c,!1,h)};Ai.unmountComponentAtNode=function(o){if(!kE(o))throw Error(ve(40));return o._reactRootContainer?(Wc(function(){LE(null,null,o,!1,function(){o._reactRootContainer=null,o[ks]=null})}),!0):!1};Ai.unstable_batchedUpdates=u0;Ai.unstable_renderSubtreeIntoContainer=function(o,c,h,f){if(!kE(h))throw Error(ve(200));if(o==null||o._reactInternals===void 0)throw Error(ve(38));return LE(o,c,h,!1,f)};Ai.version="18.3.1-next-f1338f8080-20240426";function sB(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(sB)}catch(o){console.error(o)}}sB(),sV.exports=Ai;var F$=sV.exports,Bx=F$;Ny.createRoot=Bx.createRoot,Ny.hydrateRoot=Bx.hydrateRoot;const B$="modulepreload",j$=function(o,c){return new URL(o,c).href},jx={},G$=function(c,h,f){if(!h||h.length===0)return c();const g=document.getElementsByTagName("link");return Promise.all(h.map(S=>{if(S=j$(S,f),S in jx)return;jx[S]=!0;const I=S.endsWith(".css"),L=I?'[rel="stylesheet"]':"";if(!!f)for(let X=g.length-1;X>=0;X--){const H=g[X];if(H.href===S&&(!I||H.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${S}"]${L}`))return;const F=document.createElement("link");if(F.rel=I?"stylesheet":B$,I||(F.as="script",F.crossOrigin=""),F.href=S,document.head.appendChild(F),I)return new Promise((X,H)=>{F.addEventListener("load",X),F.addEventListener("error",()=>H(new Error(`Unable to preload CSS for ${S}`)))})})).then(()=>c()).catch(S=>{const I=new Event("vite:preloadError",{cancelable:!0});if(I.payload=S,window.dispatchEvent(I),!I.defaultPrevented)throw S})};var Gx="popstate";function W$(o={}){function c(f,g){let{pathname:S,search:I,hash:L}=f.location;return yC("",{pathname:S,search:I,hash:L},g.state&&g.state.usr||null,g.state&&g.state.key||"default")}function h(f,g){return typeof g=="string"?g:op(g)}return K$(c,h,null,o)}function Jn(o,c){if(o===!1||o===null||typeof o>"u")throw new Error(c)}function ko(o,c){if(!o){typeof console<"u"&&console.warn(c);try{throw new Error(c)}catch{}}}function H$(){return Math.random().toString(36).substring(2,10)}function Wx(o,c){return{usr:o.state,key:o.key,idx:c}}function yC(o,c,h=null,f){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof c=="string"?Gl(c):c,state:h,key:c&&c.key||f||H$()}}function op({pathname:o="/",search:c="",hash:h=""}){return c&&c!=="?"&&(o+=c.charAt(0)==="?"?c:"?"+c),h&&h!=="#"&&(o+=h.charAt(0)==="#"?h:"#"+h),o}function Gl(o){let c={};if(o){let h=o.indexOf("#");h>=0&&(c.hash=o.substring(h),o=o.substring(0,h));let f=o.indexOf("?");f>=0&&(c.search=o.substring(f),o=o.substring(0,f)),o&&(c.pathname=o)}return c}function K$(o,c,h,f={}){let{window:g=document.defaultView,v5Compat:S=!1}=f,I=g.history,L="POP",M=null,F=X();F==null&&(F=0,I.replaceState({...I.state,idx:F},""));function X(){return(I.state||{idx:null}).idx}function H(){L="POP";let we=X(),z=we==null?null:we-F;F=we,M&&M({action:L,location:pe.location,delta:z})}function J(we,z){L="PUSH";let W=yC(pe.location,we,z);h&&h(W,we),F=X()+1;let K=Wx(W,F),Ee=pe.createHref(W);try{I.pushState(K,"",Ee)}catch(Ie){if(Ie instanceof DOMException&&Ie.name==="DataCloneError")throw Ie;g.location.assign(Ee)}S&&M&&M({action:L,location:pe.location,delta:1})}function ce(we,z){L="REPLACE";let W=yC(pe.location,we,z);h&&h(W,we),F=X();let K=Wx(W,F),Ee=pe.createHref(W);I.replaceState(K,"",Ee),S&&M&&M({action:L,location:pe.location,delta:0})}function se(we){return z$(we)}let pe={get action(){return L},get location(){return o(g,I)},listen(we){if(M)throw new Error("A history only accepts one active listener");return g.addEventListener(Gx,H),M=we,()=>{g.removeEventListener(Gx,H),M=null}},createHref(we){return c(g,we)},createURL:se,encodeLocation(we){let z=se(we);return{pathname:z.pathname,search:z.search,hash:z.hash}},push:J,replace:ce,go(we){return I.go(we)}};return pe}function z$(o,c=!1){let h="http://localhost";typeof window<"u"&&(h=window.location.origin!=="null"?window.location.origin:window.location.href),Jn(h,"No window.location.(origin|href) available to create URL");let f=typeof o=="string"?o:op(o);return f=f.replace(/ $/,"%20"),!c&&f.startsWith("//")&&(f=h+f),new URL(f,h)}function aB(o,c,h="/"){return Y$(o,c,h,!1)}function Y$(o,c,h,f){let g=typeof c=="string"?Gl(c):c,S=Us(g.pathname||"/",h);if(S==null)return null;let I=cB(o);q$(I);let L=null;for(let M=0;L==null&&M<I.length;++M){let F=oee(S);L=ree(I[M],F,f)}return L}function cB(o,c=[],h=[],f="",g=!1){let S=(I,L,M=g,F)=>{let X={relativePath:F===void 0?I.path||"":F,caseSensitive:I.caseSensitive===!0,childrenIndex:L,route:I};if(X.relativePath.startsWith("/")){if(!X.relativePath.startsWith(f)&&M)return;Jn(X.relativePath.startsWith(f),`Absolute route path "${X.relativePath}" nested under path "${f}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),X.relativePath=X.relativePath.slice(f.length)}let H=Ds([f,X.relativePath]),J=h.concat(X);I.children&&I.children.length>0&&(Jn(I.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${H}".`),cB(I.children,c,J,H,M)),!(I.path==null&&!I.index)&&c.push({path:H,score:tee(H,I.index),routesMeta:J})};return o.forEach((I,L)=>{var M;if(I.path===""||!((M=I.path)!=null&&M.includes("?")))S(I,L);else for(let F of dB(I.path))S(I,L,!0,F)}),c}function dB(o){let c=o.split("/");if(c.length===0)return[];let[h,...f]=c,g=h.endsWith("?"),S=h.replace(/\?$/,"");if(f.length===0)return g?[S,""]:[S];let I=dB(f.join("/")),L=[];return L.push(...I.map(M=>M===""?S:[S,M].join("/"))),g&&L.push(...I),L.map(M=>o.startsWith("/")&&M===""?"/":M)}function q$(o){o.sort((c,h)=>c.score!==h.score?h.score-c.score:nee(c.routesMeta.map(f=>f.childrenIndex),h.routesMeta.map(f=>f.childrenIndex)))}var X$=/^:[\w-]+$/,J$=3,Q$=2,Z$=1,$$=10,eee=-2,Hx=o=>o==="*";function tee(o,c){let h=o.split("/"),f=h.length;return h.some(Hx)&&(f+=eee),c&&(f+=Q$),h.filter(g=>!Hx(g)).reduce((g,S)=>g+(X$.test(S)?J$:S===""?Z$:$$),f)}function nee(o,c){return o.length===c.length&&o.slice(0,-1).every((f,g)=>f===c[g])?o[o.length-1]-c[c.length-1]:0}function ree(o,c,h=!1){let{routesMeta:f}=o,g={},S="/",I=[];for(let L=0;L<f.length;++L){let M=f[L],F=L===f.length-1,X=S==="/"?c:c.slice(S.length)||"/",H=gE({path:M.relativePath,caseSensitive:M.caseSensitive,end:F},X),J=M.route;if(!H&&F&&h&&!f[f.length-1].route.index&&(H=gE({path:M.relativePath,caseSensitive:M.caseSensitive,end:!1},X)),!H)return null;Object.assign(g,H.params),I.push({params:g,pathname:Ds([S,H.pathname]),pathnameBase:dee(Ds([S,H.pathnameBase])),route:J}),H.pathnameBase!=="/"&&(S=Ds([S,H.pathnameBase]))}return I}function gE(o,c){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[h,f]=iee(o.path,o.caseSensitive,o.end),g=c.match(h);if(!g)return null;let S=g[0],I=S.replace(/(.)\/+$/,"$1"),L=g.slice(1);return{params:f.reduce((F,{paramName:X,isOptional:H},J)=>{if(X==="*"){let se=L[J]||"";I=S.slice(0,S.length-se.length).replace(/(.)\/+$/,"$1")}const ce=L[J];return H&&!ce?F[X]=void 0:F[X]=(ce||"").replace(/%2F/g,"/"),F},{}),pathname:S,pathnameBase:I,pattern:o}}function iee(o,c=!1,h=!0){ko(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let f=[],g="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(I,L,M)=>(f.push({paramName:L,isOptional:M!=null}),M?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(f.push({paramName:"*"}),g+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):h?g+="\\/*$":o!==""&&o!=="/"&&(g+="(?:(?=\\/|$))"),[new RegExp(g,c?void 0:"i"),f]}function oee(o){try{return o.split("/").map(c=>decodeURIComponent(c).replace(/\//g,"%2F")).join("/")}catch(c){return ko(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${c}).`),o}}function Us(o,c){if(c==="/")return o;if(!o.toLowerCase().startsWith(c.toLowerCase()))return null;let h=c.endsWith("/")?c.length-1:c.length,f=o.charAt(h);return f&&f!=="/"?null:o.slice(h)||"/"}var see=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function aee(o,c="/"){let{pathname:h,search:f="",hash:g=""}=typeof o=="string"?Gl(o):o,S;return h?(h=h.replace(/\/\/+/g,"/"),h.startsWith("/")?S=Kx(h.substring(1),"/"):S=Kx(h,c)):S=c,{pathname:S,search:lee(f),hash:uee(g)}}function Kx(o,c){let h=c.replace(/\/+$/,"").split("/");return o.split("/").forEach(g=>{g===".."?h.length>1&&h.pop():g!=="."&&h.push(g)}),h.length>1?h.join("/"):"/"}function Ay(o,c,h,f){return`Cannot include a '${o}' character in a manually specified \`to.${c}\` field [${JSON.stringify(f)}].  Please separate it out to the \`to.${h}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function cee(o){return o.filter((c,h)=>h===0||c.route.path&&c.route.path.length>0)}function lB(o){let c=cee(o);return c.map((h,f)=>f===c.length-1?h.pathname:h.pathnameBase)}function uB(o,c,h,f=!1){let g;typeof o=="string"?g=Gl(o):(g={...o},Jn(!g.pathname||!g.pathname.includes("?"),Ay("?","pathname","search",g)),Jn(!g.pathname||!g.pathname.includes("#"),Ay("#","pathname","hash",g)),Jn(!g.search||!g.search.includes("#"),Ay("#","search","hash",g)));let S=o===""||g.pathname==="",I=S?"/":g.pathname,L;if(I==null)L=h;else{let H=c.length-1;if(!f&&I.startsWith("..")){let J=I.split("/");for(;J[0]==="..";)J.shift(),H-=1;g.pathname=J.join("/")}L=H>=0?c[H]:"/"}let M=aee(g,L),F=I&&I!=="/"&&I.endsWith("/"),X=(S||I===".")&&h.endsWith("/");return!M.pathname.endsWith("/")&&(F||X)&&(M.pathname+="/"),M}var Ds=o=>o.join("/").replace(/\/\/+/g,"/"),dee=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),lee=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,uee=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o,hee=class{constructor(o,c,h,f=!1){this.status=o,this.statusText=c||"",this.internal=f,h instanceof Error?(this.data=h.toString(),this.error=h):this.data=h}};function pee(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}function fee(o){return o.map(c=>c.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var hB=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function pB(o,c){let h=o;if(typeof h!="string"||!see.test(h))return{absoluteURL:void 0,isExternal:!1,to:h};let f=h,g=!1;if(hB)try{let S=new URL(window.location.href),I=h.startsWith("//")?new URL(S.protocol+h):new URL(h),L=Us(I.pathname,c);I.origin===S.origin&&L!=null?h=L+I.search+I.hash:g=!0}catch{ko(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:f,isExternal:g,to:h}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var fB=["POST","PUT","PATCH","DELETE"];new Set(fB);var _ee=["GET",...fB];new Set(_ee);var Wl=le.createContext(null);Wl.displayName="DataRouter";var ME=le.createContext(null);ME.displayName="DataRouterState";var mee=le.createContext(!1),_B=le.createContext({isTransitioning:!1});_B.displayName="ViewTransition";var Eee=le.createContext(new Map);Eee.displayName="Fetchers";var gee=le.createContext(null);gee.displayName="Await";var io=le.createContext(null);io.displayName="Navigation";var up=le.createContext(null);up.displayName="Location";var Vs=le.createContext({outlet:null,matches:[],isDataRoute:!1});Vs.displayName="Route";var S0=le.createContext(null);S0.displayName="RouteError";var mB="REACT_ROUTER_ERROR",See="REDIRECT",Tee="ROUTE_ERROR_RESPONSE";function vee(o){if(o.startsWith(`${mB}:${See}:{`))try{let c=JSON.parse(o.slice(28));if(typeof c=="object"&&c&&typeof c.status=="number"&&typeof c.statusText=="string"&&typeof c.location=="string"&&typeof c.reloadDocument=="boolean"&&typeof c.replace=="boolean")return c}catch{}}function Ree(o){if(o.startsWith(`${mB}:${Tee}:{`))try{let c=JSON.parse(o.slice(40));if(typeof c=="object"&&c&&typeof c.status=="number"&&typeof c.statusText=="string")return new hee(c.status,c.statusText,c.data)}catch{}}function yee(o,{relative:c}={}){Jn(hp(),"useHref() may be used only in the context of a <Router> component.");let{basename:h,navigator:f}=le.useContext(io),{hash:g,pathname:S,search:I}=pp(o,{relative:c}),L=S;return h!=="/"&&(L=S==="/"?h:Ds([h,S])),f.createHref({pathname:L,search:I,hash:g})}function hp(){return le.useContext(up)!=null}function Wa(){return Jn(hp(),"useLocation() may be used only in the context of a <Router> component."),le.useContext(up).location}var EB="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function gB(o){le.useContext(io).static||le.useLayoutEffect(o)}function SB(){let{isDataRoute:o}=le.useContext(Vs);return o?Uee():Cee()}function Cee(){Jn(hp(),"useNavigate() may be used only in the context of a <Router> component.");let o=le.useContext(Wl),{basename:c,navigator:h}=le.useContext(io),{matches:f}=le.useContext(Vs),{pathname:g}=Wa(),S=JSON.stringify(lB(f)),I=le.useRef(!1);return gB(()=>{I.current=!0}),le.useCallback((M,F={})=>{if(ko(I.current,EB),!I.current)return;if(typeof M=="number"){h.go(M);return}let X=uB(M,JSON.parse(S),g,F.relative==="path");o==null&&c!=="/"&&(X.pathname=X.pathname==="/"?c:Ds([c,X.pathname])),(F.replace?h.replace:h.push)(X,F.state,F)},[c,h,S,g,o])}le.createContext(null);function pp(o,{relative:c}={}){let{matches:h}=le.useContext(Vs),{pathname:f}=Wa(),g=JSON.stringify(lB(h));return le.useMemo(()=>uB(o,JSON.parse(g),f,c==="path"),[o,g,f,c])}function Iee(o,c,h,f,g){var W;Jn(hp(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:S}=le.useContext(io),{matches:I}=le.useContext(Vs),L=I[I.length-1],M=L?L.params:{},F=L?L.pathname:"/",X=L?L.pathnameBase:"/",H=L&&L.route;{let K=H&&H.path||"";vB(F,!H||K.endsWith("*")||K.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${F}" (under <Route path="${K}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${K}"> to <Route path="${K==="/"?"*":`${K}/*`}">.`)}let J=Wa(),ce;if(c){let K=typeof c=="string"?Gl(c):c;Jn(X==="/"||((W=K.pathname)==null?void 0:W.startsWith(X)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${X}" but pathname "${K.pathname}" was given in the \`location\` prop.`),ce=K}else ce=J;let se=ce.pathname||"/",pe=se;if(X!=="/"){let K=X.replace(/^\//,"").split("/");pe="/"+se.replace(/^\//,"").split("/").slice(K.length).join("/")}let we=aB(o,{pathname:pe});ko(H||we!=null,`No routes matched location "${ce.pathname}${ce.search}${ce.hash}" `),ko(we==null||we[we.length-1].route.element!==void 0||we[we.length-1].route.Component!==void 0||we[we.length-1].route.lazy!==void 0,`Matched leaf route at location "${ce.pathname}${ce.search}${ce.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let z=Nee(we&&we.map(K=>Object.assign({},K,{params:Object.assign({},M,K.params),pathname:Ds([X,S.encodeLocation?S.encodeLocation(K.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:K.pathname]),pathnameBase:K.pathnameBase==="/"?X:Ds([X,S.encodeLocation?S.encodeLocation(K.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:K.pathnameBase])})),I,h,f,g);return c&&z?le.createElement(up.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ce},navigationType:"POP"}},z):z}function wee(){let o=Mee(),c=pee(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),h=o instanceof Error?o.stack:null,f="rgba(200,200,200, 0.5)",g={padding:"0.5rem",backgroundColor:f},S={padding:"2px 4px",backgroundColor:f},I=null;return console.error("Error handled by React Router default ErrorBoundary:",o),I=le.createElement(le.Fragment,null,le.createElement("p",null," Hey developer "),le.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",le.createElement("code",{style:S},"ErrorBoundary")," or"," ",le.createElement("code",{style:S},"errorElement")," prop on your route.")),le.createElement(le.Fragment,null,le.createElement("h2",null,"Unexpected Application Error!"),le.createElement("h3",{style:{fontStyle:"italic"}},c),h?le.createElement("pre",{style:g},h):null,I)}var Aee=le.createElement(wee,null),TB=class extends le.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,c){return c.location!==o.location||c.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:c.error,location:c.location,revalidation:o.revalidation||c.revalidation}}componentDidCatch(o,c){this.props.onError?this.props.onError(o,c):console.error("React Router caught the following error during render",o)}render(){let o=this.state.error;if(this.context&&typeof o=="object"&&o&&"digest"in o&&typeof o.digest=="string"){const h=Ree(o.digest);h&&(o=h)}let c=o!==void 0?le.createElement(Vs.Provider,{value:this.props.routeContext},le.createElement(S0.Provider,{value:o,children:this.props.component})):this.props.children;return this.context?le.createElement(bee,{error:o},c):c}};TB.contextType=mee;var by=new WeakMap;function bee({children:o,error:c}){let{basename:h}=le.useContext(io);if(typeof c=="object"&&c&&"digest"in c&&typeof c.digest=="string"){let f=vee(c.digest);if(f){let g=by.get(c);if(g)throw g;let S=pB(f.location,h);if(hB&&!by.get(c))if(S.isExternal||f.reloadDocument)window.location.href=S.absoluteURL||S.to;else{const I=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(S.to,{replace:f.replace}));throw by.set(c,I),I}return le.createElement("meta",{httpEquiv:"refresh",content:`0;url=${S.absoluteURL||S.to}`})}}return o}function Oee({routeContext:o,match:c,children:h}){let f=le.useContext(Wl);return f&&f.static&&f.staticContext&&(c.route.errorElement||c.route.ErrorBoundary)&&(f.staticContext._deepestRenderedBoundaryId=c.route.id),le.createElement(Vs.Provider,{value:o},h)}function Nee(o,c=[],h=null,f=null,g=null){if(o==null){if(!h)return null;if(h.errors)o=h.matches;else if(c.length===0&&!h.initialized&&h.matches.length>0)o=h.matches;else return null}let S=o,I=h==null?void 0:h.errors;if(I!=null){let X=S.findIndex(H=>H.route.id&&(I==null?void 0:I[H.route.id])!==void 0);Jn(X>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(I).join(",")}`),S=S.slice(0,Math.min(S.length,X+1))}let L=!1,M=-1;if(h)for(let X=0;X<S.length;X++){let H=S[X];if((H.route.HydrateFallback||H.route.hydrateFallbackElement)&&(M=X),H.route.id){let{loaderData:J,errors:ce}=h,se=H.route.loader&&!J.hasOwnProperty(H.route.id)&&(!ce||ce[H.route.id]===void 0);if(H.route.lazy||se){L=!0,M>=0?S=S.slice(0,M+1):S=[S[0]];break}}}let F=h&&f?(X,H)=>{var J,ce;f(X,{location:h.location,params:((ce=(J=h.matches)==null?void 0:J[0])==null?void 0:ce.params)??{},unstable_pattern:fee(h.matches),errorInfo:H})}:void 0;return S.reduceRight((X,H,J)=>{let ce,se=!1,pe=null,we=null;h&&(ce=I&&H.route.id?I[H.route.id]:void 0,pe=H.route.errorElement||Aee,L&&(M<0&&J===0?(vB("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),se=!0,we=null):M===J&&(se=!0,we=H.route.hydrateFallbackElement||null)));let z=c.concat(S.slice(0,J+1)),W=()=>{let K;return ce?K=pe:se?K=we:H.route.Component?K=le.createElement(H.route.Component,null):H.route.element?K=H.route.element:K=X,le.createElement(Oee,{match:H,routeContext:{outlet:X,matches:z,isDataRoute:h!=null},children:K})};return h&&(H.route.ErrorBoundary||H.route.errorElement||J===0)?le.createElement(TB,{location:h.location,revalidation:h.revalidation,component:pe,error:ce,children:W(),routeContext:{outlet:null,matches:z,isDataRoute:!0},onError:F}):W()},null)}function T0(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Dee(o){let c=le.useContext(Wl);return Jn(c,T0(o)),c}function Pee(o){let c=le.useContext(ME);return Jn(c,T0(o)),c}function kee(o){let c=le.useContext(Vs);return Jn(c,T0(o)),c}function v0(o){let c=kee(o),h=c.matches[c.matches.length-1];return Jn(h.route.id,`${o} can only be used on routes that contain a unique "id"`),h.route.id}function Lee(){return v0("useRouteId")}function Mee(){var f;let o=le.useContext(S0),c=Pee("useRouteError"),h=v0("useRouteError");return o!==void 0?o:(f=c.errors)==null?void 0:f[h]}function Uee(){let{router:o}=Dee("useNavigate"),c=v0("useNavigate"),h=le.useRef(!1);return gB(()=>{h.current=!0}),le.useCallback(async(g,S={})=>{ko(h.current,EB),h.current&&(typeof g=="number"?await o.navigate(g):await o.navigate(g,{fromRouteId:c,...S}))},[o,c])}var zx={};function vB(o,c,h){!c&&!zx[o]&&(zx[o]=!0,ko(!1,h))}le.memo(xee);function xee({routes:o,future:c,state:h,onError:f}){return Iee(o,void 0,h,f,c)}function Vee({basename:o="/",children:c=null,location:h,navigationType:f="POP",navigator:g,static:S=!1,unstable_useTransitions:I}){Jn(!hp(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let L=o.replace(/^\/*/,"/"),M=le.useMemo(()=>({basename:L,navigator:g,static:S,unstable_useTransitions:I,future:{}}),[L,g,S,I]);typeof h=="string"&&(h=Gl(h));let{pathname:F="/",search:X="",hash:H="",state:J=null,key:ce="default"}=h,se=le.useMemo(()=>{let pe=Us(F,L);return pe==null?null:{location:{pathname:pe,search:X,hash:H,state:J,key:ce},navigationType:f}},[L,F,X,H,J,ce,f]);return ko(se!=null,`<Router basename="${L}"> is not able to match the URL "${F}${X}${H}" because it does not start with the basename, so the <Router> won't render anything.`),se==null?null:le.createElement(io.Provider,{value:M},le.createElement(up.Provider,{children:c,value:se}))}var zm="get",Ym="application/x-www-form-urlencoded";function UE(o){return typeof HTMLElement<"u"&&o instanceof HTMLElement}function Fee(o){return UE(o)&&o.tagName.toLowerCase()==="button"}function Bee(o){return UE(o)&&o.tagName.toLowerCase()==="form"}function jee(o){return UE(o)&&o.tagName.toLowerCase()==="input"}function Gee(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function Wee(o,c){return o.button===0&&(!c||c==="_self")&&!Gee(o)}function CC(o=""){return new URLSearchParams(typeof o=="string"||Array.isArray(o)||o instanceof URLSearchParams?o:Object.keys(o).reduce((c,h)=>{let f=o[h];return c.concat(Array.isArray(f)?f.map(g=>[h,g]):[[h,f]])},[]))}function Hee(o,c){let h=CC(o);return c&&c.forEach((f,g)=>{h.has(g)||c.getAll(g).forEach(S=>{h.append(g,S)})}),h}var km=null;function Kee(){if(km===null)try{new FormData(document.createElement("form"),0),km=!1}catch{km=!0}return km}var zee=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Oy(o){return o!=null&&!zee.has(o)?(ko(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ym}"`),null):o}function Yee(o,c){let h,f,g,S,I;if(Bee(o)){let L=o.getAttribute("action");f=L?Us(L,c):null,h=o.getAttribute("method")||zm,g=Oy(o.getAttribute("enctype"))||Ym,S=new FormData(o)}else if(Fee(o)||jee(o)&&(o.type==="submit"||o.type==="image")){let L=o.form;if(L==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let M=o.getAttribute("formaction")||L.getAttribute("action");if(f=M?Us(M,c):null,h=o.getAttribute("formmethod")||L.getAttribute("method")||zm,g=Oy(o.getAttribute("formenctype"))||Oy(L.getAttribute("enctype"))||Ym,S=new FormData(L,o),!Kee()){let{name:F,type:X,value:H}=o;if(X==="image"){let J=F?`${F}.`:"";S.append(`${J}x`,"0"),S.append(`${J}y`,"0")}else F&&S.append(F,H)}}else{if(UE(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');h=zm,f=null,g=Ym,I=o}return S&&g==="text/plain"&&(I=S,S=void 0),{action:f,method:h.toLowerCase(),encType:g,formData:S,body:I}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function R0(o,c){if(o===!1||o===null||typeof o>"u")throw new Error(c)}function qee(o,c,h,f){let g=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return h?g.pathname.endsWith("/")?g.pathname=`${g.pathname}_.${f}`:g.pathname=`${g.pathname}.${f}`:g.pathname==="/"?g.pathname=`_root.${f}`:c&&Us(g.pathname,c)==="/"?g.pathname=`${c.replace(/\/$/,"")}/_root.${f}`:g.pathname=`${g.pathname.replace(/\/$/,"")}.${f}`,g}async function Xee(o,c){if(o.id in c)return c[o.id];try{let h=await G$(()=>import(o.module),[],import.meta.url);return c[o.id]=h,h}catch(h){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(h),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Jee(o){return o!=null&&typeof o.page=="string"}function Qee(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function Zee(o,c,h){let f=await Promise.all(o.map(async g=>{let S=c.routes[g.route.id];if(S){let I=await Xee(S,h);return I.links?I.links():[]}return[]}));return nte(f.flat(1).filter(Qee).filter(g=>g.rel==="stylesheet"||g.rel==="preload").map(g=>g.rel==="stylesheet"?{...g,rel:"prefetch",as:"style"}:{...g,rel:"prefetch"}))}function Yx(o,c,h,f,g,S){let I=(M,F)=>h[F]?M.route.id!==h[F].route.id:!0,L=(M,F)=>{var X;return h[F].pathname!==M.pathname||((X=h[F].route.path)==null?void 0:X.endsWith("*"))&&h[F].params["*"]!==M.params["*"]};return S==="assets"?c.filter((M,F)=>I(M,F)||L(M,F)):S==="data"?c.filter((M,F)=>{var H;let X=f.routes[M.route.id];if(!X||!X.hasLoader)return!1;if(I(M,F)||L(M,F))return!0;if(M.route.shouldRevalidate){let J=M.route.shouldRevalidate({currentUrl:new URL(g.pathname+g.search+g.hash,window.origin),currentParams:((H=h[0])==null?void 0:H.params)||{},nextUrl:new URL(o,window.origin),nextParams:M.params,defaultShouldRevalidate:!0});if(typeof J=="boolean")return J}return!0}):[]}function $ee(o,c,{includeHydrateFallback:h}={}){return ete(o.map(f=>{let g=c.routes[f.route.id];if(!g)return[];let S=[g.module];return g.clientActionModule&&(S=S.concat(g.clientActionModule)),g.clientLoaderModule&&(S=S.concat(g.clientLoaderModule)),h&&g.hydrateFallbackModule&&(S=S.concat(g.hydrateFallbackModule)),g.imports&&(S=S.concat(g.imports)),S}).flat(1))}function ete(o){return[...new Set(o)]}function tte(o){let c={},h=Object.keys(o).sort();for(let f of h)c[f]=o[f];return c}function nte(o,c){let h=new Set,f=new Set(c);return o.reduce((g,S)=>{if(c&&!Jee(S)&&S.as==="script"&&S.href&&f.has(S.href))return g;let L=JSON.stringify(tte(S));return h.has(L)||(h.add(L),g.push({key:L,link:S})),g},[])}function RB(){let o=le.useContext(Wl);return R0(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function rte(){let o=le.useContext(ME);return R0(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var y0=le.createContext(void 0);y0.displayName="FrameworkContext";function yB(){let o=le.useContext(y0);return R0(o,"You must render this element inside a <HydratedRouter> element"),o}function ite(o,c){let h=le.useContext(y0),[f,g]=le.useState(!1),[S,I]=le.useState(!1),{onFocus:L,onBlur:M,onMouseEnter:F,onMouseLeave:X,onTouchStart:H}=c,J=le.useRef(null);le.useEffect(()=>{if(o==="render"&&I(!0),o==="viewport"){let pe=z=>{z.forEach(W=>{I(W.isIntersecting)})},we=new IntersectionObserver(pe,{threshold:.5});return J.current&&we.observe(J.current),()=>{we.disconnect()}}},[o]),le.useEffect(()=>{if(f){let pe=setTimeout(()=>{I(!0)},100);return()=>{clearTimeout(pe)}}},[f]);let ce=()=>{g(!0)},se=()=>{g(!1),I(!1)};return h?o!=="intent"?[S,J,{}]:[S,J,{onFocus:Ah(L,ce),onBlur:Ah(M,se),onMouseEnter:Ah(F,ce),onMouseLeave:Ah(X,se),onTouchStart:Ah(H,ce)}]:[!1,J,{}]}function Ah(o,c){return h=>{o&&o(h),h.defaultPrevented||c(h)}}function ote({page:o,...c}){let{router:h}=RB(),f=le.useMemo(()=>aB(h.routes,o,h.basename),[h.routes,o,h.basename]);return f?le.createElement(ate,{page:o,matches:f,...c}):null}function ste(o){let{manifest:c,routeModules:h}=yB(),[f,g]=le.useState([]);return le.useEffect(()=>{let S=!1;return Zee(o,c,h).then(I=>{S||g(I)}),()=>{S=!0}},[o,c,h]),f}function ate({page:o,matches:c,...h}){let f=Wa(),{future:g,manifest:S,routeModules:I}=yB(),{basename:L}=RB(),{loaderData:M,matches:F}=rte(),X=le.useMemo(()=>Yx(o,c,F,S,f,"data"),[o,c,F,S,f]),H=le.useMemo(()=>Yx(o,c,F,S,f,"assets"),[o,c,F,S,f]),J=le.useMemo(()=>{if(o===f.pathname+f.search+f.hash)return[];let pe=new Set,we=!1;if(c.forEach(W=>{var Ee;let K=S.routes[W.route.id];!K||!K.hasLoader||(!X.some(Ie=>Ie.route.id===W.route.id)&&W.route.id in M&&((Ee=I[W.route.id])!=null&&Ee.shouldRevalidate)||K.hasClientLoader?we=!0:pe.add(W.route.id))}),pe.size===0)return[];let z=qee(o,L,g.unstable_trailingSlashAwareDataRequests,"data");return we&&pe.size>0&&z.searchParams.set("_routes",c.filter(W=>pe.has(W.route.id)).map(W=>W.route.id).join(",")),[z.pathname+z.search]},[L,g.unstable_trailingSlashAwareDataRequests,M,f,S,X,c,o,I]),ce=le.useMemo(()=>$ee(H,S),[H,S]),se=ste(H);return le.createElement(le.Fragment,null,J.map(pe=>le.createElement("link",{key:pe,rel:"prefetch",as:"fetch",href:pe,...h})),ce.map(pe=>le.createElement("link",{key:pe,rel:"modulepreload",href:pe,...h})),se.map(({key:pe,link:we})=>le.createElement("link",{key:pe,nonce:h.nonce,...we,crossOrigin:we.crossOrigin??h.crossOrigin})))}function cte(...o){return c=>{o.forEach(h=>{typeof h=="function"?h(c):h!=null&&(h.current=c)})}}var dte=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{dte&&(window.__reactRouterVersion="7.13.0")}catch{}function lte({basename:o,children:c,unstable_useTransitions:h,window:f}){let g=le.useRef();g.current==null&&(g.current=W$({window:f,v5Compat:!0}));let S=g.current,[I,L]=le.useState({action:S.action,location:S.location}),M=le.useCallback(F=>{h===!1?L(F):le.startTransition(()=>L(F))},[h]);return le.useLayoutEffect(()=>S.listen(M),[S,M]),le.createElement(Vee,{basename:o,children:c,location:I.location,navigationType:I.action,navigator:S,unstable_useTransitions:h})}var CB=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,IB=le.forwardRef(function({onClick:c,discover:h="render",prefetch:f="none",relative:g,reloadDocument:S,replace:I,state:L,target:M,to:F,preventScrollReset:X,viewTransition:H,unstable_defaultShouldRevalidate:J,...ce},se){let{basename:pe,unstable_useTransitions:we}=le.useContext(io),z=typeof F=="string"&&CB.test(F),W=pB(F,pe);F=W.to;let K=yee(F,{relative:g}),[Ee,Ie,Le]=ite(f,ce),be=fte(F,{replace:I,state:L,target:M,preventScrollReset:X,relative:g,viewTransition:H,unstable_defaultShouldRevalidate:J,unstable_useTransitions:we});function je(ge){c&&c(ge),ge.defaultPrevented||be(ge)}let Bt=le.createElement("a",{...ce,...Le,href:W.absoluteURL||K,onClick:W.isExternal||S?c:je,ref:cte(se,Ie),target:M,"data-discover":!z&&h==="render"?"true":void 0});return Ee&&!z?le.createElement(le.Fragment,null,Bt,le.createElement(ote,{page:K})):Bt});IB.displayName="Link";var ute=le.forwardRef(function({"aria-current":c="page",caseSensitive:h=!1,className:f="",end:g=!1,style:S,to:I,viewTransition:L,children:M,...F},X){let H=pp(I,{relative:F.relative}),J=Wa(),ce=le.useContext(ME),{navigator:se,basename:pe}=le.useContext(io),we=ce!=null&&Tte(H)&&L===!0,z=se.encodeLocation?se.encodeLocation(H).pathname:H.pathname,W=J.pathname,K=ce&&ce.navigation&&ce.navigation.location?ce.navigation.location.pathname:null;h||(W=W.toLowerCase(),K=K?K.toLowerCase():null,z=z.toLowerCase()),K&&pe&&(K=Us(K,pe)||K);const Ee=z!=="/"&&z.endsWith("/")?z.length-1:z.length;let Ie=W===z||!g&&W.startsWith(z)&&W.charAt(Ee)==="/",Le=K!=null&&(K===z||!g&&K.startsWith(z)&&K.charAt(z.length)==="/"),be={isActive:Ie,isPending:Le,isTransitioning:we},je=Ie?c:void 0,Bt;typeof f=="function"?Bt=f(be):Bt=[f,Ie?"active":null,Le?"pending":null,we?"transitioning":null].filter(Boolean).join(" ");let ge=typeof S=="function"?S(be):S;return le.createElement(IB,{...F,"aria-current":je,className:Bt,ref:X,style:ge,to:I,viewTransition:L},typeof M=="function"?M(be):M)});ute.displayName="NavLink";var hte=le.forwardRef(({discover:o="render",fetcherKey:c,navigate:h,reloadDocument:f,replace:g,state:S,method:I=zm,action:L,onSubmit:M,relative:F,preventScrollReset:X,viewTransition:H,unstable_defaultShouldRevalidate:J,...ce},se)=>{let{unstable_useTransitions:pe}=le.useContext(io),we=gte(),z=Ste(L,{relative:F}),W=I.toLowerCase()==="get"?"get":"post",K=typeof L=="string"&&CB.test(L),Ee=Ie=>{if(M&&M(Ie),Ie.defaultPrevented)return;Ie.preventDefault();let Le=Ie.nativeEvent.submitter,be=(Le==null?void 0:Le.getAttribute("formmethod"))||I,je=()=>we(Le||Ie.currentTarget,{fetcherKey:c,method:be,navigate:h,replace:g,state:S,relative:F,preventScrollReset:X,viewTransition:H,unstable_defaultShouldRevalidate:J});pe&&h!==!1?le.startTransition(()=>je()):je()};return le.createElement("form",{ref:se,method:W,action:z,onSubmit:f?M:Ee,...ce,"data-discover":!K&&o==="render"?"true":void 0})});hte.displayName="Form";function pte(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function wB(o){let c=le.useContext(Wl);return Jn(c,pte(o)),c}function fte(o,{target:c,replace:h,state:f,preventScrollReset:g,relative:S,viewTransition:I,unstable_defaultShouldRevalidate:L,unstable_useTransitions:M}={}){let F=SB(),X=Wa(),H=pp(o,{relative:S});return le.useCallback(J=>{if(Wee(J,c)){J.preventDefault();let ce=h!==void 0?h:op(X)===op(H),se=()=>F(o,{replace:ce,state:f,preventScrollReset:g,relative:S,viewTransition:I,unstable_defaultShouldRevalidate:L});M?le.startTransition(()=>se()):se()}},[X,F,H,h,f,c,o,g,S,I,L,M])}function _te(o){ko(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let c=le.useRef(CC(o)),h=le.useRef(!1),f=Wa(),g=le.useMemo(()=>Hee(f.search,h.current?null:c.current),[f.search]),S=SB(),I=le.useCallback((L,M)=>{const F=CC(typeof L=="function"?L(new URLSearchParams(g)):L);h.current=!0,S("?"+F,M)},[S,g]);return[g,I]}var mte=0,Ete=()=>`__${String(++mte)}__`;function gte(){let{router:o}=wB("useSubmit"),{basename:c}=le.useContext(io),h=Lee(),f=o.fetch,g=o.navigate;return le.useCallback(async(S,I={})=>{let{action:L,method:M,encType:F,formData:X,body:H}=Yee(S,c);if(I.navigate===!1){let J=I.fetcherKey||Ete();await f(J,h,I.action||L,{unstable_defaultShouldRevalidate:I.unstable_defaultShouldRevalidate,preventScrollReset:I.preventScrollReset,formData:X,body:H,formMethod:I.method||M,formEncType:I.encType||F,flushSync:I.flushSync})}else await g(I.action||L,{unstable_defaultShouldRevalidate:I.unstable_defaultShouldRevalidate,preventScrollReset:I.preventScrollReset,formData:X,body:H,formMethod:I.method||M,formEncType:I.encType||F,replace:I.replace,state:I.state,fromRouteId:h,flushSync:I.flushSync,viewTransition:I.viewTransition})},[f,g,c,h])}function Ste(o,{relative:c}={}){let{basename:h}=le.useContext(io),f=le.useContext(Vs);Jn(f,"useFormAction must be used inside a RouteContext");let[g]=f.matches.slice(-1),S={...pp(o||".",{relative:c})},I=Wa();if(o==null){S.search=I.search;let L=new URLSearchParams(S.search),M=L.getAll("index");if(M.some(X=>X==="")){L.delete("index"),M.filter(H=>H).forEach(H=>L.append("index",H));let X=L.toString();S.search=X?`?${X}`:""}}return(!o||o===".")&&g.route.index&&(S.search=S.search?S.search.replace(/^\?/,"?index&"):"?index"),h!=="/"&&(S.pathname=S.pathname==="/"?h:Ds([h,S.pathname])),op(S)}function Tte(o,{relative:c}={}){let h=le.useContext(_B);Jn(h!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:f}=wB("useViewTransitionState"),g=pp(o,{relative:c});if(!h.isTransitioning)return!1;let S=Us(h.currentLocation.pathname,f)||h.currentLocation.pathname,I=Us(h.nextLocation.pathname,f)||h.nextLocation.pathname;return gE(g.pathname,I)!=null||gE(g.pathname,S)!=null}var AB={exports:{}};(function(o,c){(function(h,f){o.exports=f()})(_m,function(){function h(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var f=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof _m<"u"?_m:typeof self<"u"?self:{};function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S=function(e){try{return!!e()}catch{return!0}},I=!S(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),L=I,M=Function.prototype,F=M.call,X=L&&M.bind.bind(F,F),H=L?X:function(e){return function(){return F.apply(e,arguments)}},J=H({}.isPrototypeOf),ce=function(e){return e&&e.Math===Math&&e},se=ce(typeof globalThis=="object"&&globalThis)||ce(typeof window=="object"&&window)||ce(typeof self=="object"&&self)||ce(typeof f=="object"&&f)||ce(typeof f=="object"&&f)||function(){return this}()||Function("return this")(),pe=I,we=Function.prototype,z=we.apply,W=we.call,K=typeof Reflect=="object"&&Reflect.apply||(pe?W.bind(z):function(){return W.apply(z,arguments)}),Ee=H,Ie=Ee({}.toString),Le=Ee("".slice),be=function(e){return Le(Ie(e),8,-1)},je=be,Bt=H,ge=function(e){if(je(e)==="Function")return Bt(e)},bt=typeof document=="object"&&document.all,ct=bt===void 0&&bt!==void 0?function(e){return typeof e=="function"||e===bt}:function(e){return typeof e=="function"},Hn={},en=!S(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),xE=I,Fs=Function.prototype.call,un=xE?Fs.bind(Fs):function(){return Fs.apply(Fs,arguments)},xe={},dt={}.propertyIsEnumerable,Et=Object.getOwnPropertyDescriptor,Tn=Et&&!dt.call({1:2},1);xe.f=Tn?function(e){var t=Et(this,e);return!!t&&t.enumerable}:dt;var tn,as,vr=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Hl=S,cs=be,Bs=Object,NB=H("".split),_p=Hl(function(){return!Bs("z").propertyIsEnumerable(0)})?function(e){return cs(e)==="String"?NB(e,""):Bs(e)}:Bs,mp=function(e){return e==null},DB=mp,PB=TypeError,Ha=function(e){if(DB(e))throw new PB("Can't call method on "+e);return e},kB=_p,LB=Ha,js=function(e){return kB(LB(e))},MB=ct,ur=function(e){return typeof e=="object"?e!==null:MB(e)},di={},VE=di,FE=se,UB=ct,C0=function(e){return UB(e)?e:void 0},hr=function(e,t){return arguments.length<2?C0(VE[e])||C0(FE[e]):VE[e]&&VE[e][t]||FE[e]&&FE[e][t]},I0=se.navigator,w0=I0&&I0.userAgent,ds=w0?String(w0):"",A0=se,BE=ds,b0=A0.process,O0=A0.Deno,N0=b0&&b0.versions||O0&&O0.version,D0=N0&&N0.v8;D0&&(as=(tn=D0.split("."))[0]>0&&tn[0]<4?1:+(tn[0]+tn[1])),!as&&BE&&(!(tn=BE.match(/Edge\/(\d+)/))||tn[1]>=74)&&(tn=BE.match(/Chrome\/(\d+)/))&&(as=+tn[1]);var Ka=as,P0=Ka,xB=S,VB=se.String,zc=!!Object.getOwnPropertySymbols&&!xB(function(){var e=Symbol("symbol detection");return!VB(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&P0&&P0<41}),k0=zc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",FB=hr,BB=ct,jB=J,GB=Object,Kl=k0?function(e){return typeof e=="symbol"}:function(e){var t=FB("Symbol");return BB(t)&&jB(t.prototype,GB(e))},WB=String,Yc=function(e){try{return WB(e)}catch{return"Object"}},HB=ct,KB=Yc,zB=TypeError,Wr=function(e){if(HB(e))return e;throw new zB(KB(e)+" is not a function")},YB=Wr,qB=mp,Ep=function(e,t){var n=e[t];return qB(n)?void 0:YB(n)},jE=un,GE=ct,WE=ur,XB=TypeError,L0={exports:{}},M0=se,JB=Object.defineProperty,QB=se,ZB=function(e,t){try{JB(M0,e,{value:t,configurable:!0,writable:!0})}catch{M0[e]=t}return t},U0="__core-js_shared__",x0=L0.exports=QB[U0]||ZB(U0,{});(x0.versions||(x0.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var HE=L0.exports,V0=HE,qc=function(e,t){return V0[e]||(V0[e]=t||{})},$B=Ha,ej=Object,Lo=function(e){return ej($B(e))},tj=Lo,nj=H({}.hasOwnProperty),Kn=Object.hasOwn||function(e,t){return nj(tj(e),t)},rj=H,ij=0,oj=Math.random(),sj=rj(1 .toString),KE=function(e){return"Symbol("+(e===void 0?"":e)+")_"+sj(++ij+oj,36)},aj=qc,F0=Kn,cj=KE,dj=zc,lj=k0,Xc=se.Symbol,zE=aj("wks"),uj=lj?Xc.for||Xc:Xc&&Xc.withoutSetter||cj,nn=function(e){return F0(zE,e)||(zE[e]=dj&&F0(Xc,e)?Xc[e]:uj("Symbol."+e)),zE[e]},hj=un,B0=ur,j0=Kl,pj=Ep,fj=function(e,t){var n,r;if(t==="string"&&GE(n=e.toString)&&!WE(r=jE(n,e))||GE(n=e.valueOf)&&!WE(r=jE(n,e))||t!=="string"&&GE(n=e.toString)&&!WE(r=jE(n,e)))return r;throw new XB("Can't convert object to primitive value")},_j=TypeError,mj=nn("toPrimitive"),Ej=function(e,t){if(!B0(e)||j0(e))return e;var n,r=pj(e,mj);if(r){if(t===void 0&&(t="default"),n=hj(r,e,t),!B0(n)||j0(n))return n;throw new _j("Can't convert object to primitive value")}return t===void 0&&(t="number"),fj(e,t)},gj=Kl,YE=function(e){var t=Ej(e,"string");return gj(t)?t:t+""},G0=ur,qE=se.document,Sj=G0(qE)&&G0(qE.createElement),XE=function(e){return Sj?qE.createElement(e):{}},Tj=XE,W0=!en&&!S(function(){return Object.defineProperty(Tj("div"),"a",{get:function(){return 7}}).a!==7}),vj=en,Rj=un,yj=xe,Cj=vr,Ij=js,wj=YE,Aj=Kn,bj=W0,H0=Object.getOwnPropertyDescriptor;Hn.f=vj?H0:function(e,t){if(e=Ij(e),t=wj(t),bj)try{return H0(e,t)}catch{}if(Aj(e,t))return Cj(!Rj(yj.f,e,t),e[t])};var Oj=S,Nj=ct,Dj=/#|\.prototype\./,zl=function(e,t){var n=kj[Pj(e)];return n===Mj||n!==Lj&&(Nj(t)?Oj(t):!!t)},Pj=zl.normalize=function(e){return String(e).replace(Dj,".").toLowerCase()},kj=zl.data={},Lj=zl.NATIVE="N",Mj=zl.POLYFILL="P",K0=zl,Uj=Wr,xj=I,Vj=ge(ge.bind),Gs=function(e,t){return Uj(e),t===void 0?e:xj?Vj(e,t):function(){return e.apply(t,arguments)}},Oi={},z0=en&&S(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Fj=ur,Bj=String,jj=TypeError,kr=function(e){if(Fj(e))return e;throw new jj(Bj(e)+" is not an object")},Gj=en,Wj=W0,Hj=z0,gp=kr,Y0=YE,Kj=TypeError,JE=Object.defineProperty,zj=Object.getOwnPropertyDescriptor,QE="enumerable",ZE="configurable",$E="writable";Oi.f=Gj?Hj?function(e,t,n){if(gp(e),t=Y0(t),gp(n),typeof e=="function"&&t==="prototype"&&"value"in n&&$E in n&&!n[$E]){var r=zj(e,t);r&&r[$E]&&(e[t]=n.value,n={configurable:ZE in n?n[ZE]:r[ZE],enumerable:QE in n?n[QE]:r[QE],writable:!1})}return JE(e,t,n)}:JE:function(e,t,n){if(gp(e),t=Y0(t),gp(n),Wj)try{return JE(e,t,n)}catch{}if("get"in n||"set"in n)throw new Kj("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Yj=Oi,qj=vr,za=en?function(e,t,n){return Yj.f(e,t,qj(1,n))}:function(e,t,n){return e[t]=n,e},Yl=se,Xj=K,Jj=ge,Qj=ct,Zj=Hn.f,$j=K0,Jc=di,e3=Gs,Qc=za,q0=Kn,t3=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return Xj(e,this,arguments)};return t.prototype=e.prototype,t},lt=function(e,t){var n,r,i,s,a,d,l,u,p,_=e.target,m=e.global,E=e.stat,C=e.proto,R=m?Yl:E?Yl[_]:Yl[_]&&Yl[_].prototype,y=m?Jc:Jc[_]||Qc(Jc,_,{})[_],b=y.prototype;for(s in t)r=!(n=$j(m?s:_+(E?".":"#")+s,e.forced))&&R&&q0(R,s),d=y[s],r&&(l=e.dontCallGetSet?(p=Zj(R,s))&&p.value:R[s]),a=r&&l?l:t[s],(n||C||typeof d!=typeof a)&&(u=e.bind&&r?e3(a,Yl):e.wrap&&r?t3(a):C&&Qj(a)?Jj(a):a,(e.sham||a&&a.sham||d&&d.sham)&&Qc(u,"sham",!0),Qc(y,s,u),C&&(q0(Jc,i=_+"Prototype")||Qc(Jc,i,{}),Qc(Jc[i],s,a),e.real&&b&&(n||!b[s])&&Qc(b,s,a)))},n3=Math.ceil,r3=Math.floor,i3=Math.trunc||function(e){var t=+e;return(t>0?r3:n3)(t)},o3=i3,eg=function(e){var t=+e;return t!=t||t===0?0:o3(t)},s3=eg,a3=Math.max,c3=Math.min,tg=function(e,t){var n=s3(e);return n<0?a3(n+t,0):c3(n,t)},d3=eg,l3=Math.min,X0=function(e){var t=d3(e);return t>0?l3(t,9007199254740991):0},u3=X0,Ws=function(e){return u3(e.length)},h3=js,p3=tg,f3=Ws,J0=function(e){return function(t,n,r){var i=h3(t),s=f3(i);if(s===0)return!e&&-1;var a,d=p3(r,s);if(e&&n!=n){for(;s>d;)if((a=i[d++])!=a)return!0}else for(;s>d;d++)if((e||d in i)&&i[d]===n)return e||d||0;return!e&&-1}},ng={includes:J0(!0),indexOf:J0(!1)},_3=ng.includes;lt({target:"Array",proto:!0,forced:S(function(){return!Array(1).includes()})},{includes:function(e){return _3(this,e,arguments.length>1?arguments[1]:void 0)}});var m3=se,E3=di,Ni=function(e,t){var n=E3[e+"Prototype"],r=n&&n[t];if(r)return r;var i=m3[e],s=i&&i.prototype;return s&&s[t]},g3=Ni("Array","includes"),S3=ur,T3=be,v3=nn("match"),Q0=function(e){var t;return S3(e)&&((t=e[v3])!==void 0?!!t:T3(e)==="RegExp")},R3=Q0,y3=TypeError,Z0={};Z0[nn("toStringTag")]="z";var rg=String(Z0)==="[object z]",C3=rg,I3=ct,Sp=be,w3=nn("toStringTag"),A3=Object,b3=Sp(function(){return arguments}())==="Arguments",Hs=C3?Sp:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(i,s){try{return i[s]}catch{}}(t=A3(e),w3))=="string"?n:b3?Sp(t):(r=Sp(t))==="Object"&&I3(t.callee)?"Arguments":r},O3=Hs,N3=String,Hr=function(e){if(O3(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return N3(e)},D3=nn("match"),P3=lt,k3=function(e){if(R3(e))throw new y3("The method doesn't accept regular expressions");return e},L3=Ha,$0=Hr,M3=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[D3]=!1,"/./"[e](t)}catch{}}return!1},U3=H("".indexOf);P3({target:"String",proto:!0,forced:!M3("includes")},{includes:function(e){return!!~U3($0(L3(this)),$0(k3(e)),arguments.length>1?arguments[1]:void 0)}});var x3=Ni("String","includes"),eI=J,V3=g3,F3=x3,ig=Array.prototype,og=String.prototype,B3=function(e){var t=e.includes;return e===ig||eI(ig,e)&&t===ig.includes?V3:typeof e=="string"||e===og||eI(og,e)&&t===og.includes?F3:t},oe=g(B3),j3=Wr,G3=Lo,W3=_p,H3=Ws,tI=TypeError,nI="Reduce of empty array with no initial value",rI=function(e){return function(t,n,r,i){var s=G3(t),a=W3(s),d=H3(s);if(j3(n),d===0&&r<2)throw new tI(nI);var l=e?d-1:0,u=e?-1:1;if(r<2)for(;;){if(l in a){i=a[l],l+=u;break}if(l+=u,e?l<0:d<=l)throw new tI(nI)}for(;e?l>=0:d>l;l+=u)l in a&&(i=n(i,a[l],l,s));return i}},K3={left:rI(!1),right:rI(!0)},z3=S,Tp=function(e,t){var n=[][e];return!!n&&z3(function(){n.call(null,t||function(){return 1},1)})},ql=se,Y3=ds,q3=be,vp=function(e){return Y3.slice(0,e.length)===e},sg=vp("Bun/")?"BUN":vp("Cloudflare-Workers")?"CLOUDFLARE":vp("Deno/")?"DENO":vp("Node.js/")?"NODE":ql.Bun&&typeof Bun.version=="string"?"BUN":ql.Deno&&typeof Deno.version=="object"?"DENO":q3(ql.process)==="process"?"NODE":ql.window&&ql.document?"BROWSER":"REST",Rp=sg==="NODE",X3=K3.left;lt({target:"Array",proto:!0,forced:!Rp&&Ka>79&&Ka<83||!Tp("reduce")},{reduce:function(e){var t=arguments.length;return X3(this,e,t,t>1?arguments[1]:void 0)}});var J3=Ni("Array","reduce"),Q3=J,Z3=J3,ag=Array.prototype,$3=function(e){var t=e.reduce;return e===ag||Q3(ag,e)&&t===ag.reduce?Z3:t},iI=$3,Di=g(iI),e4=be,Xl=Array.isArray||function(e){return e4(e)==="Array"},t4=lt,n4=Xl,r4=H([].reverse),oI=[1,2];t4({target:"Array",proto:!0,forced:String(oI)===String(oI.reverse())},{reverse:function(){return n4(this)&&(this.length=this.length),r4(this)}});var i4=Ni("Array","reverse"),o4=J,s4=i4,cg=Array.prototype,a4=function(e){var t=e.reverse;return e===cg||o4(cg,e)&&t===cg.reverse?s4:t},sI=a4,aI=g(sI),c4=KE,cI=qc("keys"),yp=function(e){return cI[e]||(cI[e]=c4(e))},d4=!S(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),l4=Kn,u4=ct,h4=Lo,p4=d4,dI=yp("IE_PROTO"),dg=Object,f4=dg.prototype,lg=p4?dg.getPrototypeOf:function(e){var t=h4(e);if(l4(t,dI))return t[dI];var n=t.constructor;return u4(n)&&t instanceof n?n.prototype:t instanceof dg?f4:null},_4=H,m4=Wr,E4=ur,g4=function(e){return E4(e)||e===null},S4=String,T4=TypeError,v4=function(e,t,n){try{return _4(m4(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},R4=ur,y4=Ha,C4=function(e){if(g4(e))return e;throw new T4("Can't set "+S4(e)+" as a prototype")},I4=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=v4(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return y4(r),C4(i),R4(r)&&(t?e(r,i):r.__proto__=i),r}}():void 0),Cp={},Ip={},ug=Kn,w4=js,A4=ng.indexOf,b4=Ip,lI=H([].push),uI=function(e,t){var n,r=w4(e),i=0,s=[];for(n in r)!ug(b4,n)&&ug(r,n)&&lI(s,n);for(;t.length>i;)ug(r,n=t[i++])&&(~A4(s,n)||lI(s,n));return s},hg=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],O4=uI,N4=hg.concat("length","prototype");Cp.f=Object.getOwnPropertyNames||function(e){return O4(e,N4)};var Jl={};Jl.f=Object.getOwnPropertySymbols;var D4=hr,P4=Cp,k4=Jl,L4=kr,M4=H([].concat),U4=D4("Reflect","ownKeys")||function(e){var t=P4.f(L4(e)),n=k4.f;return n?M4(t,n(e)):t},hI=Kn,x4=U4,V4=Hn,F4=Oi,pg={},B4=uI,j4=hg,wp=Object.keys||function(e){return B4(e,j4)},G4=en,W4=z0,H4=Oi,K4=kr,z4=js,Y4=wp;pg.f=G4&&!W4?Object.defineProperties:function(e,t){K4(e);for(var n,r=z4(t),i=Y4(t),s=i.length,a=0;s>a;)H4.f(e,n=i[a++],r[n]);return e};var Ap,pI=hr("document","documentElement"),q4=kr,X4=pg,fI=hg,J4=Ip,Q4=pI,Z4=XE,fg="prototype",_g="script",_I=yp("IE_PROTO"),mg=function(){},mI=function(e){return"<"+_g+">"+e+"</"+_g+">"},EI=function(e){e.write(mI("")),e.close();var t=e.parentWindow.Object;return e=null,t},bp=function(){try{Ap=new ActiveXObject("htmlfile")}catch{}var e,t,n;bp=typeof document<"u"?document.domain&&Ap?EI(Ap):(t=Z4("iframe"),n="java"+_g+":",t.style.display="none",Q4.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(mI("document.F=Object")),e.close(),e.F):EI(Ap);for(var r=fI.length;r--;)delete bp[fg][fI[r]];return bp()};J4[_I]=!0;var Ql=Object.create||function(e,t){var n;return e!==null?(mg[fg]=q4(e),n=new mg,mg[fg]=null,n[_I]=e):n=bp(),t===void 0?n:X4.f(n,t)},$4=ur,e5=za,gI=Error,t5=H("".replace),n5=String(new gI("zxcasd").stack),SI=/\n\s*at [^:]*:[^\n]*/,r5=SI.test(n5),i5=vr,o5=!S(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i5(1,7)),e.stack!==7)}),s5=za,a5=function(e,t){if(r5&&typeof e=="string"&&!gI.prepareStackTrace)for(;t--;)e=t5(e,SI,"");return e},c5=o5,TI=Error.captureStackTrace,Zc={},d5=Zc,l5=nn("iterator"),u5=Array.prototype,vI=function(e){return e!==void 0&&(d5.Array===e||u5[l5]===e)},h5=Hs,RI=Ep,p5=mp,f5=Zc,_5=nn("iterator"),Op=function(e){if(!p5(e))return RI(e,_5)||RI(e,"@@iterator")||f5[h5(e)]},m5=un,E5=Wr,g5=kr,S5=Yc,T5=Op,v5=TypeError,Eg=function(e,t){var n=arguments.length<2?T5(e):t;if(E5(n))return g5(m5(n,e));throw new v5(S5(e)+" is not iterable")},R5=un,yI=kr,y5=Ep,CI=function(e,t,n){var r,i;yI(e);try{if(!(r=y5(e,"return"))){if(t==="throw")throw n;return n}r=R5(r,e)}catch(s){i=!0,r=s}if(t==="throw")throw n;if(i)throw r;return yI(r),n},C5=Gs,I5=un,w5=kr,A5=Yc,b5=vI,O5=Ws,II=J,N5=Eg,D5=Op,wI=CI,P5=TypeError,Np=function(e,t){this.stopped=e,this.result=t},AI=Np.prototype,Zl=function(e,t,n){var r,i,s,a,d,l,u,p=n&&n.that,_=!(!n||!n.AS_ENTRIES),m=!(!n||!n.IS_RECORD),E=!(!n||!n.IS_ITERATOR),C=!(!n||!n.INTERRUPTED),R=C5(t,p),y=function(A){return r&&wI(r,"normal",A),new Np(!0,A)},b=function(A){return _?(w5(A),C?R(A[0],A[1],y):R(A[0],A[1])):C?R(A,y):R(A)};if(m)r=e.iterator;else if(E)r=e;else{if(!(i=D5(e)))throw new P5(A5(e)+" is not iterable");if(b5(i)){for(s=0,a=O5(e);a>s;s++)if((d=b(e[s]))&&II(AI,d))return d;return new Np(!1)}r=N5(e,i)}for(l=m?e.next:r.next;!(u=I5(l,r)).done;){try{d=b(u.value)}catch(A){wI(r,"throw",A)}if(typeof d=="object"&&d&&II(AI,d))return d}return new Np(!1)},k5=Hr,L5=lt,M5=J,U5=lg,Dp=I4,x5=function(e,t,n){for(var r=x4(t),i=F4.f,s=V4.f,a=0;a<r.length;a++){var d=r[a];hI(e,d)||n&&hI(n,d)||i(e,d,s(t,d))}},bI=Ql,gg=za,Sg=vr,V5=function(e,t){$4(t)&&"cause"in t&&e5(e,"cause",t.cause)},F5=function(e,t,n,r){c5&&(TI?TI(e,t):s5(e,"stack",a5(n,r)))},B5=Zl,j5=function(e,t){return e===void 0?arguments.length<2?"":t:k5(e)},G5=nn("toStringTag"),Pp=Error,W5=[].push,$c=function(e,t){var n,r=M5(Tg,this);Dp?n=Dp(new Pp,r?U5(this):Tg):(n=r?this:bI(Tg),gg(n,G5,"Error")),t!==void 0&&gg(n,"message",j5(t)),F5(n,$c,n.stack,1),arguments.length>2&&V5(n,arguments[2]);var i=[];return B5(e,W5,{that:i}),gg(n,"errors",i),n};Dp?Dp($c,Pp):x5($c,Pp,{name:!0});var Tg=$c.prototype=bI(Pp.prototype,{constructor:Sg(1,$c),message:Sg(1,""),name:Sg(1,"AggregateError")});L5({global:!0,constructor:!0,arity:2},{AggregateError:$c});var kp,$l,Lp,H5=ct,OI=se.WeakMap,K5=H5(OI)&&/native code/.test(String(OI)),NI=se,z5=ur,Y5=za,vg=Kn,Rg=HE,q5=yp,X5=Ip,DI="Object already initialized",yg=NI.TypeError,J5=NI.WeakMap;if(K5||Rg.state){var Mo=Rg.state||(Rg.state=new J5);Mo.get=Mo.get,Mo.has=Mo.has,Mo.set=Mo.set,kp=function(e,t){if(Mo.has(e))throw new yg(DI);return t.facade=e,Mo.set(e,t),t},$l=function(e){return Mo.get(e)||{}},Lp=function(e){return Mo.has(e)}}else{var ed=q5("state");X5[ed]=!0,kp=function(e,t){if(vg(e,ed))throw new yg(DI);return t.facade=e,Y5(e,ed,t),t},$l=function(e){return vg(e,ed)?e[ed]:{}},Lp=function(e){return vg(e,ed)}}var Ya,PI,kI,qa={set:kp,get:$l,has:Lp,enforce:function(e){return Lp(e)?$l(e):kp(e,{})},getterFor:function(e){return function(t){var n;if(!z5(t)||(n=$l(t)).type!==e)throw new yg("Incompatible receiver, "+e+" required");return n}}},Cg=en,Q5=Kn,LI=Function.prototype,Z5=Cg&&Object.getOwnPropertyDescriptor,Ig=Q5(LI,"name"),MI={EXISTS:Ig,PROPER:Ig&&(function(){}).name==="something",CONFIGURABLE:Ig&&(!Cg||Cg&&Z5(LI,"name").configurable)},$5=za,Ks=function(e,t,n,r){return r&&r.enumerable?e[t]=n:$5(e,t,n),e},eG=S,tG=ct,nG=ur,rG=Ql,UI=lg,iG=Ks,wg=nn("iterator"),xI=!1;[].keys&&("next"in(kI=[].keys())?(PI=UI(UI(kI)))!==Object.prototype&&(Ya=PI):xI=!0);var oG=!nG(Ya)||eG(function(){var e={};return Ya[wg].call(e)!==e});tG((Ya=oG?{}:rG(Ya))[wg])||iG(Ya,wg,function(){return this});var VI={IteratorPrototype:Ya,BUGGY_SAFARI_ITERATORS:xI},sG=Hs,aG=rg?{}.toString:function(){return"[object "+sG(this)+"]"},cG=rg,dG=Oi.f,lG=za,uG=Kn,hG=aG,FI=nn("toStringTag"),ls=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(uG(i,FI)||dG(i,FI,{configurable:!0,value:t}),r&&!cG&&lG(i,"toString",hG))},pG=VI.IteratorPrototype,fG=Ql,_G=vr,mG=ls,EG=Zc,gG=function(){return this},Ag=function(e,t,n,r){var i=t+" Iterator";return e.prototype=fG(pG,{next:_G(+!r,n)}),mG(e,i,!1,!0),EG[i]=gG,e},SG=lt,TG=un,vG=MI,RG=Ag,yG=lg,CG=ls,BI=Ks,jI=Zc,IG=VI,wG=vG.PROPER,Mp=IG.BUGGY_SAFARI_ITERATORS,bg=nn("iterator"),GI="keys",Up="values",WI="entries",AG=function(){return this},HI=function(e,t,n,r,i,s,a){RG(n,t,r);var d,l,u,p=function(b){if(b===i&&R)return R;if(!Mp&&b&&b in E)return E[b];switch(b){case GI:case Up:case WI:return function(){return new n(this,b)}}return function(){return new n(this)}},_=t+" Iterator",m=!1,E=e.prototype,C=E[bg]||E["@@iterator"]||i&&E[i],R=!Mp&&C||p(i),y=t==="Array"&&E.entries||C;if(y&&(d=yG(y.call(new e)))!==Object.prototype&&d.next&&(CG(d,_,!0,!0),jI[_]=AG),wG&&i===Up&&C&&C.name!==Up&&(m=!0,R=function(){return TG(C,this)}),i)if(l={values:p(Up),keys:s?R:p(GI),entries:p(WI)},a)for(u in l)(Mp||m||!(u in E))&&BI(E,u,l[u]);else SG({target:t,proto:!0,forced:Mp||m},l);return a&&E[bg]!==R&&BI(E,bg,R,{name:i}),jI[t]=R,l},xp=function(e,t){return{value:e,done:t}},bG=js,KI=Zc,zI=qa;Oi.f;var OG=HI,Vp=xp,YI="Array Iterator",NG=zI.set,DG=zI.getterFor(YI);OG(Array,"Array",function(e,t){NG(this,{type:YI,target:bG(e),index:0,kind:t})},function(){var e=DG(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Vp(void 0,!0);switch(e.kind){case"keys":return Vp(n,!1);case"values":return Vp(t[n],!1)}return Vp([n,t[n]],!1)},"values"),KI.Arguments=KI.Array;var PG=Oi,Fp=function(e,t,n){return PG.f(e,t,n)},kG=hr,LG=Fp,MG=en,qI=nn("species"),UG=J,xG=TypeError,Og=function(e,t){if(UG(t,e))return e;throw new xG("Incorrect invocation")},VG=ct,Ng=HE,FG=H(Function.toString);VG(Ng.inspectSource)||(Ng.inspectSource=function(e){return FG(e)});var XI=Ng.inspectSource,BG=H,jG=S,JI=ct,GG=Hs,WG=XI,QI=function(){},ZI=hr("Reflect","construct"),Dg=/^\s*(?:class|function)\b/,HG=BG(Dg.exec),KG=!Dg.test(QI),eu=function(e){if(!JI(e))return!1;try{return ZI(QI,[],e),!0}catch{return!1}},$I=function(e){if(!JI(e))return!1;switch(GG(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return KG||!!HG(Dg,WG(e))}catch{return!0}};$I.sham=!0;var tu,td,ew,Pg,Bp=!ZI||jG(function(){var e;return eu(eu.call)||!eu(Object)||!eu(function(){e=!0})||e})?$I:eu,zG=Bp,YG=Yc,qG=TypeError,tw=kr,XG=function(e){if(zG(e))return e;throw new qG(YG(e)+" is not a constructor")},JG=mp,QG=nn("species"),kg=function(e,t){var n,r=tw(e).constructor;return r===void 0||JG(n=tw(r)[QG])?t:XG(n)},zs=H([].slice),ZG=TypeError,Xa=function(e,t){if(e<t)throw new ZG("Not enough arguments");return e},nw=/(?:ipad|iphone|ipod).*applewebkit/i.test(ds),li=se,$G=K,eW=Gs,rw=ct,tW=Kn,iw=S,ow=pI,nW=zs,sw=XE,rW=Xa,iW=nw,oW=Rp,Lg=li.setImmediate,Mg=li.clearImmediate,sW=li.process,Ug=li.Dispatch,aW=li.Function,aw=li.MessageChannel,cW=li.String,xg=0,nu={},cw="onreadystatechange";iw(function(){tu=li.location});var Vg=function(e){if(tW(nu,e)){var t=nu[e];delete nu[e],t()}},Fg=function(e){return function(){Vg(e)}},dw=function(e){Vg(e.data)},lw=function(e){li.postMessage(cW(e),tu.protocol+"//"+tu.host)};Lg&&Mg||(Lg=function(e){rW(arguments.length,1);var t=rw(e)?e:aW(e),n=nW(arguments,1);return nu[++xg]=function(){$G(t,void 0,n)},td(xg),xg},Mg=function(e){delete nu[e]},oW?td=function(e){sW.nextTick(Fg(e))}:Ug&&Ug.now?td=function(e){Ug.now(Fg(e))}:aw&&!iW?(Pg=(ew=new aw).port2,ew.port1.onmessage=dw,td=eW(Pg.postMessage,Pg)):li.addEventListener&&rw(li.postMessage)&&!li.importScripts&&tu&&tu.protocol!=="file:"&&!iw(lw)?(td=lw,li.addEventListener("message",dw,!1)):td=cw in sw("script")?function(e){ow.appendChild(sw("script"))[cw]=function(){ow.removeChild(this),Vg(e)}}:function(e){setTimeout(Fg(e),0)});var jp={set:Lg,clear:Mg},uw=se,dW=en,lW=Object.getOwnPropertyDescriptor,hw=function(e){if(!dW)return uw[e];var t=lW(uw,e);return t&&t.value},pw=function(){this.head=null,this.tail=null};pw.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var nd,Bg,jg,Gg,fw,_w=pw,uW=/ipad|iphone|ipod/i.test(ds)&&typeof Pebble<"u",hW=/web0s(?!.*chrome)/i.test(ds),rd=se,pW=hw,mw=Gs,Wg=jp.set,fW=_w,_W=nw,mW=uW,EW=hW,Hg=Rp,Ew=rd.MutationObserver||rd.WebKitMutationObserver,gw=rd.document,Sw=rd.process,Gp=rd.Promise,Kg=pW("queueMicrotask");if(!Kg){var Wp=new fW,Hp=function(){var e,t;for(Hg&&(e=Sw.domain)&&e.exit();t=Wp.get();)try{t()}catch(n){throw Wp.head&&nd(),n}e&&e.enter()};_W||Hg||EW||!Ew||!gw?!mW&&Gp&&Gp.resolve?((Gg=Gp.resolve(void 0)).constructor=Gp,fw=mw(Gg.then,Gg),nd=function(){fw(Hp)}):Hg?nd=function(){Sw.nextTick(Hp)}:(Wg=mw(Wg,rd),nd=function(){Wg(Hp)}):(Bg=!0,jg=gw.createTextNode(""),new Ew(Hp).observe(jg,{characterData:!0}),nd=function(){jg.data=Bg=!Bg}),Kg=function(e){Wp.head||nd(),Wp.add(e)}}var Tw=Kg,id=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Ja=se.Promise,gW=se,ru=Ja,SW=ct,TW=K0,vW=XI,RW=nn,vw=sg,zg=Ka,Rw=ru&&ru.prototype,yW=RW("species"),yw=!1,Cw=SW(gW.PromiseRejectionEvent),CW=TW("Promise",function(){var e=vW(ru),t=e!==String(ru);if(!t&&zg===66||!Rw.catch||!Rw.finally)return!0;if(!zg||zg<51||!/native code/.test(e)){var n=new ru(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[yW]=r,!(yw=n.then(function(){})instanceof r))return!0}return!(t||vw!=="BROWSER"&&vw!=="DENO"||Cw)}),iu={CONSTRUCTOR:CW,REJECTION_EVENT:Cw,SUBCLASSING:yw},Uo={},Iw=Wr,IW=TypeError,wW=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw new IW("Bad Promise constructor");t=r,n=i}),this.resolve=Iw(t),this.reject=Iw(n)};Uo.f=function(e){return new wW(e)};var Yg,ww,AW=lt,Kp=Rp,Ys=se,ou=un,bW=Ks,OW=ls,NW=function(e){var t=kG(e);MG&&t&&!t[qI]&&LG(t,qI,{configurable:!0,get:function(){return this}})},DW=Wr,qg=ct,PW=ur,kW=Og,LW=kg,Aw=jp.set,Xg=Tw,MW=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},UW=id,xW=_w,bw=qa,Jg=Ja,Ow=iu,Nw=Uo,zp="Promise",Dw=Ow.CONSTRUCTOR,VW=Ow.REJECTION_EVENT,Qg=bw.getterFor(zp),FW=bw.set,BW=Jg&&Jg.prototype,su=Jg,Zg=BW,Pw=Ys.TypeError,$g=Ys.document,eS=Ys.process,tS=Nw.f,jW=tS,GW=!!($g&&$g.createEvent&&Ys.dispatchEvent),kw="unhandledrejection",Lw=function(e){var t;return!(!PW(e)||!qg(t=e.then))&&t},Mw=function(e,t){var n,r,i,s=t.value,a=t.state===1,d=a?e.ok:e.fail,l=e.resolve,u=e.reject,p=e.domain;try{d?(a||(t.rejection===2&&HW(t),t.rejection=1),d===!0?n=s:(p&&p.enter(),n=d(s),p&&(p.exit(),i=!0)),n===e.promise?u(new Pw("Promise-chain cycle")):(r=Lw(n))?ou(r,n,l,u):l(n)):u(s)}catch(_){p&&!i&&p.exit(),u(_)}},Uw=function(e,t){e.notified||(e.notified=!0,Xg(function(){for(var n,r=e.reactions;n=r.get();)Mw(n,e);e.notified=!1,t&&!e.rejection&&WW(e)}))},xw=function(e,t,n){var r,i;GW?((r=$g.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Ys.dispatchEvent(r)):r={promise:t,reason:n},!VW&&(i=Ys["on"+e])?i(r):e===kw&&MW("Unhandled promise rejection",n)},WW=function(e){ou(Aw,Ys,function(){var t,n=e.facade,r=e.value;if(Vw(e)&&(t=UW(function(){Kp?eS.emit("unhandledRejection",r,n):xw(kw,n,r)}),e.rejection=Kp||Vw(e)?2:1,t.error))throw t.value})},Vw=function(e){return e.rejection!==1&&!e.parent},HW=function(e){ou(Aw,Ys,function(){var t=e.facade;Kp?eS.emit("rejectionHandled",t):xw("rejectionhandled",t,e.value)})},od=function(e,t,n){return function(r){e(t,r,n)}},sd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Uw(e,!0))},nS=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new Pw("Promise can't be resolved itself");var r=Lw(t);r?Xg(function(){var i={done:!1};try{ou(r,t,od(nS,i,e),od(sd,i,e))}catch(s){sd(i,s,e)}}):(e.value=t,e.state=1,Uw(e,!1))}catch(i){sd({done:!1},i,e)}}};Dw&&(Zg=(su=function(e){kW(this,Zg),DW(e),ou(Yg,this);var t=Qg(this);try{e(od(nS,t),od(sd,t))}catch(n){sd(t,n)}}).prototype,(Yg=function(e){FW(this,{type:zp,done:!1,notified:!1,parent:!1,reactions:new xW,rejection:!1,state:0,value:null})}).prototype=bW(Zg,"then",function(e,t){var n=Qg(this),r=tS(LW(this,su));return n.parent=!0,r.ok=!qg(e)||e,r.fail=qg(t)&&t,r.domain=Kp?eS.domain:void 0,n.state===0?n.reactions.add(r):Xg(function(){Mw(r,n)}),r.promise}),ww=function(){var e=new Yg,t=Qg(e);this.promise=e,this.resolve=od(nS,t),this.reject=od(sd,t)},Nw.f=tS=function(e){return e===su||e===void 0?new ww(e):jW(e)}),AW({global:!0,constructor:!0,wrap:!0,forced:Dw},{Promise:su}),OW(su,zp,!1,!0),NW(zp);var Fw=nn("iterator"),Bw=!1;try{var KW=0,jw={next:function(){return{done:!!KW++}},return:function(){Bw=!0}};jw[Fw]=function(){return this},Array.from(jw,function(){throw 2})}catch{}var zW=Ja,YW=function(e,t){try{if(!t&&!Bw)return!1}catch{return!1}var n=!1;try{var r={};r[Fw]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},Yp=iu.CONSTRUCTOR||!YW(function(e){zW.all(e).then(void 0,function(){})}),qW=un,XW=Wr,JW=Uo,QW=id,ZW=Zl;lt({target:"Promise",stat:!0,forced:Yp},{all:function(e){var t=this,n=JW.f(t),r=n.resolve,i=n.reject,s=QW(function(){var a=XW(t.resolve),d=[],l=0,u=1;ZW(e,function(p){var _=l++,m=!1;u++,qW(a,t,p).then(function(E){m||(m=!0,d[_]=E,--u||r(d))},i)}),--u||r(d)});return s.error&&i(s.value),n.promise}});var $W=lt,e6=iu.CONSTRUCTOR;Ja&&Ja.prototype,$W({target:"Promise",proto:!0,forced:e6,real:!0},{catch:function(e){return this.then(void 0,e)}});var t6=un,n6=Wr,r6=Uo,i6=id,o6=Zl;lt({target:"Promise",stat:!0,forced:Yp},{race:function(e){var t=this,n=r6.f(t),r=n.reject,i=i6(function(){var s=n6(t.resolve);o6(e,function(a){t6(s,t,a).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var s6=Uo;lt({target:"Promise",stat:!0,forced:iu.CONSTRUCTOR},{reject:function(e){var t=s6.f(this);return(0,t.reject)(e),t.promise}});var a6=kr,c6=ur,d6=Uo,Gw=function(e,t){if(a6(e),c6(t)&&t.constructor===e)return t;var n=d6.f(e);return(0,n.resolve)(t),n.promise},l6=lt,u6=Ja,h6=iu.CONSTRUCTOR,p6=Gw,f6=hr("Promise"),_6=!h6;l6({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return p6(_6&&this===f6?u6:this,e)}});var m6=un,E6=Wr,g6=Uo,S6=id,T6=Zl;lt({target:"Promise",stat:!0,forced:Yp},{allSettled:function(e){var t=this,n=g6.f(t),r=n.resolve,i=n.reject,s=S6(function(){var a=E6(t.resolve),d=[],l=0,u=1;T6(e,function(p){var _=l++,m=!1;u++,m6(a,t,p).then(function(E){m||(m=!0,d[_]={status:"fulfilled",value:E},--u||r(d))},function(E){m||(m=!0,d[_]={status:"rejected",reason:E},--u||r(d))})}),--u||r(d)});return s.error&&i(s.value),n.promise}});var v6=un,R6=Wr,y6=hr,C6=Uo,I6=id,w6=Zl,Ww="No one promise resolved";lt({target:"Promise",stat:!0,forced:Yp},{any:function(e){var t=this,n=y6("AggregateError"),r=C6.f(t),i=r.resolve,s=r.reject,a=I6(function(){var d=R6(t.resolve),l=[],u=0,p=1,_=!1;w6(e,function(m){var E=u++,C=!1;p++,v6(d,t,m).then(function(R){C||_||(_=!0,i(R))},function(R){C||_||(C=!0,l[E]=R,--p||s(new n(l,Ww)))})}),--p||s(new n(l,Ww))});return a.error&&s(a.value),r.promise}});var A6=lt,b6=K,O6=zs,N6=Uo,D6=Wr,Hw=id,rS=se.Promise,Kw=!1;A6({target:"Promise",stat:!0,forced:!rS||!rS.try||Hw(function(){rS.try(function(e){Kw=e===8},8)}).error||!Kw},{try:function(e){var t=arguments.length>1?O6(arguments,1):[],n=N6.f(this),r=Hw(function(){return b6(D6(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var P6=Uo;lt({target:"Promise",stat:!0},{withResolvers:function(){var e=P6.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var k6=lt,iS=Ja,L6=S,M6=hr,U6=ct,x6=kg,zw=Gw,V6=iS&&iS.prototype;k6({target:"Promise",proto:!0,real:!0,forced:!!iS&&L6(function(){V6.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=x6(this,M6("Promise")),n=U6(e);return this.then(n?function(r){return zw(t,e()).then(function(){return r})}:e,n?function(r){return zw(t,e()).then(function(){throw r})}:e)}});var oS=H,F6=eg,B6=Hr,j6=Ha,G6=oS("".charAt),Yw=oS("".charCodeAt),W6=oS("".slice),qw=function(e){return function(t,n){var r,i,s=B6(j6(t)),a=F6(n),d=s.length;return a<0||a>=d?e?"":void 0:(r=Yw(s,a))<55296||r>56319||a+1===d||(i=Yw(s,a+1))<56320||i>57343?e?G6(s,a):r:e?W6(s,a,a+2):i-56320+(r-55296<<10)+65536}},sS={codeAt:qw(!1),charAt:qw(!0)},H6=sS.charAt,K6=Hr,Xw=qa,z6=HI,Jw=xp,Qw="String Iterator",Y6=Xw.set,q6=Xw.getterFor(Qw);z6(String,"String",function(e){Y6(this,{type:Qw,string:K6(e),index:0})},function(){var e,t=q6(this),n=t.string,r=t.index;return r>=n.length?Jw(void 0,!0):(e=H6(n,r),t.index+=e.length,Jw(e,!1))});var X6=di.Promise,J6={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Q6=se,Z6=ls,Zw=Zc;for(var aS in J6)Z6(Q6[aS],aS),Zw[aS]=Zw.Array;var $w=X6,de=g($w),$6=Ni("Array","values"),eH=Hs,tH=Kn,nH=J,rH=$6,cS=Array.prototype,iH={DOMTokenList:!0,NodeList:!0},oH=function(e){var t=e.values;return e===cS||nH(cS,e)&&t===cS.values||tH(iH,eH(e))?rH:t},Lr=g(oH),eA=Yc,sH=TypeError,tA=zs,aH=Math.floor,dS=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var a=aH(n/2),d=dS(tA(e,0,a),t),l=dS(tA(e,a),t),u=d.length,p=l.length,_=0,m=0;_<u||m<p;)e[_+m]=_<u&&m<p?t(d[_],l[m])<=0?d[_++]:l[m++]:_<u?d[_++]:l[m++];return e},nA=dS,rA=ds.match(/firefox\/(\d+)/i),cH=!!rA&&+rA[1],dH=/MSIE|Trident/.test(ds),iA=ds.match(/AppleWebKit\/(\d+)\./),lH=!!iA&&+iA[1],uH=lt,oA=H,hH=Wr,pH=Lo,sA=Ws,fH=function(e,t){if(!delete e[t])throw new sH("Cannot delete property "+eA(t)+" of "+eA(e))},aA=Hr,lS=S,_H=nA,mH=Tp,cA=cH,EH=dH,dA=Ka,lA=lH,qs=[],uA=oA(qs.sort),gH=oA(qs.push),SH=lS(function(){qs.sort(void 0)}),TH=lS(function(){qs.sort(null)}),vH=mH("sort"),hA=!lS(function(){if(dA)return dA<70;if(!(cA&&cA>3)){if(EH)return!0;if(lA)return lA<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)qs.push({k:t+r,v:n})}for(qs.sort(function(s,a){return a.v-s.v}),r=0;r<qs.length;r++)t=qs[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});uH({target:"Array",proto:!0,forced:SH||!TH||!vH||!hA},{sort:function(e){e!==void 0&&hH(e);var t=pH(this);if(hA)return e===void 0?uA(t):uA(t,e);var n,r,i=[],s=sA(t);for(r=0;r<s;r++)r in t&&gH(i,t[r]);for(_H(i,function(a){return function(d,l){return l===void 0?-1:d===void 0?1:a!==void 0?+a(d,l)||0:aA(d)>aA(l)?1:-1}}(e)),n=sA(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)fH(t,r++);return t}});var RH=Ni("Array","sort"),yH=J,CH=RH,uS=Array.prototype,IH=function(e){var t=e.sort;return e===uS||yH(uS,e)&&t===uS.sort?CH:t},Qa=g(IH),wH=lt,AH=H,bH=tg,OH=RangeError,pA=String.fromCharCode,fA=String.fromCodePoint,NH=AH([].join);wH({target:"String",stat:!0,arity:1,forced:!!fA&&fA.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],bH(t,1114111)!==t)throw new OH(t+" is not a valid code point");n[i]=t<65536?pA(t):pA(55296+((t-=65536)>>10),t%1024+56320)}return NH(n,"")}});var DH=S,PH=nn("iterator"),qp=!DH(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,s){t.delete("b"),r+=s+i}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[PH]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),kH=Ks,hS=lt,_A=se,pS=hw,LH=hr,Xp=un,oo=H,au=en,mA=qp,EA=Ks,MH=Fp,UH=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:kH(e,r,t[r],n);return e},xH=ls,VH=Ag,fS=qa,gA=Og,_S=ct,FH=Kn,BH=Gs,jH=Hs,GH=kr,SA=ur,Mr=Hr,WH=Ql,TA=vr,vA=Eg,HH=Op,Jp=xp,ad=Xa,KH=nA,zH=nn("iterator"),cd="URLSearchParams",RA=cd+"Iterator",yA=fS.set,Pi=fS.getterFor(cd),YH=fS.getterFor(RA),CA=pS("fetch"),Qp=pS("Request"),cu=pS("Headers"),mS=Qp&&Qp.prototype,IA=cu&&cu.prototype,qH=_A.TypeError,XH=_A.encodeURIComponent,JH=String.fromCharCode,QH=LH("String","fromCodePoint"),ZH=parseInt,Zp=oo("".charAt),wA=oo([].join),Xs=oo([].push),AA=oo("".replace),$H=oo([].shift),bA=oo([].splice),OA=oo("".split),NA=oo("".slice),e8=oo(/./.exec),t8=/\+/g,n8=/^[0-9a-f]+$/i,DA=function(e,t){var n=NA(e,t,t+2);return e8(n8,n)?ZH(n,16):NaN},r8=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},i8=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},PA=function(e){for(var t=(e=AA(e,t8," ")).length,n="",r=0;r<t;){var i=Zp(e,r);if(i==="%"){if(Zp(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var s=DA(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var a=r8(s);if(a===0)i=JH(s);else{if(a===1||a>4){n+="",r++;continue}for(var d=[s],l=1;l<a&&!(++r+3>t||Zp(e,r)!=="%");){var u=DA(e,r+1);if(u!=u){r+=3;break}if(u>191||u<128)break;Xs(d,u),r+=2,l++}if(d.length!==a){n+="";continue}var p=i8(d);p===null?n+="":i=QH(p)}}n+=i,r++}return n},o8=/[!'()~]|%20/g,s8={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},a8=function(e){return s8[e]},kA=function(e){return AA(XH(e),o8,a8)},ES=VH(function(e,t){yA(this,{type:RA,target:Pi(e).entries,index:0,kind:t})},cd,function(){var e=YH(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Jp(void 0,!0);var r=t[n];switch(e.kind){case"keys":return Jp(r.key,!1);case"values":return Jp(r.value,!1)}return Jp([r.key,r.value],!1)},!0),LA=function(e){this.entries=[],this.url=null,e!==void 0&&(SA(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Zp(e,0)==="?"?NA(e,1):e:Mr(e)))};LA.prototype={type:cd,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,a,d,l=this.entries,u=HH(e);if(u)for(n=(t=vA(e,u)).next;!(r=Xp(n,t)).done;){if(s=(i=vA(GH(r.value))).next,(a=Xp(s,i)).done||(d=Xp(s,i)).done||!Xp(s,i).done)throw new qH("Expected sequence with length 2");Xs(l,{key:Mr(a.value),value:Mr(d.value)})}else for(var p in e)FH(e,p)&&Xs(l,{key:p,value:Mr(e[p])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=OA(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=OA(t,"="),Xs(r,{key:PA($H(n)),value:PA(wA(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Xs(n,kA(e.key)+"="+kA(e.value));return wA(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var $p=function(){gA(this,dd);var e=yA(this,new LA(arguments.length>0?arguments[0]:void 0));au||(this.size=e.entries.length)},dd=$p.prototype;if(UH(dd,{append:function(e,t){var n=Pi(this);ad(arguments.length,2),Xs(n.entries,{key:Mr(e),value:Mr(t)}),au||this.length++,n.updateURL()},delete:function(e){for(var t=Pi(this),n=ad(arguments.length,1),r=t.entries,i=Mr(e),s=n<2?void 0:arguments[1],a=s===void 0?s:Mr(s),d=0;d<r.length;){var l=r[d];if(l.key!==i||a!==void 0&&l.value!==a)d++;else if(bA(r,d,1),a!==void 0)break}au||(this.size=r.length),t.updateURL()},get:function(e){var t=Pi(this).entries;ad(arguments.length,1);for(var n=Mr(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Pi(this).entries;ad(arguments.length,1);for(var n=Mr(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Xs(r,t[i].value);return r},has:function(e){for(var t=Pi(this).entries,n=ad(arguments.length,1),r=Mr(e),i=n<2?void 0:arguments[1],s=i===void 0?i:Mr(i),a=0;a<t.length;){var d=t[a++];if(d.key===r&&(s===void 0||d.value===s))return!0}return!1},set:function(e,t){var n=Pi(this);ad(arguments.length,1);for(var r,i=n.entries,s=!1,a=Mr(e),d=Mr(t),l=0;l<i.length;l++)(r=i[l]).key===a&&(s?bA(i,l--,1):(s=!0,r.value=d));s||Xs(i,{key:a,value:d}),au||(this.size=i.length),n.updateURL()},sort:function(){var e=Pi(this);KH(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Pi(this).entries,r=BH(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new ES(this,"keys")},values:function(){return new ES(this,"values")},entries:function(){return new ES(this,"entries")}},{enumerable:!0}),EA(dd,zH,dd.entries,{name:"entries"}),EA(dd,"toString",function(){return Pi(this).serialize()},{enumerable:!0}),au&&MH(dd,"size",{get:function(){return Pi(this).entries.length},configurable:!0,enumerable:!0}),xH($p,cd),hS({global:!0,constructor:!0,forced:!mA},{URLSearchParams:$p}),!mA&&_S(cu)){var c8=oo(IA.has),d8=oo(IA.set),MA=function(e){if(SA(e)){var t,n=e.body;if(jH(n)===cd)return t=e.headers?new cu(e.headers):new cu,c8(t,"content-type")||d8(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),WH(e,{body:TA(0,Mr(n)),headers:TA(0,t)})}return e};if(_S(CA)&&hS({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return CA(e,arguments.length>1?MA(arguments[1]):{})}}),_S(Qp)){var gS=function(e){return gA(this,mS),new Qp(e,arguments.length>1?MA(arguments[1]):{})};mS.constructor=gS,gS.prototype=mS,hS({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:gS})}}var ki,l8={URLSearchParams:$p,getState:Pi},u8=di.URLSearchParams,UA=en,h8=H,p8=un,f8=S,SS=wp,_8=Jl,m8=xe,E8=Lo,g8=_p,ld=Object.assign,xA=Object.defineProperty,S8=h8([].concat),T8=!ld||f8(function(){if(UA&&ld({b:1},ld(xA({},"a",{enumerable:!0,get:function(){xA(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),ld({},e)[n]!==7||SS(ld({},t)).join("")!==r})?function(e,t){for(var n=E8(e),r=arguments.length,i=1,s=_8.f,a=m8.f;r>i;)for(var d,l=g8(arguments[i++]),u=s?S8(SS(l),s(l)):SS(l),p=u.length,_=0;p>_;)d=u[_++],UA&&!p8(a,l,d)||(n[d]=l[d]);return n}:ld,v8=kr,R8=CI,y8=en,C8=Oi,I8=vr,TS=function(e,t,n){y8?C8.f(e,t,I8(0,n)):e[t]=n},w8=Gs,A8=un,b8=Lo,O8=function(e,t,n,r){try{return r?t(v8(n)[0],n[1]):t(n)}catch(i){R8(e,"throw",i)}},N8=vI,D8=Bp,P8=Ws,VA=TS,k8=Eg,L8=Op,FA=Array,Za=H,vS=2147483647,M8=/[^\0-\u007E]/,BA=/[.\u3002\uFF0E\uFF61]/g,jA="Overflow: input needs wider integers to process",GA=RangeError,U8=Za(BA.exec),ud=Math.floor,RS=String.fromCharCode,WA=Za("".charCodeAt),HA=Za([].join),Js=Za([].push),x8=Za("".replace),V8=Za("".split),F8=Za("".toLowerCase),KA=function(e){return e+22+75*(e<26)},B8=function(e,t,n){var r=0;for(e=n?ud(e/700):e>>1,e+=ud(e/t);e>455;)e=ud(e/35),r+=36;return ud(r+36*e/(e+38))},j8=function(e){var t=[];e=function(b){for(var A=[],D=0,V=b.length;D<V;){var x=WA(b,D++);if(x>=55296&&x<=56319&&D<V){var k=WA(b,D++);(64512&k)==56320?Js(A,((1023&x)<<10)+(1023&k)+65536):(Js(A,x),D--)}else Js(A,x)}return A}(e);var n,r,i=e.length,s=128,a=0,d=72;for(n=0;n<e.length;n++)(r=e[n])<128&&Js(t,RS(r));var l=t.length,u=l;for(l&&Js(t,"-");u<i;){var p=vS;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<p&&(p=r);var _=u+1;if(p-s>ud((vS-a)/_))throw new GA(jA);for(a+=(p-s)*_,s=p,n=0;n<e.length;n++){if((r=e[n])<s&&++a>vS)throw new GA(jA);if(r===s){for(var m=a,E=36;;){var C=E<=d?1:E>=d+26?26:E-d;if(m<C)break;var R=m-C,y=36-C;Js(t,RS(KA(C+R%y))),m=ud(R/y),E+=36}Js(t,RS(KA(m))),d=B8(a,_,u===l),a=0,u++}}a++,s++}return HA(t,"")},G8=lt,yS=en,W8=qp,CS=se,zA=Gs,Li=H,ef=Ks,Mi=Fp,H8=Og,IS=Kn,wS=T8,hd=function(e){var t=b8(e),n=D8(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=w8(i,r>2?arguments[2]:void 0));var a,d,l,u,p,_,m=L8(t),E=0;if(!m||this===FA&&N8(m))for(a=P8(t),d=n?new this(a):FA(a);a>E;E++)_=s?i(t[E],E):t[E],VA(d,E,_);else for(d=n?new this:[],p=(u=k8(t,m)).next;!(l=A8(p,u)).done;E++)_=s?O8(u,i,[l.value,E],!0):l.value,VA(d,E,_);return d.length=E,d},so=zs,K8=sS.codeAt,z8=function(e){var t,n,r=[],i=V8(x8(F8(e),BA,"."),".");for(t=0;t<i.length;t++)n=i[t],Js(r,U8(M8,n)?"xn--"+j8(n):n);return HA(r,".")},us=Hr,Y8=ls,q8=Xa,YA=l8,qA=qa,X8=qA.set,tf=qA.getterFor("URL"),J8=YA.URLSearchParams,Q8=YA.getState,du=CS.URL,AS=CS.TypeError,nf=CS.parseInt,Z8=Math.floor,XA=Math.pow,Ui=Li("".charAt),ao=Li(/./.exec),lu=Li([].join),$8=Li(1 .toString),eK=Li([].pop),pd=Li([].push),bS=Li("".replace),tK=Li([].shift),nK=Li("".split),uu=Li("".slice),rf=Li("".toLowerCase),rK=Li([].unshift),OS="Invalid scheme",$a="Invalid host",JA="Invalid port",QA=/[a-z]/i,iK=/[\d+-.a-z]/i,NS=/\d/,oK=/^0x/i,sK=/^[0-7]+$/,aK=/^\d+$/,ZA=/^[\da-f]+$/i,cK=/[\0\t\n\r #%/:<>?@[\\\]^|]/,dK=/[\0\t\n\r #/:<>?@[\\\]^|]/,lK=/^[\u0000-\u0020]+/,uK=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,hK=/[\t\n\r]/g,hu=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)rK(t,e%256),e=Z8(e/256);return lu(t,".")}if(typeof e=="object"){for(t="",r=function(s){for(var a=null,d=1,l=null,u=0,p=0;p<8;p++)s[p]!==0?(u>d&&(a=l,d=u),l=null,u=0):(l===null&&(l=p),++u);return u>d?l:a}(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=$8(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},of={},$A=wS({},of,{" ":1,'"':1,"<":1,">":1,"`":1}),eb=wS({},$A,{"#":1,"?":1,"{":1,"}":1}),DS=wS({},eb,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qs=function(e,t){var n=K8(e,0);return n>32&&n<127&&!IS(t,e)?e:encodeURIComponent(e)},sf={ftp:21,file:null,http:80,https:443,ws:80,wss:443},pu=function(e,t){var n;return e.length===2&&ao(QA,Ui(e,0))&&((n=Ui(e,1))===":"||!t&&n==="|")},tb=function(e){var t;return e.length>1&&pu(uu(e,0,2))&&(e.length===2||(t=Ui(e,2))==="/"||t==="\\"||t==="?"||t==="#")},pK=function(e){return e==="."||rf(e)==="%2e"},PS={},nb={},kS={},rb={},ib={},LS={},ob={},sb={},af={},cf={},MS={},US={},xS={},VS={},ab={},FS={},fd={},xo={},cb={},ec={},hs={},BS=function(e,t,n){var r,i,s,a=us(e);if(t){if(i=this.parse(a))throw new AS(i);this.searchParams=null}else{if(n!==void 0&&(r=new BS(n,!0)),i=this.parse(a,null,r))throw new AS(i);(s=Q8(new J8)).bindURL(this),this.searchParams=s}};BS.prototype={type:"URL",parse:function(e,t,n){var r,i,s,a,d,l=this,u=t||PS,p=0,_="",m=!1,E=!1,C=!1;for(e=us(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=bS(e,lK,""),e=bS(e,uK,"$1")),e=bS(e,hK,""),r=hd(e);p<=r.length;){switch(i=r[p],u){case PS:if(!i||!ao(QA,i)){if(t)return OS;u=kS;continue}_+=rf(i),u=nb;break;case nb:if(i&&(ao(iK,i)||i==="+"||i==="-"||i==="."))_+=rf(i);else{if(i!==":"){if(t)return OS;_="",u=kS,p=0;continue}if(t&&(l.isSpecial()!==IS(sf,_)||_==="file"&&(l.includesCredentials()||l.port!==null)||l.scheme==="file"&&!l.host))return;if(l.scheme=_,t)return void(l.isSpecial()&&sf[l.scheme]===l.port&&(l.port=null));_="",l.scheme==="file"?u=VS:l.isSpecial()&&n&&n.scheme===l.scheme?u=rb:l.isSpecial()?u=sb:r[p+1]==="/"?(u=ib,p++):(l.cannotBeABaseURL=!0,pd(l.path,""),u=cb)}break;case kS:if(!n||n.cannotBeABaseURL&&i!=="#")return OS;if(n.cannotBeABaseURL&&i==="#"){l.scheme=n.scheme,l.path=so(n.path),l.query=n.query,l.fragment="",l.cannotBeABaseURL=!0,u=hs;break}u=n.scheme==="file"?VS:LS;continue;case rb:if(i!=="/"||r[p+1]!=="/"){u=LS;continue}u=af,p++;break;case ib:if(i==="/"){u=cf;break}u=xo;continue;case LS:if(l.scheme=n.scheme,i===ki)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=so(n.path),l.query=n.query;else if(i==="/"||i==="\\"&&l.isSpecial())u=ob;else if(i==="?")l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=so(n.path),l.query="",u=ec;else{if(i!=="#"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=so(n.path),l.path.length--,u=xo;continue}l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=so(n.path),l.query=n.query,l.fragment="",u=hs}break;case ob:if(!l.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,u=xo;continue}u=cf}else u=af;break;case sb:if(u=af,i!=="/"||Ui(_,p+1)!=="/")continue;p++;break;case af:if(i!=="/"&&i!=="\\"){u=cf;continue}break;case cf:if(i==="@"){m&&(_="%40"+_),m=!0,s=hd(_);for(var R=0;R<s.length;R++){var y=s[R];if(y!==":"||C){var b=Qs(y,DS);C?l.password+=b:l.username+=b}else C=!0}_=""}else if(i===ki||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(m&&_==="")return"Invalid authority";p-=hd(_).length+1,_="",u=MS}else _+=i;break;case MS:case US:if(t&&l.scheme==="file"){u=FS;continue}if(i!==":"||E){if(i===ki||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(l.isSpecial()&&_==="")return $a;if(t&&_===""&&(l.includesCredentials()||l.port!==null))return;if(a=l.parseHost(_))return a;if(_="",u=fd,t)return;continue}i==="["?E=!0:i==="]"&&(E=!1),_+=i}else{if(_==="")return $a;if(a=l.parseHost(_))return a;if(_="",u=xS,t===US)return}break;case xS:if(!ao(NS,i)){if(i===ki||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()||t){if(_!==""){var A=nf(_,10);if(A>65535)return JA;l.port=l.isSpecial()&&A===sf[l.scheme]?null:A,_=""}if(t)return;u=fd;continue}return JA}_+=i;break;case VS:if(l.scheme="file",i==="/"||i==="\\")u=ab;else{if(!n||n.scheme!=="file"){u=xo;continue}switch(i){case ki:l.host=n.host,l.path=so(n.path),l.query=n.query;break;case"?":l.host=n.host,l.path=so(n.path),l.query="",u=ec;break;case"#":l.host=n.host,l.path=so(n.path),l.query=n.query,l.fragment="",u=hs;break;default:tb(lu(so(r,p),""))||(l.host=n.host,l.path=so(n.path),l.shortenPath()),u=xo;continue}}break;case ab:if(i==="/"||i==="\\"){u=FS;break}n&&n.scheme==="file"&&!tb(lu(so(r,p),""))&&(pu(n.path[0],!0)?pd(l.path,n.path[0]):l.host=n.host),u=xo;continue;case FS:if(i===ki||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&pu(_))u=xo;else if(_===""){if(l.host="",t)return;u=fd}else{if(a=l.parseHost(_))return a;if(l.host==="localhost"&&(l.host=""),t)return;_="",u=fd}continue}_+=i;break;case fd:if(l.isSpecial()){if(u=xo,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==ki&&(u=xo,i!=="/"))continue}else l.fragment="",u=hs;else l.query="",u=ec;break;case xo:if(i===ki||i==="/"||i==="\\"&&l.isSpecial()||!t&&(i==="?"||i==="#")){if((d=rf(d=_))===".."||d==="%2e."||d===".%2e"||d==="%2e%2e"?(l.shortenPath(),i==="/"||i==="\\"&&l.isSpecial()||pd(l.path,"")):pK(_)?i==="/"||i==="\\"&&l.isSpecial()||pd(l.path,""):(l.scheme==="file"&&!l.path.length&&pu(_)&&(l.host&&(l.host=""),_=Ui(_,0)+":"),pd(l.path,_)),_="",l.scheme==="file"&&(i===ki||i==="?"||i==="#"))for(;l.path.length>1&&l.path[0]==="";)tK(l.path);i==="?"?(l.query="",u=ec):i==="#"&&(l.fragment="",u=hs)}else _+=Qs(i,eb);break;case cb:i==="?"?(l.query="",u=ec):i==="#"?(l.fragment="",u=hs):i!==ki&&(l.path[0]+=Qs(i,of));break;case ec:t||i!=="#"?i!==ki&&(i==="'"&&l.isSpecial()?l.query+="%27":l.query+=i==="#"?"%23":Qs(i,of)):(l.fragment="",u=hs);break;case hs:i!==ki&&(l.fragment+=Qs(i,$A))}p++}},parseHost:function(e){var t,n,r;if(Ui(e,0)==="["){if(Ui(e,e.length-1)!=="]"||(t=function(i){var s,a,d,l,u,p,_,m=[0,0,0,0,0,0,0,0],E=0,C=null,R=0,y=function(){return Ui(i,R)};if(y()===":"){if(Ui(i,1)!==":")return;R+=2,C=++E}for(;y();){if(E===8)return;if(y()!==":"){for(s=a=0;a<4&&ao(ZA,y());)s=16*s+nf(y(),16),R++,a++;if(y()==="."){if(a===0||(R-=a,E>6))return;for(d=0;y();){if(l=null,d>0){if(!(y()==="."&&d<4))return;R++}if(!ao(NS,y()))return;for(;ao(NS,y());){if(u=nf(y(),10),l===null)l=u;else{if(l===0)return;l=10*l+u}if(l>255)return;R++}m[E]=256*m[E]+l,++d!=2&&d!==4||E++}if(d!==4)return;break}if(y()===":"){if(R++,!y())return}else if(y())return;m[E++]=s}else{if(C!==null)return;R++,C=++E}}if(C!==null)for(p=E-C,E=7;E!==0&&p>0;)_=m[E],m[E--]=m[C+p-1],m[C+--p]=_;else if(E!==8)return;return m}(uu(e,1,-1)),!t))return $a;this.host=t}else if(this.isSpecial()){if(e=z8(e),ao(cK,e)||(t=function(i){var s,a,d,l,u,p,_,m=nK(i,".");if(m.length&&m[m.length-1]===""&&m.length--,(s=m.length)>4)return i;for(a=[],d=0;d<s;d++){if((l=m[d])==="")return i;if(u=10,l.length>1&&Ui(l,0)==="0"&&(u=ao(oK,l)?16:8,l=uu(l,u===8?1:2)),l==="")p=0;else{if(!ao(u===10?aK:u===8?sK:ZA,l))return i;p=nf(l,u)}pd(a,p)}for(d=0;d<s;d++)if(p=a[d],d===s-1){if(p>=XA(256,5-s))return null}else if(p>255)return null;for(_=eK(a),d=0;d<a.length;d++)_+=a[d]*XA(256,3-d);return _}(e),t===null))return $a;this.host=t}else{if(ao(dK,e))return $a;for(t="",n=hd(e),r=0;r<n.length;r++)t+=Qs(n[r],of);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return IS(sf,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&pu(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,a=e.path,d=e.query,l=e.fragment,u=t+":";return i!==null?(u+="//",e.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=hu(i),s!==null&&(u+=":"+s)):t==="file"&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+lu(a,"/"):"",d!==null&&(u+="?"+d),l!==null&&(u+="#"+l),u},setHref:function(e){var t=this.parse(e);if(t)throw new AS(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new _d(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+hu(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(us(e)+":",PS)},getUsername:function(){return this.username},setUsername:function(e){var t=hd(us(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Qs(t[n],DS)}},getPassword:function(){return this.password},setPassword:function(e){var t=hd(us(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Qs(t[n],DS)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?hu(e):hu(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,MS)},getHostname:function(){var e=this.host;return e===null?"":hu(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,US)},getPort:function(){var e=this.port;return e===null?"":us(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=us(e))===""?this.port=null:this.parse(e,xS))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+lu(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,fd))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=us(e))===""?this.query=null:(Ui(e,0)==="?"&&(e=uu(e,1)),this.query="",this.parse(e,ec)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=us(e))!==""?(Ui(e,0)==="#"&&(e=uu(e,1)),this.fragment="",this.parse(e,hs)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var _d=function(e){var t=H8(this,Ur),n=q8(arguments.length,1)>1?arguments[1]:void 0,r=X8(t,new BS(e,!1,n));yS||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Ur=_d.prototype,xi=function(e,t){return{get:function(){return tf(this)[e]()},set:t&&function(n){return tf(this)[t](n)},configurable:!0,enumerable:!0}};if(yS&&(Mi(Ur,"href",xi("serialize","setHref")),Mi(Ur,"origin",xi("getOrigin")),Mi(Ur,"protocol",xi("getProtocol","setProtocol")),Mi(Ur,"username",xi("getUsername","setUsername")),Mi(Ur,"password",xi("getPassword","setPassword")),Mi(Ur,"host",xi("getHost","setHost")),Mi(Ur,"hostname",xi("getHostname","setHostname")),Mi(Ur,"port",xi("getPort","setPort")),Mi(Ur,"pathname",xi("getPathname","setPathname")),Mi(Ur,"search",xi("getSearch","setSearch")),Mi(Ur,"searchParams",xi("getSearchParams")),Mi(Ur,"hash",xi("getHash","setHash"))),ef(Ur,"toJSON",function(){return tf(this).serialize()},{enumerable:!0}),ef(Ur,"toString",function(){return tf(this).serialize()},{enumerable:!0}),du){var db=du.createObjectURL,lb=du.revokeObjectURL;db&&ef(_d,"createObjectURL",zA(db,du)),lb&&ef(_d,"revokeObjectURL",zA(lb,du))}Y8(_d,"URL"),G8({global:!0,constructor:!0,forced:!W8,sham:!yS},{URL:_d});var fK=lt,ub=S,_K=Xa,hb=Hr,mK=qp,jS=hr("URL"),EK=mK&&ub(function(){jS.canParse()}),gK=ub(function(){return jS.canParse.length!==1});fK({target:"URL",stat:!0,forced:!EK||gK},{canParse:function(e){var t=_K(arguments.length,1),n=hb(e),r=t<2||arguments[1]===void 0?void 0:hb(arguments[1]);try{return!!new jS(n,r)}catch{return!1}}});var SK=lt,TK=Xa,pb=Hr,vK=qp,RK=hr("URL");SK({target:"URL",stat:!0,forced:!vK},{parse:function(e){var t=TK(arguments.length,1),n=pb(e),r=t<2||arguments[1]===void 0?void 0:pb(arguments[1]);try{return new RK(n,r)}catch{return null}}});var df=g(di.URL);let fb=!0,_b=!0;function lf(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function tc(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(a,d){if(a!==t)return i.apply(this,arguments);const l=u=>{const p=n(u);p&&(d.handleEvent?d.handleEvent(p):d(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,l),i.apply(this,[a,l])};const s=r.removeEventListener;r.removeEventListener=function(a,d){if(a!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(d))return s.apply(this,arguments);const l=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(a){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),a&&this.addEventListener(t,this["_on"+t]=a)},enumerable:!0,configurable:!0})}function yK(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(fb=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function CK(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(_b=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function mb(){if(typeof window=="object"){if(fb)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function GS(e,t){_b&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Eb(e){return Object.prototype.toString.call(e)==="[object Object]"}function gb(e){var t;return Eb(e)?Di(t=Object.keys(e)).call(t,function(n,r){const i=Eb(e[r]),s=i?gb(e[r]):e[r],a=i&&!Object.keys(s).length;return s===void 0||a?n:Object.assign(n,{[r]:s})},{}):e}function WS(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?WS(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{WS(e,e.get(i),n)})}))}function Sb(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===t.id&&s.push(a)}),s.forEach(a=>{e.forEach(d=>{d.type===r&&d.trackId===a.id&&WS(e,d,i)})}),i}const Tb=mb;function vb(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const d={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const p=function(_,m){return _?_+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){d.optional=d.optional||[];let _={};typeof u.ideal=="number"?(_[p("min",l)]=u.ideal,d.optional.push(_),_={},_[p("max",l)]=u.ideal,d.optional.push(_)):(_[p("",l)]=u.ideal,d.optional.push(_))}u.exact!==void 0&&typeof u.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[p("",l)]=u.exact):["min","max"].forEach(_=>{u[_]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[p(_,l)]=u[_])})}),a.advanced&&(d.optional=(d.optional||[]).concat(a.advanced)),d},i=function(a,d){if(t.version>=61)return d(a);if((a=JSON.parse(JSON.stringify(a)))&&typeof a.audio=="object"){const l=function(u,p,_){p in u&&!(_ in u)&&(u[_]=u[p],delete u[p])};l((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||u)){let p;if(delete a.video.facingMode,l.exact==="environment"||l.ideal==="environment"?p=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(_=>{_=_.filter(E=>E.kind==="videoinput");let m=_.find(E=>p.some(C=>{var R;return oe(R=E.label.toLowerCase()).call(R,C)}));return!m&&_.length&&oe(p).call(p,"back")&&(m=_[_.length-1]),m&&(a.video.deviceId=l.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=r(a.video),Tb("chrome: "+JSON.stringify(a)),d(a)})}a.video=r(a.video)}return Tb("chrome: "+JSON.stringify(a)),d(a)},s=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(a,d,l){i(a,u=>{n.webkitGetUserMedia(u,d,p=>{l&&l(s(p))})})}).bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(d){return i(d,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return u},u=>de.reject(s(u))))}}}function Rb(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function yb(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===r.id):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else tc(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Cb(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,d){let l=i.apply(this,arguments);return l||(l=t(this,a),this._senders.push(l)),l};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const d=this._senders.indexOf(a);d!==-1&&this._senders.splice(d,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{const a=this._senders.find(d=>d.track===s);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ib(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(d){const l={};return d.result().forEach(u=>{const p={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(_=>{p[_]=u.stat(_)}),l[p.id]=p}),l},a=function(d){return new Map(Object.keys(d).map(l=>[l,d[l]]))};if(arguments.length>=2){const d=function(l){r(a(s(l)))};return t.apply(this,[d,n])}return new de((d,l)=>{t.apply(this,[function(u){d(a(s(u)))},l])}).then(r,i)}}function wb(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>Sb(s,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),tc(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>Sb(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach(a=>{a.track===n&&(r?s=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===n&&(i?s=!0:i=a),a.track===n)),s||r&&i?de.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():de.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ab(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(d)===-1&&this._shimmedLocalStreams[a.id].push(d):this._shimmedLocalStreams[a.id]=[a,d],d};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(p=>p.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const d=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(d)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const d=this._shimmedLocalStreams[a].indexOf(s);d!==-1&&this._shimmedLocalStreams[a].splice(d,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function bb(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ab(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(u=>this._reverseStreams[u.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(u=>{if(this.getSenders().find(_=>_.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const u=new e.MediaStream(l.getTracks());this._streams[l.id]=u,this._reverseStreams[u.id]=l,l=u}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;function s(l,u){let p=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(_=>{const m=l._reverseStreams[_],E=l._streams[m.id];p=p.replace(new RegExp(E.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:p})}e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(E=>E===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[u.id];if(m)m.addTrack(l),de.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new e.MediaStream([l]);this._streams[u.id]=E,this._reverseStreams[E.id]=u,this.addStream(E)}return this.getSenders().find(E=>E.track===l)},["createOffer","createAnswer"].forEach(function(l){const u=e.RTCPeerConnection.prototype[l],p={[l](){const _=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[m=>{const E=s(this,m);_[0].apply(null,[E])},m=>{_[1]&&_[1].apply(null,m)},arguments[2]]):u.apply(this,arguments).then(m=>s(this,m))}};e.RTCPeerConnection.prototype[l]=p[l]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(l,u){let p=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(_=>{const m=l._reverseStreams[_],E=l._streams[m.id];p=p.replace(new RegExp(m.id,"g"),E.id)}),new RTCSessionDescription({type:u.type,sdp:p})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=d.get.apply(this);return l.type===""?l:s(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(_=>l.track===_)&&(u=this._streams[p])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function HS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function Ob(e,t){tc(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var Nb=Object.freeze({__proto__:null,fixNegotiationNeeded:Ob,shimAddTrackRemoveTrack:bb,shimAddTrackRemoveTrackWithNative:Ab,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:a||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Cb,shimGetStats:Ib,shimGetUserMedia:vb,shimMediaStream:Rb,shimOnTrack:yb,shimPeerConnection:HS,shimSenderReceiverGetStats:wb});function Db(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,s,a){GS("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,a)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(a,d,l){d in a&&!(l in a)&&(a[l]=a[d],delete a[d])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const d=a.apply(this,arguments);return i(d,"mozAutoGainControl","autoGainControl"),i(d,"mozNoiseSuppression","noiseSuppression"),d}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),i(d,"autoGainControl","mozAutoGainControl"),i(d,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[d])}}}}function Pb(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KS(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=a[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,a]=arguments;return r.apply(this,[i||null]).then(d=>{if(t.version<53&&!s)try{d.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;d.forEach((u,p)=>{d.set(p,Object.assign({},u,{type:n[u.type]||u.type}))})}return d}).then(s,a)}}function kb(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):de.resolve(new Map)}}function Lb(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),tc(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Mb(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){GS("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&oe(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function Ub(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function xb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:s}=i,a=s.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(a).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function Vb(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Fb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?de.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Bb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?de.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var jb=Object.freeze({__proto__:null,shimAddTransceiver:xb,shimCreateAnswer:Bb,shimCreateOffer:Fb,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,de.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Vb,shimGetUserMedia:Db,shimOnTrack:Pb,shimPeerConnection:KS,shimRTCDataChannel:Ub,shimReceiverGetStats:Lb,shimRemoveStream:Mb,shimSenderGetStats:kb});function Gb(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),oe(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach(a=>{var d;this._localStreams?oe(d=this._localStreams).call(d,a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{oe(r).call(r,i.track)&&this.removeTrack(i)})})}}function Wb(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),oe(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function Hb(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(l,u){const p=arguments.length>=2?arguments[2]:arguments[0],_=n.apply(this,[p]);return u?(_.then(l,u),de.resolve()):_},t.createAnswer=function(l,u){const p=arguments.length>=2?arguments[2]:arguments[0],_=r.apply(this,[p]);return u?(_.then(l,u),de.resolve()):_};let d=function(l,u,p){const _=i.apply(this,[l]);return p?(_.then(u,p),de.resolve()):_};t.setLocalDescription=d,d=function(l,u,p){const _=s.apply(this,[l]);return p?(_.then(u,p),de.resolve()):_},t.setRemoteDescription=d,d=function(l,u,p){const _=a.apply(this,[l]);return p?(_.then(u,p),de.resolve()):_},t.addIceCandidate=d}function Kb(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(zb(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function zb(e){return e&&e.video!==void 0?Object.assign({},e,{video:gb(e.video)}):e}function Yb(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let a=n.iceServers[s];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(GS("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function qb(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xb(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Jb(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Qb=Object.freeze({__proto__:null,shimAudioContext:Jb,shimCallbacksAPI:Hb,shimConstraints:zb,shimCreateOfferLegacy:Xb,shimGetUserMedia:Kb,shimLocalStreamsAPI:Gb,shimRTCIceServerUrls:Yb,shimRemoteStreamsAPI:Wb,shimTrackEventTransceiver:qb}),Zb=`	
\v\f\r \u2028\u2029\uFEFF`,IK=Ha,wK=Hr,zS=Zb,$b=H("".replace),AK=RegExp("^["+zS+"]+"),bK=RegExp("(^|[^"+zS+"])["+zS+"]+$"),YS=function(e){return function(t){var n=wK(IK(t));return 1&e&&(n=$b(n,AK,"")),2&e&&(n=$b(n,bK,"$1")),n}},OK={start:YS(1),end:YS(2),trim:YS(3)},NK=MI.PROPER,DK=S,eO=Zb,PK=OK.trim;lt({target:"String",proto:!0,forced:function(e){return DK(function(){return!!eO[e]()||""[e]()!==""||NK&&eO[e].name!==e})}("trim")},{trim:function(){return PK(this)}});var kK=Ni("String","trim"),LK=J,MK=kK,qS=String.prototype,UK=function(e){var t=e.trim;return typeof e=="string"||e===qS||LK(qS,e)&&t===qS.trim?MK:t},Qn=g(UK),tO={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)i=s[a].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?s.push(a+"="+n.parameters[a]):s.push(a)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],s=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const d=i[a],l=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(l){const u=t.parseRtpMap(l),p=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(u.parameters=p.length?t.parseFmtp(p[0]):{},u.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))});const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(a=>{s.forEach(d=>{a.rtcpFeedback.find(l=>l.type===d.type&&l.parameter===d.parameter)||a.rtcpFeedback.push(d)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{i+=t.writeRtpMap(a),i+=t.writeFmtp(a),i+=t.writeRtcpFb(a)});let s=0;return r.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{i+=t.writeExtmap(a)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),l=d.length>0&&d[0].ssrc;let u;const p=t.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(E=>parseInt(E,10)));p.length>0&&p[0].length>1&&p[0][0]===l&&(u=p[0][1]),i.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let E={ssrc:l,codecPayloadType:parseInt(m.parameters.apt,10)};l&&u&&(E.rtx={ssrc:u}),r.push(E),s&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},r.push(E))}}),r.length===0&&l&&r.push({ssrc:l});let _=t.matchPrefix(n,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,r.forEach(m=>{m.maxBitrate=_})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const a=t.matchPrefix(n,"a=rtcp-mux");return r.mux=a.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(n,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const a=t.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const d=t.matchPrefix(n,"a=sctpmap:");if(d.length>0){const l=d[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let s;const a=r!==void 0?r:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(tO);var nO=tO.exports,md=g(nO),xK=h({__proto__:null,default:md},[nO]);function uf(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=md.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,tc(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function XS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||tc(e,"icecandidate",t=>{if(t.candidate){const n=md.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function hf(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(d){if(!d||!d.sdp)return!1;const l=md.splitSections(d.sdp);return l.shift(),l.some(u=>{const p=md.parseMLine(u);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(d){const l=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!=u?-1:u},i=function(d){let l=65536;return t.browser==="firefox"&&(l=t.version<57?d===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},s=function(d,l){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const p=md.matchPrefix(d.sdp,"a=max-message-size:");return p.length>0?u=parseInt(p[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(u=2147483637),u},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const d=r(arguments[0]),l=i(d),u=s(arguments[0],d);let p;p=l===0&&u===0?Number.POSITIVE_INFINITY:l===0||u===0?Math.max(l,u):Math.min(l,u);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>p}),this._sctp=_}return a.apply(this,arguments)}}function pf(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const s=r.send;r.send=function(){const a=arguments[0],d=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&d>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},tc(e,"datachannel",r=>(t(r.channel,r.target),r))}function JS(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",i);s.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function QS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(s=>Qn(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function ff(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?de.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),de.resolve())})}function _f(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var VK=Object.freeze({__proto__:null,removeExtmapAllowMixed:QS,shimAddIceCandidateNullOrEmpty:ff,shimConnectionState:JS,shimMaxMessageSize:hf,shimParameterlessSetLocalDescription:_f,shimRTCIceCandidate:uf,shimRTCIceCandidateRelayProtocol:XS,shimSendThrowTypeError:pf});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=mb,r=function(s){const a={browser:null,version:null};if(s===void 0||!s.navigator)return a.browser="Not a browser.",a;const{navigator:d}=s;if(d.mozGetUserMedia)a.browser="firefox",a.version=lf(d.userAgent,/Firefox\/(\d+)\./,1);else if(d.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)a.browser="chrome",a.version=lf(d.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!d.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=lf(d.userAgent,/AppleWebKit\/(\d+)\./,1),a.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return a}(e),i={browserDetails:r,commonShim:VK,extractVersion:lf,disableLog:yK,disableWarnings:CK,sdp:xK};switch(r.browser){case"chrome":if(!Nb||!HS||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Nb,ff(e,r),_f(e),vb(e,r),Rb(e),HS(e,r),yb(e),bb(e,r),Cb(e),Ib(e),wb(e),Ob(e,r),uf(e),XS(e),JS(e),hf(e,r),pf(e),QS(e,r);break;case"firefox":if(!jb||!KS||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=jb,ff(e,r),_f(e),Db(e,r),KS(e,r),Pb(e),Mb(e),kb(e),Lb(e),Ub(e),xb(e),Vb(e),Fb(e),Bb(e),uf(e),JS(e),hf(e,r),pf(e);break;case"safari":if(!Qb||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Qb,ff(e,r),_f(e),Yb(e),Xb(e),Hb(e),Gb(e),Wb(e),qb(e),Kb(e),Jb(e),uf(e),XS(e),hf(e,r),pf(e),QS(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var ZS=se;lt({global:!0,forced:ZS.globalThis!==ZS},{globalThis:ZS});var rO=g(se),$S={exports:{}};(function(e,t){(function(n,r){var i="function",s="undefined",a="object",d="string",l="major",u="model",p="name",_="type",m="vendor",E="version",C="architecture",R="console",y="mobile",b="tablet",A="smarttv",D="wearable",V="embedded",x="Amazon",k="Apple",B="ASUS",q="BlackBerry",Z="Browser",te="Chrome",Fe="Firefox",Ge="Google",Oe="Huawei",it="LG",nt="Microsoft",Gn="Motorola",Q="Opera",ie="Samsung",fe="Sharp",$="Sony",v="Xiaomi",P="Zebra",U="Facebook",re="Chromium OS",Me="Mac OS",vt=" Browser",sn=function($t){for(var an={},wt=0;wt<$t.length;wt++)an[$t[wt].toUpperCase()]=$t[wt];return an},vi=function($t,an){return typeof $t===d&&Qi(an).indexOf(Qi($t))!==-1},Qi=function($t){return $t.toLowerCase()},gh=function($t,an){if(typeof $t===d)return $t=$t.replace(/^\s\s*/,""),typeof an===s?$t:$t.substring(0,500)},Oc=function($t,an){for(var wt,br,Co,zt,Is,Je,Io=0;Io<an.length&&!Is;){var Nc=an[Io],ts=an[Io+1];for(wt=br=0;wt<Nc.length&&!Is&&Nc[wt];)if(Is=Nc[wt++].exec($t))for(Co=0;Co<ts.length;Co++)Je=Is[++br],typeof(zt=ts[Co])===a&&zt.length>0?zt.length===2?typeof zt[1]==i?this[zt[0]]=zt[1].call(this,Je):this[zt[0]]=zt[1]:zt.length===3?typeof zt[1]!==i||zt[1].exec&&zt[1].test?this[zt[0]]=Je?Je.replace(zt[1],zt[2]):r:this[zt[0]]=Je?zt[1].call(this,Je,zt[2]):r:zt.length===4&&(this[zt[0]]=Je?zt[3].call(this,Je.replace(zt[1],zt[2])):r):this[zt]=Je||r;Io+=2}},ul=function($t,an){for(var wt in an)if(typeof an[wt]===a&&an[wt].length>0){for(var br=0;br<an[wt].length;br++)if(vi(an[wt][br],$t))return wt==="?"?r:wt}else if(vi(an[wt],$t))return wt==="?"?r:wt;return an.hasOwnProperty("*")?an["*"]:$t},hm={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},pm={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[E,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[E,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,E],[/opios[\/ ]+([\w\.]+)/i],[E,[p,Q+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[E,[p,Q+" GX"]],[/\bopr\/([\w\.]+)/i],[E,[p,Q]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[E,[p,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[E,[p,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,E],[/quark(?:pc)?\/([-\w\.]+)/i],[E,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[E,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[E,[p,"UC"+Z]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[E,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[E,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[E,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[E,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[E,[p,"Smart Lenovo "+Z]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+Z],E],[/\bfocus\/([\w\.]+)/i],[E,[p,Fe+" Focus"]],[/\bopt\/([\w\.]+)/i],[E,[p,Q+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[E,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[E,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[E,[p,Q+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[E,[p,"MIUI"+vt]],[/fxios\/([\w\.-]+)/i],[E,[p,Fe]],[/\bqihoobrowser\/?([\w\.]*)/i],[E,[p,"360"]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],E],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+vt],E],[/samsungbrowser\/([\w\.]+)/i],[E,[p,ie+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[E,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],E],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[p,E],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[E,p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,U],E],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,E],[/\bgsa\/([\w\.]+) .*safari\//i],[E,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[E,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[E,[p,te+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,te+" WebView"],E],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[E,[p,"Android "+Z]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,E],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[E,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[E,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[E,ul,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,E],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],E],[/(wolvic|librewolf)\/([\w\.]+)/i],[p,E],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[E,[p,Fe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,[E,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[E,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[C,"amd64"]],[/(ia32(?=;))/i],[[C,Qi]],[/((?:i[346]|x)86)[;\)]/i],[[C,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/windows (ce|mobile); ppc;/i],[[C,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[C,/ower/,"",Qi]],[/(sun4\w)[;\)]/i],[[C,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[C,Qi]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[m,ie],[_,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[u,[m,ie],[_,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[m,k],[_,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[m,k],[_,b]],[/(macintosh);/i],[u,[m,k]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[m,fe],[_,y]],[/(?:honor)([-\w ]+)[;\)]/i],[u,[m,"Honor"],[_,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[m,Oe],[_,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[m,Oe],[_,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[u,/_/g," "],[m,v],[_,y]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[m,v],[_,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[m,"OPPO"],[_,y]],[/\b(opd2\d{3}a?) bui/i],[u,[m,"OPPO"],[_,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[m,"Vivo"],[_,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[m,"Realme"],[_,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[m,Gn],[_,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[m,Gn],[_,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[m,it],[_,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[m,it],[_,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[m,"Lenovo"],[_,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[m,"Nokia"],[_,y]],[/(pixel c)\b/i],[u,[m,Ge],[_,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[m,Ge],[_,y]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[m,$],[_,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[m,$],[_,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[m,"OnePlus"],[_,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[m,x],[_,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[m,x],[_,y]],[/(playbook);[-\w\),; ]+(rim)/i],[u,m,[_,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[m,q],[_,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[m,B],[_,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[m,B],[_,y]],[/(nexus 9)/i],[u,[m,"HTC"],[_,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[u,/_/g," "],[_,y]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[u,[m,"TCL"],[_,b]],[/(itel) ((\w+))/i],[[m,Qi],u,[_,ul,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[m,"Acer"],[_,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[m,"Meizu"],[_,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[m,"Ulefone"],[_,y]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[u,[m,"Energizer"],[_,y]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[u,[m,"Cat"],[_,y]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[u,[m,"Smartfren"],[_,y]],[/droid.+; (a(?:015|06[35]|142p?))/i],[u,[m,"Nothing"],[_,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,u,[_,y]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,u,[_,b]],[/(surface duo)/i],[u,[m,nt],[_,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[m,"Fairphone"],[_,y]],[/(u304aa)/i],[u,[m,"AT&T"],[_,y]],[/\bsie-(\w*)/i],[u,[m,"Siemens"],[_,y]],[/\b(rct\w+) b/i],[u,[m,"RCA"],[_,b]],[/\b(venue[\d ]{2,7}) b/i],[u,[m,"Dell"],[_,b]],[/\b(q(?:mv|ta)\w+) b/i],[u,[m,"Verizon"],[_,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[m,"Barnes & Noble"],[_,b]],[/\b(tm\d{3}\w+) b/i],[u,[m,"NuVision"],[_,b]],[/\b(k88) b/i],[u,[m,"ZTE"],[_,b]],[/\b(nx\d{3}j) b/i],[u,[m,"ZTE"],[_,y]],[/\b(gen\d{3}) b.+49h/i],[u,[m,"Swiss"],[_,y]],[/\b(zur\d{3}) b/i],[u,[m,"Swiss"],[_,b]],[/\b((zeki)?tb.*\b) b/i],[u,[m,"Zeki"],[_,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],u,[_,b]],[/\b(ns-?\w{0,9}) b/i],[u,[m,"Insignia"],[_,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[m,"NextBook"],[_,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],u,[_,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],u,[_,y]],[/\b(ph-1) /i],[u,[m,"Essential"],[_,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[m,"Envizen"],[_,b]],[/\b(trio[-\w\. ]+) b/i],[u,[m,"MachSpeed"],[_,b]],[/\btu_(1491) b/i],[u,[m,"Rotor"],[_,b]],[/(shield[\w ]+) b/i],[u,[m,"Nvidia"],[_,b]],[/(sprint) (\w+)/i],[m,u,[_,y]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[m,nt],[_,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[m,P],[_,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[m,P],[_,y]],[/smart-tv.+(samsung)/i],[m,[_,A]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[m,ie],[_,A]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,it],[_,A]],[/(apple) ?tv/i],[m,[u,k+" TV"],[_,A]],[/crkey/i],[[u,te+"cast"],[m,Ge],[_,A]],[/droid.+aft(\w+)( bui|\))/i],[u,[m,x],[_,A]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[m,fe],[_,A]],[/(bravia[\w ]+)( bui|\))/i],[u,[m,$],[_,A]],[/(mitv-\w{5}) bui/i],[u,[m,v],[_,A]],[/Hbbtv.*(technisat) (.*);/i],[m,u,[_,A]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,gh],[u,gh],[_,A]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,A]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,u,[_,R]],[/droid.+; (shield) bui/i],[u,[m,"Nvidia"],[_,R]],[/(playstation [345portablevi]+)/i],[u,[m,$],[_,R]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[m,nt],[_,R]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[u,[m,ie],[_,D]],[/((pebble))app/i],[m,u,[_,D]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[m,k],[_,D]],[/droid.+; (glass) \d/i],[u,[m,Ge],[_,D]],[/droid.+; (wt63?0{2,3})\)/i],[u,[m,P],[_,D]],[/droid.+; (glass) \d/i],[u,[m,Ge],[_,D]],[/(pico) (4|neo3(?: link|pro)?)/i],[m,u,[_,D]],[/; (quest( \d| pro)?)/i],[u,[m,U],[_,D]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[_,V]],[/(aeobc)\b/i],[u,[m,x],[_,V]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[_,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[_,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,y]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[E,[p,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[p,E],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[E,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,E],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[E,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,E],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[E,ul,hm]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,ul,hm],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[E,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Me],[E,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[E,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,E],[/\(bb(10);/i],[E,[p,q]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[E,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[E,[p,Fe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[E,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[E,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[E,[p,te+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,re],E],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,E],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],E],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,E]]},Ri=function($t,an){if(typeof $t===a&&(an=$t,$t=r),!(this instanceof Ri))return new Ri($t,an).getResult();var wt=typeof n!==s&&n.navigator?n.navigator:r,br=$t||(wt&&wt.userAgent?wt.userAgent:""),Co=wt&&wt.userAgentData?wt.userAgentData:r,zt=an?function(Je,Io){var Nc={};for(var ts in Je)Io[ts]&&Io[ts].length%2==0?Nc[ts]=Io[ts].concat(Je[ts]):Nc[ts]=Je[ts];return Nc}(pm,an):pm,Is=wt&&wt.userAgent==br;return this.getBrowser=function(){var Je={};return Je[p]=r,Je[E]=r,Oc.call(Je,br,zt.browser),Je[l]=function(Io){return typeof Io===d?Io.replace(/[^\d\.]/g,"").split(".")[0]:r}(Je[E]),Is&&wt&&wt.brave&&typeof wt.brave.isBrave==i&&(Je[p]="Brave"),Je},this.getCPU=function(){var Je={};return Je[C]=r,Oc.call(Je,br,zt.cpu),Je},this.getDevice=function(){var Je={};return Je[m]=r,Je[u]=r,Je[_]=r,Oc.call(Je,br,zt.device),Is&&!Je[_]&&Co&&Co.mobile&&(Je[_]=y),Is&&Je[u]=="Macintosh"&&wt&&typeof wt.standalone!==s&&wt.maxTouchPoints&&wt.maxTouchPoints>2&&(Je[u]="iPad",Je[_]=b),Je},this.getEngine=function(){var Je={};return Je[p]=r,Je[E]=r,Oc.call(Je,br,zt.engine),Je},this.getOS=function(){var Je={};return Je[p]=r,Je[E]=r,Oc.call(Je,br,zt.os),Is&&!Je[p]&&Co&&Co.platform&&Co.platform!="Unknown"&&(Je[p]=Co.platform.replace(/chrome os/i,re).replace(/macos/i,Me)),Je},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return br},this.setUA=function(Je){return br=typeof Je===d&&Je.length>500?gh(Je,500):Je,this},this.setUA(br),this};Ri.VERSION="0.7.40",Ri.BROWSER=sn([p,E,l]),Ri.CPU=sn([C]),Ri.DEVICE=sn([u,m,_,R,y,A,b,D,V]),Ri.ENGINE=Ri.OS=sn([p,E]),e.exports&&(t=e.exports=Ri),t.UAParser=Ri;var Cs=typeof n!==s&&(n.jQuery||n.Zepto);if(Cs&&!Cs.ua){var fm=new Ri;Cs.ua=fm.getResult(),Cs.ua.get=function(){return fm.getUA()},Cs.ua.set=function($t){fm.setUA($t);var an=fm.getResult();for(var wt in an)Cs.ua[wt]=an[wt]}}})(typeof window=="object"?window:f)})($S,$S.exports);var FK=g($S.exports),iO=jp.clear;lt({global:!0,bind:!0,enumerable:!0,forced:se.clearImmediate!==iO},{clearImmediate:iO});var oO=se,BK=K,jK=ct,GK=sg,WK=ds,HK=zs,KK=Xa,zK=oO.Function,YK=/MSIE .\./.test(WK)||GK==="BUN"&&function(){var e=oO.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),qK=lt,sO=se,aO=jp.set,XK=function(e,t){var n=t?2:1;return YK?function(r,i){var s=KK(arguments.length,1)>n,a=jK(r)?r:zK(r),d=s?HK(arguments,n):[],l=s?function(){BK(a,this,d)}:a;return t?e(l,i):e(l)}:e},cO=sO.setImmediate?XK(aO,!1):aO;qK({global:!0,bind:!0,enumerable:!0,forced:sO.setImmediate!==cO},{setImmediate:cO});var dO=g(di.setImmediate),JK=se,QK=Tw,ZK=Wr,$K=Xa,ez=en;lt({global:!0,enumerable:!0,dontCallGetSet:!0,forced:S(function(){return ez&&Object.getOwnPropertyDescriptor(JK,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){$K(arguments.length,1),QK(ZK(e))}});var lO=g(di.queueMicrotask);function uO(e,t){return function(){return e.apply(t,arguments)}}const{toString:tz}=Object.prototype,{getPrototypeOf:eT}=Object,{iterator:mf,toStringTag:hO}=Symbol,Ef=(tT=Object.create(null),e=>{const t=tz.call(e);return tT[t]||(tT[t]=t.slice(8,-1).toLowerCase())});var tT;const co=e=>(e=e.toLowerCase(),t=>Ef(t)===e),gf=e=>t=>typeof t===e,{isArray:Ed}=Array,fu=gf("undefined"),pO=co("ArrayBuffer"),nz=gf("string"),Kr=gf("function"),fO=gf("number"),Sf=e=>e!==null&&typeof e=="object",Tf=e=>{if(Ef(e)!=="object")return!1;const t=eT(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||hO in e||mf in e)},rz=co("Date"),iz=co("File"),oz=co("Blob"),sz=co("FileList"),az=co("URLSearchParams"),[cz,dz,lz,uz]=["ReadableStream","Request","Response","Headers"].map(co);function _u(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ed(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),a=s.length;let d;for(n=0;n<a;n++)d=s[n],t.call(null,e[d],d,e)}}function _O(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const nc=rO!==void 0?rO:typeof self<"u"?self:typeof window<"u"?window:_m,mO=e=>!fu(e)&&e!==nc,hz=(nT=typeof Uint8Array<"u"&&eT(Uint8Array),e=>nT&&e instanceof nT);var nT;const pz=co("HTMLFormElement"),EO=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),fz=co("RegExp"),gO=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};_u(n,(i,s)=>{let a;(a=t(i,s,e))!==!1&&(r[s]=a||i)}),Object.defineProperties(e,r)},_z=co("AsyncFunction"),SO=(TO=typeof dO=="function",vO=Kr(nc.postMessage),TO?dO:vO?(rT="axios@".concat(Math.random()),vf=[],nc.addEventListener("message",e=>{let{source:t,data:n}=e;t===nc&&n===rT&&vf.length&&vf.shift()()},!1),e=>{vf.push(e),nc.postMessage(rT,"*")}):e=>setTimeout(e));var TO,vO,rT,vf;const mz=lO!==void 0?lO.bind(nc):typeof process<"u"&&process.nextTick||SO;var ae={isArray:Ed,isArrayBuffer:pO,isBuffer:function(e){return e!==null&&!fu(e)&&e.constructor!==null&&!fu(e.constructor)&&Kr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Kr(e.append)&&((t=Ef(e))==="formdata"||t==="object"&&Kr(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&pO(e.buffer),t},isString:nz,isNumber:fO,isBoolean:e=>e===!0||e===!1,isObject:Sf,isPlainObject:Tf,isReadableStream:cz,isRequest:dz,isResponse:lz,isHeaders:uz,isUndefined:fu,isDate:rz,isFile:iz,isBlob:oz,isRegExp:fz,isFunction:Kr,isStream:e=>Sf(e)&&Kr(e.pipe),isURLSearchParams:az,isTypedArray:hz,isFileList:sz,forEach:_u,merge:function e(){const{caseless:t}=mO(this)&&this||{},n={},r=(i,s)=>{const a=t&&_O(n,s)||s;Tf(n[a])&&Tf(i)?n[a]=e(n[a],i):Tf(i)?n[a]=e({},i):Ed(i)?n[a]=i.slice():n[a]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&_u(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return _u(t,(i,s)=>{n&&Kr(i)?e[s]=uO(i,n):e[s]=i},{allOwnKeys:r}),e},trim:e=>Qn(e)?Qn(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,a;const d={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],r&&!r(a,e,t)||d[a]||(t[a]=e[a],d[a]=!0);e=n!==!1&&eT(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Ef,kindOfTest:co,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(Ed(e))return e;let t=e.length;if(!fO(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[mf]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:pz,hasOwnProperty:EO,hasOwnProp:EO,reduceDescriptors:gO,freezeMethods:e=>{gO(e,(t,n)=>{if(Kr(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];Kr(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach(s=>{n[s]=!0})};return Ed(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:_O,global:nc,isContextDefined:mO,isSpecCompliantForm:function(e){return!!(e&&Kr(e.append)&&e[hO]==="FormData"&&e[mf])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(Sf(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const s=Ed(r)?[]:{};return _u(r,(a,d)=>{const l=n(a,i+1);!fu(l)&&(s[d]=l)}),t[i]=void 0,s}}return r};return n(e,0)},isAsyncFn:_z,isThenable:e=>e&&(Sf(e)||Kr(e))&&Kr(e.then)&&Kr(e.catch),setImmediate:SO,asap:mz,isIterable:e=>e!=null&&Kr(e[mf])};function ft(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}ae.inherits(ft,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ae.toJSONObject(this.config),code:this.code,status:this.status}}});const RO=ft.prototype,yO={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{yO[e]={value:e}}),Object.defineProperties(ft,yO),Object.defineProperty(RO,"isAxiosError",{value:!0}),ft.from=(e,t,n,r,i,s)=>{const a=Object.create(RO);return ae.toFlatObject(e,a,function(d){return d!==Error.prototype},d=>d!=="isAxiosError"),ft.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};function iT(e){return ae.isPlainObject(e)||ae.isArray(e)}function CO(e){return ae.endsWith(e,"[]")?e.slice(0,-2):e}function IO(e,t,n){return e?e.concat(t).map(function(r,i){return r=CO(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}const Ez=ae.toFlatObject(ae,{},null,function(e){return/^is[A-Z]/.test(e)});function Rf(e,t,n){if(!ae.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=ae.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,E){return!ae.isUndefined(E[m])})).metaTokens,i=n.visitor||u,s=n.dots,a=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&ae.isSpecCompliantForm(t);if(!ae.isFunction(i))throw new TypeError("visitor must be a function");function l(m){if(m===null)return"";if(ae.isDate(m))return m.toISOString();if(!d&&ae.isBlob(m))throw new ft("Blob is not supported. Use a Buffer instead.");return ae.isArrayBuffer(m)||ae.isTypedArray(m)?d&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,E,C){let R=m;if(m&&!C&&typeof m=="object"){if(ae.endsWith(E,"{}"))E=r?E:E.slice(0,-2),m=JSON.stringify(m);else if(ae.isArray(m)&&function(y){return ae.isArray(y)&&!y.some(iT)}(m)||(ae.isFileList(m)||ae.endsWith(E,"[]"))&&(R=ae.toArray(m)))return E=CO(E),R.forEach(function(y,b){!ae.isUndefined(y)&&y!==null&&t.append(a===!0?IO([E],b,s):a===null?E:E+"[]",l(y))}),!1}return!!iT(m)||(t.append(IO(C,E,s),l(m)),!1)}const p=[],_=Object.assign(Ez,{defaultVisitor:u,convertValue:l,isVisitable:iT});if(!ae.isObject(e))throw new TypeError("data must be an object");return function m(E,C){if(!ae.isUndefined(E)){if(p.indexOf(E)!==-1)throw Error("Circular reference detected in "+C.join("."));p.push(E),ae.forEach(E,function(R,y){(!(ae.isUndefined(R)||R===null)&&i.call(t,R,ae.isString(y)?Qn(y).call(y):y,C,_))===!0&&m(R,C?C.concat(y):[y])}),p.pop()}}(e),t}function wO(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function oT(e,t){this._pairs=[],e&&Rf(e,this,t)}const AO=oT.prototype;function gz(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bO(e,t,n){if(!t)return e;const r=n&&n.encode||gz;ae.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):ae.isURLSearchParams(t)?t.toString():new oT(t,n).toString(r),s){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}AO.append=function(e,t){this._pairs.push([e,t])},AO.toString=function(e){const t=e?function(n){return e.call(this,n,wO)}:wO;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var OO=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ae.forEach(this.handlers,function(t){t!==null&&e(t)})}},NO={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},DO={exports:{}},Sz=lt,Tz=en,PO=Oi.f;Sz({target:"Object",stat:!0,forced:Object.defineProperty!==PO,sham:!Tz},{defineProperty:PO});var kO=di.Object,vz=DO.exports=function(e,t,n){return kO.defineProperty(e,t,n)};kO.defineProperty.sham&&(vz.sham=!0);var LO=g(DO.exports),Rz=TypeError,MO=Xl,yz=Bp,Cz=ur,Iz=nn("species"),UO=Array,wz=function(e){var t;return MO(e)&&(t=e.constructor,(yz(t)&&(t===UO||MO(t.prototype))||Cz(t)&&(t=t[Iz])===null)&&(t=void 0)),t===void 0?UO:t},xO=function(e,t){return new(wz(e))(t===0?0:t)},Az=S,bz=Ka,Oz=nn("species"),VO=function(e){return bz>=51||!Az(function(){var t=[];return(t.constructor={})[Oz]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Nz=lt,Dz=S,Pz=Xl,kz=ur,Lz=Lo,Mz=Ws,FO=function(e){if(e>9007199254740991)throw Rz("Maximum allowed index exceeded");return e},BO=TS,Uz=xO,xz=VO,Vz=Ka,jO=nn("isConcatSpreadable"),Fz=Vz>=51||!Dz(function(){var e=[];return e[jO]=!1,e.concat()[0]!==e}),Bz=function(e){if(!kz(e))return!1;var t=e[jO];return t!==void 0?!!t:Pz(e)};Nz({target:"Array",proto:!0,arity:1,forced:!Fz||!xz("concat")},{concat:function(e){var t,n,r,i,s,a=Lz(this),d=Uz(a,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(Bz(s=t===-1?a:arguments[t]))for(i=Mz(s),FO(l+i),n=0;n<i;n++,l++)n in s&&BO(d,l,s[n]);else FO(l+1),BO(d,l++,s);return d.length=l,d}});var GO={},jz=be,Gz=js,WO=Cp.f,Wz=zs,HO=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];GO.f=function(e){return HO&&jz(e)==="Window"?function(t){try{return WO(t)}catch{return Wz(HO)}}(e):WO(Gz(e))};var gd={},Hz=nn;gd.f=Hz;var KO=di,Kz=Kn,zz=gd,Yz=Oi.f,vn=function(e){var t=KO.Symbol||(KO.Symbol={});Kz(t,e)||Yz(t,e,{value:zz.f(e)})},qz=un,Xz=hr,Jz=nn,Qz=Ks,zO=function(){var e=Xz("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=Jz("toPrimitive");t&&!t[r]&&Qz(t,r,function(i){return qz(n,this)},{arity:1})},Zz=Gs,$z=_p,eY=Lo,tY=Ws,nY=xO,YO=H([].push),Zs=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,s=e===6,a=e===7,d=e===5||s;return function(l,u,p,_){for(var m,E,C=eY(l),R=$z(C),y=tY(R),b=Zz(u,p),A=0,D=_||nY,V=t?D(l,y):n||a?D(l,0):void 0;y>A;A++)if((d||A in R)&&(E=b(m=R[A],A,C),e))if(t)V[A]=E;else if(E)switch(e){case 3:return!0;case 5:return m;case 6:return A;case 2:YO(V,m)}else switch(e){case 4:return!1;case 7:YO(V,m)}return s?-1:r||i?i:V}},qO={forEach:Zs(0),map:Zs(1),filter:Zs(2),some:Zs(3),every:Zs(4),find:Zs(5),findIndex:Zs(6),filterReject:Zs(7)},yf=lt,mu=se,sT=un,rY=H,Sd=en,Td=zc,iY=S,rr=Kn,oY=J,aT=kr,Cf=js,cT=YE,sY=Hr,dT=vr,vd=Ql,XO=wp,aY=Cp,JO=GO,cY=Jl,QO=Hn,ZO=Oi,dY=pg,$O=xe,eN=Ks,lY=Fp,lT=qc,tN=Ip,nN=KE,uY=nn,hY=gd,pY=vn,fY=zO,_Y=ls,rN=qa,If=qO.forEach,zr=yp("hidden"),wf="Symbol",Eu="prototype",mY=rN.set,iN=rN.getterFor(wf),lo=Object[Eu],rc=mu.Symbol,Af=rc&&rc[Eu],EY=mu.RangeError,gY=mu.TypeError,uT=mu.QObject,oN=QO.f,ic=ZO.f,sN=JO.f,SY=$O.f,aN=rY([].push),ps=lT("symbols"),gu=lT("op-symbols"),TY=lT("wks"),hT=!uT||!uT[Eu]||!uT[Eu].findChild,cN=function(e,t,n){var r=oN(lo,t);r&&delete lo[t],ic(e,t,n),r&&e!==lo&&ic(lo,t,r)},pT=Sd&&iY(function(){return vd(ic({},"a",{get:function(){return ic(this,"a",{value:7}).a}})).a!==7})?cN:ic,fT=function(e,t){var n=ps[e]=vd(Af);return mY(n,{type:wf,tag:e,description:t}),Sd||(n.description=t),n},bf=function(e,t,n){e===lo&&bf(gu,t,n),aT(e);var r=cT(t);return aT(n),rr(ps,r)?(n.enumerable?(rr(e,zr)&&e[zr][r]&&(e[zr][r]=!1),n=vd(n,{enumerable:dT(0,!1)})):(rr(e,zr)||ic(e,zr,dT(1,vd(null))),e[zr][r]=!0),pT(e,r,n)):ic(e,r,n)},_T=function(e,t){aT(e);var n=Cf(t),r=XO(n).concat(hN(n));return If(r,function(i){Sd&&!sT(dN,n,i)||bf(e,i,n[i])}),e},dN=function(e){var t=cT(e),n=sT(SY,this,t);return!(this===lo&&rr(ps,t)&&!rr(gu,t))&&(!(n||!rr(this,t)||!rr(ps,t)||rr(this,zr)&&this[zr][t])||n)},lN=function(e,t){var n=Cf(e),r=cT(t);if(n!==lo||!rr(ps,r)||rr(gu,r)){var i=oN(n,r);return!i||!rr(ps,r)||rr(n,zr)&&n[zr][r]||(i.enumerable=!0),i}},uN=function(e){var t=sN(Cf(e)),n=[];return If(t,function(r){rr(ps,r)||rr(tN,r)||aN(n,r)}),n},hN=function(e){var t=e===lo,n=sN(t?gu:Cf(e)),r=[];return If(n,function(i){!rr(ps,i)||t&&!rr(lo,i)||aN(r,ps[i])}),r};Td||(rc=function(){if(oY(Af,this))throw new gY("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?sY(arguments[0]):void 0,t=nN(e),n=function(r){var i=this===void 0?mu:this;i===lo&&sT(n,gu,r),rr(i,zr)&&rr(i[zr],t)&&(i[zr][t]=!1);var s=dT(1,r);try{pT(i,t,s)}catch(a){if(!(a instanceof EY))throw a;cN(i,t,s)}};return Sd&&hT&&pT(lo,t,{configurable:!0,set:n}),fT(t,e)},eN(Af=rc[Eu],"toString",function(){return iN(this).tag}),eN(rc,"withoutSetter",function(e){return fT(nN(e),e)}),$O.f=dN,ZO.f=bf,dY.f=_T,QO.f=lN,aY.f=JO.f=uN,cY.f=hN,hY.f=function(e){return fT(uY(e),e)},Sd&&lY(Af,"description",{configurable:!0,get:function(){return iN(this).description}})),yf({global:!0,constructor:!0,wrap:!0,forced:!Td,sham:!Td},{Symbol:rc}),If(XO(TY),function(e){pY(e)}),yf({target:wf,stat:!0,forced:!Td},{useSetter:function(){hT=!0},useSimple:function(){hT=!1}}),yf({target:"Object",stat:!0,forced:!Td,sham:!Sd},{create:function(e,t){return t===void 0?vd(e):_T(vd(e),t)},defineProperty:bf,defineProperties:_T,getOwnPropertyDescriptor:lN}),yf({target:"Object",stat:!0,forced:!Td},{getOwnPropertyNames:uN}),fY(),_Y(rc,wf),tN[zr]=!0;var pN=zc&&!!Symbol.for&&!!Symbol.keyFor,vY=lt,RY=hr,yY=Kn,CY=Hr,fN=qc,IY=pN,mT=fN("string-to-symbol-registry"),wY=fN("symbol-to-string-registry");vY({target:"Symbol",stat:!0,forced:!IY},{for:function(e){var t=CY(e);if(yY(mT,t))return mT[t];var n=RY("Symbol")(t);return mT[t]=n,wY[n]=t,n}});var AY=lt,bY=Kn,OY=Kl,NY=Yc,DY=pN,_N=qc("symbol-to-string-registry");AY({target:"Symbol",stat:!0,forced:!DY},{keyFor:function(e){if(!OY(e))throw new TypeError(NY(e)+" is not a symbol");if(bY(_N,e))return _N[e]}});var mN=Xl,PY=ct,EN=be,kY=Hr,gN=H([].push),LY=lt,SN=hr,TN=K,MY=un,Su=H,vN=S,RN=ct,yN=Kl,CN=zs,UY=function(e){if(PY(e))return e;if(mN(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?gN(n,i):typeof i!="number"&&EN(i)!=="Number"&&EN(i)!=="String"||gN(n,kY(i))}var s=n.length,a=!0;return function(d,l){if(a)return a=!1,l;if(mN(this))return l;for(var u=0;u<s;u++)if(n[u]===d)return l}}},xY=zc,VY=String,$s=SN("JSON","stringify"),Of=Su(/./.exec),IN=Su("".charAt),FY=Su("".charCodeAt),BY=Su("".replace),jY=Su(1 .toString),GY=/[\uD800-\uDFFF]/g,wN=/^[\uD800-\uDBFF]$/,AN=/^[\uDC00-\uDFFF]$/,bN=!xY||vN(function(){var e=SN("Symbol")("stringify detection");return $s([e])!=="[null]"||$s({a:e})!=="{}"||$s(Object(e))!=="{}"}),ON=vN(function(){return $s("\uDF06\uD834")!=='"\\udf06\\ud834"'||$s("\uDEAD")!=='"\\udead"'}),WY=function(e,t){var n=CN(arguments),r=UY(t);if(RN(r)||e!==void 0&&!yN(e))return n[1]=function(i,s){if(RN(r)&&(s=MY(r,this,VY(i),s)),!yN(s))return s},TN($s,null,n)},HY=function(e,t,n){var r=IN(n,t-1),i=IN(n,t+1);return Of(wN,e)&&!Of(AN,i)||Of(AN,e)&&!Of(wN,r)?"\\u"+jY(FY(e,0),16):e};$s&&LY({target:"JSON",stat:!0,arity:3,forced:bN||ON},{stringify:function(e,t,n){var r=CN(arguments),i=TN(bN?WY:$s,null,r);return ON&&typeof i=="string"?BY(i,GY,HY):i}});var NN=Jl,KY=Lo;lt({target:"Object",stat:!0,forced:!zc||S(function(){NN.f(1)})},{getOwnPropertySymbols:function(e){var t=NN.f;return t?t(KY(e)):[]}}),vn("asyncIterator"),vn("hasInstance"),vn("isConcatSpreadable"),vn("iterator"),vn("match"),vn("matchAll"),vn("replace"),vn("search"),vn("species"),vn("split");var zY=zO;vn("toPrimitive"),zY();var YY=hr,qY=ls;vn("toStringTag"),qY(YY("Symbol"),"Symbol"),vn("unscopables"),ls(se.JSON,"JSON",!0);var XY=di.Symbol,JY=nn,QY=Oi.f,DN=JY("metadata"),PN=Function.prototype;PN[DN]===void 0&&QY(PN,DN,{value:null}),vn("asyncDispose"),vn("dispose"),vn("metadata");var ZY=XY,$Y=H,ET=hr("Symbol"),e9=ET.keyFor,t9=$Y(ET.prototype.valueOf),kN=ET.isRegisteredSymbol||function(e){try{return e9(t9(e))!==void 0}catch{return!1}};lt({target:"Symbol",stat:!0},{isRegisteredSymbol:kN});for(var n9=qc,LN=hr,r9=H,i9=Kl,o9=nn,Nf=LN("Symbol"),MN=Nf.isWellKnownSymbol,UN=LN("Object","getOwnPropertyNames"),s9=r9(Nf.prototype.valueOf),xN=n9("wks"),gT=0,VN=UN(Nf),a9=VN.length;gT<a9;gT++)try{var FN=VN[gT];i9(Nf[FN])&&o9(FN)}catch{}var BN=function(e){if(MN&&MN(e))return!0;try{for(var t=s9(e),n=0,r=UN(xN),i=r.length;n<i;n++)if(xN[r[n]]==t)return!0}catch{}return!1};lt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:BN}),vn("customMatcher"),vn("observable"),lt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:kN}),lt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:BN}),vn("matcher"),vn("metadataKey"),vn("patternMatch"),vn("replaceAll");var Rd=g(ZY),jN=g(gd.f("iterator"));function Tu(e){return Tu=typeof Rd=="function"&&typeof jN=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Rd=="function"&&t.constructor===Rd&&t!==Rd.prototype?"symbol":typeof t},Tu(e)}var c9=g(gd.f("toPrimitive"));function d9(e){var t=function(n,r){if(Tu(n)!="object"||!n)return n;var i=n[c9];if(i!==void 0){var s=i.call(n,r||"default");if(Tu(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return Tu(t)=="symbol"?t:t+""}function w(e,t,n){return(t=d9(t))in e?LO(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var GN=g(u8),l9={isBrowser:!0,classes:{URLSearchParams:GN!==void 0?GN:oT,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const ST=typeof window<"u"&&typeof document<"u",TT=typeof navigator=="object"&&navigator||void 0,u9=ST&&(!TT||["ReactNative","NativeScript","NS"].indexOf(TT.product)<0),h9=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",p9=ST&&window.location.href||"http://localhost";function WN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function HN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WN(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WN(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Rr=HN(HN({},Object.freeze({__proto__:null,hasBrowserEnv:ST,hasStandardBrowserEnv:u9,hasStandardBrowserWebWorkerEnv:h9,navigator:TT,origin:p9})),l9),f9=kr,_9=un,m9=Kn,E9=J,g9=function(){var e=f9(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},KN=RegExp.prototype,zN=function(e){var t=e.flags;return t!==void 0||"flags"in KN||m9(e,"flags")||!E9(KN,e)?t:_9(g9,e)},S9=sS.charAt,YN=un,T9=kr,v9=ct,R9=be,y9=/./.exec,C9=TypeError,I9=lt,qN=un,XN=ge,w9=Ag,Df=xp,JN=Ha,QN=X0,vu=Hr,A9=kr,b9=ur,O9=be,N9=Q0,ZN=zN,D9=Ep,P9=S,k9=kg,L9=function(e,t,n){return t+(n?S9(e,t).length:1)},M9=function(e,t){var n=e.exec;if(v9(n)){var r=YN(n,e,t);return r!==null&&T9(r),r}if(R9(e)==="RegExp")return YN(y9,e,t);throw new C9("RegExp#exec called on incompatible receiver")},$N=qa,U9=nn("matchAll"),eD="RegExp String",tD=eD+" Iterator",x9=$N.set,V9=$N.getterFor(tD),F9=TypeError,vT=XN("".indexOf),Pf=XN("".matchAll),RT=!!Pf&&!P9(function(){Pf("a",/./)}),B9=w9(function(e,t,n,r){x9(this,{type:tD,regexp:e,string:t,global:n,unicode:r,done:!1})},eD,function(){var e=V9(this);if(e.done)return Df(void 0,!0);var t=e.regexp,n=e.string,r=M9(t,n);return r===null?(e.done=!0,Df(void 0,!0)):e.global?(vu(r[0])===""&&(t.lastIndex=L9(n,QN(t.lastIndex),e.unicode)),Df(r,!1)):(e.done=!0,Df(r,!1))}),nD=function(e){var t,n,r,i=A9(this),s=vu(e),a=k9(i,RegExp),d=vu(ZN(i));return t=new a(a===RegExp?i.source:i,d),n=!!~vT(d,"g"),r=!!~vT(d,"u"),t.lastIndex=QN(i.lastIndex),new B9(t,s,n,r)};I9({target:"String",proto:!0,forced:RT},{matchAll:function(e){var t,n,r,i,s=JN(this);if(b9(e)){if(N9(e)&&(t=vu(JN(ZN(e))),!~vT(t,"g")))throw new F9("`.matchAll` does not allow non-global regexes");if(RT)return Pf(s,e);if((r=D9(e,U9))===void 0&&O9(e)==="RegExp"&&(r=nD),r)return qN(r,e,s)}else if(RT)return Pf(s,e);return n=vu(s),i=new RegExp(e,"g"),qN(nD,i,n)}});var j9=Ni("String","matchAll"),G9=J,W9=j9,yT=String.prototype,H9=function(e){var t=e.matchAll;return typeof e=="string"||e===yT||G9(yT,e)&&t===yT.matchAll?W9:t},K9=g(H9);function rD(e){function t(n,r,i,s){let a=n[s++];if(a==="__proto__")return!0;const d=Number.isFinite(+a),l=s>=n.length;return a=!a&&ae.isArray(i)?i.length:a,l?(ae.hasOwnProp(i,a)?i[a]=[i[a],r]:i[a]=r,!d):(i[a]&&ae.isObject(i[a])||(i[a]=[]),t(n,r,i[a],s)&&ae.isArray(i[a])&&(i[a]=function(u){const p={},_=Object.keys(u);let m;const E=_.length;let C;for(m=0;m<E;m++)C=_[m],p[C]=u[C];return p}(i[a])),!d)}if(ae.isFormData(e)&&ae.isFunction(e.entries)){const n={};return ae.forEachEntry(e,(r,i)=>{t(function(s){return K9(ae).call(ae,/\w+|\[(\w*)]/g,s).map(a=>a[0]==="[]"?"":a[1]||a[0])}(r),i,n,0)}),n}return null}const CT={transitional:NO,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=ae.isObject(e);if(i&&ae.isHTMLForm(e)&&(e=new FormData(e)),ae.isFormData(e))return r?JSON.stringify(rD(e)):e;if(ae.isArrayBuffer(e)||ae.isBuffer(e)||ae.isStream(e)||ae.isFile(e)||ae.isBlob(e)||ae.isReadableStream(e))return e;if(ae.isArrayBufferView(e))return e.buffer;if(ae.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(a,d){return Rf(a,new Rr.classes.URLSearchParams,Object.assign({visitor:function(l,u,p,_){return Rr.isNode&&ae.isBuffer(l)?(this.append(u,l.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},d))}(e,this.formSerializer).toString();if((s=ae.isFileList(e))||n.indexOf("multipart/form-data")>-1){const a=this.env&&this.env.FormData;return Rf(s?{"files[]":e}:e,a&&new a,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(a,d,l){if(ae.isString(a))try{return(d||JSON.parse)(a),Qn(ae).call(ae,a)}catch(u){if(u.name!=="SyntaxError")throw u}return(l||JSON.stringify)(a)}(e)):e}],transformResponse:[function(e){const t=this.transitional||CT.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(ae.isResponse(e)||ae.isReadableStream(e))return e;if(e&&ae.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(i)throw s.name==="SyntaxError"?ft.from(s,ft.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Rr.classes.FormData,Blob:Rr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ae.forEach(["delete","get","head","post","put","patch"],e=>{CT.headers[e]={}});var IT=CT;const z9=ae.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),iD=Symbol("internals");function Ru(e){var t;return e&&Qn(t=String(e)).call(t).toLowerCase()}function kf(e){return e===!1||e==null?e:ae.isArray(e)?e.map(kf):String(e)}function wT(e,t,n,r,i){return ae.isFunction(r)?r.call(this,t,n):(i&&(t=n),ae.isString(t)?ae.isString(r)?t.indexOf(r)!==-1:ae.isRegExp(r)?r.test(t):void 0:void 0)}class Lf{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function s(l,u,p){const _=Ru(u);if(!_)throw new Error("header name must be a non-empty string");const m=ae.findKey(i,_);(!m||i[m]===void 0||p===!0||p===void 0&&i[m]!==!1)&&(i[m||u]=kf(l))}const a=(l,u)=>ae.forEach(l,(p,_)=>s(p,_,u));if(ae.isPlainObject(t)||t instanceof this.constructor)a(t,n);else if(ae.isString(t)&&(t=Qn(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Qn(d=t).call(d)))a((l=>{const u={};let p,_,m;return l&&l.split(`
`).forEach(function(E){var C,R;m=E.indexOf(":"),p=Qn(C=E.substring(0,m)).call(C).toLowerCase(),_=Qn(R=E.substring(m+1)).call(R),!p||u[p]&&z9[p]||(p==="set-cookie"?u[p]?u[p].push(_):u[p]=[_]:u[p]=u[p]?u[p]+", "+_:_)}),u})(t),n);else if(ae.isObject(t)&&ae.isIterable(t)){let l,u,p={};for(const _ of t){if(!ae.isArray(_))throw TypeError("Object iterator must return a key-value pair");p[u=_[0]]=(l=p[u])?ae.isArray(l)?[...l,_[1]]:[l,_[1]]:_[1]}a(p,n)}else t!=null&&s(n,t,r);var d;return this}get(t,n){if(t=Ru(t)){const r=ae.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(s){const a=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=d.exec(s);)a[l[1]]=l[2];return a}(i);if(ae.isFunction(n))return n.call(this,i,r);if(ae.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Ru(t)){const r=ae.findKey(this,t);return!(!r||this[r]===void 0||n&&!wT(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function s(a){if(a=Ru(a)){const d=ae.findKey(r,a);!d||n&&!wT(0,r[d],d,n)||(delete r[d],i=!0)}}return ae.isArray(t)?t.forEach(s):s(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];t&&!wT(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const n=this,r={};return ae.forEach(this,(i,s)=>{var a;const d=ae.findKey(r,s);if(d)return n[d]=kf(i),void delete n[s];const l=t?function(u){return Qn(u).call(u).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,_,m)=>_.toUpperCase()+m)}(s):Qn(a=String(s)).call(a);l!==s&&delete n[s],n[l]=kf(i),r[l]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return ae.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&ae.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach(a=>n.set(a)),n}static accessor(t){const n=(this[iD]=this[iD]={accessors:{}}).accessors,r=this.prototype;function i(s){const a=Ru(s);n[a]||(function(d,l){const u=ae.toCamelCase(" "+l);["get","set","has"].forEach(p=>{Object.defineProperty(d,p+u,{value:function(_,m,E){return this[p].call(this,l,_,m,E)},configurable:!0})})}(r,s),n[a]=!0)}return ae.isArray(t)?t.forEach(i):i(t),this}}Lf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ae.reduceDescriptors(Lf.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),ae.freezeMethods(Lf);var uo=Lf;function AT(e,t){const n=this||IT,r=t||n,i=uo.from(r.headers);let s=r.data;return ae.forEach(e,function(a){s=a.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function oD(e){return!(!e||!e.__CANCEL__)}function yd(e,t,n){ft.call(this,e??"canceled",ft.ERR_CANCELED,t,n),this.name="CanceledError"}function sD(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new ft("Request failed with status code "+n.status,[ft.ERR_BAD_REQUEST,ft.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}ae.inherits(yd,ft,{__CANCEL__:!0});const Mf=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(s,a){s=s||10;const d=new Array(s),l=new Array(s);let u,p=0,_=0;return a=a!==void 0?a:1e3,function(m){const E=Date.now(),C=l[_];u||(u=E),d[p]=m,l[p]=E;let R=_,y=0;for(;R!==p;)y+=d[R++],R%=s;if(p=(p+1)%s,p===_&&(_=(_+1)%s),E-u<a)return;const b=C&&E-C;return b?Math.round(1e3*y/b):void 0}}(50,250);return function(s,a){let d,l,u=0,p=1e3/a;const _=function(m){u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),d=null,l&&(clearTimeout(l),l=null),s.apply(null,m)};return[function(){const m=Date.now(),E=m-u;for(var C=arguments.length,R=new Array(C),y=0;y<C;y++)R[y]=arguments[y];E>=p?_(R,m):(d=R,l||(l=setTimeout(()=>{l=null,_(d)},p-E)))},()=>d&&_(d)]}(s=>{const a=s.loaded,d=s.lengthComputable?s.total:void 0,l=a-r,u=i(l);r=a,e({loaded:a,total:d,progress:d?a/d:void 0,bytes:l,rate:u||void 0,estimated:u&&d&&a<=d?(d-a)/u:void 0,event:s,lengthComputable:d!=null,[t?"download":"upload"]:!0})},n)},aD=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},cD=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ae.asap(()=>e(...n))};var Y9=Rr.hasStandardBrowserEnv?((e,t)=>n=>(n=new df(n,Rr.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new df(Rr.origin),Rr.navigator&&/(msie|trident)/i.test(Rr.navigator.userAgent)):()=>!0,q9=Rr.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const a=[e+"="+encodeURIComponent(t)];ae.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),ae.isString(r)&&a.push("path="+r),ae.isString(i)&&a.push("domain="+i),s===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function dD(e,t,n){let r=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t);return e&&(r||n==0)?function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i}(e,t):t}function lD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const uD=e=>e instanceof uo?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?lD(Object(r),!0).forEach(function(i){w(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):lD(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e):e;function oc(e,t){t=t||{};const n={};function r(u,p,_,m){return ae.isPlainObject(u)&&ae.isPlainObject(p)?ae.merge.call({caseless:m},u,p):ae.isPlainObject(p)?ae.merge({},p):ae.isArray(p)?p.slice():p}function i(u,p,_,m){return ae.isUndefined(p)?ae.isUndefined(u)?void 0:r(void 0,u,0,m):r(u,p,0,m)}function s(u,p){if(!ae.isUndefined(p))return r(void 0,p)}function a(u,p){return ae.isUndefined(p)?ae.isUndefined(u)?void 0:r(void 0,u):r(void 0,p)}function d(u,p,_){return _ in t?r(u,p):_ in e?r(void 0,u):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:d,headers:(u,p,_)=>i(uD(u),uD(p),0,!0)};return ae.forEach(Object.keys(Object.assign({},e,t)),function(u){const p=l[u]||i,_=p(e[u],t[u],u);ae.isUndefined(_)&&p!==d||(n[u]=_)}),n}var hD=e=>{const t=oc({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:a,headers:d,auth:l}=t;if(t.headers=d=uo.from(d),t.url=bO(dD(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&d.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),ae.isFormData(r)){if(Rr.hasStandardBrowserEnv||Rr.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if((n=d.getContentType())!==!1){const[u,...p]=n?n.split(";").map(_=>Qn(_).call(_)).filter(Boolean):[];d.setContentType([u||"multipart/form-data",...p].join("; "))}}if(Rr.hasStandardBrowserEnv&&(i&&ae.isFunction(i)&&(i=i(t)),i||i!==!1&&Y9(t.url))){const u=s&&a&&q9.read(a);u&&d.set(s,u)}return t},X9=typeof XMLHttpRequest<"u"&&function(e){return new de(function(t,n){const r=hD(e);let i=r.data;const s=uo.from(r.headers).normalize();let a,d,l,u,p,{responseType:_,onUploadProgress:m,onDownloadProgress:E}=r;function C(){u&&u(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let R=new XMLHttpRequest;function y(){if(!R)return;const A=uo.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders());sD(function(D){t(D),C()},function(D){n(D),C()},{data:_&&_!=="text"&&_!=="json"?R.response:R.responseText,status:R.status,statusText:R.statusText,headers:A,config:e,request:R}),R=null}R.open(r.method.toUpperCase(),r.url,!0),R.timeout=r.timeout,"onloadend"in R?R.onloadend=y:R.onreadystatechange=function(){R&&R.readyState===4&&(R.status!==0||R.responseURL&&R.responseURL.indexOf("file:")===0)&&setTimeout(y)},R.onabort=function(){R&&(n(new ft("Request aborted",ft.ECONNABORTED,e,R)),R=null)},R.onerror=function(){n(new ft("Network Error",ft.ERR_NETWORK,e,R)),R=null},R.ontimeout=function(){let A=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const D=r.transitional||NO;r.timeoutErrorMessage&&(A=r.timeoutErrorMessage),n(new ft(A,D.clarifyTimeoutError?ft.ETIMEDOUT:ft.ECONNABORTED,e,R)),R=null},i===void 0&&s.setContentType(null),"setRequestHeader"in R&&ae.forEach(s.toJSON(),function(A,D){R.setRequestHeader(D,A)}),ae.isUndefined(r.withCredentials)||(R.withCredentials=!!r.withCredentials),_&&_!=="json"&&(R.responseType=r.responseType),E&&([l,p]=Mf(E,!0),R.addEventListener("progress",l)),m&&R.upload&&([d,u]=Mf(m),R.upload.addEventListener("progress",d),R.upload.addEventListener("loadend",u)),(r.cancelToken||r.signal)&&(a=A=>{R&&(n(!A||A.type?new yd(null,e,R):A),R.abort(),R=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const b=function(A){const D=/^([-+\w]{1,25})(:?\/\/|:)/.exec(A);return D&&D[1]||""}(r.url);b&&Rr.protocols.indexOf(b)===-1?n(new ft("Unsupported protocol "+b+":",ft.ERR_BAD_REQUEST,e)):R.send(i||null)})},J9=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController;const s=function(u){if(!r){r=!0,d();const p=u instanceof Error?u:this.reason;i.abort(p instanceof ft?p:new yd(p instanceof Error?p.message:p))}};let a=t&&setTimeout(()=>{a=null,s(new ft("timeout ".concat(t," of ms exceeded"),ft.ETIMEDOUT))},t);const d=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(u=>{u.unsubscribe?u.unsubscribe(s):u.removeEventListener("abort",s)}),e=null)};e.forEach(u=>u.addEventListener("abort",s));const{signal:l}=i;return l.unsubscribe=()=>ae.asap(d),l}},bT=g($w),pD=gd.f("asyncIterator"),Q9=g(pD);function OT(e,t){this.v=e,this.k=t}function ui(e){return function(){return new yu(e.apply(this,arguments))}}function yu(e){var t,n;function r(s,a){try{var d=e[s](a),l=d.value,u=l instanceof OT;bT.resolve(u?l.v:l).then(function(p){if(u){var _=s==="return"?"return":"next";if(!l.k||p.done)return r(_,p);p=e[_](p).value}i(d.done?"return":"normal",p)},function(p){r("throw",p)})}catch(p){i("throw",p)}}function i(s,a){switch(s){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(s,a){return new bT(function(d,l){var u={key:s,arg:a,resolve:d,reject:l,next:null};n?n=n.next=u:(t=n=u,r(s,a))})},typeof e.return!="function"&&(this.return=void 0)}function Qe(e){return new OT(e,0)}function Uf(e){var t={},n=!1;function r(i,s){return n=!0,s=new bT(function(a){a(e[i](s))}),{done:!1,value:new OT(s,1)}}return t[Rd!==void 0&&jN||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}yu.prototype[typeof Rd=="function"&&Q9||"@@asyncIterator"]=function(){return this},yu.prototype.next=function(e){return this._invoke("next",e)},yu.prototype.throw=function(e){return this._invoke("throw",e)},yu.prototype.return=function(e){return this._invoke("return",e)};var NT=g(pD);function DT(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=NT,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new xf(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function xf(e){function t(n){if(Object(n)!==n)return de.reject(new TypeError(n+" is not an object."));var r=n.done;return de.resolve(n.value).then(function(i){return{value:i,done:r}})}return xf=function(n){this.s=n,this.n=n.next},xf.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?de.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?de.reject(n):t(r.apply(this.s,arguments))}},new xf(e)}const Z9=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},$9=function(){var e=ui(function*(t,n){var r,i=!1,s=!1;try{for(var a,d=DT(e7(t));i=!(a=yield Qe(d.next())).done;i=!1){const l=a.value;yield*Uf(DT(Z9(l,n)))}}catch(l){s=!0,r=l}finally{try{i&&d.return!=null&&(yield Qe(d.return()))}finally{if(s)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),e7=function(){var e=ui(function*(t){if(t[NT])return void(yield*Uf(DT(t)));const n=t.getReader();try{for(;;){const{done:r,value:i}=yield Qe(n.read());if(r)break;yield i}}finally{yield Qe(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),fD=(e,t,n,r)=>{const i=$9(e,t);let s,a=0,d=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:p}=await i.next();if(u)return d(),void l.close();let _=p.byteLength;if(n){let m=a+=_;n(m)}l.enqueue(new Uint8Array(p))}catch(u){throw d(u),u}},cancel:l=>(d(l),i.return())},{highWaterMark:2})};function _D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function mD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_D(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_D(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Vf=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ED=Vf&&typeof ReadableStream=="function",t7=Vf&&(typeof TextEncoder=="function"?(gD=new TextEncoder,e=>gD.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var gD;const SD=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},n7=ED&&SD(()=>{let e=!1;const t=new Request(Rr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),PT=ED&&SD(()=>ae.isReadableStream(new Response("").body)),Ff={stream:PT&&(e=>e.body)};var TD;Vf&&(TD=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ff[e]&&(Ff[e]=ae.isFunction(TD[e])?t=>t[e]():(t,n)=>{throw new ft("Response type '".concat(e,"' is not supported"),ft.ERR_NOT_SUPPORT,n)})}));const r7=async(e,t)=>{const n=ae.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:ae.isBlob(r)?r.size:ae.isSpecCompliantForm(r)?(await new Request(Rr.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:ae.isArrayBufferView(r)||ae.isArrayBuffer(r)?r.byteLength:(ae.isURLSearchParams(r)&&(r+=""),ae.isString(r)?(await t7(r)).byteLength:void 0))(t)};var i7=Vf&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:a,onDownloadProgress:d,onUploadProgress:l,responseType:u,headers:p,withCredentials:_="same-origin",fetchOptions:m}=hD(e);u=u?(u+"").toLowerCase():"text";let E,C=J9([i,s&&s.toAbortSignal()],a);const R=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let y;try{if(l&&n7&&n!=="get"&&n!=="head"&&(y=await r7(p,r))!==0){let x,k=new Request(t,{method:"POST",body:r,duplex:"half"});if(ae.isFormData(r)&&(x=k.headers.get("content-type"))&&p.setContentType(x),k.body){const[B,q]=aD(y,Mf(cD(l)));r=fD(k.body,65536,B,q)}}ae.isString(_)||(_=_?"include":"omit");const b="credentials"in Request.prototype;E=new Request(t,mD(mD({},m),{},{signal:C,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:r,duplex:"half",credentials:b?_:void 0}));let A=await fetch(E);const D=PT&&(u==="stream"||u==="response");if(PT&&(d||D&&R)){const x={};["status","statusText","headers"].forEach(Z=>{x[Z]=A[Z]});const k=ae.toFiniteNumber(A.headers.get("content-length")),[B,q]=d&&aD(k,Mf(cD(d),!0))||[];A=new Response(fD(A.body,65536,B,()=>{q&&q(),R&&R()}),x)}u=u||"text";let V=await Ff[ae.findKey(Ff,u)||"text"](A,e);return!D&&R&&R(),await new de((x,k)=>{sD(x,k,{data:V,headers:uo.from(A.headers),status:A.status,statusText:A.statusText,config:e,request:E})})}catch(b){throw R&&R(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new ft("Network Error",ft.ERR_NETWORK,e,E),{cause:b.cause||b}):ft.from(b,b&&b.code,e,E)}});const kT={http:null,xhr:X9,fetch:i7};ae.forEach(kT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const vD=e=>"- ".concat(e),o7=e=>ae.isFunction(e)||e===null||e===!1;var RD={getAdapter:e=>{e=ae.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let a;if(n=e[s],r=n,!o7(n)&&(r=kT[(a=String(n)).toLowerCase()],r===void 0))throw new ft("Unknown adapter '".concat(a,"'"));if(r)break;i[a||"#"+s]=r}if(!r){const s=Object.entries(i).map(a=>{let[d,l]=a;return"adapter ".concat(d," ")+(l===!1?"is not supported by the environment":"is not available in the build")});throw new ft("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(vD).join(`
`):" "+vD(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:kT};function LT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new yd(null,e)}function yD(e){return LT(e),e.headers=uo.from(e.headers),e.data=AT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),RD.getAdapter(e.adapter||IT.adapter)(e).then(function(t){return LT(e),t.data=AT.call(e,e.transformResponse,t),t.headers=uo.from(t.headers),t},function(t){return oD(t)||(LT(e),t&&t.response&&(t.response.data=AT.call(e,e.transformResponse,t.response),t.response.headers=uo.from(t.response.headers))),de.reject(t)})}const CD="1.9.0",Bf={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Bf[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const ID={};Bf.transitional=function(e,t,n){function r(i,s){return"[Axios v"+CD+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,a)=>{if(e===!1)throw new ft(r(s," has been removed"+(t?" in "+t:"")),ft.ERR_DEPRECATED);return t&&!ID[s]&&(ID[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,a)}},Bf.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var jf={assertOptions:function(e,t,n){if(typeof e!="object")throw new ft("options must be an object",ft.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],a=t[s];if(a){const d=e[s],l=d===void 0||a(d,s,e);if(l!==!0)throw new ft("option "+s+" must be "+l,ft.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new ft("Unknown option "+s,ft.ERR_BAD_OPTION)}},validators:Bf};const Vo=jf.validators;let Gf=class{constructor(e){this.defaults=e||{},this.interceptors={request:new OO,response:new OO}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=oc(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&jf.assertOptions(n,{silentJSONParsing:Vo.transitional(Vo.boolean),forcedJSONParsing:Vo.transitional(Vo.boolean),clarifyTimeoutError:Vo.transitional(Vo.boolean)},!1),r!=null&&(ae.isFunction(r)?t.paramsSerializer={serialize:r}:jf.assertOptions(r,{encode:Vo.function,serialize:Vo.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),jf.assertOptions(t,{baseUrl:Vo.spelling("baseURL"),withXsrfToken:Vo.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&ae.merge(i.common,i[t.method]);i&&ae.forEach(["delete","get","head","post","put","patch","common"],E=>{delete i[E]}),t.headers=uo.concat(s,i);const a=[];let d=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(d=d&&E.synchronous,a.unshift(E.fulfilled,E.rejected))});const l=[];let u;this.interceptors.response.forEach(function(E){l.push(E.fulfilled,E.rejected)});let p,_=0;if(!d){const E=[yD.bind(this),void 0];for(E.unshift.apply(E,a),E.push.apply(E,l),p=E.length,u=de.resolve(t);_<p;)u=u.then(E[_++],E[_++]);return u}p=a.length;let m=t;for(_=0;_<p;){const E=a[_++],C=a[_++];try{m=E(m)}catch(R){C.call(this,R);break}}try{u=yD.call(this,m)}catch(E){return de.reject(E)}for(_=0,p=l.length;_<p;)u=u.then(l[_++],l[_++]);return u}getUri(e){return bO(dD((e=oc(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};ae.forEach(["delete","get","head","options"],function(e){Gf.prototype[e]=function(t,n){return this.request(oc(n||{},{method:e,url:t,data:(n||{}).data}))}}),ae.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,s){return this.request(oc(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Gf.prototype[e]=t(),Gf.prototype[e+"Form"]=t(!0)});var Wf=Gf;class MT{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new de(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const a=new de(d=>{r.subscribe(d),s=d}).then(i);return a.cancel=function(){r.unsubscribe(s)},a},t(function(i,s,a){r.reason||(r.reason=new yd(i,s,a),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new MT(function(r){t=r}),cancel:t}}}var s7=MT;const UT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(UT).forEach(e=>{let[t,n]=e;UT[n]=t});var a7=UT;const zn=function e(t){const n=new Wf(t),r=uO(Wf.prototype.request,n);return ae.extend(r,Wf.prototype,n,{allOwnKeys:!0}),ae.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(oc(t,i))},r}(IT);zn.Axios=Wf,zn.CanceledError=yd,zn.CancelToken=s7,zn.isCancel=oD,zn.VERSION=CD,zn.toFormData=Rf,zn.AxiosError=ft,zn.Cancel=zn.CanceledError,zn.all=function(e){return de.all(e)},zn.spread=function(e){return function(t){return e.apply(null,t)}},zn.isAxiosError=function(e){return ae.isObject(e)&&e.isAxiosError===!0},zn.mergeConfig=oc,zn.AxiosHeaders=uo,zn.formToJSON=e=>rD(ae.isHTMLForm(e)?new FormData(e):e),zn.getAdapter=RD.getAdapter,zn.HttpStatusCode=a7,zn.default=zn;var pr=zn;const c7=()=>{};function Cu(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:c7};return e.promise=new de((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const Hf=new Map,Kf=new Map,Fo=new Map;let hn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),tt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const xT=new FK;let ho=xT.getResult(),VT=null;function qe(e){if(!VT){e&&xT.setUA(e),ho=xT.getResult();const t=function(d){if(d.engine.name==="Blink"&&d.browser.name!=="WeChat")return tt.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return tt.CHROME;case"Safari":case"Mobile Safari":return tt.SAFARI;case"Edge":return tt.EDGE;case"Firefox":return tt.FIREFOX;case"QQ":case"QQBrowser":return tt.QQ;case"Opera":return tt.OPERA;case"WeChat":return tt.WECHAT;default:return d.browser.name||""}}(ho),n=wD(ho),r=function(d){return d.os.name==="Windows"?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||""}(ho),i=ho.os.version,s=wD(ho,!1),a=ho.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:a};VT={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:a}}return VT}function wD(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function zf(){return qe().os}function AD(){const e=qe();return"".concat(e.os," ").concat(e.osVersion)}function Yf(){const e=qe();return!!(ho.engine.name==="WebKit"&&e.os===hn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==tt.SAFARI||Yn()&&e.name!==tt.SAFARI)}function fs(){return qe().name===tt.CHROME}function Nn(){return qe().name===tt.SAFARI}function bD(){const e=qe();if(e.name!==tt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function OD(){return qe().name===tt.EDGE}function Ut(){return qe().name===tt.FIREFOX}function Yn(){return qe().os===hn.IOS}function Cd(e){const t=qe();return!(t.name!==tt.CHROME||!t.osVersion)&&Number(t.version)>=e}function ND(e){const t=qe();return!(t.name!==tt.CHROME||!t.osVersion)&&Number(t.version)<e}function FT(e,t,n){const r=qe();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function BT(e){const t=qe();return!(t.name!==tt.EDGE||!t.osVersion)&&Number(t.version)>=e}function jT(e){const t=qe();return!(t.name!==tt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function DD(e){const t=qe();return!(t.name!==tt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function PD(e,t,n){const r=qe();if(r.os!==hn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function kD(e,t,n){const r=qe();if(r.os!==hn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function GT(e,t,n){const r=qe();if(r.name!==tt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function WT(e){const t=qe();return!(t.name!==tt.OPERA||!t.osVersion)&&Number(t.version)>=e}function LD(){const e=qe();if(e.os!==hn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Id(){const e=qe();if(e.os!==hn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function HT(){const e=qe();if(e.os!==hn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function MD(){const e=qe();if(e.os!==hn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Vi(){return Nn()&&navigator.maxTouchPoints>0}function UD(){return qe().name===tt.WECHAT}function xD(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function KT(){const e=zf();return function(){const{deviceType:t}=qe();return t==="mobile"||t==="tablet"}()||e===hn.ANDROID||e===hn.IOS||e===hn.HARMONY_OS}function _s(){const e=qe();return e.name!==tt.EDGE&&e.name!==tt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function qf(){return zf()===hn.ANDROID}function Iu(){const e=qe();return qf()&&(e.name===tt.CHROME||e.name===tt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function De(e,t,n){return(t=function(r){var i=function(s,a){if(typeof s!="object"||!s)return s;var d=s[Symbol.toPrimitive];if(d!==void 0){var l=d.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function VD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VD(Object(n),!0).forEach(function(r){De(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VD(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let O=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Y=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),De(this,"code",void 0),De(this,"message",void 0),De(this,"data",void 0),De(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function po(e,t){if(typeof e!="boolean")throw new Y(O.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function cn(e,t,n){if(!oe(n).call(n,e))throw new Y(O.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function _t(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new Y(O.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function zT(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Y(O.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&_t(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&_t(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&_t(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&_t(e.ideal,"".concat(t,".ideal"),1,1/0)}else _t(e,t,1,1/0)}function Rn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Y(O.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!FD(e,n,r,i))throw new Y(O.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function ms(e,t){if(!Array.isArray(e))throw new Y(O.INVALID_PARAMS,"".concat(t," should be an array"))}function xt(e){return e==null}function FD(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const a=i.charCodeAt(s);if(a<0||a>255)return!1}return!0}(e))}var wu=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(wu||{}),YT=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(YT||{});const BD=new class{constructor(){De(this,"_clientSize",null),De(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),De(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),De(this,"getStyle",e=>window.getComputedStyle(e,null)),De(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:a,filter:d}=r;return(i==="none"||oe(t=["hidden","collapse"]).call(t,s)||Number(a)<.1)&&(n=!1),!!n&&(d&&d.split(" ").filter(l=>{var u;const p=l.split("(")[0];return oe(u=["brightness","blur","opacity"]).call(u,p)}).map(l=>{const[u,p]=l.split(/\(|\)/);return[u,Number(p.match(/^[0-9\.]+/))]}).forEach(l=>{const[u,p]=l;switch(u){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),De(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=a=>t(a);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),De(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),De(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:a}=e.getBoundingClientRect(),d=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:a,clientWidth:d,clientHeight:l,clientMin:Math.min(d,l)}}),De(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),De(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),De(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),De(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,a=[],d=10**6;for(let l=0;l<5;l++)for(let u=0;u<5;u++){const p=(n*d+(l===0?.1:l===4?(i*l*d-1e5)/d:i*l)*d)/d,_=(r*d+(u===0?.1:u===4?(s*u*d-1e5)/d:s*u)*d)/d;a.push({x:p,y:_})}return[...a]}),De(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),De(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),De(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:a}=this._clientSize;let d,l,u,p;if(e<0)d=0;else{if(!(e<s))return!1;d=e}if(t<0)return!1;if(l=t<s?t:s,n<0)u=0;else{if(!(n<i))return!1;u=n}if(r<0)return!1;p=r<i?r:i;const _=l-d,m=p-u;return this.checkSizeIsVisible(_,m,a)}),De(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),De(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(wu.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(wu.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(wu.SIZE)}}return this.returnHiddenResult(wu.STYLE)}return this.returnHiddenResult(YT.UNMOUNTED)}return this.returnHiddenResult(YT.INVALID_HTML_ELEMENT)}),De(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function qT(e){return new TextEncoder().encode(e)}const jD=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},XT=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",qT(e)),16);class Lt{constructor(){De(this,"_events",{}),De(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],i=this._indexOfListener(r,n);i!==-1&&r.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(a=>a);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(let a=0;a<n.length;a+=1){const d=n[a];d.once&&this.off(t,d.listener),d.listener.apply(this,i||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(a){console.error("safeEmit event:".concat(t," error ").concat(a==null?void 0:a.toString()))}})}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}let Au=null;function GD(){if(Au)return Au;if(window.electron)return Au=window.electron;if(!window.require)return null;try{return Au=window.require("electron"),Au}catch{return null}}let Wt=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Dt=function(e){return e.TRACER="tracer",e}({});function WD(e){return _t(e.timeout,"config.timeout",0,1e5),_t(e.timeoutFactor,"config.timeoutFactor",0,100,!1),_t(e.maxRetryCount,"config.maxRetryConfig",0,1/0),_t(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let d7=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),ot=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function bu(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function HD(e){return Rn(e.turnServerURL,"turnServerURL"),Rn(e.username,"username"),Rn(e.password,"password"),e.udpport&&_t(e.udpport,"udpport",1,99999,!0),e.forceturn&&po(e.forceturn,"forceturn"),e.security&&po(e.security,"security"),e.tcpport&&_t(e.tcpport,"tcpport",1,99999,!0),!0}function JT(e){return e.level!==void 0&&cn(e.level,"level",[1,2,3]),e.delay!==void 0&&_t(e.delay,"delay",0,3e3,!0),!0}let Ke=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Dn=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),xr=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),wd=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Pn(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?de.reject(new Y(O.UNEXPECTED_ERROR,"can not emit promise")):new de((s,a)=>{e.emit(t,...r,s,a)})}function gt(e,t){if(e.getListeners(t).length===0)return de.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Pn(e,t,...r)}function Yr(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Ou(e,t,...r)}function Ou(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];if(e.emit(t,...s,d=>{n=d},d=>{r=d}),r!==null)throw r;if(n===null)throw new Y(O.UNEXPECTED_ERROR,"handler is not sync");return n}const Yt=new class extends Lt{set networkState(e){this.emit(wd.NETWORK_STATE_CHANGE,e,this._networkState),e===xr.ONLINE?this.emit(wd.ONLINE):e===xr.OFFLINE&&(this.onlineWaiter=new de(t=>{this.once(wd.ONLINE,()=>{this.onlineWaiter=void 0,t(xr.ONLINE)})}),this.emit(wd.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===xr.ONLINE}constructor(){super(),De(this,"_moduleName","network-indicator"),De(this,"_networkState",xr.ONLINE),De(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=xr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xr.OFFLINE})}};function Xf(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Ad(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Jf(e){de!==void 0?de.resolve().then(e):setTimeout(e,0)}function Pt(e){return JSON.parse(JSON.stringify(e))}function sc(e){try{return Pt(e)}catch{return e}}const KD={};function ea(e,t){KD[t]||(KD[t]=!0,e())}function ac(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function ta(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function zD(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function YD(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Di(t).call(t,(a,d)=>a+d.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach(a=>{i.set(a,s),s+=a.length}),i}function Bo(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function qD(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Bo(n):n.size}),t+138}function l7(e){const t=new Y(O.TIMEOUT,"timeout");return new de((n,r)=>{window.setTimeout(()=>r(t),e)})}function yn(e){return new de(t=>{window.setTimeout(t,e)})}function St(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+St(e-n.length,"")}function cc(){return St(32,"").toUpperCase()}const Qf=()=>{},XD=new class{constructor(){De(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),a=4;a<i;a++)s[a-4]=arguments[a];if(this.fnMap.has(t)){const d=this.fnMap.get(t);if(d.threshold!==n){d.fn(...d.args),clearTimeout(d.timer);const l=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:s,skipFn:r})}else d.skipFn&&d.skipFn(...d.args),this.fnMap.set(t,ne(ne({},d),{},{fn:e,args:s,skipFn:r}))}else{const d=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:d,args:s,skipFn:r})}}},JD=XD.throttleByKey.bind(XD);function QD(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function QT(e,t){if(!QD(e)||!QD(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=QT(e[r],t[r]);return n}{const n=ne({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=QT(e[r],t[r]):n[r]=t[r]);return n}}function ZD(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function bd(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function ZT(e){return Di(e).call(e,(t,n)=>t+n,0)}function $D(e){const t="0123456789abcdef";function n(D){let V,x="";for(V=0;V<=3;V++)x+=t.charAt(D>>8*V+4&15)+t.charAt(D>>8*V&15);return x}function r(D,V){const x=(65535&D)+(65535&V);return(D>>16)+(V>>16)+(x>>16)<<16|65535&x}function i(D,V,x,k,B,q){return r(function(Z,te){return Z<<te|Z>>>32-te}(r(r(V,D),r(k,q)),B),x)}function s(D,V,x,k,B,q,Z){return i(V&x|~V&k,D,V,B,q,Z)}function a(D,V,x,k,B,q,Z){return i(V&k|x&~k,D,V,B,q,Z)}function d(D,V,x,k,B,q,Z){return i(V^x^k,D,V,B,q,Z)}function l(D,V,x,k,B,q,Z){return i(x^(V|~k),D,V,B,q,Z)}const u=function(D){let V;const x=1+(D.length+8>>6),k=new Array(16*x);for(V=0;V<16*x;V++)k[V]=0;for(V=0;V<D.length;V++)k[V>>2]|=D.charCodeAt(V)<<V%4*8;return k[V>>2]|=128<<V%4*8,k[16*x-2]=8*D.length,k}(e);let p,_,m,E,C,R=1732584193,y=-271733879,b=-1732584194,A=271733878;for(p=0;p<u.length;p+=16)_=R,m=y,E=b,C=A,R=s(R,y,b,A,u[p+0],7,-680876936),A=s(A,R,y,b,u[p+1],12,-389564586),b=s(b,A,R,y,u[p+2],17,606105819),y=s(y,b,A,R,u[p+3],22,-1044525330),R=s(R,y,b,A,u[p+4],7,-176418897),A=s(A,R,y,b,u[p+5],12,1200080426),b=s(b,A,R,y,u[p+6],17,-1473231341),y=s(y,b,A,R,u[p+7],22,-45705983),R=s(R,y,b,A,u[p+8],7,1770035416),A=s(A,R,y,b,u[p+9],12,-1958414417),b=s(b,A,R,y,u[p+10],17,-42063),y=s(y,b,A,R,u[p+11],22,-1990404162),R=s(R,y,b,A,u[p+12],7,1804603682),A=s(A,R,y,b,u[p+13],12,-40341101),b=s(b,A,R,y,u[p+14],17,-1502002290),y=s(y,b,A,R,u[p+15],22,1236535329),R=a(R,y,b,A,u[p+1],5,-165796510),A=a(A,R,y,b,u[p+6],9,-1069501632),b=a(b,A,R,y,u[p+11],14,643717713),y=a(y,b,A,R,u[p+0],20,-373897302),R=a(R,y,b,A,u[p+5],5,-701558691),A=a(A,R,y,b,u[p+10],9,38016083),b=a(b,A,R,y,u[p+15],14,-660478335),y=a(y,b,A,R,u[p+4],20,-405537848),R=a(R,y,b,A,u[p+9],5,568446438),A=a(A,R,y,b,u[p+14],9,-1019803690),b=a(b,A,R,y,u[p+3],14,-187363961),y=a(y,b,A,R,u[p+8],20,1163531501),R=a(R,y,b,A,u[p+13],5,-1444681467),A=a(A,R,y,b,u[p+2],9,-51403784),b=a(b,A,R,y,u[p+7],14,1735328473),y=a(y,b,A,R,u[p+12],20,-1926607734),R=d(R,y,b,A,u[p+5],4,-378558),A=d(A,R,y,b,u[p+8],11,-2022574463),b=d(b,A,R,y,u[p+11],16,1839030562),y=d(y,b,A,R,u[p+14],23,-35309556),R=d(R,y,b,A,u[p+1],4,-1530992060),A=d(A,R,y,b,u[p+4],11,1272893353),b=d(b,A,R,y,u[p+7],16,-155497632),y=d(y,b,A,R,u[p+10],23,-1094730640),R=d(R,y,b,A,u[p+13],4,681279174),A=d(A,R,y,b,u[p+0],11,-358537222),b=d(b,A,R,y,u[p+3],16,-722521979),y=d(y,b,A,R,u[p+6],23,76029189),R=d(R,y,b,A,u[p+9],4,-640364487),A=d(A,R,y,b,u[p+12],11,-421815835),b=d(b,A,R,y,u[p+15],16,530742520),y=d(y,b,A,R,u[p+2],23,-995338651),R=l(R,y,b,A,u[p+0],6,-198630844),A=l(A,R,y,b,u[p+7],10,1126891415),b=l(b,A,R,y,u[p+14],15,-1416354905),y=l(y,b,A,R,u[p+5],21,-57434055),R=l(R,y,b,A,u[p+12],6,1700485571),A=l(A,R,y,b,u[p+3],10,-1894986606),b=l(b,A,R,y,u[p+10],15,-1051523),y=l(y,b,A,R,u[p+1],21,-2054922799),R=l(R,y,b,A,u[p+8],6,1873313359),A=l(A,R,y,b,u[p+15],10,-30611744),b=l(b,A,R,y,u[p+6],15,-1560198380),y=l(y,b,A,R,u[p+13],21,1309151649),R=l(R,y,b,A,u[p+4],6,-145523070),A=l(A,R,y,b,u[p+11],10,-1120210379),b=l(b,A,R,y,u[p+2],15,718787259),y=l(y,b,A,R,u[p+9],21,-343485551),R=r(R,_),y=r(y,m),b=r(b,E),A=r(A,C);return n(R)+n(y)+n(b)+n(A)}let u7=1,eP=console,xn=class{static setLogger(e){eP=e}constructor(e,t){De(this,"id",void 0),De(this,"lockingPromise",de.resolve()),De(this,"locks",0),De(this,"name",""),De(this,"lockId",void 0),this.lockId=u7++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");eP.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new de(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Od(e,t){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const a=this[t];if(!a)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const d=await a.lock("From ".concat(e,".").concat(r));try{for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return await s.apply(this,u)}finally{d()}},i}}const Qt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function $T(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function fo(e,t,n,r){const i=Object.assign({},Qt,r);let s=i.timeout;const a=async()=>{await function(u){return new de(p=>{window.setTimeout(p,u)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let d=!1;const l=new de(async(u,p)=>{t=t||(()=>!1),n=n||(()=>!0);for(let _=0;_<i.maxRetryCount;_+=1){if(d)return p(new Y(O.OPERATION_ABORTED));try{const m=await e();if(!t(m,_)||_+1===i.maxRetryCount)return u(m);await a()}catch(m){if(!n(m,_)||_+1===i.maxRetryCount)return p(m);await a()}}});return l.cancel=()=>d=!0,l}let Zf,tP=class{constructor(e){De(this,"input",[]),De(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Di(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},$f=0,ev=0;function tv(e,t,n,r){return new de((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),$f+=Bo(t.data)):n&&(t.data.size?$f+=t.data.size:t.data instanceof FormData?$f+=qD(t.data):$f+=Bo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pr.request(t).then(a=>{typeof a.data=="string"?ev+=Bo(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?ev+=a.data.byteLength:ev+=Bo(JSON.stringify(a.data)),r&&i({data:a.data,headers:a.headers}),i(a.data)}).catch(a=>{pr.isCancel(a)?s(new Y(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?s(new Y(O.NETWORK_TIMEOUT,a.message)):a.response?s(new Y(O.NETWORK_RESPONSE_ERROR,a.response.status)):s(new Y(O.NETWORK_ERROR,a.message))})})}async function h7(e,t){const n=new Blob([t.data],{type:"buffer"});return await tv(e,ne(ne({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const nP=()=>window.isSecureContext!==void 0;function Fi(e){if(Array.isArray(e))return e.map(n=>n);if(!rP(e))return e;const t={};for(const n in e){const r=e[n];rP(r)||Array.isArray(r)?t[n]=Fi(r):t[n]=r}return t}function rP(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let nv=class{constructor(e){De(this,"input",[]),De(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const jo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Nu={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:jo,remoteCandidate:jo},updateInterval:0},iP={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},oP={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},sP={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},aP={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let rv=class{constructor(e,t){De(this,"onFirstVideoReceived",void 0),De(this,"onFirstVideoDecoded",void 0),De(this,"onFirstAudioReceived",void 0),De(this,"onFirstVideoDecodedTimeout",void 0),De(this,"onFirstAudioDecoded",void 0),De(this,"onSelectedLocalCandidateChanged",void 0),De(this,"onSelectedRemoteCandidateChanged",void 0),De(this,"videoIsReady",!1),De(this,"videoIsReady2",{}),De(this,"pc",void 0),De(this,"options",void 0),De(this,"intervalTimer",void 0),De(this,"stats",Fi(Nu)),De(this,"isFirstVideoReceived",{}),De(this,"isFirstVideoDecoded",{}),De(this,"isFirstAudioReceived",{}),De(this,"isFirstAudioDecoded",{}),De(this,"isFirstVideoDecodedTimeout",{}),De(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new de(e=>{e({local:ne({},jo),remote:ne({},jo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,a=0;for(const d of n)e[d].forEach((l,u)=>{if(!this.lossRateWindowStats[t-1][d][u]||!this.lossRateWindowStats[0][d][u])return;const p=this.lossRateWindowStats[t-1][d][u].packets-this.lossRateWindowStats[0][d][u].packets,_=this.lossRateWindowStats[t-1][d][u].packetsLost-this.lossRateWindowStats[0][d][u].packetsLost;d==="videoSend"||d==="audioSend"?(r+=p,s+=_):(i+=p,a+=_),Number.isNaN(p)||Number.isNaN(p)?l.packetLostRate=0:l.packetLostRate=p<=0||_<=0?0:_/(p+_)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}},p7=class extends rv{constructor(){super(...arguments),De(this,"_stats",Nu),De(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Fi(Nu);const n=t.filter(i=>i.type==="ssrc");this.processSSRCStats(n);const r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const r=oe(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=Fi(oP);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=Fi(iP),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){const a=s.stats,d=Date.now()-s.lts;i.framesDecodeFreezeTime=a.framesDecodeFreezeTime,i.framesDecodeInterval=a.framesDecodeInterval,i.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=d,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:ne({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=Fi(aP);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=Fi(sP);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new de((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(i=>{r[i]=n.stat(i)}),t.push(r)}),t}},Du=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),e_=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),iv=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),qr=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Nd=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Nd||{});function Pu(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Nd.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const a=Number(t[r]);if(typeof a!="number")return;if(!e)return a?s/a*i:void 0;const d=Number(e[n]);if(typeof d!="number")return;const l=Number(e[r]);if(typeof l!="number")return;const u=a-l;return u?(s-d)/u*i:void 0}let cP=class extends rv{constructor(){super(...arguments),De(this,"_stats",Nu),De(this,"report",void 0),De(this,"lastDecodeVideoReceiverStats",new Map),De(this,"lastVideoFramesRecv",new Map),De(this,"lastVideoFramesSent",new Map),De(this,"lastVideoFramesDecode",new Map),De(this,"lastVideoFramesOutput",new Map),De(this,"lastVideoJBDelay",new Map),De(this,"lastAudioJBDelay",new Map),De(this,"mediaBytesSent",new Map),De(this,"mediaBytesRetransmit",new Map),De(this,"mediaBytesTargetEncode",new Map),De(this,"lastDecodeAudioReceiverStats",new Map),De(this,"lastAudioConcealment",new Map),De(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Fi(Nu),this.report.forEach(e=>{switch(e.type){case qr.OUTBOUND:case qr.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===qr.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===qr.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case qr.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case qr.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:ne({},jo),remote:ne({},jo)};return e.forEach(n=>{let r;if(n.type===qr.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===qr.CANDIDATE_PAIR&&n.selected&&(r=n),r){const i=(s,a)=>{s.type=a.type,s.id=a.id,a.address&&(s.address=a.address),a.candidateType&&(s.candidateType=a.candidateType),a.port&&(s.port=a.port),a.priority&&(s.priority=a.priority),a.protocol&&(s.protocol=a.protocol),a.relayProtocol&&(s.relayProtocol=a.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&i(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&i(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===qr.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===qr.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===qr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ne({},t),ne({},this.stats.selectedCandidatePair.localCandidate)),e.type===qr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ne({},t),ne({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=Fi(aP),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Pu(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Nd.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ne({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,s=n.timestamp,a=s-i;if(a<=0)return;const d=e.concealedSamples-t.concealedSamples-0,l=r.nonSilent+d,u=e.totalSamplesReceived-t.totalSamplesReceived;if(u<=0)return;const p=80*u/a,_=200*u/a,m=a/u;let E=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,l>p&&(r.plc80>0?(e.freezeSamples80+=d,e.freezeMs80+=Math.round(d*m)):(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*m)),E=r.plc80+1);let C=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,l>_&&(r.plc200>0?(e.freezeSamples200+=d,e.freezeMs200+=Math.round(d*m)):(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*m)),C=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:d,lts:s,plc80:E,plc200:C})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(a=>a.ssrc===e.ssrc);t||(t=Fi(iP),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const a=t.decodedFrame?t.decodedFrame.width:0,d=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,a,d),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const a=n.stats,d=s-n.lts;t.framesDecodeFreezeTime=a.framesDecodeFreezeTime,t.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&d>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=d,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<a.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Pu(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Pu(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",Nd.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Pu(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Nd.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Pu(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",Nd.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ne({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Fi(oP),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new nv(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new nv(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new nv(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,qr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Fi(sP),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,qr.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(Lr(n=this.report).call(n)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,a;const d=t?this.report.get(t):void 0,l=(r=d==null?void 0:d.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof l!="number")return;let u=(i=d==null?void 0:d.frameWidth)!==null&&i!==void 0?i:e.frameWidth,p=(s=d==null?void 0:d.frameHeight)!==null&&s!==void 0?s:e.frameHeight,_=(a=d==null?void 0:d.framesPerSecond)!==null&&a!==void 0?a:e.framesPerSecond;if(typeof u=="number"&&typeof p=="number"||(u=0,p=0),_==null){const m=Date.now(),E=this.lastVideoFramesSent.get(n.ssrc);E&&m-E.lts>=800?(_=Math.round((l-E.count)/((m-E.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:m,rate:_})):E?_=E.rate:this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:m,rate:0})}n.sentFrame={width:u,height:p,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,a,d;const l=t?this.report.get(t):void 0,u=(r=l==null?void 0:l.framesReceived)!==null&&r!==void 0?r:e.framesReceived,p=(i=l==null?void 0:l.frameWidth)!==null&&i!==void 0?i:e.frameWidth,_=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:e.frameHeight,m=(a=l==null?void 0:l.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,E=(d=l==null?void 0:l.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount;if(typeof u=="number"){const C=this.lastVideoFramesRecv.get(n.ssrc),R=Date.now();n.framesReceivedCount=u;let y=0;C&&R-C.lts>=800?(y=Math.round((u-C.count)/((R-C.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:R,rate:y})):C?y=C.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:R,rate:0}),n.receivedFrame={width:p||0,height:_||0,frameRate:y||0},n.decodedFrame={width:p||0,height:_||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:_||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(m&&E){const C=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let R=C.jitterBufferMs;const y=E-C.jitterBufferEmittedCount;y>0&&(R=1e3*(m-C.jitterBufferDelay)/y),n.jitterBufferMs=R,n.currentDelayMs=Math.round(R),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:m,jitterBufferEmittedCount:E,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,a;const d=t?this.report.get(t):void 0,l=(r=(i=d==null?void 0:d.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,u=(s=(a=d==null?void 0:d.echoReturnLossEnhancement)!==null&&a!==void 0?a:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=l,n.aecReturnLossEnhancement=u}processAudioTrackReceiverStats(e,t,n){var r,i,s,a,d,l,u,p,_;const m=t?this.report.get(t):void 0,E=(r=m==null?void 0:m.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,C=(i=m==null?void 0:m.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,R=(s=m==null?void 0:m.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,y=(a=m==null?void 0:m.jitterBufferEmittedCount)!==null&&a!==void 0?a:e.jitterBufferEmittedCount,b=(d=m==null?void 0:m.audioLevel)!==null&&d!==void 0?d:e==null?void 0:e.audioLevel,A=(l=m==null?void 0:m.totalSamplesDuration)!==null&&l!==void 0?l:e==null?void 0:e.totalSamplesDuration,D=(u=m==null?void 0:m.concealedSamples)!==null&&u!==void 0?u:e.concealedSamples,V=(p=m==null?void 0:m.silentConcealedSamples)!==null&&p!==void 0?p:e.silentConcealedSamples,x=(_=m==null?void 0:m.concealmentEvents)!==null&&_!==void 0?_:e.concealmentEvents;if(typeof C=="number"&&(n.totalSamplesReceived=C),typeof V=="number"&&(n.silentConcealedSamples=V),typeof x=="number"&&(n.concealmentEvents=x),typeof D=="number"&&(n.concealedSamples=D),E&&C&&(n.accelerateRate=E/C),R&&y){const B=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let q=B.jitterBufferMs;const Z=y-B.jitterBufferEmittedCount;Z>0&&(q=1e3*(R-B.jitterBufferDelay)/Z),n.jitterBufferMs=Math.round(q),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:y,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=b;let k=1920;A&&C&&(k=C/A/50,n.receivedFrames=Math.round(C/k)),D&&(n.droppedFrames=Math.round(D/k))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{n=n===null?i.diffMean():n+i.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},f7=class extends rv{updateStats(){return de.resolve()}};function ov(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const a=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return a&&a[0]?Number(a[0].split("/")[1]):null}();return s?s<76?new p7(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new cP(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(a){if(!window.RTCStatsReport)return!1;const d=a.getStats();return!!(d instanceof de||function(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}(d))}(e)?new cP(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new f7(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const dP="websdk_ng_install_id";function sv(){try{if(N("INSTALL_ID"))return N("INSTALL_ID");let e=window.localStorage.getItem(dP);return e||(e=cc(),window.localStorage.setItem(dP,e)),ht("INSTALL_ID",e),e}catch{return}}const hi=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.24.0"),av=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let dc=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const kn=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let d=0;d<6;d++)i.push("1");const s=i.join(""),a={};return a[e]=r,a[t]=s,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=kn;const t_={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},cv={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},dv="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",lv={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Ot=ne(ne(ne(ne({},lv),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:cv,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},t_),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function ht(e,t,n){var r,i,s;oe(r=Object.keys(Ot)).call(r,e)&&(!n&&oe(i=Object.keys(_o)).call(i,e)||(Ot[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Ot.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,Ot.USE_NEW_NETWORK_CONFIG=s,s&&(Ot.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ot.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ot.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ot.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ot.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ot.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ot.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Ot.ENABLE_INSTANT_VIDEO=!0,Ot.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Ot.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Ot.NEW_TURN_MODE||(Ot.NEW_TURN_MODE=4))))}function N(e){return Ot[e]}av||(Ot.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ot.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ot.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ot.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ot.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ot.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ot.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ot.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ot.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ot.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ot.AREAS=["NORTH_AMERICA","OVERSEA"]);let lP=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const _o={};var Pe=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Pe||{});let ku=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const uP=128,_7=96,hP=1e3,Dd=10;let m7=0;var pP=(()=>{var e={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>Z,Printer:()=>it,parse:()=>ie,print:()=>fe});const a=`
`,d="".concat("\r").concat(a),l=" ";let u;function p($){return $>="0"&&$<="9"}function _($){return $>="!"&&$<="~"}function m($){return _($)||$>=""&&$<=""}function E($){return $==="!"||$>="#"&&$<="'"||$>="*"&&$<="+"||$>="-"&&$<="."||$>="0"&&$<="9"||$>="A"&&$<="Z"||$>="^"&&$<="~"}function C($){return $>="1"&&$<="9"}function R($){return $>="A"&&$<="Z"||$>="a"&&$<="z"}function y($){return $==="d"||$==="h"||$==="m"||$==="s"}function b($){return $>""&&$<"	"||$>"\v"&&$<"\f"||$>""&&$<""}function A($){return R($)||p($)||$==="+"||$==="/"}function D($){return p($)||R($)||$==="+"||$==="/"||$==="-"||$==="_"}function V($){return R($)||p($)||$==="+"||$==="/"}function x($,v){var P=Object.keys($);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols($);v&&(U=U.filter(function(re){return Object.getOwnPropertyDescriptor($,re).enumerable})),P.push.apply(P,U)}return P}function k($){for(var v=1;v<arguments.length;v++){var P=arguments[v]!=null?arguments[v]:{};v%2?x(Object(P),!0).forEach(function(U){B($,U,P[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(P)):x(Object(P)).forEach(function(U){Object.defineProperty($,U,Object.getOwnPropertyDescriptor(P,U))})}return $}function B($,v,P){return v in $?Object.defineProperty($,v,{value:P,enumerable:!0,configurable:!0,writable:!0}):$[v]=P,$}(function($){$.VERSION="v",$.ORIGIN="o",$.SESSION_NAME="s",$.INFORMATION="i",$.URI="u",$.EMAIL="e",$.PHONE="p",$.CONNECTION="c",$.BANDWIDTH="b",$.TIME="t",$.REPEAT="r",$.ZONE_ADJUSTMENTS="z",$.KEY="k",$.ATTRIBUTE="a",$.MEDIA="m"})(u||(u={}));class q{consumeText(v,P){let U=P;for(;U<v.length;){const re=v[U];if(re==="\0"||re==="\r"||re===a)break;U+=1}if(U-P==0)throw new Error("Invalid text, at ".concat(v));return U}consumeUnicastAddress(v,P,U){return this.consumeTill(v,P,l)}consumeOneOrMore(v,P,U){let re=P;for(;U(v[re]);)re++;if(re-P==0)throw new Error("Invalid rule at ".concat(P,"."));return re}consumeSpace(v,P){if(v[P]===l)return P+1;throw new Error("Invalid space at ".concat(P,"."))}consumeIP4Address(v,P){let U=P;for(let re=0;re<4;re++)if(U=this.consumeDecimalUChar(v,U),re!==3){if(v[U]!==".")throw new Error("Invalid IP4 address.");U++}return U}consumeDecimalUChar(v,P){let U=P;for(let Me=0;Me<3&&p(v[U]);Me++,U++);if(U-P==0)throw new Error("Invalid decimal uchar.");const re=parseInt(v.slice(P,U));if(re>=0&&re<=255)return U;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,P){let U=this.consumeHexpart(v,P);return v[U]===":"&&(U+=1,U=this.consumeIP4Address(v,U)),U}consumeHexpart(v,P){let U=P;if(v[U]===":"&&v[U+1]===":"){U+=2;try{U=this.consumeHexseq(v,U)}catch{}return U}if(U=this.consumeHexseq(v,U),v[U]===":"&&v[U+1]===":"){U+=2;try{U=this.consumeHexseq(v,U)}catch{}return U}return U}consumeHexseq(v,P){let U=P;for(;U=this.consumeHex4(v,U),v[U]===":"&&v[U+1]!==":";)U+=1;return U}consumeHex4(v,P){let U=0;for(;U<4;U++)if(!((re=v[P+U])>="0"&&re<="9"||re>="a"&&re<="f"||re>="A"&&re<="F")){if(U===0)throw new Error("Invalid hex 4");break}var re;return P+U}consumeFQDN(v,P){let U=P;for(;p(v[U])||R(v[U])||v[U]==="-"||v[U]===".";)U+=1;if(U-P<4)throw new Error("Invalid FQDN");return U}consumeExtnAddr(v,P){return this.consumeOneOrMore(v,P,m)}consumeMulticastAddress(v,P,U){switch(U){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,P);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,P);default:try{return this.consumeFQDN(v,P)}catch{return this.consumeExtnAddr(v,P)}}}consumeIP6MulticastAddress(v,P){const U=this.consumeHexpart(v,P);return v[U]==="/"?this.consumeInteger(v,U+1):U}consumeIP4MulticastAddress(v,P){let U=P+3;const re=v.slice(P,U),Me=parseInt(re);if(Me<224||Me>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let vt=0;vt<3;vt++){if(v[U]!==".")throw new Error("Invalid IP4 multicast address.");U+=1,U=this.consumeDecimalUChar(v,U)}return v[U]==="/"&&(U+=1),U=this.consumeTTL(v,U),v[U]==="/"&&(U=this.consumeInteger(v,U)),U}consumeInteger(v,P){if(!C(v[P]))throw new Error("Invalid integer.");for(P+=1;p(v[P]);)P+=1;return P}consumeTTL(v,P){if(v[P]==="0")return P+1;if(!C(v[P]))throw new Error("Invalid TTL.");P+=1;for(let U=0;U<2&&p(v[P]);U++)P+=1;return P}consumeToken(v,P){return this.consumeOneOrMore(v,P,E)}consumeTime(v,P){let U=P;if(v[U]==="0")return U+1;for(C(v[U])&&(U+=1);p(v[U]);)U++;if(U-P<10)throw new Error("Invalid time");return U}consumeAddress(v,P){return this.consumeTill(v,P,l)}consumeTypedTime(v,P){let U=P;return U=this.consumeOneOrMore(v,U,p),y(v[U])?U+1:U}consumeRepeatInterval(v,P){if(!C(v[P]))throw new Error("Invalid repeat interval");for(P+=1;p(v[P]);)P+=1;return y(v[P])&&(P+=1),P}consumePort(v,P){return this.consumeOneOrMore(v,P,p)}consume(v,P,U){for(let re=0;re<U.length;re++){if(P+re>=v.length)throw new Error("consume exceeding value length");if(v[P+re]!==U[re])throw new Error("consume ".concat(U," failed at ").concat(re))}return P+U.length}consumeTill(v,P,U){let re=P;for(;re<v.length&&(typeof U!="string"||v[re]!==U)&&(typeof U!="function"||!U(v[re]));)re++;return re}}class Z extends q{constructor(){super(),B(this,"records",[]),B(this,"currentLine",0)}parse(v){const P=this.probeEOL(v);this.records=v.split(P).filter(Cs=>!!Qn(Cs).call(Cs)).map(this.parseLine),this.currentLine=0;const U=this.parseVersion(),re=this.parseOrigin(),Me=this.parseSessionName(),vt=this.parseInformation(),sn=this.parseUri(),vi=this.parseEmail(),Qi=this.parsePhone(),gh=this.parseConnection(),Oc=this.parseBandWidth(),ul=this.parseTimeFields(),hm=this.parseKey(),pm=this.parseSessionAttribute(),Ri=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:U,origin:re,sessionName:Me,information:vt,uri:sn,emails:vi,phones:Qi,connection:gh,bandwidths:Oc,timeFields:ul,key:hm,attributes:pm,mediaDescriptions:Ri}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let P=0;P<v.length;P++)if(v[P]===a)return v[P-1]==="\r"?d:a;throw new Error("Invalid newline character.")}parseLine(v,P){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const U=v[0];if(v[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:U,value:v.slice(2),line:P,cur:0}}parseSessionAttribute(){const v=new Fe;for(;this.currentLine<this.records.length;){const P=this.getCurrentRecord();if(P.type!==u.ATTRIBUTE)break;const U={attField:this.extractOneOrMore(P,re=>E(re)&&re!==":"),_cur:0};P.value[P.cur]===":"&&(P.cur+=1,U.attValue=this.extractOneOrMore(P,b)),v.parse(U),this.currentLine++}return v.digest()}parseMediaAttributes(v){const P=new Ge(v);for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==u.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(U,Me=>E(Me)&&Me!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,re.attValue=this.extractOneOrMore(U,b)),P.parse(re),this.currentLine++}return P.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===u.KEY){if(v.value==="prompt"||v.value==="clear:"||v.value==="base64:"||v.value==="uri:")return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===u.ZONE_ADJUSTMENTS){const P=[];for(;;)try{const U=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let re=!1;v.value[v.cur]==="-"&&(re=!0,v.cur+=1);const Me=this.extract(v,this.consumeTypedTime);P.push({time:U,typedTime:Me,back:re})}catch{break}if(P.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,P}return[]}parseRepeat(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==u.REPEAT)break;{const U=this.extract(P,this.consumeRepeatInterval),re=this.parseTypedTime(P);v.push({repeatInterval:U,typedTimes:re}),this.currentLine++}}return v}parseTypedTime(v){const P=[];for(;;)try{this.consumeSpaceForRecord(v),P.push(this.extract(v,this.consumeTypedTime))}catch{break}if(P.length===0)throw new Error("Invalid typed time.");return P}parseTime(){const v=this.getCurrentRecord(),P=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const U=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:P,stopTime:U}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const P=this.getCurrentRecord();if(P.type!==u.BANDWIDTH)break;{const U=this.extractOneOrMore(P,E);if(P.value[P.cur]!==":")throw new Error("Invalid bandwidth field.");P.cur++;const re=this.extractOneOrMore(P,p);v.push({bwtype:U,bandwidth:re}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==u.VERSION)throw new Error("first sdp record must be version");const P=v.value.slice(0,this.consumeOneOrMore(v.value,0,p));if(P.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,P}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==u.ORIGIN)throw new Error("second line of sdp must be origin");const P=this.extractOneOrMore(v,m);this.consumeSpaceForRecord(v);const U=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const re=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const Me=this.extractOneOrMore(v,E);this.consumeSpaceForRecord(v);const vt=this.extractOneOrMore(v,E);this.consumeSpaceForRecord(v);const sn=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:P,sessId:U,sessVersion:re,nettype:Me,addrtype:vt,unicastAddress:sn}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===u.SESSION_NAME){const P=this.extract(v,this.consumeText);return this.currentLine++,P}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==u.INFORMATION)return;const P=this.extract(v,this.consumeText);return this.currentLine++,P}parseUri(){const v=this.getCurrentRecord();if(v.type===u.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==u.EMAIL)break;v.push(P.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==u.PHONE)break;v.push(P.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===u.CONNECTION){const P=this.extractOneOrMore(v,E);this.consumeSpaceForRecord(v);const U=this.extractOneOrMore(v,E);this.consumeSpaceForRecord(v);const re=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:P,addrtype:U,address:re}}}parseMedia(){const v=this.getCurrentRecord(),P=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let U=this.extract(v,this.consumePort);v.value[v.cur]==="/"&&(v.cur+=1,U+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const re=[];for(re.push(this.extract(v,this.consumeToken));v.value[v.cur]==="/";)v.cur+=1,re.push(this.extract(v,this.consumeToken));if(re.length===0)throw new Error("Invalid proto");const Me=this.parseFmt(v);return this.currentLine++,{mediaType:P,port:U,protos:re,fmts:Me}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===u.TIME;){const P=this.parseTime(),U=this.parseRepeat(),re=this.parseZone();v.push({time:P,repeats:U,zones:re})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.MEDIA;){const P=this.parseMedia(),U=this.parseInformation(),re=this.parseConnections(),Me=this.parseBandWidth(),vt=this.parseKey(),sn=this.parseMediaAttributes(P);v.push({media:P,information:U,connections:re,bandwidths:Me,key:vt,attributes:sn})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const P=[];for(;;)try{this.consumeSpaceForRecord(v),P.push(this.extract(v,this.consumeToken))}catch{break}if(P.length===0)throw new Error("Invalid fmts");return P}extract(v,P){for(var U=arguments.length,re=new Array(U>2?U-2:0),Me=2;Me<U;Me++)re[Me-2]=arguments[Me];const vt=P.call(this,v.value,v.cur,...re),sn=v.value.slice(v.cur,vt);return v.cur=vt,sn}extractOneOrMore(v,P){const U=this.consumeOneOrMore(v.value,v.cur,P),re=v.value.slice(v.cur,U);return v.cur=U,re}consumeSpaceForRecord(v){if(v.value[v.cur]!==l)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class te extends q{constructor(){super(...arguments),B(this,"attributes",void 0),B(this,"digested",!1)}extractOneOrMore(v,P,U){const re=this.consumeOneOrMore(v.attValue,v._cur,P),Me=v.attValue.slice(v._cur,re),[vt,sn]=U||[];if(typeof vt=="number"&&Me.length<vt)throw new Error("error in length, should be more or equal than ".concat(vt," characters."));if(typeof sn=="number"&&Me.length>sn)throw new Error("error in length, should be less or equal than ".concat(sn," characters."));return v._cur=re,Me}consumeAttributeSpace(v){if(v.attValue[v._cur]!==l)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,P){if(!v.attValue)throw new Error("Nothing to extract from attValue.");for(var U=arguments.length,re=new Array(U>2?U-2:0),Me=2;Me<U;Me++)re[Me-2]=arguments[Me];const vt=P.call(this,v.attValue,v._cur,...re),sn=v.attValue.slice(v._cur,vt);return v._cur=vt,sn}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,P){if(!v.attValue)throw new Error;for(let U=0;U<P.length;U++)if(P[U]!==v.attValue[v._cur+U])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,A,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,A,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const P=[];for(;!this.atEnd(v);){P.push(this.extractOneOrMore(v,A));try{this.consumeAttributeSpace(v)}catch(U){if(this.atEnd(v))break;throw U}}this.attributes.iceOptions=P}parseFingerprint(v){const P=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:P,fingerprint:U})}parseExtmap(v){const P=this.extractOneOrMore(v,p);let U;this.peekChar(v)==="/"&&(this.extract(v,this.consume,"/"),U=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeTill,l),Me=k(k({entry:parseInt(P,10)},U&&{direction:U}),{},{extensionName:re});this.peekChar(v)===l&&(this.consumeAttributeSpace(v),Me.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(Me)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const P=this.extract(v,this.consumeTill);if(P!=="active"&&P!=="passive"&&P!=="actpass"&&P!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=P}}class Fe extends te{constructor(){super(...arguments),B(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(P){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),P}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const P=this.extract(v,this.consumeToken),U=[];for(;!this.atEnd(v)&&this.peekChar(v)===l;)this.consumeAttributeSpace(v),U.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:P,identificationTag:U})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,D)}parseIdentity(v){const P=this.extractOneOrMore(v,V),U=[];for(;!this.atEnd(v)&&this.peekChar(v)===l;){this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const Me=this.extractOneOrMore(v,vt=>vt!==l&&b(vt));U.push({name:re,value:Me})}this.attributes.identities.push({assertionValue:P,extensions:U})}parseMsidSemantic(v){this.peekChar(v)===l&&this.consumeAttributeSpace(v);const P={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if(this.peekChar(v)==="*"){this.extract(v,this.consume,"*"),P.applyForAll=!0;break}{const U=this.extract(v,this.consumeTill,l);P.identifierList.push(U)}}this.attributes.msidSemantic=P}}class Ge extends te{constructor(v){super(),B(this,"attributes",void 0),v.protos.indexOf("RTP")!==-1||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(P){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),P}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const P=this.extractOneOrMore(v,A,[1,32]);this.consumeAttributeSpace(v);const U=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const Me=this.extractOneOrMore(v,p,[1,10]);this.consumeAttributeSpace(v);const vt=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const sn=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const vi={foundation:P,componentId:U,transport:re,priority:Me,connectionAddress:vt,port:sn,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),vi.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),vi.relPort=this.extract(v,this.consumePort));this.peekChar(v)===l;){this.consumeAttributeSpace(v);const Qi=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),vi.extension[Qi]=this.extractOneOrMore(v,_)}this.attributes.candidates.push(vi)}parseRemoteCandidate(v){const P=[];for(;;){const U=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Me=this.extract(v,this.consumePort);P.push({componentId:U,connectionAddress:re,port:Me});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(P)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const P=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const re={encodingName:U,clockRate:this.extractOneOrMore(v,p)};this.atEnd(v)||this.peekChar(v)!=="/"||(this.extract(v,this.consume,"/"),re.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const Me=this.attributes.payloads.find(vt=>vt.payloadType===parseInt(P,10));Me?Me.rtpMap=re:this.attributes.payloads.push({payloadType:parseInt(P,10),rtpMap:re,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const P=this.extractOneOrMore(v,p);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill,":");let re;this.peekChar(v)===":"&&(this.extract(v,this.consume,":"),re=this.extract(v,this.consumeTill));const Me=this.attributes.ssrcs.find(vt=>vt.ssrcId===parseInt(P,10));Me?Me.attributes[U]=re:this.attributes.ssrcs.push({ssrcId:parseInt(P,10),attributes:{[U]:re}})}parseFmtp(v){const P=this.extract(v,this.consumeTill,l);this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill),re={};U.split(";").forEach(vt=>{let[sn,vi]=vt.split("=");sn=Qn(sn).call(sn);const Qi=typeof vi=="string"?Qn(vi).call(vi):null;typeof sn=="string"&&sn.length>0&&(re[sn]=Qi)});const Me=this.attributes.payloads.find(vt=>vt.payloadType===parseInt(P,10));Me?Me.fmtp={parameters:re}:this.attributes.payloads.push({payloadType:parseInt(P,10),rtcpFeedbacks:[],fmtp:{parameters:re}})}parseFmtParameters(v){const P={},U=this.extract(v,this.consumeTill,"=");v._cur++;const re=this.extract(v,this.consumeTill,";");for(P[U]=re;v.attValue[v._cur]===";";){const Me=this.extract(v,this.consumeTill,"=");v._cur++;const vt=this.extract(v,this.consumeTill,";");P[Me]=vt}return P}parseRtcpFb(v){let P="";P=this.peekChar(v)==="*"?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,l),this.consumeAttributeSpace(v);const U=this.extract(v,this.consumeTill,l);let re;if(U==="trr-int")re={type:U,interval:this.extract(v,this.consumeTill)};else{const Me={type:U};this.peekChar(v)===l&&(this.consumeAttributeSpace(v),Me.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===l&&(Me.additional=this.extract(v,this.consumeTill))),re=Me}if(P==="*")this.attributes.rtcpFeedbackWildcards.push(re);else{const Me=this.attributes.payloads.find(vt=>vt.payloadType===parseInt(P,10));Me?Me.rtcpFeedbacks.push(re):this.attributes.payloads.push({payloadType:parseInt(P,10),rtcpFeedbacks:[re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const P={port:this.extract(v,this.consumePort)};this.peekChar(v)===l&&(this.consumeAttributeSpace(v),P.netType=this.extractOneOrMore(v,E),this.consumeAttributeSpace(v),P.addressType=this.extractOneOrMore(v,E),this.consumeAttributeSpace(v),P.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=P}parseMsid(v){const P={id:this.extractOneOrMore(v,E,[1,64])};this.peekChar(v)===l&&(this.consumeAttributeSpace(v),P.appdata=this.extractOneOrMore(v,E,[1,64])),this.attributes.msids.push(P)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const P=this.extractOneOrMore(v,re=>R(re)||p(re)||re==="_"||re==="-");this.consumeAttributeSpace(v);const U={id:P,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===l){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const re=[];for(;;){const Me=this.extract(v,this.consumeToken);re.push(Me);try{this.extract(v,this.consume,",")}catch{break}}U.payloads=re,this.peekChar(v)===l&&this.extract(v,this.consume,l)}for(;;){const re=this.extract(v,this.consumeToken);switch(re){case"depend":{const Me={type:re,rids:this.extract(v,this.consume,"=").split(",")};U.params.push(Me);break}default:{const Me={type:re};this.peekChar(v)==="="&&(this.extract(v,this.consume,"="),Me.val=this.extract(v,this.consumeTill,";")),U.params.push(Me)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(U)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,p,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const P=this.extract(v,this.consumeToken),U=[];for(;;)try{this.consumeAttributeSpace(v);const re=this.extract(v,this.consumeInteger);U.push(parseInt(re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:P,ssrcIds:U})}}function Oe($,v,P){return v in $?Object.defineProperty($,v,{value:P,enumerable:!0,configurable:!0,writable:!0}):$[v]=P,$}class it{constructor(){Oe(this,"eol",d)}print(v,P){let U="";return P&&(this.eol=P),U+=this.printVersion(v.version),U+=this.printOrigin(v.origin),U+=this.printSessionName(v.sessionName),U+=this.printInformation(v.information),U+=this.printUri(v.uri),U+=this.printEmail(v.emails),U+=this.printPhone(v.phones),U+=this.printConnection(v.connection),U+=this.printBandwidth(v.bandwidths),U+=this.printTimeFields(v.timeFields),U+=this.printKey(v.key),U+=this.printSessionAttributes(v.attributes),U+=this.printMediaDescription(v.mediaDescriptions),U}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let P="";for(const U of v)P+="e=".concat(U).concat(this.eol);return P}printPhone(v){let P="";for(const U of v)P+="e=".concat(U).concat(this.eol);return P}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let P="";for(const U of v)P+="b=".concat(U.bwtype,":").concat(U.bandwidth).concat(this.eol);return P}printTimeFields(v){let P="";for(const U of v){P+="t=".concat(U.time.startTime," ").concat(U.time.startTime).concat(this.eol);for(const re of U.repeats)P+="r=".concat(re.repeatInterval," ").concat(re.typedTimes.join(" ")).concat(this.eol);U.zoneAdjustments&&(P+="z=",P+="z=".concat(U.zoneAdjustments.map(re=>"".concat(re.time," ").concat(re.back?"-":""," ").concat(re.typedTime)).join(" ")).concat(this.eol),P+=this.eol)}return P}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let P="";for(const U of v)P+="a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol);return P}printMediaDescription(v){let P="";for(const U of v)P+=this.printMedia(U.media),P+=this.printInformation(U.information),P+=this.printConnections(U.connections),P+=this.printBandwidth(U.bandwidths),P+=this.printKey(U.key),P+=this.printMediaAttributes(U);return P}printConnections(v){let P="";for(const U of v)P+=this.printConnection(U);return P}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new Gn(this.eol).print(v)}printMediaAttributes(v){return new Q(this.eol).print(v)}}class nt{constructor(v){Oe(this,"eol",void 0),this.eol=v}printIceUfrag(v){return v===void 0?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return v===void 0?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return v===void 0?"":"a=ice-options:".concat(v.join(l)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map(P=>"a=fingerprint:".concat(P.hashFunction).concat(l).concat(P.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v){return v.map(P=>"a=extmap:".concat(P.entry).concat(P.direction?"/".concat(P.direction):"").concat(l).concat(P.extensionName).concat(P.extensionAttributes?"".concat(l).concat(P.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v){return v===void 0?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map(P=>"a=".concat(P.attField).concat(P.attValue?":".concat(P.attValue):"").concat(this.eol)).join("")}}class Gn extends nt{print(v){let P="";return P+=this.printGroups(v.groups),P+=this.printMsidSemantic(v.msidSemantic),P+=this.printIceLite(v.iceLite),P+=this.printIceUfrag(v.iceUfrag),P+=this.printIcePwd(v.icePwd),P+=this.printIceOptions(v.iceOptions),P+=this.printFingerprints(v.fingerprints),P+=this.printSetup(v.setup),P+=this.printTlsId(v.tlsId),P+=this.printIdentity(v.identities),P+=this.printExtmap(v.extmaps),P+=this.printUnrecognized(v.unrecognized),P}printGroups(v){let P="";return v.length>0&&(P+=v.map(U=>"a=group:".concat(U.semantic).concat(U.identificationTag.map(re=>"".concat(l).concat(re)).join("")).concat(this.eol)).join("")),P}printIceLite(v){return v===void 0?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return v.length===0?"":v.map(P=>"a=identity:".concat(P.assertionValue).concat(P.extensions.map(U=>"".concat(l).concat(U.name).concat(U.value?"=".concat(U.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let P="a=msid-semantic:".concat(v.semantic);return v.applyForAll?P+="".concat(l,"*"):v.identifierList.length>0&&(P+=v.identifierList.map(U=>"".concat(l).concat(U))),P+this.eol}}class Q extends nt{print(v){const P=v.attributes;let U="";return U+=this.printRTCP(P.rtcp),U+=this.printIceUfrag(P.iceUfrag),U+=this.printIcePwd(P.icePwd),U+=this.printIceOptions(P.iceOptions),U+=this.printCandidates(P.candidates),U+=this.printRemoteCandidatesList(P.remoteCandidatesList),U+=this.printEndOfCandidates(P.endOfCandidates),U+=this.printFingerprints(P.fingerprints),U+=this.printSetup(P.setup),U+=this.printMid(P.mid),U+=this.printExtmap(P.extmaps),U+=this.printRTPRelated(P),U+=this.printPtime(P.ptime),U+=this.printMaxPtime(P.maxPtime),U+=this.printDirection(P.direction),U+=this.printSSRCGroups(P.ssrcGroups),U+=this.printSSRC(P.ssrcs),U+=this.printRTCPMux(P.rtcpMux),U+=this.printRTCPMuxOnly(P.rtcpMuxOnly),U+=this.printRTCPRsize(P.rtcpRsize),U+=this.printMSId(P.msids),U+=this.printImageattr(P.imageattr),U+=this.printRid(P.rids),U+=this.printSimulcast(P.simulcast),U+=this.printSCTPPort(P.sctpPort),U+=this.printMaxMessageSize(P.maxMessageSize),U+=this.printUnrecognized(P.unrecognized),U}printCandidates(v){return v.map(P=>"a=candidate:".concat(P.foundation).concat(l).concat(P.componentId).concat(l).concat(P.transport).concat(l).concat(P.priority).concat(l).concat(P.connectionAddress).concat(l).concat(P.port).concat(l,"typ").concat(l).concat(P.type).concat(P.relAddr?"".concat(l,"raddr").concat(l).concat(P.relAddr):"").concat(P.relPort?"".concat(l,"rport").concat(l).concat(P.relPort):"").concat(Object.keys(P.extension).map(U=>"".concat(l).concat(U).concat(l).concat(P.extension[U])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v){return v.map(P=>"a=remote-candidates:".concat(P.join(l)).concat(this.eol)).join("")}printEndOfCandidates(v){return v===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const P=v.payloads;let U="";U+=v.rtcpFeedbackWildcards.map(re=>this.printRTCPFeedback("*",re)).join("");for(const re of P)U+=this.printRtpMap(re.payloadType,re.rtpMap),U+=this.printFmtp(re.payloadType,re.fmtp),U+=re.rtcpFeedbacks.map(Me=>this.printRTCPFeedback(re.payloadType,Me)).join("");return U}printFmtp(v,P){if(!P)return"";const U=Object.keys(P.parameters);return U.length===1&&P.parameters[U[0]]===null?"a=fmtp:".concat(v).concat(l).concat(U[0]).concat(this.eol):"a=fmtp:".concat(v).concat(l).concat(Object.keys(P.parameters).map(re=>"".concat(re,"=").concat(P.parameters[re])).join(";")).concat(this.eol)}printRtpMap(v,P){return P?"a=rtpmap:".concat(v).concat(l).concat(P.encodingName,"/").concat(P.clockRate).concat(P.encodingParameters?"/".concat(P.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,P){let U="a=rtcp-fb:".concat(v).concat(l),re=P;return re.type==="trr-int"?U+="ttr-int".concat(l).concat(re.interval):(U+="".concat(re.type),re.parameter&&(U+="".concat(l).concat(re.parameter),re.additional&&(U+="".concat(l).concat(re.additional)))),U+this.eol}printPtime(v){return v===void 0?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return v===void 0?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return v===void 0?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map(P=>Object.keys(P.attributes).map(U=>"a=ssrc:".concat(P.ssrcId.toString(10)).concat(l).concat(U).concat(P.attributes[U]?":".concat(P.attributes[U]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v){return v===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return v===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return v===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(v===void 0)return"";let P="a=rtcp:".concat(v.port);return v.netType&&(P+="".concat(l).concat(v.netType)),v.addressType&&(P+="".concat(l).concat(v.addressType)),v.address&&(P+="".concat(l).concat(v.address)),P+this.eol}printMSId(v){return v.map(P=>"a=msid:".concat(P.id).concat(P.appdata?"".concat(l).concat(P.appdata):"").concat(this.eol)).join("")}printImageattr(v){return v.map(P=>"a=imageattr:".concat(P).concat(this.eol)).join("")}printRid(v){return v.map(P=>{let U="a=rid:".concat(P.id).concat(l).concat(P.direction);return P.payloads&&(U+="".concat(l,"pt=").concat(P.payloads.join(","))),P.params.length>0&&(U+="".concat(l).concat(P.params.map(re=>re.type==="depend"?"depend=".concat(re.rids.join(",")):"".concat(re.type,"=").concat(re.val)).join(";"))),U+this.eol}).join("")}printSimulcast(v){return v===void 0?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return v===void 0?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return v===void 0?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return v===void 0?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map(P=>"a=ssrc-group:".concat(P.semantic).concat(P.ssrcIds.map(U=>"".concat(l).concat(U.toString(10))).join("")).concat(this.eol)).join("")}}function ie($){return new Z().parse($)}function fe($,v){return new it().print($,v)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function yr(e){return pP.parse(e)}function na(e,t){return pP.print(e,t)}var E7=Ni("Array","keys"),g7=Hs,S7=Kn,T7=J,v7=E7,uv=Array.prototype,R7={DOMTokenList:!0,NodeList:!0},y7=function(e){var t=e.keys;return e===uv||T7(uv,e)&&t===uv.keys||S7(R7,g7(e))?v7:t},Cr=g(y7);function Vt(e,t,n){return(t=function(r){var i=function(s,a){if(typeof s!="object"||!s)return s;var d=s[Symbol.toPrimitive];if(d!==void 0){var l=d.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fP(Object(n),!0).forEach(function(r){Vt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fP(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const _P=new class extends Lt{constructor(){super(...arguments),Vt(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class C7{constructor(t){Vt(this,"logger",void 0),Vt(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function hv(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function mP(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const pi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},n_=Date.now(),Lu=e=>{for(const t in pi)if(Object.prototype.hasOwnProperty.call(pi,t)&&pi[t]===e)return t;return"DEFAULT"},T=new class{constructor(){Vt(this,"proxyServerURL",void 0),Vt(this,"logLevel",pi.DEBUG),Vt(this,"uploadState","collecting"),Vt(this,"uploadLogWaitingList",[]),Vt(this,"uploadLogUploadingList",[]),Vt(this,"uploadErrorCount",0),Vt(this,"currentLogID",0),Vt(this,"url",void 0),Vt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pi.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pi.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pi.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pi.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pi.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){ht("UPLOAD_LOG",!0)}disableLogUpload(){ht("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new C7(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-n_<100)return void setTimeout(()=>{this.log(...t)},Date.now()-n_);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=hv()+" Agora-SDK [".concat(Lu(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=hv()+" %cAgora-SDK [".concat(Lu(r),"]:");let s=[];if(!N("USE_NEW_LOG"))switch(r){case pi.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case pi.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case pi.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case pi.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-n_<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-n_);const r=Math.max(0,Math.min(4,t[0]));t[0]=hv()+" Agora-SDK [".concat(Lu(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!N("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=mP()+" Agora-SDK [".concat(Lu(e),"]:"):n[0]=mP()+" Agora-SDK [".concat(Lu(e),"]:");let i="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:hi,process_id:N("PROCESS_ID"),payload:JSON.stringify(e)};return fo(async()=>{const n=await pr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(N("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(N("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),_P.reportLogUploadError(r),!0},{timeout:N("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:N("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,N("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var EP;function I7(e){return Rn(e.reportId,"params.reportId",0,100,!1),Rn(e.category,"params.category",0,100,!1),Rn(e.event,"params.event",0,100,!1),Rn(e.label,"params.label",0,100,!1),_t(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(EP={}).FREE="free",EP.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const w7={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let dn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Nt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let A7=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ce(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var a,d=arguments.length,l=new Array(d),u=0;u<d;u++)l[u]=arguments[u];let p=l;if(e.argsMap)try{p=e.argsMap(this,...l)}catch(m){T.warning(m),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const _=(e.report||Se).reportApiInvoke(this._sessionId||null,{id:this._clientId||((a=this.store)===null||a===void 0?void 0:a.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:Dt.TRACER,reportResult:e.reportResult},e.throttleTime);try{const m=i.apply(this,l);return m instanceof de?m.then(E=>(_.onSuccess(e.reportResult&&E),E)).catch(E=>{throw _.onError(E),E}):(_.onSuccess(e.reportResult&&m),m)}catch(m){throw _.onError(m),m}}}return r}}const Se=new class{constructor(){Vt(this,"baseInfoMap",new Map),Vt(this,"proxyServer",void 0),Vt(this,"eventUploadTimer",void 0),Vt(this,"setSessionIdTimer",void 0),Vt(this,"url",void 0),Vt(this,"sids",new Set),Vt(this,"backupUrl",void 0),Vt(this,"_appId",void 0),Vt(this,"_aid",0),Vt(this,"keyEventUploadPendingItems",[]),Vt(this,"normalEventUploadPendingItems",[]),Vt(this,"apiInvokeUploadPendingItems",[]),Vt(this,"apiInvokeCount",0),Vt(this,"apiInvokeLoggedCount",0),Vt(this,"ltsList",[]),Vt(this,"lastSendNormalEventTime",Date.now()),Vt(this,"customReportCounterTimer",void 0),Vt(this,"customReportCount",0),Vt(this,"extApiInvoke",async e=>{for(const t of e){const n=Ve(Ve({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Dt.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),N("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),N("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!N("SHOW_REPORT_INVOKER_LOG"),a=!!N("SHOW_REPORT_USER_INVOKER_LOG"),d=s||a&&t.id;d&&(this.apiInvokeLoggedCount+=1);const l=this.apiInvokeLoggedCount;function u(E,C){if(d){let R="[apiInvoke-".concat(l,"]");if(t.id&&(R+="[".concat(t.id,"]")),t.name&&(R+="[".concat(t.name,"]"),t.name===Wt.JOIN))return T.info("".concat(R," ").concat(E));T.info("".concat(R," ").concat(E),E==="start"?t.options:C||"")}}const p=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});u("start");let _=!1;yn(t.timeout).then(()=>{_||(this.sendApiInvoke(Ve(Ve({},p()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),u("timeout"))});const m=new Y(O.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:E=>{const C=()=>{if(_)throw m;return _=!0,this.sendApiInvoke(Ve(Ve({},p()),{},{success:!0},t.reportResult&&{result:E})),u("onSuccess"),E};return n?JD(C,t.name+"Success",n,()=>_=!0):C()},onError:E=>{const C=()=>{if(_)throw E;_=!0,this.sendApiInvoke(Ve(Ve({},p()),{},{success:!1,error:E})),u("onFailure",E.toString())};return n?JD(C,t.name+"Error",n,()=>_=!0):C()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:N("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:av?"global":"oversea",areas:N("AREAS")&&N("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:a,channelMode:d,isABTestSuccess:l,lsid:u,clientRole:p}=t,_=Date.now(),m=Ve(Ve({},r),{},{eventType:dn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:dv,lts:_,elapse:_-n,extend:JSON.stringify(i),mode:t.mode,process:N("PROCESS_ID"),appType:N("APP_TYPE"),success:!0,version:hi,stringUid:s,channelProfile:a,channelMode:d,isABTestSuccess:l,lsid:u,clientType:oe(E=window.navigator.userAgent).call(E,"AgoraWebView")?42:20,clientRole:p,serviceId:N("PROCESS_ID"),extensionID:N("PLUGIN_INFO").join(",")||""});var E;this.send({type:Nt.SESSION,data:m},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve({},r),{},{role:t.role,eventType:dn.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Nt.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve({},r),{},{eventType:dn.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Nt.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:a,isProxy:d}=t,l=i-n.startTime,u=Ve(Ve({},r),{},{eventType:dn.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:l,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:sv(),isABTestSuccess:t.isABTestSuccess?1:0}),p=u.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),s)this.send({type:Nt.JOIN_GATEWAY,data:u},!0);else{let _;if(a)if(d){const E=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),C=a.match(/p=[0-9]{1,6}/g);_={isSuccess:p,gatewayIp:E&&E.length?E[0].split("=")[1].replace(/-/g,"."):"",port:C&&C.length?C[0].split("=")[1]:"",isProxy:d?1:0}}else{const E=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),C=a.match(/(:|p=)[0-9]{1,6}/g);_={isSuccess:p,gatewayIp:E&&E.length?E[0].split("//")[1].replace(/-/g,"."):"",port:C&&C.length?C[0].split(/:|p=/g)[1]:"",isProxy:d?1:0}}else _={isSuccess:p,gatewayIp:"",port:"",isProxy:d?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);const m=Object.assign({},u,_,{eventType:dn.REJOIN_GATEWAY});this.send({type:Nt.RE_JOIN_GATEWAY,data:m},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=Ve(Ve({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:Nt.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve({},r),{},{eventType:dn.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Nt.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),a=Ve(Ve({},i),{},{eventType:dn.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:Nt.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...Cr(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,a=Date.now(),d=Ve(Ve({},s),{},{eventType:dn.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:Nt.WS_COMPRESSOR_INIT,data:d},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),a=Ve(Ve({},r),{},{elapse:i-n.startTime,eventType:dn.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:Nt.XLA_PEER_FIRST_VIDEO_FRAME,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),d=Ve(Ve(Ve({},s),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((r.firstFrame||a)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:d},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),d=Ve(Ve(Ve({},s),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:d},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve(Ve({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:dn.AB_TEST,lts:i});this.send({type:Nt.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve(Ve({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:dn.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Nt.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve(Ve({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:dn.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Nt.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,a=Date.now(),d=Ve(Ve(Ve({},s),r),{},{eventType:t,lts:a});this.send({type:n,data:d},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve({},r),{},{eventType:dn.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:Nt.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve({},r),{},{eventType:dn.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nt.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve({},r),{},{eventType:dn.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Nt.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?T.debug("reportProxyServerurl: ".concat(e)):T.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Nt.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(s,a,d){const l=s[a];if(!l||typeof l!="string")return[s];s[a]="";const u=Bo(JSON.stringify(s));let p=0;const _=[];let m=0;for(let E=0;E<l.length;E++)m+=l.charCodeAt(E)<=127?1:3,m<=d-u||(_[_.length]=ne(ne({},s),{},{[a]:l.substring(p,E)}),p=E,m=l.charCodeAt(E)<=127?1:3);return p!==l.length-1&&(_[_.length]=ne(ne({},s),{},{[a]:l.substring(p)})),_})(Ve(Ve(Ve({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:Nt.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve(Ve({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Nt.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve(Ve({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:Nt.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=Ve(Ve(Ve({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Nt.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>N("CUSTOM_REPORT_LIMIT"))throw new Y(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(i=>({type:Nt.USER_ANALYTICS,data:Ve(Ve({sid:e},i),{},{lts:n})}));try{N("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw T.error("send custom report message failed",i.toString()),new Y(O.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=N("NOT_REPORT_EVENT");if(e.tag&&oe(t)&&oe(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Y){const{code:l,message:u}=e.error;a=l||u||e.error.toString()}else a=e.error.toString();const d={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Nt.API_INVOKE,data:d},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):r.push(s)}e.push(...r);for(const s of[...n]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Qa(i=this.ltsList).call(i,(a,d)=>a-d))}return t||(this.lastSendNormalEventTime=Date.now()),N("ENABLE_EVENT_REPORT")&&n.length&&(N("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>a=>{N("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-N("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Yt.networkState===xr.OFFLINE&&await de.race([Yt.onlineWaiter,yn(2*Qt.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach(a=>{const d=qT(JSON.stringify(a.data)),l=new ArrayBuffer(5),u=(_=>{let m=0;return Object.entries(Nt).forEach(E=>{let[C,R]=E;R===_.type&&(m=A7[C])}),m})(a),p=new DataView(l);p.setUint16(0,d.byteLength,!0),p.setUint8(2,255&u),p.setUint8(3,u>>>8&255),p.setUint8(4,u>>>16&255),s=jD(s,new Uint8Array(l)),s=jD(s,d)}),s},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await tv(r,{timeout:1e4,data:t(e),headers:Ve(Ve({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(d=>{const l=d&&d.data.sid&&this.baseInfoMap.get(d.data.sid);return l&&l.info.vid&&+l.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(d=>JSON.stringify(d)),vid:n,aid:r};Yt.networkState===xr.OFFLINE&&await de.race([Yt.onlineWaiter,yn(2*Qt.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(N("EVENT_REPORT_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(s));for(let d=0;d<2;d+=1){d===1&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(N("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(s)));try{t?await h7(a,{timeout:1e4,data:i}):await tv(a,{timeout:1e4,data:i})}catch(l){if(d===1)throw l;continue}return}}createBaseInfo(e,t){const n=Object.assign({},w7);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Dt.TRACER}).onSuccess()}};_P.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Yt.networkState,Se.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Dt.TRACER}).onSuccess("logUploadError")});class G extends Y{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Vt(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,T)}throw(){super.throw(T)}}const Cn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ze(){return Cn}function gP(){return"setSinkId"in HTMLAudioElement.prototype&&(!N("RESTRICTION_SET_PLAYBACK_DEVICE")||(fs()||OD())&&!KT())}function r_(){return!Cn.supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&_s()}function pv(e){return!(Ut()||ND(87)||r_()||!N("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||N("FORCE_DISABLE_AUTO_SUB")))}function SP(e){return!!N("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||N("FORCE_DISABLE_AUTO_SUB"))}let In=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Pd(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function $e(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Bi(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function fv(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const b7={"90p":$e(160,90),"90p_1":$e(160,90),"120p":$e(160,120,15,30,65),"120p_1":$e(160,120,15,30,65),"120p_3":$e(120,120,15,30,50),"120p_4":$e(212,120),"180p":$e(320,180,15,30,140),"180p_1":$e(320,180,15,30,140),"180p_3":$e(180,180,15,30,100),"180p_4":$e(240,180,15,30,120),"240p":$e(320,240,15,40,200),"240p_1":$e(320,240,15,40,200),"240p_3":$e(240,240,15,40,140),"240p_4":$e(424,240,15,40,220),"360p":$e(640,360,15,80,400),"360p_1":$e(640,360,15,80,400),"360p_3":$e(360,360,15,80,260),"360p_4":$e(640,360,30,80,600),"360p_6":$e(360,360,30,80,400),"360p_7":$e(480,360,15,80,320),"360p_8":$e(480,360,30,80,490),"360p_9":$e(640,360,15,80,800),"360p_10":$e(640,360,24,80,800),"360p_11":$e(640,360,24,80,1e3),"480p":$e(640,480,15,100,500),"480p_1":$e(640,480,15,100,500),"480p_2":$e(640,480,30,100,1e3),"480p_3":$e(480,480,15,100,400),"480p_4":$e(640,480,30,100,750),"480p_6":$e(480,480,30,100,600),"480p_8":$e(848,480,15,100,610),"480p_9":$e(848,480,30,100,930),"480p_10":$e(640,480,10,100,400),"720p":$e(1280,720,15,120,1130),"720p_auto":$e(1280,720,30,900,3e3),"720p_1":$e(1280,720,15,120,1130),"720p_2":$e(1280,720,30,120,2e3),"720p_3":$e(1280,720,30,120,1710),"720p_5":$e(960,720,15,120,910),"720p_6":$e(960,720,30,120,1380),"1080p":$e(1920,1080,15,120,2080),"1080p_1":$e(1920,1080,15,120,2080),"1080p_2":$e(1920,1080,30,120,3e3),"1080p_3":$e(1920,1080,30,120,3150),"1080p_5":$e(1920,1080,60,120,4780),"1440p":$e(2560,1440,30,120,4850),"1440p_1":$e(2560,1440,30,120,4850),"1440p_2":$e(2560,1440,60,120,7350),"4k":$e(3840,2160,30,120,8910),"4k_1":$e(3840,2160,30,120,8910),"4k_3":$e(3840,2160,60,120,13500)},O7={"480p":Bi(640,480,5),"480p_1":Bi(640,480,5),"480p_2":Bi(640,480,30),"480p_3":Bi(640,480,15),"720p":Bi(1280,720,5),"720p_auto":$e(1280,720,30,900,3e3),"720p_1":Bi(1280,720,5),"720p_2":Bi(1280,720,30),"720p_3":Bi(1280,720,15),"1080p":Bi(1920,1080,5),"1080p_1":Bi(1920,1080,5),"1080p_2":Bi(1920,1080,30),"1080p_3":Bi(1920,1080,15)},N7={"1SL1TL":fv(1,1),"3SL3TL":fv(3,3),"2SL3TL":fv(2,3)};function ji(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},b7[e]):e}function _v(e){return typeof e=="string"?Object.assign({},O7[e]):e}function i_(e){return typeof e=="string"?Object.assign({},N7[e]):e}const D7={speech_low_quality:Pd(16e3,!1),speech_standard:Pd(32e3,!1,18),music_standard:Pd(48e3,!1),standard_stereo:Pd(48e3,!0,56),high_quality:Pd(48e3,!1,128),high_quality_stereo:Pd(48e3,!0,192)};function o_(e){return typeof e=="string"?Object.assign({},D7[e]):e}const kd=[];function TP(e){return cn(e,"mediaSource",["screen","window","application"]),!0}let _e=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),mt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Ld=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),P7=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),k7=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),lc=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Md=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),fi=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Ud=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Xr=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const mv={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Ev={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},vP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},L7={uplinkNetworkQuality:0,downlinkNetworkQuality:0},RP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ir=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Jr=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Mu=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),uc=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Vn=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Go=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const gv={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let s_=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Ye(e,t,n,r,i){var s,a,d={};return Object.keys(r).forEach(function(l){d[l]=r[l]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=Di(s=aI(a=n.slice()).call(a)).call(s,function(l,u){return u(e,t,l)||l},d),i&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(i):void 0,d.initializer=void 0),d.initializer===void 0?(Object.defineProperty(e,t,d),null):d}function j(e,t,n){return(t=function(r){var i=function(s,a){if(typeof s!="object"||!s)return s;var d=s[Symbol.toPrimitive];if(d!==void 0){var l=d.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yP(Object(n),!0).forEach(function(r){j(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yP(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class CP extends Lt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(lc.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),j(this,"trackMediaType",void 0),j(this,"_ID",void 0),j(this,"_rtpTransceiver",void 0),j(this,"_lowRtpTransceiver",void 0),j(this,"_hints",[]),j(this,"_isClosed",!1),j(this,"_originMediaStreamTrack",void 0),j(this,"mediaStreamTrack",void 0),j(this,"_external",{}),this._ID=n||St(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){oe(kd).call(kd,r)||kd.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||ea(()=>{var n;Se.reportApiInvoke(null,{name:Wt.GET_MEDIA_STREAM_TRACK,options:[],tag:Dt.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Ld.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=kd.indexOf(t);n!==-1&&kd.splice(n,1)}(this),this.emit(Md.CLOSED),this.removeAllListeners(lc.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===Ld.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(lc.TRANSCEIVER_UPDATED,t,n)}}class xd extends CP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),j(this,"_enabled",!0),j(this,"_muted",!1),j(this,"_isExternalTrack",!1),j(this,"_isClosed",!1),j(this,"_enabledMutex",void 0),j(this,"processor",void 0),j(this,"_processorContext",void 0),j(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new xn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(_e.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,_e.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Md.TRACK_ENDED)}stateCheck(t,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),po(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new Y(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new Y(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():de.resolve([])}}const IP=window.AudioContext||window.webkitAudioContext;let Qr=null;const pt=new class extends Lt{constructor(){super(...arguments),j(this,"prevState",void 0),j(this,"curState",void 0),j(this,"currentTime",void 0),j(this,"currentTimeStuckAt",void 0),j(this,"interruptDetectorTrack",void 0),j(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(In.IOS_15_16_INTERRUPTION_START)}),j(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(Qr&&await Qr.suspend(),this.emit(In.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){T.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){T.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Vd(){if(!Qr){if(function(){if(!IP)return void T.error("your browser is not support web audio");T.info("create audio context");const e=Rt({},N("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(e)),Qr=new IP(e),pt.curState=Qr.state,Qr.onstatechange=()=>{pt.prevState=pt.curState,pt.curState=Qr?Qr.state:void 0;const{prevState:t,curState:n}=pt,r=n==="running",i=n==="interrupted",s=t==="running",a=t==="suspended",d=t==="interrupted",l=qe().osVersion;(Yn()||Vi())&&s&&i&&(T.info("ios".concat(l,"-interruption-start")),pt.emit(In.IOS_INTERRUPTION_START)),(Yn()||Vi())&&(a||d)&&r&&(T.info("ios".concat(l,"-interruption-end")),pt.emit(In.IOS_INTERRUPTION_END)),t!==n&&pt.emit(In.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Qr)===null||t===void 0?void 0:t.currentTime;pt.currentTime!==n?(pt.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),pt.currentTimeStuckAt=void 0),pt.currentTime=n):(n!==pt.currentTimeStuckAt&&(Se.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Dt.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),pt.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,a=!1;function d(R){t.state==="running"?l(!1):Yn()||Vi()?t.state==="suspended"&&(l(!0),R&&t.resume().then(u,u)):t.state!=="closed"&&(l(!0),R&&t.resume().then(u,u))}function l(R){if(i!==R){i=R;for(let y=0,b=n;y<b.length;y+=1){const A=b[y];R?window.addEventListener(A,p,{capture:!0,passive:!0}):window.removeEventListener(A,p,{capture:!0,passive:!0})}}}function u(){d(!1)}function p(){d(!0)}function _(R){if(!a)if(r.paused)if(R){let y;m(!1),a=!0;try{y=r.play(),y?y.then(E,E):(r.addEventListener("playing",E),r.addEventListener("abort",E),r.addEventListener("error",E))}catch{E()}}else m(!0);else m(!1)}function m(R){if(s!==R){s=R;for(let y=0,b=n;y<b.length;y++){const A=b[y];R?window.addEventListener(A,C,{capture:!0,passive:!0}):window.removeEventListener(A,C,{capture:!0,passive:!0})}}}function E(){r.removeEventListener("playing",E),r.removeEventListener("abort",E),r.removeEventListener("error",E),a=!1,_(!1)}function C(){_(!0)}if(Yn()){const R=t.createMediaStreamDestination(),y=document.createElement("div");y.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=y.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=R.stream,_(!0)}pt.on(In.STATE_CHANGE,function(){d(!0)}),d(!1)}(Qr)}(),!Qr)throw new Y(O.NOT_SUPPORTED,"can not create audio context");return Qr}return Qr}function hc(e){if(function(){if(Sv!==null)return Sv;const r=Vd(),i=r.createBufferSource(),s=r.createGain(),a=r.createGain();i.connect(s),i.connect(a),i.disconnect(s);let d=!1;try{i.disconnect(s)}catch{d=!0}return i.disconnect(),Sv=d,d}())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,s)=>{var a;return e._inputNodes||(e._inputNodes=[]),oe(a=e._inputNodes).call(a,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,s)):t.call(e,r,i)),e},e.disconnect=(r,i,s)=>{n.call(e),r?Xf(e._inputNodes,r):e._inputNodes=[];for(const a of e._inputNodes)t.call(e,a)}}let Sv=null;function Tv(e,t){let n=!1;const r=1/t;if(N("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=Vd();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const a=()=>{if(n)return void(s=null);const d=i.createOscillator();d.onended=a,d.connect(s),d.start(0),d.stop(i.currentTime+r),e(i.currentTime)};a()}return()=>{n=!0}}class wP{constructor(){j(this,"context",void 0),j(this,"analyserNode",void 0),j(this,"sourceNode",void 0),this.context=Vd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Yn()||Vi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=Di(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class AP extends Lt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),j(this,"outputNode",void 0),j(this,"outputTrack",void 0),j(this,"isPlayed",!1),j(this,"sourceNode",void 0),j(this,"context",void 0),j(this,"audioBufferNode",void 0),j(this,"destNode",void 0),j(this,"audioOutputLevel",0),j(this,"volumeLevelAnalyser",void 0),j(this,"_processedNode",void 0),j(this,"playNode",void 0),j(this,"isDestroyed",!1),j(this,"onNoAudioInput",void 0),j(this,"isNoAudioInput",!1),j(this,"_noAudioInputCount",0),this.context=Vd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),hc(this.outputNode),this.volumeLevelAnalyser=new wP}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Xr.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let a=0;a<s.length;a+=1)s[a]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ze().webAudioMediaStreamDest)throw new Y(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Jf(()=>{pt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Yn()||Vi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await yn(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bP extends AP{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),j(this,"sourceNode",void 0),j(this,"track",void 0),j(this,"clonedTrack",void 0),j(this,"audioElement",void 0),j(this,"isCurrentTrackCloned",!1),j(this,"isRemoteTrack",!1),j(this,"originVolumeLevelAnalyser",void 0),j(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const d=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?d.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),hc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),hc(this.outputNode),this.emit(Xr.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Y(O.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),hc(this.sourceNode),r){const d=r.clone();d.enabled=!0,this.clonedTrack=d,T.debug("create an unmuted track ".concat(d.id," from the original track ").concat(r.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([d]));hc(l),this.originVolumeLevelAnalyser=new wP,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const a=qe();n&&a.os===hn.IOS&&Number((i=a.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(pt.on(In.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(d=>{d||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),hc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Xr.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),pt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));hc(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function OP(e,t,n){const r=(s,a)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||a:s:a,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function M7(e,t){const n=await NP(e.mediaSource),{sourceId:r,audio:i}=await function(s){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new de((d,l)=>{const u=document.createElement("div");u.innerText="share screen",u.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const E=document.createElement("div");E.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const C=document.createElement("button");C.innerHTML="cancel",C.setAttribute("style","width: 85px;"),C.onclick=()=>{document.body.removeChild(b);const A=new Error("NotAllowedError");A.name="NotAllowedError",l(A)};let R=a;const y=document.createElement("div");if(a){const A=document.createElement("input");A.setAttribute("type","checkbox");const D=document.createElement("span");A.setAttribute("style","margin-right: 6px;"),D.innerText="Share audio",A.checked=R,A.onchange=()=>{R=A.checked},y.appendChild(A),y.appendChild(D)}E.appendChild(y),E.appendChild(C),p.appendChild(_),p.appendChild(m),p.appendChild(E);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(u),b.appendChild(p),document.body.appendChild(b),s.map(A=>{if(A.id){const D=document.createElement("div");D.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let V=A.thumbnail;try{const{width:x}=V.getSize();x>1920&&(V=V.resize({width:1920}))}catch(x){throw x&&x.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),x}D.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+V.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+A.name.replace(/[\u00A0-\u9999<>\&]/g,function(x){return"&#"+x.charCodeAt(0)+";"})+"</span>",D.onclick=()=>{document.body.removeChild(b),d({sourceId:A.id,audio:R})},m.appendChild(D)}})})}(n,t);return await OP(r,e,i)}async function NP(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=GD();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Y(O.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new de((s,a)=>{n.desktopCapturer.getSources({types:t},(d,l)=>{d?a(d):s(l)})}));try{return await r}catch(s){throw new Y(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const vv=new xn("safari");let DP=!1,PP=!1;async function Zr(e,t){let n=0,r=null;for(;n<2;)try{r=await U7(e,t,n>0);break}catch(i){if(i instanceof Y)throw T.error("[".concat(t,"] ").concat(i.toString())),i;const s=a_(i.name||i.code||i,i.message);if(s.code===O.MEDIA_OPTION_INVALID){T.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await yn(500);continue}throw T.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new Y(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function U7(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Y(O.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ze(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return T.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(GD())e.screen.sourceId?Fd(i,await OP(e.screen.sourceId,e.screen,!!e.screenAudio)):Fd(i,await M7(e.screen,!!e.screenAudio));else if(fs()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new Y(O.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const m=await(a=e.screen.extensionId,d=t,new de((E,C)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},R=>{if(!R||!R.streamId)return T.error("[".concat(d,"] No response from Chrome Plugin. Plugin not installed properly"),R),void C(new Y(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));E(R.streamId)})}catch(R){T.error("[".concat(d,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),R.toString()),C(new Y(O.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=m,Fd(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&TP(e.screen.mediaSource);const m={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:E,surfaceSwitching:C,systemAudio:R,preferCurrentTab:y}=e.screen,b={selfBrowserSurface:E,surfaceSwitching:C,systemAudio:R,preferCurrentTab:y};!E&&delete b.selfBrowserSurface,!C&&delete b.surfaceSwitching,!R&&delete b.systemAudio,!y&&delete b.preferCurrentTab,T.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:m,audio:e.screenAudio,controls:b})),Fd(i,await navigator.mediaDevices.getDisplayMedia(Rt({video:m,audio:e.screenAudio},b)))}else{if(!Ut())throw T.error("[".concat(t,"] This browser does not support screenSharing")),new Y(O.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&TP(e.screen.mediaSource);const m={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};T.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(m))),Fd(i,await navigator.mediaDevices.getUserMedia(m))}}var a,d;if(!e.video&&!e.audio)return i;let l={video:e.video,audio:e.audio},u=N("MEDIA_DEVICE_CONSTRAINTS");if(u)try{typeof u=="string"&&(u=JSON.parse(u)),l=QT(l,u)}catch{}T.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),qe();let p,_=null;(Nn()||Yn()||Yf())&&(_=await vv.lock());try{p=await navigator.mediaDevices.getUserMedia(l)}catch(m){throw _&&_(),m}return l.audio&&(DP=!0),l.video&&(PP=!0),Fd(i,p),_&&_(),i}function a_(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Y(O.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Y(O.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Y(O.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Y(O.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Y(O.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Y(O.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return T.error("getUserMedia unexpected error",e),new Y(O.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Fd(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const $r=new class extends Lt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(uc.STATE_CHANGE,e),this._state=e)}constructor(){super(),j(this,"_state",Mu.IDLE),j(this,"isAccessMicrophonePermission",!1),j(this,"isAccessCameraPermission",!1),j(this,"lastAccessMicrophonePermission",!1),j(this,"lastAccessCameraPermission",!1),j(this,"checkdeviceMatched",!1),j(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(N("ENUMERATE_DEVICES_INTERVAL")||(qf()||zf()===hn.HARMONY_OS)&&_s())&&this.updateDevicesInfo()},N("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>T.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Y(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(a=!1);let d=null,l=null,u=null;if(!n&&(s||a)){if(vv.isLocked&&(T.debug("[device manager] wait GUM lock"),(await vv.lock())(),T.debug("[device manager] GUM unlock")),DP&&(s=!1,this.isAccessMicrophonePermission=!0),PP&&(a=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",e,t,s,a),s&&a){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const _=a_(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;T.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{d=await navigator.mediaDevices.getUserMedia({audio:e})}catch(p){const _=a_(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;T.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(p){const _=a_(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;T.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",e,"cam permission",t)}try{const p=await navigator.mediaDevices.enumerateDevices();return d&&d.getTracks().forEach(_=>_.stop()),l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),d=null,l=null,u=null,p}catch(p){return d&&d.getTracks().forEach(_=>_.stop()),l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),d=null,l=null,u=null,new Y(O.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new Y(O.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Mu.INITING;try{await this.updateDevicesInfo(),this.state=Mu.INITEND}catch(e){throw T.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Mu.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Y(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(a=>a.kind==="audioinput"&&a.deviceId==="default"),s=e.find(a=>a.kind==="audiooutput"&&a.deviceId==="default");i&&s?s.groupId===i.groupId?T.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):T.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):T.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const a={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),a),n.push(a)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Mu.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(uc.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(uc.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(uc.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let Rv=!1;const ei=new class extends Lt{constructor(){super(...arguments),j(this,"onAutoplayFailed",void 0),j(this,"onAudioAutoplayFailed",void 0)}};function kP(){if(qe(),!Rv){const e=t=>{t.preventDefault(),Rv=!1,Iu()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Rv=!0,Iu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ei.onAutoplayFailed?ei.onAutoplayFailed():ei.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ei.emit("autoplay-failed")}}function LP(e,t,n,r){if(!e)return;const i=Se.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,a=Date.now(),d=Rt(Rt({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:a,elapse:a-i.startTime,cbRegistered:ei.onAutoplayFailed||ei.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});Se.send({type:Nt.AUTOPLAY_FAILED,data:d},!0)}const x7=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],fr=new class{constructor(){j(this,"onAutoplayFailed",void 0),j(this,"elementMap",new Map),j(this,"elementStateMap",new Map),j(this,"elementsNeedToResume",[]),j(this,"sinkIdMap",new Map),j(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],a=s&&s.readyState;if(T.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),a==="live"){if(e)return r.pause(),void r.play();if(pt.curState==="running")return Id()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),j(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),pt.on(In.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pt.on(In.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),pt.on(In.STATE_CHANGE,()=>{Yn()&&pt.prevState==="suspended"&&pt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new Y(O.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Vn.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch(d=>{T.warning("[".concat(t,"] set sink id failed"),d.toString())})}catch(d){T.warning("[".concat(t,"] set sink id failed"),d.toString())}const a=i.play();a&&a.then&&a.catch(d=>{r&&LP(r,"audio",d.message,t),T.warning("audio element play warning",d.toString()),this.elementMap.has(t)&&d.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Jf(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),kP()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){x7.forEach(n=>{t.addEventListener(n,r=>{const i=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(T.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const a=t==null?void 0:t.error;a&&T.error("[".concat(e,"] media error, code: ").concat(a.code,", message: ").concat(a.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new de(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Iu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function jt(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new Y(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];const d=r.apply(this,s);return d instanceof de?new de((l,u)=>{d.then(l).catch(u)}):d}),n}}class MP extends Lt{constructor(t){super(),j(this,"name","VideoProcessorDestination"),j(this,"ID","0"),j(this,"_source",void 0),j(this,"videoContext",void 0),j(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Y(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Y(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ir.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ir.ON_TRACK,void 0)}}class UP extends Lt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),j(this,"constraintsMap",new Map),j(this,"statsRegistry",[]),j(this,"usageRegistry",[]),j(this,"trackId",void 0),j(this,"direction",void 0),j(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Pn(this,Jr.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),gt(this,Jr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return T.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),gt(this,Jr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const a=s();t.push({processorID:n,processorName:r,type:i,stats:a})}catch(a){T.error(new Y(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof de&&(r=await r),t.push(Rt(Rt({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class xP extends Lt{constructor(t){super(),j(this,"name","AudioProcessorDestination"),j(this,"ID","0"),j(this,"inputTrack",void 0),j(this,"inputNode",void 0),j(this,"audioProcessorContext",void 0),j(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Y(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Y(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ir.ON_TRACK,void 0),this.emit(ir.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ir.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ir.ON_NODE,this.inputNode))}}class VP extends Lt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),j(this,"constraintsMap",new Map),j(this,"statsRegistry",[]),j(this,"audioContext",void 0),j(this,"trackId",void 0),j(this,"direction",void 0),j(this,"usageRegistry",[]),j(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Pn(this,Jr.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),gt(this,Jr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),gt(this,Jr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const a=s();t.push({processorID:n,processorName:r,type:i,stats:a})}catch(a){T.error(new Y(O.UNEXPECTED_ERROR,a.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof de&&(r=await r),t.push(Rt(Rt({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class yv extends Lt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),j(this,"context",void 0),j(this,"processSourceNode",void 0),j(this,"outputTrack",void 0),j(this,"processedNode",void 0),j(this,"clonedTrack",void 0),j(this,"outputNode",void 0),this.outputNode=new V7}setVolume(){}createOutputTrack(){throw new Y(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class V7{disconnect(){}connect(){}}function FP(e){return new de((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=Yn()?"canplay":"playing";i.addEventListener(s,()=>{const a=i.videoWidth,d=i.videoHeight;!a&&Ut()||(r=!0,i.srcObject=null,i.remove(),t([a,d]))}),i.srcObject=new MediaStream([e]),i.play().catch(Qf),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function c_(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=ji(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!xD()&&n.frameRate&&(t.frameRate=n.frameRate),OD()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Ut()&&(t.frameRate={ideal:30,max:30}),t}function BP(e){const t={};return xD()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,fs()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function jP(e){const t=BP(e);if(e.encoderConfig){const n=o_(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),qf()&&(t.sampleRate=void 0),t}const F7=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:a=r,height:d=i}=t;if(!s||!a||!d)return;a=bd(a),d=bd(d),s=bd(s);const{max:l,min:u}=function(E,C,R){const y=200*Math.pow(R/15,.6)*Math.pow(E*C/640/360,.75);return{min:Math.floor(y),max:Math.floor(4*y)}}(a,d,s),{bitrateMax:p,bitrateMin:_}=t||{};p||T.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(d,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(_,"]"));const{maxFramerate:m}=N("ENCODER_CONFIG_LIMIT");return m&&typeof m=="number"&&(s=Math.min(s,m)),{frameRate:s,bitrateMax:p||l,bitrateMin:_||u,scaleResolutionDownBy:1,scale:0}},GP=async(e,t,n)=>await(async(r,i,s)=>{const a=function(u){const p=[];for(let _=0;_<u.length;_+=2)p.push(parseInt(u.slice(_,_+2),16));return Uint8Array.from(p)}($D(""+i+s)).slice(0,16),d=a.slice(0,12),l=await window.crypto.subtle.importKey("raw",a,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},l,r))})(e.buffer,t,n),Cv=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new de((n,r)=>{t.toBlob(async i=>{if(t.remove(),i){const s=await WP(i);n({buffer:s,width:t.width,height:t.height})}else r(new Y(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},WP=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var HP,KP,zP,YP,qP,XP,JP,QP,ZP,$P,ek,tk,nk,rk,ik,ok,sk,ak,Mt,ck,dk,lk,uk,hk,pk,Wo,fk,_k,mk,Ek,gk,Sk,Tk,vk,Rk,yk,Ck,Ik,wk,Ln;let Gt=(HP=Ce({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),KP=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),zP=jt(),YP=Od("LocalAudioTrack","_enabledMutex"),qP=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),XP=jt(),JP=Od("LocalAudioTrack","_enabledMutex"),QP=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),ZP=jt(),$P=jt(),ek=jt(),tk=Ce({argsMap:e=>[e.getTrackId()]}),nk=jt(),rk=Ce({argsMap:e=>[e.getTrackId()]}),ik=jt(),ok=Ce({argsMap:e=>[e.getTrackId()]}),sk=Ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ak=Ce({argsMap:e=>[e.getTrackId()]}),Ye((Mt=class extends xd{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?fr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),j(this,"trackMediaType",Ud.AUDIO),j(this,"_encoderConfig",void 0),j(this,"_trackSource",void 0),j(this,"metadata",[]),j(this,"_enabled",!0),j(this,"_volume",100),j(this,"_useAudioElement",!0),j(this,"_bypassWebAudio",!1),j(this,"processor",void 0),j(this,"_processorContext",void 0),j(this,"_processorDestination",void 0),j(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new yv,N("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),N("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Nn()&&!Qr?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){_t(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&fr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,gt(this,_e.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!gP())throw new Y(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await gt(this,_e.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await gt(this,_e.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await gt(this,_e.NEED_MUTE_TRACK,this):await gt(this,_e.NEED_UNMUTE_TRACK,this))}getStats(){return ea(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Yr(this,_e.GET_STATS)||Rt({},mv)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Xr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Xr.ON_AUDIO_BUFFER),this._source.on(Xr.ON_AUDIO_BUFFER,n=>e(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),fr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?fr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,_e.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return de.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Y(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ir.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await gt(this,_e.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,_e.NEED_REPLACE_TRACK,this))}),e.on(ir.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ir.ON_TRACK),e.removeAllListeners(ir.ON_NODE)}bindProcessorContextEvents(e){e.on(Jr.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Jr.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof yv&&(this._trackSource=new bP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new VP(this._source.context,this.getTrackId(),"local"),t=new xP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Xr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(fr.stop(this.getTrackId()),this._source.play()),gt(this,_e.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[HP],Object.getOwnPropertyDescriptor(Mt.prototype,"setVolume"),Mt.prototype),Ye(Mt.prototype,"setPlaybackDevice",[KP,zP],Object.getOwnPropertyDescriptor(Mt.prototype,"setPlaybackDevice"),Mt.prototype),Ye(Mt.prototype,"setEnabled",[YP,qP,XP],Object.getOwnPropertyDescriptor(Mt.prototype,"setEnabled"),Mt.prototype),Ye(Mt.prototype,"setMuted",[JP,QP,ZP],Object.getOwnPropertyDescriptor(Mt.prototype,"setMuted"),Mt.prototype),Ye(Mt.prototype,"getStats",[$P],Object.getOwnPropertyDescriptor(Mt.prototype,"getStats"),Mt.prototype),Ye(Mt.prototype,"setAudioFrameCallback",[ek],Object.getOwnPropertyDescriptor(Mt.prototype,"setAudioFrameCallback"),Mt.prototype),Ye(Mt.prototype,"play",[tk,nk],Object.getOwnPropertyDescriptor(Mt.prototype,"play"),Mt.prototype),Ye(Mt.prototype,"stop",[rk,ik],Object.getOwnPropertyDescriptor(Mt.prototype,"stop"),Mt.prototype),Ye(Mt.prototype,"close",[ok],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),Ye(Mt.prototype,"pipe",[sk],Object.getOwnPropertyDescriptor(Mt.prototype,"pipe"),Mt.prototype),Ye(Mt.prototype,"unpipe",[ak],Object.getOwnPropertyDescriptor(Mt.prototype,"unpipe"),Mt.prototype),Mt),Uu=(ck=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),dk=jt(),lk=Od("MicrophoneAudioTrack","_enabledMutex"),uk=Ce({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),hk=jt(),pk=Ce({argsMap:e=>[e.getTrackId()]}),Ye((Wo=class extends Gt{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?o_(t.encoderConfig):{},r,N("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),j(this,"_config",void 0),j(this,"_deviceName","default"),j(this,"_constraints",void 0),j(this,"_originalConstraints",void 0),j(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Id()||HT())&&pt.bindInterruptDetectorTrack(this)}async setDevice(e){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await $r.getDeviceById(e),n={};n.audio=Rt({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Zr(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Zr({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await $r.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}T.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),N("AUTO_RESET_AUDIO_ROUTE")&&(Yn()||Vi())){const a=navigator.audioSession;a&&(e||(a.type="playback"),a.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await gt(this,_e.NEED_DISABLE_TRACK,this)}catch(a){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),a.toString()),a}return}const i=Rt({},this._constraints),s=$r.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const a=await Zr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),await gt(this,_e.NEED_ENABLE_TRACK,this)}catch(a){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),a.toString()),a}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Id()||HT())&&pt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Yn()||Vi())&&this._enabled&&!this._isClosed&&pt.duringInterruption){const e=async()=>{pt.off(In.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pt.on(In.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Md.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=$r.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Zr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Jr.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Jr.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[ck,dk],Object.getOwnPropertyDescriptor(Wo.prototype,"setDevice"),Wo.prototype),Ye(Wo.prototype,"setEnabled",[lk,uk,hk],Object.getOwnPropertyDescriptor(Wo.prototype,"setEnabled"),Wo.prototype),Ye(Wo.prototype,"close",[pk],Object.getOwnPropertyDescriptor(Wo.prototype,"close"),Wo.prototype),Wo),B7=(fk=Ce({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),_k=jt(),mk=Ce({argsMap:e=>[e.getTrackId()]}),Ek=jt(),gk=Ce({argsMap:e=>[e.getTrackId()]}),Sk=jt(),Tk=Ce({argsMap:e=>[e.getTrackId()]}),vk=jt(),Rk=Ce({argsMap:e=>[e.getTrackId()]}),yk=jt(),Ck=Ce({argsMap:e=>[e.getTrackId()]}),Ik=Ce({argsMap:e=>[e.getTrackId()]}),wk=jt(),Ye((Ln=class extends Gt{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),j(this,"source",void 0),j(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Xr.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(Md.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){_t(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[fk,_k],Object.getOwnPropertyDescriptor(Ln.prototype,"startProcessAudioBuffer"),Ln.prototype),Ye(Ln.prototype,"pauseProcessAudioBuffer",[mk,Ek],Object.getOwnPropertyDescriptor(Ln.prototype,"pauseProcessAudioBuffer"),Ln.prototype),Ye(Ln.prototype,"seekAudioBuffer",[gk,Sk],Object.getOwnPropertyDescriptor(Ln.prototype,"seekAudioBuffer"),Ln.prototype),Ye(Ln.prototype,"resumeProcessAudioBuffer",[Tk,vk],Object.getOwnPropertyDescriptor(Ln.prototype,"resumeProcessAudioBuffer"),Ln.prototype),Ye(Ln.prototype,"stopProcessAudioBuffer",[Rk,yk],Object.getOwnPropertyDescriptor(Ln.prototype,"stopProcessAudioBuffer"),Ln.prototype),Ye(Ln.prototype,"close",[Ck],Object.getOwnPropertyDescriptor(Ln.prototype,"close"),Ln.prototype),Ye(Ln.prototype,"setAudioBufferPlaybackSpeed",[Ik,wk],Object.getOwnPropertyDescriptor(Ln.prototype,"setAudioBufferPlaybackSpeed"),Ln.prototype),Ln);class rn extends Gt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Vd().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,St(8,"track-mix-")),j(this,"trackList",void 0),j(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(T.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):T.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){T.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Xf(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof rn?n.emit(lc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class j7 extends AP{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Xr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),j(this,"audioBuffer",void 0),j(this,"sourceNode",void 0),j(this,"startPlayTime",0),j(this,"startPlayOffset",0),j(this,"pausePlayTime",0),j(this,"options",void 0),j(this,"currentLoopCount",0),j(this,"currentPlaybackSpeed",100),j(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Ak=new Map;function bk(e,t){if(e.length===0||t.length===0)return 1/0;const n=ZT(e),r=ZT(t);return Math.floor(r/n)}class Iv{get rendFrameRate(){const t=Math.max(1,bk(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Vn.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){j(this,"trackId",void 0),j(this,"config",void 0),j(this,"onFirstVideoFrameDecoded",void 0),j(this,"onFirstVideoFrameRender",void 0),j(this,"onVideoStateChanged",void 0),j(this,"freezeTimeCounterList",[]),j(this,"renderFreezeAccTime",0),j(this,"renderFreezeAccTime2",0),j(this,"isKeepLastFrame",!1),j(this,"isDestroyed",!1),j(this,"timeUpdatedCount",0),j(this,"freezeTime",0),j(this,"playbackTime",0),j(this,"lastTimeUpdatedTime",0),j(this,"autoplayFailed",!1),j(this,"videoTrack",void 0),j(this,"videoElement",void 0),j(this,"cacheVideoElement",void 0),j(this,"internal",!1),j(this,"_render_interframe_delays",[]),j(this,"_render_interframe_delays_sizes",[]),j(this,"_videoState",Go.VideoStateStopped),j(this,"videoElementCheckInterval",void 0),j(this,"videoElementFreezeTimeout",void 0),j(this,"_videoElementStatus",Vn.NONE),j(this,"_isInPage",!0),j(this,"isGettingVideoDimensions",!1),j(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),j(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&pt.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(AD())),MD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),j(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&T.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Vn.PLAYING;break;case"loadeddata":if(this.videoState=Go.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Vn.CANPLAY;break;case"stalled":this.videoElementStatus=Vn.STALLED;break;case"suspend":this.videoElementStatus=Vn.SUSPEND;break;case"pause":this.videoElementStatus=Vn.PAUSED,Yn()||Vi()||Nn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Vn.WAITING;break;case"abort":this.videoElementStatus=Vn.ABORT;break;case"ended":this.videoElementStatus=Vn.ENDED;break;case"emptied":this.videoElementStatus=Vn.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=Vn.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Ho.lastVisibleTime<Ho.lastHiddenTime||s<Ho.lastHiddenTime||s<Ho.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>N("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const a=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(a),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),j(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(AD())),MD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),pt.on(In.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pt.on(In.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&LP(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),i)});const r=qe();if((r.name==="Safari"&&Number(r.version)===15||Id())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new de((s,a)=>{r.toBlob(async d=>{if(r.remove(),d){const l=await WP(d);s({buffer:l,width:r.width,height:r.height})}else a(new Y(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await Cv(t)}destroy(){this.isDestroyed=!0,pt.off(In.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pt.off(In.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Go.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Vn.INIT,!this.videoElementCheckInterval&&(Ok.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(s){return s!==document.body&&document.body.contains(s)}(this.videoElement)},1e3),N("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const a=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",a),this.videoElementFreezeTimeout=window.setTimeout(d,N("VIDEO_FREEZE_DURATION")))},d=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Go.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Go.VideoStateFrozen:document.addEventListener("visibilitychange",a))},l=(u,p)=>{if(this.videoElementStatus===Vn.PLAYING){if(s){const E=p.presentationTime-s.presentationTime,C=p.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(C),this._render_interframe_delays.push(E);const R=ZT(this._render_interframe_delays_sizes),y=R-this._render_interframe_delays_sizes[0];if(R>30&&y>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Go.VideoStateStarting&&(this.videoState=Go.VideoStateDecoding),this.videoState===Go.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(d,N("VIDEO_FREEZE_DURATION"))),E<N("VIDEO_FREEZE_DURATION")&&this.videoState===Go.VideoStateFrozen&&(this.videoState=Go.VideoStateDecoding),E>N("VIDEO_FREEZE_DURATION")&&Ho.lastVisibleTime>=Ho.lastHiddenTime&&s.timestamp>Ho.lastVisibleTime&&s.timestamp>Ho.lastHiddenTime){const b=Math.min(66,bk(this._render_interframe_delays_sizes,this._render_interframe_delays)),A=Math.max(0,E-(C-1)*b);this.renderFreezeAccTime2+=A>b?A:0,this.renderFreezeAccTime+=E}}s=Rt(Rt({},p),{},{timestamp:u})}else this.isSkipCalcRenderFreezeTime()&&(s=Rt(Rt({},p),{},{timestamp:u}));var _,m;N("ENABLE_VIDEO_FRAME_CALLBACK")&&((_=(m=this.videoElement).requestVideoFrameCallback)===null||_===void 0||_.call(m,l))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,l)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),qf()&&!N("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=qe();r.name==="Safari"&&Number(r.version)===15||Id()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ut()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ut()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{T.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){Ok.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Vn.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Vn.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{T.error(r)}),this.autoplayFailed=!1,Iu()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Iu()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),kP()}}const Ok=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class wv extends Iv{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),j(this,"container",void 0),j(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await Cv(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",N("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Nk,Dk,Pk,kk,Lk,Mk,Uk,xk,Vk,Fk,Bk,jk,Gk,Wk,Hk,Kk,zk,Yk,qk,Xk,Jk,Qk,Zk,$k,e1,t1,n1,r1,We,i1,o1,s1,a1,c1,d1,l1,u1,ti;let Ct=(Nk=Ce({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Dk=jt(),Pk=Ce({argsMap:e=>[e.getTrackId()]}),kk=Od("LocalVideoTrack","_enabledMutex"),Lk=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),Mk=jt(),Uk=Od("LocalVideoTrack","_enabledMutex"),xk=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),Vk=jt(),Fk=Ce({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),Bk=jt(),jk=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),Gk=jt(),Wk=jt(),Hk=Ce({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Kk=jt(),zk=jt(),Yk=jt(),qk=Ce({argsMap:e=>[e.getTrackId()]}),Xk=jt(),Jk=jt(),Qk=jt(),Zk=jt(),$k=jt(),e1=Ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),t1=Ce({argsMap:e=>[e.getTrackId()]}),n1=Ce({argsMap:e=>[e.getTrackId()]}),r1=Ce({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),We=class bB extends xd{get videoHeight(){if(Nn()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Nn()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,s,a){if(super(t,s),j(this,"trackMediaType",Ud.VIDEO),j(this,"_player",void 0),j(this,"isUseScaleResolutionDownBy",!1),j(this,"_videoVisibleTimer",null),j(this,"_previousVideoVisibleStatus",void 0),j(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),j(this,"_encoderConfig",void 0),j(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),j(this,"_optimizationMode",void 0),j(this,"_saveEncodeBitrateRatio",1),j(this,"_videoHeight",void 0),j(this,"_videoWidth",void 0),j(this,"_forceBitrateLimit",void 0),j(this,"_enabled",!0),j(this,"_processorDestination",void 0),j(this,"_processorContext",void 0),Nn()){const{width:d,height:l}=t.getSettings();this._videoWidth=d,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=a||[],n&&this._hints.indexOf(mt.CUSTOM_TRACK)!==-1?this._encoderConfig=Pt(n):this._encoderConfig=n,this._hints.indexOf(mt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(FT(tt.CHROME,115)&&zf().indexOf("Windows")!==-1){const d=function(l,u){if("VideoFrame"in window&&"TransformStream"in window&&Ze().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(l),_=new MediaStreamTrackGenerator({kind:"video"});let m,E,C=Date.now();const R=()=>{y&&(clearInterval(y),y=void 0),m&&(m.close(),m=void 0),l.stop(),E=void 0,_.removeEventListener("ended",R)};let y=window.setInterval(()=>{if(E&&m&&Date.now()-C>(u??1e3))try{_.readyState==="live"?E.enqueue(m.clone()):R()}catch{R()}},u??1e3);const b=new TransformStream({transform:(A,D)=>{_.readyState==="live"?(E=D,C=Date.now(),m===void 0?(m=A,D.enqueue(A.clone())):(D.enqueue(m),m=A)):A.close()}});return _.addEventListener("ended",R),p.readable.pipeThrough(b).pipeTo(_.writable),_}}(t);d&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=d)}n&&this._hints.indexOf(mt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new UP(this.getTrackId(),"local"),this._processorDestination=new MP(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=Rt(Rt(Rt({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new Iv(r):this._player=new wv(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Md.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await gt(this,_e.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await gt(this,_e.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await gt(this,_e.NEED_MUTE_TRACK,this):await gt(this,_e.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),T.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await gt(this,_e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Y(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=ji(t),N("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=c_({encoderConfig:t});(Nn()||Yn()||Vi())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new Y(O.UNEXPECTED_ERROR,i.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(mt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gt(this,_e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(T)}}getStats(){return ea(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Yr(this,_e.GET_STATS)||Rt({},Ev)}async setBeautyEffect(t){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await Cv(t)}async findClosestProfile(){const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:a}=this._encoderConfig||{},d=bd(this._videoWidth||t||i||0),l=bd(this._videoHeight||n||s||0),u=function(p,_,m){if(!Array.isArray(N("VIDEO_ENCODER_CONFIG_LIST"))||N("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const E=Math.min(p,_);return!(E>=480)&&Rt(Rt({},N("VIDEO_ENCODER_CONFIG_LIST").find(C=>C.height>E)),{},{frameRate:m})}(d,l,bd(r||a||15));if(u)return T.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(d,"x").concat(l," => ").concat(JSON.stringify(u))),this.setEncoderConfiguration(u)}async setBitrateLimit(t){T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void T.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await gt(this,_e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return T.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){FP(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Qf)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Y(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=ji(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(mt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gt(this,_e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:a,min:d}=function(l,u,p,_,m){const E=N("BITRATE_ADAPTER_TYPE");if(E==="DEFAULT_BITRATE")return{min:_,max:m};if(m===void 0){const C=Math.floor(200*Math.pow(p/15,.6)*Math.pow(l*u/640/360,.75));m=E==="STANDARD_BITRATE"?4*C:2*C,_=_??C}else _=_??Math.floor(m/10);return{min:_,max:m}}(t,n,r,s,i);if(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=a,N("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){const[l,u]=function(p,_,m){const E=4*Math.floor(2e5*Math.pow(m/15,.6)*Math.pow(p*_/230400,.75)),C=p*_,R=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),y=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let b=Lr(R).call(R).next().value,A=1;if(R.has(C))b=R.get(C);else{var D;const te=Qa(D=Array.from(R.entries())).call(D,(Ge,Oe)=>{let[it]=Ge,[nt]=Oe;return it-nt}),Fe=te.find(Ge=>{let[Oe]=Ge;return Oe>C});if(Fe){const Ge=te.indexOf(Fe);if(Ge>0){const Oe=te[Ge-1],it=(C-Oe[0])/(Fe[0]-Oe[0]);b=Oe[1]+it*(Fe[1]-Oe[1])}else b=Fe[1]}else b=te[te.length-1][1]}if(y.has(C))A=y.get(C);else{var V;const te=Qa(V=Array.from(y.entries())).call(V,(Ge,Oe)=>{let[it]=Ge,[nt]=Oe;return it-nt}),Fe=te.find(Ge=>{let[Oe]=Ge;return Oe>C});if(Fe){const Ge=te.indexOf(Fe);if(Ge>0){const Oe=te[Ge-1],it=(C-Oe[0])/(Fe[0]-Oe[0]);A=Oe[1]+it*(Fe[1]-Oe[1])}else A=Fe[1]}else A=te[te.length-1][1]}const x=N("VIDEO_NEW_BITRATE_RATIO");x&&x>0&&(b=x/100);const k=Math.floor(E*b),B=Math.floor(65e4*Math.pow(p*_/230400,.5)*Math.pow(m/15,.69));let q=k;const Z=N("VIDEO_STANDARD_BITRATE_VERSION");return Z&&Z>0&&(Z===1?q=E:Z===2?q=k:Z===3&&(q=B)),[Math.floor(q/1e3),A]}(t,n,r);this._encoderConfig.bitrateMax=l,this._encoderConfig.bitrateMin=d?Math.min(d,l):l,this._saveEncodeBitrateRatio=u,T.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(a,", brMin: ").concat(d,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:s,slot:a}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&a instanceof HTMLElement){const d=BD.checkOneElementVisible(s),l=Object.assign({},d);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=Se.reportApiInvoke(null,{tag:Dt.TRACER,name:Wt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(r){throw new Y(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Rt(Rt({},r),ji(t))),r=sc(r);const i=St(8,"track-video-cloned-"),s=new bB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,sc(this._scalabilityMode),this._optimizationMode,i,sc(this._hints));return t&&r&&s.setEncoderConfiguration(r),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new Y(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Y(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(ea(()=>{Se.reportApiInvoke(null,{name:Wt.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Dt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!N("ENABLE_VIDEO_SEI")||!N("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Y(O.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):T.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(ir.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await gt(this,_e.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,_e.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ir.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Jr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Jr.REQUEST_CONSTRAINTS)}},Ye(We.prototype,"play",[Nk,Dk],Object.getOwnPropertyDescriptor(We.prototype,"play"),We.prototype),Ye(We.prototype,"stop",[Pk],Object.getOwnPropertyDescriptor(We.prototype,"stop"),We.prototype),Ye(We.prototype,"setEnabled",[kk,Lk,Mk],Object.getOwnPropertyDescriptor(We.prototype,"setEnabled"),We.prototype),Ye(We.prototype,"setMuted",[Uk,xk,Vk],Object.getOwnPropertyDescriptor(We.prototype,"setMuted"),We.prototype),Ye(We.prototype,"setSaveEncodeBitrateRatio",[Fk,Bk],Object.getOwnPropertyDescriptor(We.prototype,"setSaveEncodeBitrateRatio"),We.prototype),Ye(We.prototype,"setEncoderConfiguration",[jk,Gk],Object.getOwnPropertyDescriptor(We.prototype,"setEncoderConfiguration"),We.prototype),Ye(We.prototype,"getStats",[Wk],Object.getOwnPropertyDescriptor(We.prototype,"getStats"),We.prototype),Ye(We.prototype,"setBeautyEffect",[Hk,Kk],Object.getOwnPropertyDescriptor(We.prototype,"setBeautyEffect"),We.prototype),Ye(We.prototype,"getCurrentFrameData",[zk],Object.getOwnPropertyDescriptor(We.prototype,"getCurrentFrameData"),We.prototype),Ye(We.prototype,"getCurrentFrameImage",[Yk],Object.getOwnPropertyDescriptor(We.prototype,"getCurrentFrameImage"),We.prototype),Ye(We.prototype,"findClosestProfile",[qk,Xk],Object.getOwnPropertyDescriptor(We.prototype,"findClosestProfile"),We.prototype),Ye(We.prototype,"setBitrateLimit",[Jk],Object.getOwnPropertyDescriptor(We.prototype,"setBitrateLimit"),We.prototype),Ye(We.prototype,"setOptimizationMode",[Qk],Object.getOwnPropertyDescriptor(We.prototype,"setOptimizationMode"),We.prototype),Ye(We.prototype,"setScalabiltyMode",[Zk],Object.getOwnPropertyDescriptor(We.prototype,"setScalabiltyMode"),We.prototype),Ye(We.prototype,"updateMediaStreamTrackResolution",[$k],Object.getOwnPropertyDescriptor(We.prototype,"updateMediaStreamTrackResolution"),We.prototype),Ye(We.prototype,"pipe",[e1],Object.getOwnPropertyDescriptor(We.prototype,"pipe"),We.prototype),Ye(We.prototype,"unpipe",[t1],Object.getOwnPropertyDescriptor(We.prototype,"unpipe"),We.prototype),Ye(We.prototype,"close",[n1],Object.getOwnPropertyDescriptor(We.prototype,"close"),We.prototype),Ye(We.prototype,"replaceTrack",[r1],Object.getOwnPropertyDescriptor(We.prototype,"replaceTrack"),We.prototype),We),d_=(i1=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),o1=jt(),s1=Od("CameraVideoTrack","_enabledMutex"),a1=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),c1=jt(),d1=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),l1=jt(),u1=Ce({argsMap:e=>[e.getTrackId()]}),ti=class OB extends Ct{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,s,a){super(t,ji(n.encoderConfig),i,s,a),j(this,"_config",void 0),j(this,"_originalConstraints",void 0),j(this,"_constraints",void 0),j(this,"_enabled",!0),j(this,"_deviceName","default"),j(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Id()||HT())&&!function(){const d=qe();if(d.os!==hn.IOS||!d.osVersion)return!1;const l=d.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&UD()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=ji(this._config.encoderConfig),pt.on(In.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pt.on(In.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await $r.getDeviceById(t),r={};r.video=Rt({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Zr(r,this.getTrackId())}catch(s){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Zr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await $r.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Rt(Rt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Zr(n,this.getTrackId())}catch(i){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Zr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Rt({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Zr({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await gt(this,_e.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await gt(this,_e.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Y(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=ji(t),N("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Pt(this._config);r.encoderConfig=t;const i=c_(r);(Nn()||Yn()||Vi())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const a=new Y(O.UNEXPECTED_ERROR,s.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(mt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gt(this,_e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Yn()||Vi())&&this._enabled&&!this._isClosed&&pt.duringInterruption){const t=async()=>{pt.off(In.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pt.on(In.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Md.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=$r.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await Zr({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),pt.off(In.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pt.off(In.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Rt(Rt({},r),ji(t))),r=sc(r);const i=St(8,"track-cam-cloned-"),s=new OB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,sc(Rt(Rt({},this._config),{},{encoderConfig:r})),sc(this._constraints),sc(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(Jr.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(Jr.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Ye(ti.prototype,"setDevice",[i1,o1],Object.getOwnPropertyDescriptor(ti.prototype,"setDevice"),ti.prototype),Ye(ti.prototype,"setEnabled",[s1,a1,c1],Object.getOwnPropertyDescriptor(ti.prototype,"setEnabled"),ti.prototype),Ye(ti.prototype,"setEncoderConfiguration",[d1,l1],Object.getOwnPropertyDescriptor(ti.prototype,"setEncoderConfiguration"),ti.prototype),Ye(ti.prototype,"close",[u1],Object.getOwnPropertyDescriptor(ti.prototype,"close"),ti.prototype),ti);function Av(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Rt(Rt({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?T.debug("[".concat(e,"] set content hint to"),n.optimizationMode):T.debug("[".concat(e,"] set content hint failed")))):T.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var h1,p1,f1,_1,_i,m1,E1,g1,S1,T1,v1,Zn;class R1 extends CP{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(St(5,""))),j(this,"_userId",void 0),j(this,"_uintId",void 0),j(this,"_isDestroyed",!1),j(this,"store",void 0),j(this,"processor",void 0),j(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Bd=(h1=Ce({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),p1=Ce({argsMap:e=>[e.getTrackId()]}),f1=Ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_1=Ce({argsMap:e=>[e.getTrackId()]}),Ye((_i=class extends R1{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),j(this,"_videoVisibleTimer",null),j(this,"_previousVideoVisibleStatus",void 0),j(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),j(this,"trackMediaType",Ud.VIDEO),j(this,"_videoWidth",void 0),j(this,"_videoHeight",void 0),j(this,"_player",void 0),j(this,"_prePlayer",void 0),j(this,"processorDestination",void 0),j(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new UP(this.getTrackId(),"remote"),this.processorDestination=new MP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ea(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Yr(this,_e.GET_STATS)||Rt({},RP)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(fi.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Rt(Rt({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new Iv(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new wv(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(fi.FIRST_FRAME_DECODED),i&&this.safeEmit(fi.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(fi.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(fi.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(fi.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){FP(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Qf)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const a=BD.checkOneElementVisible(i),d=Object.assign({},a);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const l=Se.reportApiInvoke(null,{tag:Dt.TRACER,name:Wt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new Y(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ir.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ir.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(lc.SEI_RECEIVED,e)}}).prototype,"play",[h1],Object.getOwnPropertyDescriptor(_i.prototype,"play"),_i.prototype),Ye(_i.prototype,"stop",[p1],Object.getOwnPropertyDescriptor(_i.prototype,"stop"),_i.prototype),Ye(_i.prototype,"pipe",[f1],Object.getOwnPropertyDescriptor(_i.prototype,"pipe"),_i.prototype),Ye(_i.prototype,"unpipe",[_1],Object.getOwnPropertyDescriptor(_i.prototype,"unpipe"),_i.prototype),_i),jd=(m1=Ce({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),E1=Ce({argsMap:(e,t)=>[e.getTrackId(),t]}),g1=Ce({argsMap:e=>[e.getTrackId()]}),S1=Ce({argsMap:e=>[e.getTrackId()]}),T1=Ce({argsMap:(e,t)=>[e.getTrackId(),t.name]}),v1=Ce({argsMap:e=>[e.getTrackId()]}),Ye((Zn=class extends R1{get isPlaying(){return this._useAudioElement?fr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),j(this,"trackMediaType",Ud.AUDIO),j(this,"_source",void 0),j(this,"_useAudioElement",!0),j(this,"_volume",100),j(this,"processorContext",void 0),j(this,"processorDestination",void 0),j(this,"_played",!1),j(this,"_bypassWebAudio",!1),N("DISABLE_WEBAUDIO")?(this._source=new yv,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bP(e,!0),N("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Xr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(fi.FIRST_FRAME_DECODED)}),this.processorContext=new VP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new xP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Xr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Xr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Xr.ON_AUDIO_BUFFER),this._source.on(Xr.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?fr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!gP())throw new Y(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ea(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Yr(this,_e.GET_STATS)||Rt({},vP)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),fr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?fr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Y(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ir.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ir.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ir.ON_TRACK),this.processorDestination.removeAllListeners(ir.ON_NODE)}}).prototype,"setVolume",[m1],Object.getOwnPropertyDescriptor(Zn.prototype,"setVolume"),Zn.prototype),Ye(Zn.prototype,"setPlaybackDevice",[E1],Object.getOwnPropertyDescriptor(Zn.prototype,"setPlaybackDevice"),Zn.prototype),Ye(Zn.prototype,"play",[g1],Object.getOwnPropertyDescriptor(Zn.prototype,"play"),Zn.prototype),Ye(Zn.prototype,"stop",[S1],Object.getOwnPropertyDescriptor(Zn.prototype,"stop"),Zn.prototype),Ye(Zn.prototype,"pipe",[T1],Object.getOwnPropertyDescriptor(Zn.prototype,"pipe"),Zn.prototype),Ye(Zn.prototype,"unpipe",[v1],Object.getOwnPropertyDescriptor(Zn.prototype,"unpipe"),Zn.prototype),Zn);const Ho=new class extends Lt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),j(this,"_lastHiddenTime",0),j(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class y1 extends Lt{constructor(t,n){super(),j(this,"trackMediaType",Ud.DATA),j(this,"_version",1),j(this,"_type",3),j(this,"_config",void 0),j(this,"_originDataChannel",void 0),j(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),j(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),j(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return N("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new de((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;n(new Y(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new Y(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new Y(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[s_.OPEN,s_.CLOSE,s_.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class G7 extends y1{constructor(t){super(t),j(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(N("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(s_.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class W7 extends y1{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function l_(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>df.revokeObjectURL(e),0),new Worker(df.createObjectURL(e))}const C1=71,bv=1,Ov=2,Nv=1,I1=2;var ra=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(ra||{});function Dv(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==C1)return;const r=e.getUint16(1),i=bv+Ov+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const a={m:n,tlvLen:r,tlv:[],frame:s};let d=bv+Ov;for(;d<i;){const l=e.getUint8(d),u=e.getUint16(d+Nv),p=Nv+I1;if(l===ra.AUDIO_LEVEL){let _=e.getUint8(d+p);for(let m=1;m<u;m++)_=_<<8|e.getUint8(d+p+m);a.tlv.push({tag:l,length:u,value:t?127^_>>1:127&_})}else if(l===ra.METADATA||l===ra.AUDIO_64_BIT_PTS){const _=new Uint8Array(u);for(let m=0;m<u;m++)_[m]=e.getUint8(d+p+m);a.tlv.push({tag:l,length:u,value:_})}d+=p+u}return a}const u_=new Map,h_=127,pc=1e-10,Pv=139/13,p_=new Map;function kv(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;return p_.has(r)?i=p_.get(r):(i=Math.log(function(a,d){const l=a-d;d<l&&(d=l);let u=1;for(let p=a,_=1;p>d;p--,_++)u=u*p/_;return u}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,p_.set(r,i)),i<pc&&(i=pc),i}function w1(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let a=0,d=0;a<r;a++){let l=0;for(let u=d+i;d<u;d++)e[d]>n&&l++;t[a]!==l&&(t[a]=l,s=!0)}return s}window.cache=p_;let H7=0;class A1{constructor(t){j(this,"id",void 0),j(this,"immediates",[]),j(this,"lastNonSilence",-1),j(this,"immediateSpeechActivityScore",pc),j(this,"lastLevelChangedTime",Date.now()),j(this,"levels",[]),j(this,"longs",[]),j(this,"longSpeechActivityScore",pc),j(this,"mediums",[]),j(this,"mediumSpeechActivityScore",pc),j(this,"minLevel",0),j(this,"nextMinLevel",0),j(this,"nextMinLevelWindowLength",0),j(this,"energyScore",0),this.id=t||"".concat(H7++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+Pv;let i=!1;for(let s=0;s<t.length;++s){let a=n[s];a<r&&(a=0);const d=Math.floor(a/Pv);t[s]!==d&&(t[s]=d,i=!0)}return i}computeLongs(){return w1(this.mediums,this.longs,4)}computeMediums(){return w1(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=kv(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=kv(this.longs[0],10,47),this.longSpeechActivityScore>pc&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=kv(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(aI(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>h_&&(r=h_),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+Pv?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>h_&&(n=h_),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class K7{constructor(t){j(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Lv{constructor(t,n,r){j(this,"isDominant",void 0),j(this,"energyRanking",void 0),j(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class z7 extends Lt{constructor(t){super(),j(this,"dominantId",null),j(this,"lastDecisionTime",0),j(this,"lastLevelChangedTime",0),j(this,"lastLevelIdleTime",0),j(this,"relativeSpeechActivities",[]),j(this,"speakers",new Map),j(this,"enableSilence",!1),j(this,"timeoutToSilenceInterval",0),j(this,"decisionMaker",null),j(this,"loudest",[]),j(this,"numLoudestToTrack",3),j(this,"energyExpireTimeMs",250),j(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=i.levelChanged(n,r);return this.updateLoudestList(i,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new A1(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const i=t.id===this.dominantId;if(n<0){let l=0;for(;l<this.loudest.length&&this.loudest[l]!==t;)++l;return new Lv(i,l,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new Lv(i,0,t.energyScore);const s=r-this.energyExpireTimeMs;let a=0;for(;a<this.loudest.length;){const l=this.loudest[a];if(l.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(a,1);else if(l.id!==t.id)++a;else if(this.loudest.splice(a,1),this.loudest.length<this.numLoudestToTrack)break}let d=0;for(;d<this.loudest.length&&!(this.loudest[d].energyScore<t.energyScore);)++d;return d<this.numLoudestToTrack&&(this.loudest.splice(d,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Lv(i,d,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new K7(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const i=this.speakers.size;let s=null;if(i===0)s=null;else if(i===1){var a;const d=Lr(a=this.speakers).call(a).next().value;this.enableSilence&&d&&(s=d.id,d.evaluateSpeechActivityScores(t),t-d.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let d=this.dominantId==null?null:this.speakers.get(this.dominantId);if(d==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],d=p.value[1])}else s=d.id;d!=null&&d.evaluateSpeechActivityScores(t);const l=this.relativeSpeechActivities;let u=2;for(const p of this.speakers.entries()){const[_,m]=p;if(m===d)continue;m.evaluateSpeechActivityScores(t);for(let y=0;y<l.length;++y){const b=d==null?pc:d.getSpeechActivityScore(y);l[y]=Math.log(m.getSpeechActivityScore(y)/b)}const E=l[0],C=l[1],R=l[2];E>3&&C>2&&R>0&&C>u&&(u=C,s=_)}this.enableSilence&&d!=null&&s===d.id&&t-d.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const n=[];for(const i of Lr(r=this.speakers).call(r)){var r;const s=t-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<s&&i.levelTimedOut()}n.forEach(i=>this.speakers.delete(i))}}const Gd=new Map;let mo=null,f_=null;const b1=3;let fc=[];const Eo=new Map,__=new Map;class Y7{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){j(this,"id",void 0),j(this,"track",void 0),j(this,"score",0),j(this,"active",!0),j(this,"muted",!1),j(this,"timer",0),j(this,"actives",0),j(this,"inactives",0),this.id=t,this.track=n,this.setActive(Eo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=function(){const i=[],s=[];return Array.from(Lr(Eo).call(Eo)).forEach(a=>{a.active?i.push(a):s.push(a)}),{actives:i,inactives:s}}();if(n.length>3){let i;n.forEach(s=>{(!i||i.score>s.score)&&(i=s)}),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach(s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let r;return Array.from(Lr(Eo).call(Eo)).forEach(i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let r;return Array.from(Lr(Eo).call(Eo)).forEach(i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let m_;function O1(e){const t=Eo.get(e);t&&(Eo.delete(e),t.clearTimer())}const E_=new Map,q7=new Map,Mv="video/h264",Uv="video/h265";function N1(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function D1(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function P1(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?Uv:(31&r)<=31?Mv:""}const g_=new Map,xu=new Map;(function(){const e=qe();Cn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Cn.getStreamFromExtension=e.name===tt.CHROME&&Number(e.version)>34,Cn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Cn.supportMinBitrate=e.name===tt.CHROME||e.name===tt.EDGE,Cn.supportSetRtpSenderParameters=function(){const t=qe();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!_s()||!(!Nn()&&!Yf())||t.name===tt.FIREFOX&&Number(t.version)>=64)}(),e.name===tt.SAFARI&&(Number(e.version)>=14?Cn.supportDualStream=!0:Cn.supportDualStream=!1),Cn.webAudioMediaStreamDest=function(){const t=qe();return!(t.name===tt.SAFARI&&Number(t.version)<12)}(),Cn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Cn.supportWebGL=typeof WebGLRenderingContext<"u",Cn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,_s()||(Cn.webAudioWithAEC=!0),Cn.supportShareAudio=function(){const t=qe();return(t.os===hn.WIN_10||t.os===hn.WIN_81||t.os===hn.WIN_7||t.os===hn.LINUX||t.os===hn.MAC_OS||t.os===hn.CHROMIUM_OS)&&t.name===tt.CHROME&&Number(t.version)>=74}(),Cn.supportDataChannel=!!(Cd(76)||jT(68)||DD(14)),Cn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Ut()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Cn.supportWebRTCEncodedTransform=Cd(87)||bD()||jT(117),Cn.supportWebRTCInsertableStream=function(){const t=qe();return(t.name===tt.CHROME||t.name===tt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Cn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Cn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Jf(()=>{Cn.supportDualStreamEncoding=function(){const t=qe();return!!N("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&N("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",e),T.info("browser compatibility: ",Cn)})})();const X7=["CHINA","GLOBAL"],k1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],_c=[],Wd=[];function mc(e,t){return!!t&&_c.some(n=>n.uid===e&&n.channelName===t)}function xv(){return Wd.length>0}var J7=qO.forEach,L1=Tp("forEach")?[].forEach:function(e){return J7(this,e,arguments.length>1?arguments[1]:void 0)};lt({target:"Array",proto:!0,forced:[].forEach!==L1},{forEach:L1});var Q7=Ni("Array","forEach"),Z7=Hs,$7=Kn,eq=J,tq=Q7,Vv=Array.prototype,nq={DOMTokenList:!0,NodeList:!0},rq=function(e){var t=e.forEach;return e===Vv||eq(Vv,e)&&t===Vv.forEach||$7(nq,Z7(e))?tq:t},iq=g(rq),oq=Lo,M1=wp;lt({target:"Object",stat:!0,forced:S(function(){M1(1)})},{keys:function(e){return M1(oq(e))}});var sq=g(di.Object.keys),aq=g(iI),cq=g(sI),dq=lt,U1=Xl,lq=Bp,uq=ur,x1=tg,hq=Ws,pq=js,fq=TS,_q=nn,mq=zs,Eq=VO("slice"),gq=_q("species"),Fv=Array,Sq=Math.max;dq({target:"Array",proto:!0,forced:!Eq},{slice:function(e,t){var n,r,i,s=pq(this),a=hq(s),d=x1(e,a),l=x1(t===void 0?a:t,a);if(U1(s)&&(n=s.constructor,(lq(n)&&(n===Fv||U1(n.prototype))||uq(n)&&(n=n[gq])===null)&&(n=void 0),n===Fv||n===void 0))return mq(s,d,l);for(r=new(n===void 0?Fv:n)(Sq(l-d,0)),i=0;d<l;d++,i++)d in s&&fq(r,i,s[d]);return r.length=i,r}});var Tq=Ni("Array","slice"),vq=J,Rq=Tq,Bv=Array.prototype,yq=function(e){var t=e.slice;return e===Bv||vq(Bv,e)&&t===Bv.slice?Rq:t},Cq=g(yq);function me(e,t,n,r,i){var s,a,d,l={};return iq(s=sq(r)).call(s,function(u){l[u]=r[u]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=aq(a=cq(d=Cq(n).call(n)).call(d)).call(a,function(u,p){return p(e,t,u)||u},l),i&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(i):void 0,l.initializer=void 0),l.initializer===void 0?(LO(e,t,l),null):l}let S_=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),jv=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Gi=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),or=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Re=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),yt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Ne=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Ae=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Vu=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),ze=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),sr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Ue=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function T_(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw T.error("Invalid Channel Name ".concat(e)),new G(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function v_(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||FD(e,1,255)))throw new G(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Ko=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Iq={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Gv={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Wv(e,t){Rn(e.url,"".concat(t,".url"),1,1e3,!1),xt(e.x)||_t(e.x,"".concat(t,".x"),0,1e4),xt(e.y)||_t(e.y,"".concat(t,".y"),0,1e4),xt(e.width)||_t(e.width,"".concat(t,".width"),0,1e4),xt(e.height)||_t(e.height,"".concat(t,".height"),0,1e4),xt(e.zOrder)||_t(e.zOrder,"".concat(t,".zOrder"),0,255),xt(e.alpha)||_t(e.alpha,"".concat(t,".alpha"),0,1,!1)}const wq={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let ia=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Hv=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),on=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function V1(e){if(!e.channelName)throw new G(O.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new G(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Rn(e.token,"info.token",1,2047),v_(e.uid),T_(e.channelName),!0}let ar=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Es=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ir=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Hd=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),at=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),mn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),R_=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),pn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),rt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const F1=[rt.AFRICA,rt.ASIA,rt.CHINA,rt.EUROPE,rt.GLOBAL,rt.INDIA,rt.JAPAN,rt.NORTH_AMERICA,rt.OCEANIA,rt.OVERSEA,rt.SOUTH_AMERICA];let Fn=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const y_={CHINA:{},ASIA:{CODE:Fn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Fn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Fn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Fn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Fn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Fn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Fn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Fn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Fn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Fn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Fn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Fn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Fn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};av&&(y_.CHINA={CODE:Fn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Fu=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function B1(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class j1 extends Lt{constructor(t,n){super(),w(this,"onICEConnectionStateChange",void 0),w(this,"onConnectionStateChange",void 0),w(this,"onDTLSTransportStateChange",void 0),w(this,"onDTLSTransportError",void 0),w(this,"onICETransportStateChange",void 0),w(this,"onFirstAudioReceived",void 0),w(this,"onFirstVideoReceived",void 0),w(this,"onFirstAudioDecoded",void 0),w(this,"onFirstVideoDecoded",void 0),w(this,"onFirstVideoRender",void 0),w(this,"onFirstVideoDecodedTimeout",void 0),w(this,"onSelectedLocalCandidateChanged",void 0),w(this,"onSelectedRemoteCandidateChanged",void 0),w(this,"onICECandidateError",void 0),w(this,"getLocalVideoStats",void 0)}}class G1 extends j1{constructor(t,n){super(t,n),w(this,"establishPromise",void 0)}}let he=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Bn=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),gs=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const W1=["disconnected","failed"];let ee=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),st=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Te=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Wi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Hi=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),En=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),H1=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),zo=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),mi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),go=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Kd=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Kt=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),zd=function(e){return e.ABORT="abort",e}({}),oa=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Aq=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const bq={[S_.ACCESS_POINT]:{[or.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[or.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[or.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[or.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[or.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[or.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[or.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[or.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[or.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[or.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[or.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[or.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[or.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[or.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[or.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[or.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[or.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[or.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[S_.UNILBS]:{[Gi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Gi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Gi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Gi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Gi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Gi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Gi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Gi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Gi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Gi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Gi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Gi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[S_.STRING_UID_ALLOCATOR]:{[jv.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[jv.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[jv.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Yd(e){const t=bq[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===S_.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Oq={[Re.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Re.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Re.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Re.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Re.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Re.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Re.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Re.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Re.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Re.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Re.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Re.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Re.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Re.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Re.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Re.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Re.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Re.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Re.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Re.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Re.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Re.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Re.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Re.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Re.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Re.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Re.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Re.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Re.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Re.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Re.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Re.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Re.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Re.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Re.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Re.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Re.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Re.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Re.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Re.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Re.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Re.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Re.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Re.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Re.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Re.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Re.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Re.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Re.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Re.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Re.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Re.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Re.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Re.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Re.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Re.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Re.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Re.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Re.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Re.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Re.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Re.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Re.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Re.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Bu(e){return Oq[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function K1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Kv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?K1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function zv(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const s=N("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const Nq=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Dq=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Pq=/wss:\/\/(.+):([0-9]+)\/?/,kq=/wss:\/\/(.[^\/]+)\/?/;let Lq=0;class Mq{constructor(t,n){w(this,"id",0),w(this,"store",void 0),w(this,"recordIndex",void 0),w(this,"websockets",[]),w(this,"try443PortDuration",2e3),w(this,"forceCloseWSDuration",5e3),w(this,"try443PortTimeout",null),w(this,"forceCloseTimeout",null),w(this,"isTry443PortFailed",!1),w(this,"isNormalPortFailed",!1),w(this,"useDoubleDomain",!1),w(this,"useProxy",!1),w(this,"startTime",Date.now()),this.id=++Lq,this.try443PortDuration=N("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];T.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=N("GATEWAY_DOMAINS"),s=Date.now(),a=[],d=i.find(m=>{var E;return oe(E=t.host).call(E,m)});d||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)i.forEach(m=>{l.push(zv(Kv(Kv({},t),{},{host:t.host.replace(d,m)}),n))});else{const m=Kv({},t);if(n&&d){const E=i.find(C=>C!==d);E&&(m.host=m.host.replace(d,E))}l.push(zv(m,n))}try{l.forEach(m=>{const E=new WebSocket(m);E.binaryType="arraybuffer",a.push(E),this.logger("ws is connecting:",E.url)})}catch(m){if(this.logger("ws create failed"),a.forEach(E=>E.close()),a.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new G(O.WS_ERR,"init websocket failed! Error: ".concat(m.toString()))}const u=Cu();this.store&&this.store.recordJoinChannelService({urls:a.map(m=>m.url),service:"gateway"},this.recordIndex),a.forEach(m=>{m.onopen=()=>{this.logger("onopen: ws ".concat(m.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(E=>{E!==m&&(E.onopen=null,E.onclose=null,E.onmessage=null,E.close(),this.logger("close backup websocket: ".concat(E.url)))}),this.websockets.length=0,u.resolve(m)},m.onclose=E=>{this.logger("onclose: ws ".concat(m.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(m.readyState));const C=a.every(R=>R.readyState===WebSocket.CLOSED||R.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(C)),C&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(E.reason)),u.reject({code:E.code,reason:R_.A_ROUND_WS_FAILED})):!n&&C&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),_()),n?this.isTry443PortFailed=C:this.isNormalPortFailed=C},m.onmessage=E=>this.logger("".concat(m.url," onmessage: ").concat(E.data))}),this.websockets.push(...a);const p=()=>{this.websockets.forEach(m=>m.readyState!==WebSocket.OPEN&&m.close())},_=()=>{if(u.isResolved)return p();qe().os===hn.MAC_OS&&Ut()&&p(),this.createWebSocket(t,!0,!0).then(m=>{u.resolve(m)}).catch(m=>{this.isNormalPortFailed&&u.reject(m),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",u.isResolved),this.try443PortTimeout=null,_()},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(s){let a,d,l;return[,a,d,l]=s.match(Nq)||[],a||([,d,l]=s.match(Dq)||[]),d&&l||([,d,l]=s.match(Pq)||[]),d&&l||([,d]=s.match(kq)||[]),d||T.warning("un-destructible url: ",s),{proxy:a,host:d,port:l||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function z1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class Y1 extends Lt{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;oe(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ue.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ue.CONNECTED):this._state==="closed"?this.emit(Ue.CLOSED):this._state==="failed"&&this.emit(Ue.FAILED))}resetReconnectCount(t){T.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],a=arguments.length>5?arguments[5]:void 0;super(),w(this,"_websocketUrl",null),w(this,"connectionID",0),w(this,"currentURLIndex",0),w(this,"urls",[]),w(this,"_reconnectMode","tryNext"),w(this,"reconnectReason",void 0),w(this,"_initMutex",void 0),w(this,"name",void 0),w(this,"_state","closed"),w(this,"reconnectInterrupter",void 0),w(this,"websocket",void 0),w(this,"retryConfig",void 0),w(this,"reconnectCount",0),w(this,"forceCloseTimeout",5e3),w(this,"onlineReconnectListener",void 0),w(this,"useCompress",void 0),w(this,"tryDoubleDomain",!1),w(this,"use443PortOnly",!1),w(this,"wsInflateLength",0),w(this,"wsDeflateLength",0),w(this,"closeEstablishingWs",()=>{}),w(this,"store",void 0),w(this,"joinGatewayRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(_){for(var m=1;m<arguments.length;m++){var E=arguments[m]!=null?arguments[m]:{};m%2?z1(Object(E),!0).forEach(function(C){w(_,C,E[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(E)):z1(Object(E)).forEach(function(C){Object.defineProperty(_,C,Object.getOwnPropertyDescriptor(E,C))})}return _}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new xn("websocket",a?a.clientId:void 0);const{timeout:d,timeoutFactor:l}=n,u=Math.max(300,Math.floor(3*d/5)),p=Math.max(1.2,Math.floor(8*l)/10);xr.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p),Yt.on(wd.NETWORK_STATE_CHANGE,(_,m)=>{_!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(_)),_===xr.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var i;const s=Cu(),a=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(d){return!(r_()||N("USE_NEW_TOKEN")||!N("ENABLE_PREALLOC_PC")&&(d==null||!d.autoSubscribe||N("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(H1.PRE_CONNECT_PC),this.createWebSocketConnection(a).then(s.resolve).catch(s.reject),this.once(Ue.CLOSED,()=>{s.reject(new Y(O.WS_DISCONNECT))}),this.once(Ue.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Y(O.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new Y(O.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=Cu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=p=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async p=>{var _;if(T.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new Y(O.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const m=Yr(this,Ue.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,E=await this.reconnectWithAction(m);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!E)return r.reject(new Y(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);r.resolve()}},a=p=>{this.emit(Ue.ON_MESSAGE,p)},d=p=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),N("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=N("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),t);const l=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;this._websocketUrl=zv(t);const p=await this.chooseBestWebsocketConnection(t);this.websocket=p,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=a,this.websocket.onerror=d,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(p){const _=this.state==="closed",m=p instanceof Y,E=m&&p.code===O.WS_ABORT,C=m&&p.code===O.WS_ERR,R=m?p.message:p&&(p.reason||p.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(R)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:E?"aborted":"error",errors:[p]},l),_||C?(r.reject(_?new Y(O.WS_DISCONNECT,"websocket is closed: ".concat(R)):new Y(O.WS_ERR,"init websocket failed: ".concat(R))),C&&T.error("[".concat(this.name,"] init websocket failed: ").concat(R))):s&&s(p)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Yt.isOnline||!Yt.onlineWaiter||(this.onlineReconnectListener=Yt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const a=$T(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(a,"ms to reconnect websocket, mode: ").concat(t)),await de.race([yn(a),this.onlineReconnectListener||new de(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(a,d)=>{this.emit(Ue.RECONNECT_CREATE_CONNECTION,d),await this.createWebSocketConnection(a)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Pn(this,Ue.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(a){var s;T.error("[".concat(this.name,"] reconnect failed ").concat(a&&a.toString()));const d=a==null||(s=a.data)===null||s===void 0?void 0:s.desc;return Array.isArray(d)&&oe(d).call(d,"dynamic key expired")?(this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class Yv extends Y1{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=Cu(),i=function(a,d){return new Mq(a,d)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new Y(O.WS_ABORT,"choose best websocket aborted"))};const s=N("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class ju extends Y1{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new de((r,i)=>{let s=!1;const a=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),a.forEach(C=>{C.onclose=null,C.onopen=null,C.onmessage=null,C.close()}),i(new Y(O.WS_ABORT,"choose best websocket aborted"))};const d=N("GATEWAY_DOMAINS");let l;const u=t.indexOf("?h="),p=d.find(C=>u!==-1?oe(t).call(t,C,u):oe(t).call(t,C));T.debug("[choose-best-ws] currentDomain: ",p,", domains: ",d);let _=!this.tryDoubleDomain||!p;if(!_&&p){var m;const C=Date.now();try{d.forEach(R=>{const y=u===-1?t.replace(p,R):t.substr(0,u)+t.substr(u).replace(p,R),b=new WebSocket(y);b.binaryType="arraybuffer",a.push(b),T.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach(y=>y.close());a.length;)a.pop();_=!0}(m=this.store)===null||m===void 0||m.recordJoinChannelService({urls:a.map(R=>R.url),service:"gateway"},n),a.forEach(R=>{R.onopen=()=>{if(s)return;const y=Date.now()-C;T.debug("[choose-best-ws] ws open cost ".concat(y,"ms")),a.filter(b=>b!==R).forEach(b=>{T.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,r(R)},R.onclose=y=>{l=y,!s&&(a.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),s=!0,i(l)))},R.onmessage=y=>{T.debug("[choose-best-ws]".concat(R.url," onmessage: ").concat(y.data))}}),yn(this.forceCloseTimeout).then(()=>{a.forEach(R=>{R.readyState!==WebSocket.OPEN&&R.close()})})}if(_){var E;let C;T.debug("[choose-best-ws] use single url: ",t),(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:[t],service:"gateway"},n);try{C=new WebSocket(t),a.push(C),C.binaryType="arraybuffer"}catch(R){const y=new Y(O.WS_ERR,"init websocket failed! Error: ".concat(R.toString()));return T.error("[".concat(this.name,"]").concat(y)),void i(y)}C.onopen=()=>{r(C)},C.onclose=R=>{i(R)},C.onmessage=R=>{T.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(R.data))},yn(this.forceCloseTimeout).then(()=>{C&&C.readyState!==WebSocket.OPEN&&C.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class Uq extends Lt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===yt.CONNECTED?this.emit(Ne.WS_CONNECTED):t===yt.RECONNECTING?this.emit(Ne.WS_RECONNECTING,this._websocketReconnectReason):t===yt.CLOSED&&this.emit(Ne.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",yt.CLOSED),w(this,"reconnectToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new tP(5)),w(this,"pingpongTimer",void 0),w(this,"wsInflateDataTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"ortc",void 0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ne.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===ze.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ze.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(ot.UID_BANNED);break;case 15:this.close(ot.IP_BANNED);break;case 16:this.close(ot.CHANNEL_BANNED)}if(i._type===ze.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Re.ERR_LICENSE_MISSING:this.close(ot.LICENSE_MISSING);break;case Re.ERR_LICENSE_EXPIRED:this.close(ot.LICENSE_EXPIRED);break;case Re.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ot.LICENSE_MINUTES_EXCEEDED);break;case Re.ERR_LICENSE_PERIOD_INVALID:this.close(ot.LICENSE_PERIOD_INVALID);break;case Re.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ot.LICENSE_MULTIPLE_SDK_SERVICE);break;case Re.ERR_LICENSE_ILLEGAL:this.close(ot.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Yv("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yt.CONNECTED&&this.reconnect("retry",Dn.OFFLINE)})}async request(t,n,r,i){const s=St(6,""),a={_id:s,_type:t,_message:n},d=this.websocket.connectionID,l=()=>new de((C,R)=>{if(this.connectionState===yt.CONNECTED)return C();const y=()=>{this.off(Ne.WS_CLOSED,b),C()},b=()=>{this.off(Ne.WS_CONNECTED,y),R(new G(O.WS_ABORT))};this.once(Ne.WS_CONNECTED,y),this.once(Ne.WS_CLOSED,b),t!==Ae.PUBLISH&&t!==Ae.PUBLISH_DATASTREAM&&t!==Ae.SUBSCRIBE&&t!==Ae.SUBSCRIBE_DATASTREAM&&t!==Ae.UNSUBSCRIBE&&t!==Ae.UNSUBSCRIBE_DATASTREAM&&t!==Ae.UNPUBLISH&&t!==Ae.UNPUBLISH_DATASTREAM&&t!==Ae.CONTROL&&t!==Ae.RESTART_ICE||this.once(Ne.DISCONNECT_P2P,()=>{R(new G(O.DISCONNECT_P2P))}),t!==Ae.PUBLISH&&t!==Ae.RESTART_ICE||this.once(Ne.ABORT_P2P_EXECUTION,()=>{R(new G(O.DISCONNECT_P2P))})});if(this.connectionState!==yt.CONNECTING&&this.connectionState!==yt.RECONNECTING||t===Ae.JOIN||t===Ae.REJOIN||await l(),this.websocket.sendMessage(a,!0),i)return;const u=new de((C,R)=>{let y=!1;const b=(D,V)=>{y=!0,C({isSuccess:D==="success",message:V||{}}),this.off(Ne.WS_CLOSED,A),this.off(Ne.WS_RECONNECTING,A),this.emit(Ne.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),b);const A=()=>{R(new G(O.WS_ABORT,"type: ".concat(t))),this.off(Ne.WS_CLOSED,A),this.off(Ne.WS_RECONNECTING,A),this.off("res-@".concat(s),b)};this.once(Ne.WS_CLOSED,A),this.once(Ne.WS_RECONNECTING,A),yn(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ne.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await u}catch(C){if(this.connectionState===yt.CLOSED||t===Ae.LEAVE)throw new G(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?C.throw():t===Ae.JOIN||t===Ae.REJOIN?null:(await l(),await this.request(t,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),m=Bu(_),E=new G(O.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:m.desc});return m.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(m.desc,", action: ").concat(m.action)),_===Re.ERR_TOO_MANY_BROADCASTERS?((t===Ae.JOIN||t===Ae.REJOIN)&&(this.initError=E,this.close()),E.throw()):m.action==="failed"?E.throw():m.action==="quit"?(this.initError=E,this.close(),E.throw()):(_===Re.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Dn.MULTI_IP)):this.reconnect(m.action,Dn.SERVER_ERROR),t===Ae.JOIN||t===Ae.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new de(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Vu.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yt.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new de((n,r)=>{this.once(Ne.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ne.WS_CLOSED,i=>r(this.initError||new G(O.WS_ABORT,i))),this.connectionState=yt.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||ot.LEAVE,this.connectionState=yt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ne.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Pn(this,Ne.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(Ae.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(Ne.REPORT_JOIN_GATEWAY,R_.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ne.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new G(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ou(this,Ne.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ae.REJOIN,t);return!!n&&(this.connectionState=yt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(ze.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(ze.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(ze.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(ze.MUTE_AUDIO,{uid:r.uid}):this.emit(ze.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(ze.MUTE_VIDEO,{uid:r.uid}):this.emit(ze.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(ze.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(ze.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(ze.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(ze.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(ze.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Ae.DOWNGRADE_CODEC,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Bu(t.code);if(t.code===28&&"detail"in t&&(T.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Ne.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ot.UID_BANNED),void this.close()):void this.reconnect(n.action,Dn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=N("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Dn.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),N("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Vu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ue.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ne.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ue.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ue.CLOSED,()=>{this.connectionState=yt.CLOSED}),this.websocket.on(Ue.FAILED,()=>{this._disconnectedReason=ot.NETWORK_ERROR,this.connectionState=yt.CLOSED}),this.websocket.on(Ue.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===yt.CONNECTED?this.connectionState=yt.RECONNECTING:this.connectionState=yt.CONNECTING}),this.websocket.on(Ue.WILL_RECONNECT,(t,n,r)=>{const i=Ou(this,Ne.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=R_.P2P_DISCONNECTED),s&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Ne.REPORT_JOIN_GATEWAY,n||R_.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ne.DISCONNECT_P2P)),r(t)}),this.websocket.on(Ue.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Dn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ne.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof G){if(t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Re.ERR_NO_AUTHORIZED)return this.initError=new G(O.TOKEN_EXPIRE,"dynamic key expired"),void this.close(ot.TOKEN_EXPIRE);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Dn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Ue.REQUEST_NEW_URLS,(t,n)=>{Pn(this,Ne.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(H1.PRE_CONNECT_PC,()=>{this.emit(Ne.PRE_CONNECT_PC)})}}let xq=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),qt=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function q1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function C_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?q1(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q1(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function sa(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(N("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function I_(e){try{const t=N("GATEWAY_DOMAINS").concat(N("TURN_DOMAIN")).find(n=>oe(e).call(e,n));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return T.debug("serverUrlToIp error, fallback to url",e),e}}function qv(e,t){e.addresses||(e.addresses=[]);const n=function(d,l){if(N("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return d.map(_=>{let{ip:m,port:E}=_;return{address:"".concat(m,":").concat(E)}});const u=N("GATEWAY_DOMAINS");let p=u[1]&&oe(l).call(l,u[1])?1:0;return d.map(_=>{let{domain_prefix:m,port:E,ip:C}=_;if(m)return{address:"".concat(m,".").concat(u[p++%u.length],":").concat(E)};const R=/^[\.\:\d]+$/.test(C),y=R?"".concat(C.replace(/[^\d]/g,"-"),".").concat(u[p++%u.length],":").concat(E):"".concat(C,":").concat(E);return R||T.debug("Cannot recognized as ip address: ".concat(C,", use as host3")),{ip:C,port:E,address:y}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const d=r.split(";");for(let l=0;l<d.length;l++){var i;const u=Qn(i=d[l]).call(i);n[l]&&u&&(n[l].ip6=u)}}const s=e.detail&&e.detail.candidate;let a;if(s){const[d,l]=s.split(":");d&&l&&(a={port:Number(l),ip:d,address:"".concat(d,":").concat(l)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Vr(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function X1(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Vr(t.width),"x").concat(Vr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function J1(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Gu(e,t){let n,r,i;switch(t){case qt.CHOOSE_SERVER:r=4096,i="choose server";break;case qt.CLOUD_PROXY:r=1048576,i="proxy";break;case qt.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case qt.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new G(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(a=>C_(C_({},a),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:C_(C_({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!n)throw new G(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function Q1(e,t){return await de.all(e.addresses.map(async n=>({address:sa(n.ip),tcpport:n.port,udpport:n.port,username:t&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():kn.username,password:t&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await XT(t.toString()):kn.password})))}function Xv(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Vr(e.height),Vr(e.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function aa(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:a}=e;const d={candidateType:t,relayProtocol:n,protocol:a};if(r!=="local-candidate"){const l=i.split(".");l.length>=4&&(l[1]="*",l[2]="*"),d.address=l.join("."),d.port=s}return d}function Ec(e){const t=e.split(":"),n=e.split(/[-.]/),r=oe(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function w_(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N("SVC_MODE");if(N("ENABLE_SVC"))return function(t){return t in e_}(e)?e:e_.L1T3}const Z1={[he.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[he.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function A_(e,t,n){t.forEach(r=>{var i;const s=Z1[e].find(d=>{var l;let{key:u}=d;return oe(l=r.extensionName).call(l,u)});if(!s)return;const a=n.find(d=>{let{extensionName:l}=d;return oe(l).call(l,s.key)});a&&oe(i=a.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=a.extensionName)})}function qd(e,t){t.forEach(n=>{var r;const i=Z1[e].find(s=>{var a;let{key:d}=s;return oe(a=n.extensionName).call(a,d)});oe(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)})}function $1(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||oe(e).call(e,"abs-send-time")}function b_(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||oe(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function eL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function tL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Wu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:a,filterAudioCodec:d,filterVideoCodec:l,unsupportedVideoUplinkCodec:u,unsupportedVideoDownlinkCodec:p}=t,{useXR:_}=n;let m=[],E=[],C=[],R=[],y=!1,b=!1;if(yr(e).mediaDescriptions.forEach(D=>{r&&r!==D.attributes.direction||(D.media.mediaType!=="video"||y||(E=D.attributes.payloads,R=D.attributes.extmaps,y=!0),D.media.mediaType!=="audio"||b||(m=D.attributes.payloads,C=D.attributes.extmaps,b=!0))}),!R||E.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!C||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(E.forEach(D=>{var V;(V=D.rtpMap)!==null&&V!==void 0&&V.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),_&&D.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(D=>{var V;(V=D.rtpMap)!==null&&V!==void 0&&V.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),_&&D.rtcpFeedbacks.push({type:"rrtr"})}),i&&(m=m.filter(D=>{var V;return((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())!=="rtx"}),E=E.filter(D=>{var V;return((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())!=="rtx"})),s){const D=E.filter(k=>{var B;return/(red)|(ulpfec)|(flexfec)/i.test(((B=k.rtpMap)===null||B===void 0?void 0:B.encodingName)||"")}),V=da(D,E).map(k=>k.payloadType),x=[...D.map(k=>k.payloadType),...V];E=E.filter(k=>!oe(x).call(x,k.payloadType))}if(a&&(m=m.filter(D=>{var V;return!/(red)|(ulpfec)|(flexfec)/i.test(((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName)||"")})),d&&(d==null?void 0:d.length)>0&&(m=m.filter(D=>{var V;return oe(d).call(d,((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"")})),l&&(l==null?void 0:l.length)>0){const D=E.filter(V=>{var x;return oe(l).call(l,((x=V.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"")});E=D.concat(i?[]:da(D,E))}const A=N("UNSUPPORTED_VIDEO_CODEC");if(A&&A.length>0){const D=E.filter(k=>k.rtpMap&&oe(A).call(A,k.rtpMap.encodingName.toLowerCase())),V=da(D,E),x=D.concat(V).map(k=>k.payloadType);E=E.filter(k=>!oe(x).call(x,k.payloadType)),T.debug("unsupportedVideoCodec: ".concat(A,", toBeRemoved: ").concat(x))}if(u&&u.length>0&&r==="sendonly"){const D=E.filter(k=>k.rtpMap&&oe(u).call(u,k.rtpMap.encodingName.toLowerCase())),V=da(D,E),x=D.concat(V).map(k=>k.payloadType);E=E.filter(k=>!oe(x).call(x,k.payloadType)),T.debug("unsupportedVideoUplinkCodec: ".concat(u,", toBeRemoved: ").concat(x))}if(p&&p.length>0&&r==="recvonly"){const D=E.filter(k=>k.rtpMap&&oe(p).call(p,k.rtpMap.encodingName.toLowerCase())),V=da(D,E),x=D.concat(V).map(k=>k.payloadType);E=E.filter(k=>!oe(x).call(x,k.payloadType)),T.debug("unsupportedVideoDownlinkCodec: ".concat(p,", toBeRemoved: ").concat(x))}return{audioCodecs:m,videoCodecs:E,audioExtensions:C,videoExtensions:R}}function ca(e){const t=yr(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,a=i.attributes.icePwd;if(!s||!a)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:a}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function nL(e,t){const n=[],r=e.attributes.ssrcGroups.filter(a=>a.semantic==="FID"),i=e.attributes.ssrcGroups.find(a=>a.semantic==="SIM"),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(a=>{var d;const l=(d=r.find(u=>u.ssrcIds[0]===a))===null||d===void 0?void 0:d.ssrcIds[1];n.push({ssrcId:a,rtx:t?l:void 0})});else if(r.length>0){const a=r[0].ssrcIds[0],d=r[0].ssrcIds[1];n.push({ssrcId:a,rtx:t?d:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function rL(e,t,n){const{cname:r}=e;let i=[];t&&(i=iL(t)),i.length===0&&(i=e.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),T.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let d;switch(e.dtlsParameters.role){case"server":d="passive";break;case"client":d="active";break;case"auto":d="actpass"}const l=N_(e.rtpCapabilities),u=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{u.push({kind:he.VIDEO,ssrcMsg:[{ssrcId:p.v,rtx:p.v_rtx}],mslabel:"".concat(p.v,"_").concat(p.a)},{kind:he.AUDIO,ssrcMsg:[{ssrcId:p.a}],mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:a,candidates:i,rtpCapabilities:l,setup:d,cname:r,preSSRCs:u}}function iL(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(Ec(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(Ec(e.ip6),":").concat(e.port)))),t}function Hu(e,t,n){const r=[],i=[];return e.forEach(s=>{let{ssrcId:a,rtx:d}=s;const l=St(8,"track-"),u={ssrcId:a,attributes:tL({label:l,mslabel:n=n||St(10,""),msid:"".concat(n," ").concat(l)},t&&{cname:t})};if(r.push(u),d!==void 0){const p={ssrcId:d,attributes:tL({label:l,mslabel:n,msid:"".concat(n," ").concat(l)},t&&{cname:t})};r.push(p),i.push({semantic:"FID",ssrcIds:[a,d]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:a}=s;return a})}),{ssrcs:r,ssrcGroups:i}}function Xd(e,t){t instanceof Gt&&e.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof N("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=N("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Ut()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Uu&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function Jv(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function Qv(e,t){var n;if(!(t instanceof Ct&&t._encoderConfig&&t._hints.indexOf(mt.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ze().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var s,a;oe(s=["h264","h265","vp8","vp9","av1"]).call(s,((a=i.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ze().supportMinBitrate&&!oe(n=t._hints).call(n,mt.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var s,a;oe(s=["h264","h265","vp8","vp9","av1"]).call(s,((a=i.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(N("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function oL(e){if(e.media.mediaType!=="video")return;const t=qe();if(t.name!==tt.SAFARI&&t.os!==hn.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function O_(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const s=r.find(a=>b_(a.extensionName));if(s){const a=s.extensionName;e.attributes.extmaps.find(l=>b_(l.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:a}),function(l,u){return u.filter(p=>!!l.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="transport-cc")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(u=>u.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex(a=>b_(a.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(a=>{const d=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");d!==-1&&a.rtcpFeedbacks.splice(d,1)})}if(t.remb===!0){const s=r.find(a=>$1(a.extensionName));if(s){const a=s.extensionName;e.attributes.extmaps.find(l=>l.extensionName===a)||e.attributes.extmaps.push({entry:s.entry,extensionName:a}),function(l,u){return u.filter(p=>!!l.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="goog-remb")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(u=>u.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex(a=>$1(a.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(a=>{const d=a.rtcpFeedbacks.findIndex(l=>l.type==="goog-remb");d!==-1&&a.rtcpFeedbacks.splice(d,1)})}}function sL(e,t,n){if(Ut()||e.media.mediaType!=="video"||!(t instanceof Ct)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!N("SIMULCAST")||n==="vp9"&&N("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(d=>d.semantic==="FID"&&d.ssrcIds[0]===i.ssrcId),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let d=1;d<r;d++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+d,attributes:Pt(i.attributes)}),a.ssrcIds.push(i.ssrcId+d),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+d,attributes:Pt(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+d,s.ssrcIds[1]+d]}));e.attributes.ssrcGroups.unshift(a)}async function aL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:a}=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;const p=Wu(u,d,l,"sendonly"),_=Wu(u,d,l,"recvonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ki(p,_,"videoExtensions",m,E,C),Ki(p,_,"videoCodecs",m,E,C),Ki(p,_,"audioExtensions",m,E,C),Ki(p,_,"audioCodecs",m,E,C),N("RAISE_H264_BASELINE_PRIORITY")){const R=[],y=[];if(C.videoCodecs.forEach((b,A)=>{var D;if(((D=b.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"){var V,x;const k=C.videoCodecs[A+1],B=k&&hL(b,k),q=(V=b.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"],Z=(x=b.fmtp)===null||x===void 0?void 0:x.parameters["packetization-mode"];!q||q!==N("FIRST_H264_PROFILE_LEVEL_ID")||N("FIRST_PACKETIZATION_MODE")&&Z!==N("FIRST_PACKETIZATION_MODE")?B?y.push([b,k]):y.push([b]):B?R.push([b,k]):R.push([b])}}),R.length>0&&y.length>0){T.debug("raising H264 baseline profile priority"),C.videoCodecs.forEach((A,D)=>{var V;if(((V=A.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){const x=hL(A,C.videoCodecs[D+1]),k=R.shift()||y.shift()||[];k.length>0&&(x?C.videoCodecs.splice(D,2,...k):C.videoCodecs.splice(D,1,...k))}});const b=E.videoCodecs.filter(A=>{var D,V;return((D=A.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=A.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==N("FIRST_H264_PROFILE_LEVEL_ID")});if(b.length>0){const A=da(b,E.videoCodecs).map(V=>V.payloadType),D=[...b.map(V=>V.payloadType),...A];E.videoCodecs=E.videoCodecs.filter(V=>!oe(D).call(D,V.payloadType))}N("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(A=>{var D,V;return!(((D=A.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=A.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==N("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:m,recv:E,sendrecv:C}}return{send:m,recv:E,sendrecv:C}}(e,t,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:a}}function cL(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Wu(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ki(e,t,"videoExtensions",n,r,i),Ki(e,t,"videoCodecs",n,r,i),Ki(e,t,"audioExtensions",n,r,i),Ki(e,t,"audioCodecs",n,r,i),N("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const a=i.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(a<s){T.debug("raising H264 baseline profile priority");const d=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(a,0,d)}a!==-1&&(r.videoCodecs=r.videoCodecs.filter(d=>!(d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function Ki(e,t,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const a=[];return e[n].forEach(d=>{t[n].some((l,u)=>{if(d.entry===l.entry&&d.extensionName===l.extensionName)return a.push(u),!0})?s[n].push(d):r[n].push(d)}),void t[n].forEach((d,l)=>{a.indexOf(l)===-1&&i[n].push(d)})}if(n==="videoCodecs"||n==="audioCodecs"){const a=[];return e[n].forEach(d=>{t[n].some((l,u)=>{if(d.payloadType===l.payloadType&&JSON.stringify(d)===JSON.stringify(l))return a.push(u),!0})?s[n].push(d):r[n].push(d)}),void t[n].forEach((d,l)=>{a.indexOf(l)===-1&&i[n].push(d)})}}function N_(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function Jd(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Ku(e,t,n,r){let i=[];if(e===he.VIDEO){if(N("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(s=>{var a;return oe(a=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(a,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===N("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const a=[],d=[],l=[];if(n.videoCodecs.forEach(u=>{const p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"";oe(p).call(p,r)?s.push(u):oe(p).call(p,"vp9")?a.push(u):oe(p).call(p,"vp8")?d.push(u):oe(p).call(p,"h264")&&l.push(u)}),s.length===0){let u="";a.length!==0?(s=a,u="vp9"):d.length!==0?(s=d,u="vp8"):l.length!==0&&(s=l,u="h264"),T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(u))}s.length!==0&&(i=t.videoCodecs.filter(u=>s.some(p=>p.payloadType===u.payloadType)))}if(i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),N("USE_PUB_RTX")||N("USE_SUB_RTX")){const s=da(i,t.videoCodecs);i=[...i,...s]}}else{i=t.audioCodecs.filter(a=>{var d;return oe(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,r)});const s=t.audioCodecs.filter(a=>{var d;return oe(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,"red")});i.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(a=>{var d;return oe(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,"opus")})),N("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function da(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&oe(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function la(e,t,n){const r=t.toString(),i=lL(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let a=s.sdp;a=dL(a,n||{}),i==null||i(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function dL(e,t,n){const r=yr(e),{useXR:i}=t;return r.mediaDescriptions.forEach(s=>{var a;s.attributes.mid&&(Array.isArray(n)&&!oe(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Jd(s),i&&oe(a=["audio","video"]).call(a,s.media.mediaType)&&s.attributes.payloads.forEach(d=>{d.rtcpFeedbacks.findIndex(l=>l.type==="rrtr")===-1&&d.rtcpFeedbacks.push({type:"rrtr"})})))}),na(r)}function lL(e,t,n,r){if(N("SDP_LOGGING"))return T.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{lL(i,"answer",n==="local"?"remote":"local",r)}:void 0}function uL(e){const t=N("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>oe(e).call(e,n))}function hL(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function pL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ni(e,t){return typeof N(e)===t?N(e):void 0}function Vq(){try{const e=N("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?pL(Object(r),!0).forEach(function(i){w(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pL(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e)}catch(e){return T.debug("handle gateway attributes failed: ",e),{}}}const fL={};function ua(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&T.debug("install service ".concat(e.name)),fL[e.name]=e}function Ss(e){const t=fL[e];if(!t)throw new Y(O.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function _L(e,t){return Ss("DataStream").create(e,t)}function D_(){return Ss("InterceptFrame").create()}function mL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function qn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Zv=new Map;class Fq extends Lt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(mn.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(mn.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,s;super(),w(this,"store",void 0),w(this,"joinInfo",void 0),w(this,"key",void 0),w(this,"ntpOffset",0),w(this,"signal",void 0),w(this,"role",void 0),w(this,"isPreallocation",void 0),w(this,"isPreSub",void 0),w(this,"inChannelInfo",{joinAt:null,duration:0}),w(this,"spec",void 0),w(this,"_state","DISCONNECTED"),w(this,"_statsCollector",void 0),w(this,"_disconnectedReason",void 0),w(this,"isSignalRecover",!1),w(this,"hasChangeBGPAddress",!1),w(this,"trafficStatsInterval",void 0),w(this,"networkQualityInterval",void 0),w(this,"_joinGatewayStartTime",0),w(this,"_signalTimeout",!1),w(this,"_clientRoleOptions",void 0),w(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:qn(qn({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(s=Ss("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,r)):new Uq(qn(qn({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=Zv.get(t.cname);if(s||(s=new Map,Zv.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const u=new G(O.UID_CONFLICT);throw Se.joinGateway(t.sid,{lts:i,succ:!1,ec:u.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),u}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let a=0;this.joinGatewayStartTime=i;const d=t.proxyServer;try{T.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(a));const u=t.gatewayAddrs.map(p=>{let{address:_}=p;const[m,E]=_.split(":"),C={host:m,port:E};return t.proxyServer&&(C.proxy=t.proxyServer),C});a=(await this.signal.init(u)).uid,T.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(a," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){var l;throw T.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),Se.joinGateway(t.sid,{lts:i,succ:!1,ec:((l=u.data)===null||l===void 0?void 0:l.desc)||u.code,errorMsg:u.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!d,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),u}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(mn.NETWORK_QUALITY,{uplinkNetworkQuality:J1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:J1(this._statsCollector.trafficStats.B_dnq)}):this.emit(mn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),a}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==ot.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==yt.CONNECTED||await function(r,i){return i===1/0?r:de.race([r,l7(i)])}(this.signal.request(Ae.LEAVE,void 0,!0),3e3)}catch(r){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==ot.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:N("PUB_EXTEND"),twcc:!!N("PUBLISH_TWCC"),rtx:!!N("USE_PUB_RTX")};try{return(await this.signal.request(Ae.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Re.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Ae.PUBLISH_DATASTREAM,s,!0)}catch(a){if(r&&a.data&&a.data.code===Re.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),a.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw a}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ae.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await de.all(t.map(n=>this.signal.request(Ae.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX")||void 0,extend:N("SUB_EXTEND"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(Ae.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===Re.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX"),extend:N("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return(await this.signal.request(Ae.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Re.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Ae.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===Re.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!N("USE_SUB_RTX"),twcc:!!N("SUBSCRIBE_TWCC"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(Ae.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===Re.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,a=r.height,d=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(d=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(d=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,i||(d=!1)),d?{stream_type:0,width:s,height:a,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ae.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ae.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await de.all(t.map(r=>this.signal.request(Ae.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){T.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Ae.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(Ae.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ae.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ae.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),N("CLIENT_ROLE_OPTIONS")&&(T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(N("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},N("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),N("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},N("CLIENT_ROLE_OPTIONS")),T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(N("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(Ae.SET_CLIENT_ROLE,qn(qn({role:t,level:i,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ae.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ae.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ae.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ae.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ae.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),qn({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ae.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=Zv.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:kn.username,password:kn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(qn(qn({},kn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ae.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Jf(()=>{this.emit(mn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,r;if(!this.joinInfo||!this.key)throw new G(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=N("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var a;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(mn.UPDATE_GATEWAY_CONFIG),a=this.store.clientId,oe(Wd).call(Wd,a)||Wd.push(a);const d=pv(this.store),l=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),u=SP(this.store),p=Vq(),_=Cd(87)||bD()||jT(117),m=(function(){const C=qe();if(C.name!==tt.SAFARI||!C.browserVersion)return!1;const R=C.browserVersion.split(".");return Number(R[0])>18||Number(R[0])===18&&Number(R[1])>=4}()||PD(18,4,!1))&&GT(18,6,!0)&&this.spec.codec==="h264"&&N("ENABLE_ABSSENDTIME_AS_SENTTS"),E=qn({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:hi,browser:navigator.userAgent,process_id:N("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:N("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:qn(qn({enableEncodedTransform:(!!N("ENABLE_AUDIO_METADATA")||!!N("ENABLE_AUDIO_PTS"))&&_||!!N("ENABLE_AUDIO_TOPN")&&FT(tt.CHROME,87,116)||void 0,enableAudioMetadata:!!N("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!N("ENABLE_AUDIO_PTS")&&_,topnSmoothLevel:N("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:N("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:N("TOPN_SWITCH_HOLD_MS"),topnAudioGain:N("TOPN_AUDIO_GAIN"),enablePublishedUserList:N("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:N("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:ni("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:ni("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:ni("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:N("USE_PUB_RTX")===!0||N("USE_SUB_RTX")===!0||void 0,disableFEC:N("DISABLE_FEC"),enableNTPReport:!!N("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:u,enableFulllinkAvSync:!!N("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ni("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!N("FORCE_ENABLE_AUT_CC")||!r_()&&(!!N("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!N("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ni("USE_XR","boolean"),enableLossbasedBwe:ni("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!N("FORCE_ENABLE_AUT_CC")||!r_()&&(!!N("ENABLE_AUT_CC")||void 0),enableCCFallback:ni("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:d?ni("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ni("PUBLISH_TWCC","boolean"),enableSubTWCC:ni("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ni("USE_PUB_RTX","boolean"),enableSubRTX:ni("USE_SUB_RTX","boolean"),enableSubSVC:N("ENABLE_SVC")?N("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0,enableSvcExtended:N("ENABLE_SVC")&&Array.isArray(N("SVC_EXTENDED"))&&N("SVC_EXTENDED").length!==0?N("SVC_EXTENDED"):void 0},p),{},{audioDuplicate:ni("ENABLE_AUDIO_RED","boolean")?(r=ni("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!m||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,N("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new G(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ne.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ne.WS_RECONNECTING,t=>{this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Dn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Se.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ne.WS_CLOSED,t=>{let n;switch(t){case ot.LEAVE:n=Dn.LEAVE;break;case ot.UID_BANNED:case ot.IP_BANNED:case ot.CHANNEL_BANNED:case ot.SERVER_ERROR:n=Dn.SERVER_ERROR;break;case ot.FALLBACK:n=Dn.FALLBACK;break;case ot.LICENSE_MISSING:case ot.LICENSE_EXPIRED:case ot.LICENSE_MINUTES_EXCEEDED:case ot.LICENSE_PERIOD_INVALID:case ot.LICENSE_MULTIPLE_SDK_SERVICE:case ot.LICENSE_ILLEGAL:case ot.TOKEN_EXPIRE:n=t;break;default:n=Dn.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Dn.NETWORK_ERROR)),this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===ot.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==ot.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ne.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=N("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));ht("EVENT_REPORT_DOMAIN",t[1]),ht("EVENT_REPORT_BACKUP_DOMAIN",t[1]),ht("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(ze.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ne.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new G(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Pn(this,mn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(Ne.REQUEST_JOIN_INFO,async(t,n,r)=>{var i,s,a;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const d=Pt((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(N("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var l;let m=d.servers.map(R=>"turnServerURL"in R&&N("USE_TURN_IP")?qn(qn({},R),{},{turnServerURL:I_(R.turnServerURL)}):R),E=(l=d.serversFromGateway)===null||l===void 0?void 0:l.map(R=>N("USE_TURN_IP")?qn(qn({},R),{},{turnServerURL:I_(R.turnServerURL)}):R);const C=this.signal.currentURLIndex;m.length>0&&(m=[m[C%m.length]],d.servers=m),Array.isArray(E)&&E.length>0&&(E=[E[0]],d.serversFromGateway=E),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(C))}const{iceParameters:u,dtlsParameters:p,rtpCapabilities:_}=await Pn(this,mn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d,cloudProxyServer:(a=this.joinInfo)===null||a===void 0?void 0:a.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:u,dtlsParameters:p,rtpCapabilities:_,version:"2"}}))}catch(m){n(m)}}),this.signal.on(Ne.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ne.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,i="";var s;t instanceof G?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):r=t,Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Ne.IS_P2P_DISCONNECTED,t=>{t(Ou(this,mn.IS_P2P_DISCONNECTED))}),this.signal.on(Ne.DISCONNECT_P2P,()=>{this.emit(mn.DISCONNECT_P2P)}),this.signal.on(Ne.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ne.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ne.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(mn.JOIN_RESPONSE,t,n)}),this.signal.on(Ne.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=Pt((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(N("NEW_TURN_MODE")&&s&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var r;let d=s.servers.map(p=>"turnServerURL"in p&&N("USE_TURN_IP")?qn(qn({},p),{},{turnServerURL:I_(p.turnServerURL)}):p),l=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map(p=>N("USE_TURN_IP")?qn(qn({},p),{},{turnServerURL:I_(p.turnServerURL)}):p);const u=this.signal.currentURLIndex;d.length>0&&(d=[d[u%d.length]],s.servers=d),Array.isArray(l)&&l.length>0&&(l=[l[0]],s.serversFromGateway=l),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(u,",in pre pc"))}const a=N("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&a){const d=iL(i);this.emit(mn.PRE_CONNECT_PC,{candidates:d,fingerprint:a,turnServer:s})}}}),this.signal.on(Ne.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof N("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(N("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ae.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Ae.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw T.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ae.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Ae.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw T.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Ae.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(i=>i.stream_type===at.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ae.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find(i=>i.stream_type===at.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ae.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===he.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ae.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===he.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ae.CONTROL,r,!0,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ae.RESTART_ICE,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Dn.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!N("GATEWAY_WSS_ADDRESS"))return N("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ae.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let P_=0,$v=0;function So(e,t,n,r){return new de((i,s)=>{t.timeout=t.timeout||N("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),P_+=Bo(t.data)):n&&(t.data.size?P_+=t.data.size:t.data instanceof FormData?P_+=qD(t.data):P_+=Bo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pr.request(t).then(a=>{typeof a.data=="string"?$v+=Bo(a.data):a.data instanceof ArrayBuffer||a.data instanceof Uint8Array?$v+=a.data.byteLength:$v+=Bo(JSON.stringify(a.data)),r&&i({data:a.data,headers:a.headers}),i(a.data)}).catch(a=>{pr.isCancel(a)?s(new G(O.OPERATION_ABORTED,"cancel token canceled")):a.code==="ECONNABORTED"?s(new G(O.NETWORK_TIMEOUT,a.message)):a.response?s(new G(O.NETWORK_RESPONSE_ERROR,a.response.status)):s(new G(O.NETWORK_ERROR,a.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Q){var ie=0;return function(){return ie<Q.length?{done:!1,value:Q[ie++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Q,ie,fe){return Q==Array.prototype||Q==Object.prototype||(Q[ie]=fe.value),Q},r,i=function(Q){Q=[typeof globalThis=="object"&&globalThis,Q,typeof window=="object"&&window,typeof self=="object"&&self,typeof f=="object"&&f];for(var ie=0;ie<Q.length;++ie){var fe=Q[ie];if(fe&&fe.Math==Math)return fe}throw Error("Cannot find global object")}(this);function s(Q,ie){if(ie)e:{var fe=i;Q=Q.split(".");for(var $=0;$<Q.length-1;$++){var v=Q[$];if(!(v in fe))break e;fe=fe[v]}(ie=ie($=fe[Q=Q[Q.length-1]]))!=$&&ie!=null&&n(fe,Q,{configurable:!0,writable:!0,value:ie})}}function a(Q){return(Q={next:Q})[Symbol.iterator]=function(){return this},Q}function d(Q){var ie=typeof Symbol<"u"&&Symbol.iterator&&Q[Symbol.iterator];return ie?ie.call(Q):{next:t(Q)}}if(s("Symbol",function(Q){function ie(v,P){this.A=v,n(this,"description",{configurable:!0,writable:!0,value:P})}if(Q)return Q;ie.prototype.toString=function(){return this.A};var fe="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",$=0;return function v(P){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new ie(fe+(P||"")+"_"+$++,P)}}),s("Symbol.iterator",function(Q){if(Q)return Q;Q=Symbol("Symbol.iterator");for(var ie="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),fe=0;fe<ie.length;fe++){var $=i[ie[fe]];typeof $=="function"&&typeof $.prototype[Q]!="function"&&n($.prototype,Q,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return Q}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var l;e:{var u={};try{u.__proto__={a:!0},l=u.a;break e}catch{}l=!1}r=l?function(Q,ie){if(Q.__proto__=ie,Q.__proto__!==ie)throw new TypeError(Q+" is not extensible");return Q}:null}var p=r;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function m(Q){if(Q.m)throw new TypeError("Generator is already running");Q.m=!0}function E(Q,ie){return Q.h=3,{value:ie}}function C(Q){this.g=new _,this.G=Q}function R(Q,ie,fe,$){try{var v=ie.call(Q.g.j,fe);if(!(v instanceof Object))throw new TypeError("Iterator result "+v+" is not an object");if(!v.done)return Q.g.m=!1,v;var P=v.value}catch(U){return Q.g.j=null,Q.g.s(U),y(Q)}return Q.g.j=null,$.call(Q.g,P),y(Q)}function y(Q){for(;Q.g.h;)try{var ie=Q.G(Q.g);if(ie)return Q.g.m=!1,{value:ie.value,done:!1}}catch(fe){Q.g.v=void 0,Q.g.s(fe)}if(Q.g.m=!1,Q.g.l){if(ie=Q.g.l,Q.g.l=null,ie.F)throw ie.D;return{value:ie.return,done:!0}}return{value:void 0,done:!0}}function b(Q){this.next=function(ie){return Q.o(ie)},this.throw=function(ie){return Q.s(ie)},this.return=function(ie){return function(fe,$){m(fe.g);var v=fe.g.j;return v?R(fe,"return"in v?v.return:function(P){return{value:P,done:!0}},$,fe.g.return):(fe.g.return($),y(fe))}(Q,ie)},this[Symbol.iterator]=function(){return this}}function A(Q,ie){return ie=new b(new C(ie)),p&&Q.prototype&&p(ie,Q.prototype),ie}if(_.prototype.o=function(Q){this.v=Q},_.prototype.s=function(Q){this.l={D:Q,F:!0},this.h=this.C||this.u},_.prototype.return=function(Q){this.l={return:Q},this.h=this.u},C.prototype.o=function(Q){return m(this.g),this.g.j?R(this,this.g.j.next,Q,this.g.o):(this.g.o(Q),y(this))},C.prototype.s=function(Q){return m(this.g),this.g.j?R(this,this.g.j.throw,Q,this.g.o):(this.g.s(Q),y(this))},s("Array.prototype.entries",function(Q){return Q||function(){return function(ie,fe){ie instanceof String&&(ie+="");var $=0,v=!1,P={next:function(){if(!v&&$<ie.length){var U=$++;return{value:fe(U,ie[U]),done:!1}}return v=!0,{done:!0,value:void 0}}};return P[Symbol.iterator]=function(){return P},P}(this,function(ie,fe){return[ie,fe]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var D=function(Q,ie){for(var fe=0;fe<Q.length;fe++)ie(Q[fe])},V=function(Q){return Q.replace(/\r?\n|\r/g,`\r
`)},x=function(Q,ie,fe){return ie instanceof Blob?(fe=fe!==void 0?fe+"":typeof ie.name=="string"?ie.name:"blob",ie.name===fe&&Object.prototype.toString.call(ie)!=="[object Blob]"||(ie=new File([ie],fe)),[String(Q),ie]):[String(Q),String(ie)]},k=function(Q,ie){if(Q.length<ie)throw new TypeError(ie+" argument required, but only "+Q.length+" present.")},B=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,q=B.FormData,Z=B.XMLHttpRequest&&B.XMLHttpRequest.prototype.send,te=B.Request&&B.fetch,Fe=B.navigator&&B.navigator.sendBeacon,Ge=B.Element&&B.Element.prototype,Oe=B.Symbol&&Symbol.toStringTag;Oe&&(Blob.prototype[Oe]||(Blob.prototype[Oe]="Blob"),"File"in B&&!File.prototype[Oe]&&(File.prototype[Oe]="File"));try{new File([],"")}catch{B.File=function(ie,fe,$){return ie=new Blob(ie,$||{}),Object.defineProperties(ie,{name:{value:fe},lastModified:{value:+($&&$.lastModified!==void 0?new Date($.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Oe&&Object.defineProperty(ie,Oe,{value:"File"}),ie}}var it=function(Q){return Q.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},nt=function(Q){this.i=[];var ie=this;Q&&D(Q.elements,function(fe){if(fe.name&&!fe.disabled&&fe.type!=="submit"&&fe.type!=="button"&&!fe.matches("form fieldset[disabled] *"))if(fe.type==="file"){var $=fe.files&&fe.files.length?fe.files:[new File([],"",{type:"application/octet-stream"})];D($,function(v){ie.append(fe.name,v)})}else fe.type==="select-multiple"||fe.type==="select-one"?D(fe.options,function(v){!v.disabled&&v.selected&&ie.append(fe.name,v.value)}):fe.type==="checkbox"||fe.type==="radio"?fe.checked&&ie.append(fe.name,fe.value):($=fe.type==="textarea"?V(fe.value):fe.value,ie.append(fe.name,$))})};if((e=nt.prototype).append=function(Q,ie,fe){k(arguments,2),this.i.push(x(Q,ie,fe))},e.delete=function(Q){k(arguments,1);var ie=[];Q=String(Q),D(this.i,function(fe){fe[0]!==Q&&ie.push(fe)}),this.i=ie},e.entries=function Q(){var ie,fe=this;return A(Q,function($){if($.h==1&&(ie=0),$.h!=3)return ie<fe.i.length?$=E($,fe.i[ie]):($.h=0,$=void 0),$;ie++,$.h=2})},e.forEach=function(Q,ie){k(arguments,1);for(var fe=d(this),$=fe.next();!$.done;$=fe.next()){var v=d($.value);$=v.next().value,v=v.next().value,Q.call(ie,v,$,this)}},e.get=function(Q){k(arguments,1);var ie=this.i;Q=String(Q);for(var fe=0;fe<ie.length;fe++)if(ie[fe][0]===Q)return ie[fe][1];return null},e.getAll=function(Q){k(arguments,1);var ie=[];return Q=String(Q),D(this.i,function(fe){fe[0]===Q&&ie.push(fe[1])}),ie},e.has=function(Q){k(arguments,1),Q=String(Q);for(var ie=0;ie<this.i.length;ie++)if(this.i[ie][0]===Q)return!0;return!1},e.keys=function Q(){var ie,fe,$,v,P=this;return A(Q,function(U){if(U.h==1&&(ie=d(P),fe=ie.next()),U.h!=3)return fe.done?void(U.h=0):($=fe.value,v=d($),E(U,v.next().value));fe=ie.next(),U.h=2})},e.set=function(Q,ie,fe){k(arguments,2),Q=String(Q);var $=[],v=x(Q,ie,fe),P=!0;D(this.i,function(U){U[0]===Q?P&&(P=!$.push(v)):$.push(U)}),P&&$.push(v),this.i=$},e.values=function Q(){var ie,fe,$,v,P=this;return A(Q,function(U){if(U.h==1&&(ie=d(P),fe=ie.next()),U.h!=3)return fe.done?void(U.h=0):($=fe.value,(v=d($)).next(),E(U,v.next().value));fe=ie.next(),U.h=2})},nt.prototype._asNative=function(){for(var Q=new q,ie=d(this),fe=ie.next();!fe.done;fe=ie.next()){var $=d(fe.value);fe=$.next().value,$=$.next().value,Q.append(fe,$)}return Q},nt.prototype._blob=function(){var Q="----formdata-polyfill-"+Math.random(),ie=[],fe="--"+Q+`\r
Content-Disposition: form-data; name="`;return this.forEach(function($,v){return typeof $=="string"?ie.push(fe+it(V(v))+`"\r
\r
`+V($)+`\r
`):ie.push(fe+it(V(v))+'"; filename="'+it($.name)+`"\r
Content-Type: `+($.type||"application/octet-stream")+`\r
\r
`,$,`\r
`)}),ie.push("--"+Q+"--"),new Blob(ie,{type:"multipart/form-data; boundary="+Q})},nt.prototype[Symbol.iterator]=function(){return this.entries()},nt.prototype.toString=function(){return"[object FormData]"},Ge&&!Ge.matches&&(Ge.matches=Ge.matchesSelector||Ge.mozMatchesSelector||Ge.msMatchesSelector||Ge.oMatchesSelector||Ge.webkitMatchesSelector||function(Q){for(var ie=(Q=(this.document||this.ownerDocument).querySelectorAll(Q)).length;0<=--ie&&Q.item(ie)!==this;);return-1<ie}),Oe&&(nt.prototype[Oe]="FormData"),Z){var Gn=B.XMLHttpRequest.prototype.setRequestHeader;B.XMLHttpRequest.prototype.setRequestHeader=function(Q,ie){Gn.call(this,Q,ie),Q.toLowerCase()==="content-type"&&(this.B=!0)},B.XMLHttpRequest.prototype.send=function(Q){Q instanceof nt?(Q=Q._blob(),this.B||this.setRequestHeader("Content-Type",Q.type),Z.call(this,Q)):Z.call(this,Q)}}te&&(B.fetch=function(Q,ie){return ie&&ie.body&&ie.body instanceof nt&&(ie.body=ie.body._blob()),te.call(this,Q,ie)}),Fe&&(B.navigator.sendBeacon=function(Q,ie){return ie instanceof nt&&(ie=ie._asNative()),Fe.call(this,Q,ie)}),B.FormData=nt}})();const zu=()=>{const e=N("AREAS");return e.length===0&&e.push(rt.GLOBAL),Di(e).call(e,(t,n,r)=>{const i=EL(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},EL=e=>e===rt.OVERSEA?"".concat(Fn.ASIA,",").concat(Fn.EUROPE,",").concat(Fn.AFRICA,",").concat(Fn.NORTH_AMERICA,",").concat(Fn.SOUTH_AMERICA,",").concat(Fn.OCEANIA):Fn[e],Bq=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=y_[n],i=Object.keys(r);i&&i.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))})}),t},k_={GLOBAL:{ASIA:[rt.CHINA,rt.JAPAN,rt.INDIA,rt.KOREA,rt.HKMC],EUROPE:[],NORTH_AMERICA:[rt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},L_=Object.keys(k_[rt.GLOBAL]),eR=[rt.CHINA,rt.NORTH_AMERICA,rt.EUROPE,rt.ASIA,rt.JAPAN,rt.INDIA,rt.OCEANIA,rt.SOUTH_AMERICA,rt.AFRICA,rt.KOREA,rt.HKMC,rt.US],jq=function(e,t){let n=[];if(oe(e).call(e,rt.GLOBAL)){const s=[rt.GLOBAL,rt.OVERSEA],a=Object.keys(y_);if(t===rt.GLOBAL)throw new G(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===rt.CHINA)n=[rt.OVERSEA];else if(i=t,oe(L_).call(L_,i)){const d=(r=t,k_[rt.GLOBAL][r]||[]),l=[...s,t,...d];n=a.filter(u=>!oe(l).call(l,u))}else if(function(d){let l=!1;return L_.forEach(u=>{var p;oe(p=k_[rt.GLOBAL][u]).call(p,d)&&(l=!0)}),l}(t)){const d=function(u){let p;return L_.forEach(_=>{var m;oe(m=k_[rt.GLOBAL][_]).call(m,u)&&(p=_)}),p}(t),l=[...s,d,t];n=a.filter(u=>!oe(l).call(l,u))}else n=e;n=function(d){const l=[];return eR.forEach(u=>{oe(d).call(d,u)&&l.push(u)}),l.concat(d.filter(u=>!oe(eR).call(eR,u)))}(n)}else n=e;var r,i;return n};function gL(e){var t,n;if(!e&&oe(t=N("AREAS")).call(t,rt.EXTENSIONS))return T.debug("update area from ap : reset"),void tR(X7,!0);if(!oe(n=N("AREAS")).call(n,rt.GLOBAL)||!e)return;let r=y_.EXTENSIONS;r&&(r={CODE:EL(rt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},T.debug("update area from ap success: ".concat(e,",config is "),r),ht("AREAS",[rt.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?ht(i,r[i][0]):ht(i,r[i])}))}function tR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Se.reportApiInvoke(null,{name:Wt.SET_AREA,options:e,tag:Dt.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!oe(F1).call(F1,s))throw new G(O.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:a}=e;if(!s)throw new G(O.INVALID_PARAMS,"area code is needed");let d=s;typeof s=="string"&&(d=[s]),r=a?jq(d,a):d}if(!t){if(_o.AREAS){const s=new G(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void T.warning("setArea is prohibited because of config-distribute")}if(oe(r).call(r,rt.GLOBAL)&&N("AREAS")===rt.EXTENSIONS){const s=new G(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void T.warning("setArea is prohibited because of ap extensions")}}ht("AREAS",r,t);const i=Bq(r);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?ht(s,i[s][0]):ht(s,i[s])}),T.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function SL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Yo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?SL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let nR=1;function Gq(e,t,n,r,i){nR+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:nR,requestId:nR,version:hi,cname:n.cname},a={service_name:t,json_body:JSON.stringify(s)};let d,l,u=e[0];return fo(async()=>{d=Date.now();const p=await So(u,{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-d,p.code!==0){const E=new G(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:l});throw T.error(E.toString()),E}const _=JSON.parse(p.json_body);if(_.code!==200){const E=new G(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:l});throw T.error(E.toString()),E}if(!_.servers||_.servers.length===0){const E=new G(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:l});throw T.error(E.toString()),E}const m=function(E,C){return{addressList:E.servers.map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(R.wss,"?serviceName=").concat(encodeURIComponent(C))),workerToken:E.workerToken,vid:E.vid}}(_,t);return N("LIVE_STREAMING_ADDRESS")&&(m.addressList=N("LIVE_STREAMING_ADDRESS")instanceof Array?N("LIVE_STREAMING_ADDRESS"):[N("LIVE_STREAMING_ADDRESS")]),Yo(Yo({},m),{},{responseTime:l})},(p,_)=>(Se.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:_===0,responseTime:l,serverIp:e[_%e.length]}),!1),(p,_)=>(Se.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:l,serverIp:e[_%e.length]}),!!(p.code!==O.OPERATION_ABORTED&&p.code!==O.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(u=e[(_+1)%e.length],!0)),i)}let rR=1;function TL(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:a,sid:d}=t,l=Date.now();let u;const p=t.role,[_,m]=oR(t,s,[qt.CHOOSE_SERVER]);let E=Yt.networkState;return fo(async()=>{E&&Yt.networkState===xr.OFFLINE&&Yt.onlineWaiter&&await de.race([Yt.onlineWaiter,yn(r&&r.maxRetryTimeout||Qt.maxRetryTimeout)]),E=Yt.networkState;const{data:C,headers:R}=await So(i,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=R.http3==="1"?1:-1,Se.reportResourceTiming(i,d),RL(C,i,t,l,[qt.CHOOSE_SERVER],u);const y=Gu(C,qt.CHOOSE_SERVER);return iR(y),qv(y,i)},C=>(C&&Se.joinChooseServer(d,{role:p,lts:l,succ:!0,csAddr:i,opid:m,serverList:C.gatewayAddrs.map(R=>R.address),ec:null,cid:C.cid.toString(),uid:C.uid.toString(),csIp:C.csIp,unilbsServerIds:[qt.CHOOSE_SERVER].toString(),isHttp3:u,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:C.res.detail&&C.res.detail[38]}),!1),C=>C.code!==O.OPERATION_ABORTED&&(C.code===O.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(Se.joinChooseServer(d,{role:p,lts:l,succ:!1,csAddr:i,serverList:null,opid:m,ec:C.code,csIp:C.data&&C.data.csIp,unilbsServerIds:[qt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:u,corssRegionTagReq:t.apRequestDetail}),T.warning("[".concat(a||"sid-".concat(d.slice(0,6)),"] Choose server network error, retry"),C),!0)),r)}function vL(e,t,n,r){let i,{url:s,areaCode:a,serviceIds:d}=e;const l=Date.now(),u=t.role,[p,_]=oR(t,a,d);let m;return fo(async()=>{m&&Yt.networkState===xr.OFFLINE&&Yt.onlineWaiter&&await de.race([Yt.onlineWaiter,yn(r&&r.maxRetryTimeout||Qt.maxRetryTimeout)]),m=Yt.networkState;const{data:E,headers:C}=await So(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=C.http3==="1"?1:-1,Se.reportResourceTiming(s,t.sid),RL(E,s,t,l,d,i);const R=Gu(E,qt.CHOOSE_SERVER),y=Gu(E,t.cloudProxyServer==="proxy5"?qt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?qt.CLOUD_PROXY:qt.CLOUD_PROXY_FALLBACK),b=performance.getEntriesByName(s),A=b[b.length-1];let D;return A&&(D={name:A.name,protocol:"nextHopProtocol"in A?A.nextHopProtocol:"",dnscost:"domainLookupEnd"in A&&"domainLookupStart"in A&&typeof A.domainLookupEnd=="number"&&typeof A.domainLookupStart=="number"?A.domainLookupEnd-A.domainLookupStart:-1,tcpTlsCost:"connectEnd"in A&&"connectStart"in A&&typeof A.connectEnd=="number"&&typeof A.connectStart=="number"?A.connectEnd-A.connectStart:-1,reqCost:"requestStart"in A&&typeof A.requestStart=="number"&&"responseEnd"in A&&typeof A.responseEnd=="number"?A.responseEnd-A.requestStart:-1,handleCost:"leave_ts"in E&&"enter_ts"in E&&typeof E.leave_ts=="number"&&typeof E.enter_ts=="number"?E.leave_ts-E.enter_ts:-1}),iR(R),{gatewayInfo:qv(R,s),proxyInfo:y,url:s,resourceTimingInfo:D}},E=>(E.gatewayInfo&&Se.joinChooseServer(t.sid,{role:u,lts:l,succ:!0,csAddr:s,serverList:E.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:_,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:d.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:E.gatewayInfo.res.detail&&E.gatewayInfo.res.detail[38],resourceTimingInfo:E.resourceTimingInfo?JSON.stringify(E.resourceTimingInfo):void 0}),E.proxyInfo&&Se.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:s,turnServerAddrList:E.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1),E=>E.code!==O.OPERATION_ABORTED&&(E.code===O.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(Se.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:E.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:JSON.stringify({networkState:m})}),T.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),E),!0)),r)}const RL=(e,t,n,r,i,s)=>{const{sid:a,clientId:d,cloudProxyServer:l}=n,u=[],p=_=>{_.flag===4096?Se.joinChooseServer(a,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||Se.joinWebProxyAP(a,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:_.error.code,eventType:l,unilbsServerIds:i.toString()})};if(e.response_body.forEach(_=>{const m=_.buffer.code;if(_.uri===23&&m===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{const E={error:new G(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:_.buffer.flag};u.push(E),p(E)}if(m!==0){const E=Yd(m),C={error:new G(O.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:e.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?T.warning(C.error.toString()):u.push(C),p(C)}}),u.length)throw T.warning("[".concat(d||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(u.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new G(O.CAN_NOT_GET_GATEWAY_SERVER,u.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!u.find(_=>_.error.data.retry),csIp:e.detail[502],desc:[...new Set(u.map(_=>{var m;return _==null||(m=_.error)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.desc}).filter(_=>!!_))]})},iR=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new G(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(N("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?gL(e.detail[23].toLowerCase()):gL()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const a=e.detail[19],d=a==null?void 0:a.split(";");for(let l=0;l<d.length;l++){var s;const u=Qn(s=d[l]).call(s);e.addresses[l]&&d&&(e.addresses[l].fingerprint=u)}}if(N("GATEWAY_ADDRESS")&&N("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",N("GATEWAY_ADDRESS"));const a=N("GATEWAY_ADDRESS").map(d=>{var l,u;const p=(l=(u=e.addresses.find(_=>_.ip===d.ip&&_.port===d.port))===null||u===void 0?void 0:u.fingerprint)!==null&&l!==void 0?l:"";return{ip:d.ip,port:d.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p}});e.addresses=a}},Wq=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=Yd(n.buffer.code);throw new G(O.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",t),new G(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},oR=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Yo(Yo(Yo({6:e.stringUid,11:t,12:N("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach(d=>{e.multiIP&&e.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(s)),[a,r]},Hq=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let Qd=0;function Zd(e){return de.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Yu=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,a=0;const d=t;let l,u=0;const p=async()=>{const _=(()=>{const m=a*d,E=m+d;return n.slice(m,E).map(r)})();s&&s.push(..._);try{l=await Zd(_)}catch(m){if(u+=d,a++,!(u>=n.length))return void await p();i(m)}_.forEach(m=>m.cancel())};return await p(),l},yL=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const a=async()=>{const d=n(t.shift());try{return await d}catch(l){if(s++,s>=i||r!=null&&r(l))throw l;return a()}};return a()};async function Kq(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],a=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new de((l,u)=>{let p;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:m=>{m.close(),clearTimeout(p),l(!0)},error:m=>{clearTimeout(p),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const _=[t,n,r,i,s,a];for(let m=0;m<_.length;m++){const E=new EncodedVideoChunk({type:m==0?"key":"delta",timestamp:33333*m,duration:33333,data:new Uint8Array(_[m])});try{await e.decode(E)}catch{return void l(!1)}}})(),p=setTimeout(()=>{l(!1)},5e3)})}async function sR(e,t,n,r){return{gatewayInfo:await async function(s,a,d,l){let u=null;const p=[],_=async()=>{const E=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:zu()})),C=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(y=>y.url)}),R=await Yu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:y=>(T.debug("[".concat(s.clientId,"] Connect to choose_server:"),y.url),TL(y,s,a,d)),allFailedhandler:y=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:p});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R},m=async()=>{if(await yn(1e3),u!==null)return u;const E=N("WEBCS_DOMAIN_BACKUP_LIST").map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:zu()})),C=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(y=>y.url)}),R=await Yu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:y=>(T.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),y.url),TL(y,s,a,d)),allFailedhandler:y=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:p});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R};try{return u=await Zd([_(),m()]),p.length&&p.forEach(E=>E.cancel&&typeof E.cancel=="function"&&E.cancel()),u}catch(E){throw E[0]}}(e,t,n,r)}}async function CL(e,t,n,r,i){const s=e.cloudProxyServer;if(s==="disabled"){if(!r)return;if(e.useLocalAccessPoint)return await sR(e,t,n,i);if(N("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:m,proxyInfo:E}=await AL(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:m};const C=E.map(R=>({turnServerURL:R.address,tcpport:R.tcpport||kn.tcpport,udpport:R.udpport||kn.udpport,username:R.username||kn.username,password:R.password||kn.password,forceturn:!1,security:!0}));if(i.useP2P){var a;const R=(a=e.uid)!==null&&a!==void 0?a:m.uid,y="glb:".concat(R.toString()),b=await XT(y),A=E.map(D=>({turnServerURL:D.address,tcpport:D.tcpport||kn.tcpport,udpport:D.udpport||kn.udpport,username:y,password:b,forceturn:!1,security:!0}));C.push(...A)}return e.turnServer={mode:"manual",servers:C},{gatewayInfo:m}}return await sR(e,t,n,i)}const{proxyInfo:d,gatewayInfo:l}=await AL(e,t,n,i),u={gatewayInfo:l},p=d.map(m=>({turnServerURL:m.address,tcpport:s==="proxy3"?void 0:m.tcpport?m.tcpport:kn.tcpport,udpport:s==="proxy4"?void 0:m.udpport?m.udpport:kn.udpport,username:m.username||kn.username,password:m.password||kn.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var _;const m=(_=e.uid)!==null&&_!==void 0?_:l.uid,E="glb:".concat(m.toString()),C=await XT(E),R=d.map(y=>({turnServerURL:y.address,tcpport:s==="proxy3"?void 0:y.tcpport||kn.tcpport,udpport:s==="proxy4"?void 0:y.udpport||kn.udpport,username:E,password:C,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...R)}return e.turnServer={mode:"manual",servers:p},T.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),u}async function IL(e,t,n,r,i){const s=N("ACCOUNT_REGISTER").slice(0,N("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?s.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):s.map(l=>"https://".concat(l,"/api/v1"));const d=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const l=await async function(u,p,_,m,E){const C=Date.now(),R={sid:_.sid,opid:10,appid:_.appId,string_uid:p};let y=u[0];const b=await fo(()=>So(y+"".concat(y.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(A,D)=>{if(A.code===0){if(A.uid<=0||A.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(p," => ").concat(A.uid),A),Se.reqUserAccount(R.sid,{lts:C,success:!1,serverAddr:y,stringUid:R.string_uid,uid:A.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:R}),new G(O.INVALID_UINT_UID_FROM_STRING_UID);return Se.reqUserAccount(R.sid,{lts:C,success:!0,serverAddr:y,stringUid:R.string_uid,uid:A.uid,errorCode:null,extend:R}),!1}const V=Yd(A.code);return V.retry&&(y=u[(D+1)%u.length]),Se.reqUserAccount(R.sid,{lts:C,success:!1,serverAddr:y,stringUid:R.string_uid,uid:A.uid,errorCode:V.desc,extend:R}),V.retry},(A,D)=>A.code!==O.OPERATION_ABORTED&&(Se.reqUserAccount(R.sid,{lts:C,success:!1,serverAddr:y,stringUid:R.string_uid,uid:null,errorCode:A.code,extend:R}),y=u[(D+1)%u.length],!0),E);if(b.code!==0){const A=Yd(b.code);throw new G(O.UNEXPECTED_RESPONSE,A.desc)}return b}(a,e,t,n,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},d),l.uid}catch(l){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},d),l}}async function zq(e,t,n){const r=N("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await yL({referenceList:i,asyncMapHandler:a=>async function(d,l,u,p){const _=Date.now(),m={sid:u.sid,opid:10,appid:u.appId,string_uid:l};try{const E=await So(d+"".concat(d.indexOf("?")===-1?"?":"&","action=stringuid"),{data:m,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(E.code!==0){const C=Yd(E.code);throw new G(O.UNEXPECTED_RESPONSE,"preload sua error:".concat(C.desc),C)}if(E.uid<=0||E.uid>=Math.pow(2,32))throw new G(O.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_,url:d,req:m,uid:E.uid,elapse:Date.now()-_}}catch(E){throw E}}(a,e,t,n),closeFn:a=>a.code===O.OPERATION_ABORTED||a.code===O.UNEXPECTED_RESPONSE&&!a.data.retry})}catch(s){throw s}}async function Yq(e,t,n){const r=N("CDS_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")),i=r.map(l=>function(u,p,_,m){const E=qe(),C={flag:64,cipher_method:0,features:Yo(Yo(Yo(Yo(Yo({install_id:sv(),device:E.name,system:E.os,system_general:navigator.userAgent,vendor:p.appId,version:hi,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:xq.WEB_RTC,browser_name:E.name,browser_version:E.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),E.os&&{os_name:E.os}),E.osVersion&&{os_version:E.osVersion}),{},{detail:""})};return fo(()=>So(u,{data:C,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,R=>R.code!==O.OPERATION_ABORTED,m)}(l,e,t,n));let s=null,a=null,d={};try{s=await Zd(i)}catch(l){if(l.code===O.OPERATION_ABORTED)throw l;a=l}if(i.forEach(l=>l.cancel()),Se.reportApiInvoke(e.sid,{name:Wt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:s}}).onSuccess(),s&&s.test_tags)try{d=function(l){if(!l.test_tags)return{};const u=l.test_tags,p=Object.keys(u),_={};return p.forEach(m=>{var E;const C=Qn(E=m.slice(4)).call(E),R=JSON.parse(u[m]),y=R[1];_[C]={tag:R[0]||"",value:y}}),_}(s)}catch{}return d}async function wL(e,t){const n=N("WEBCS_DOMAIN").concat(N("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:zu(),serviceIds:[qt.CHOOSE_SERVER,qt.CLOUD_PROXY_FALLBACK]}));try{return await yL({referenceList:n,asyncMapHandler:i=>async function(s,a,d){let l,{url:u,areaCode:p,serviceIds:_}=s;const m=Date.now(),[E,C]=oR(a,p,_);let R=Yt.networkState;try{R&&Yt.networkState===xr.OFFLINE&&Yt.onlineWaiter&&await de.race([Yt.onlineWaiter,yn(Qt.maxRetryTimeout)]),R=Yt.networkState;const{data:y,headers:b}=await So(u,{data:E,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=b.http3==="1"?1:-1,(x=>{const k=[];if(x.response_body.forEach(B=>{const q=B.buffer.code;if(B.uri===23&&q===0&&!B.buffer.edges_services)if(B.buffer.flag===4194310)B.buffer.edges_services=[];else{const Z={error:new G(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:x.detail[502]}),flag:B.buffer.flag};k.push(Z)}if(q!==0){const Z=Yd(q),te={error:new G(O.CAN_NOT_GET_GATEWAY_SERVER,Z.desc,{desc:Z.desc,retry:Z.retry,csIp:x.detail[502]}),flag:B.buffer.flag};B.buffer.flag===4194310?T.warning(te.error.toString()):k.push(te)}}),k.length)throw new G(O.CAN_NOT_GET_GATEWAY_SERVER,k.map(B=>"flag: ".concat(B.flag,", message: ").concat(B.error.message)).join(" | "),{retry:!!k.find(B=>B.error.data.retry),csIp:x.detail[502],desc:[...new Set(k.map(B=>{var q;return B==null||(q=B.error)===null||q===void 0||(q=q.data)===null||q===void 0?void 0:q.desc}).filter(B=>!!B))]})})(y);const D=Gu(y,qt.CHOOSE_SERVER),V=Gu(y,qt.CLOUD_PROXY_FALLBACK);return iR(D),{gatewayInfo:qv(D,u),proxyInfo:V,opid:C,requestTime:m,url:u,isHttp3:l,elapse:Date.now()-m}}catch(y){throw y}}(i,e,t),closeFn:i=>i.code===O.OPERATION_ABORTED||i.code===O.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function AL(e,t,n,r){const i=N("PROXY_SERVER_TYPE3"),s=(E,C,R)=>{let y=R||i;return Array.isArray(y)&&(y=C%2==0&&i[1]||i[0]),"https://".concat(y,"/ap/?url=").concat(E)};let a=null;const d=[],l=async()=>{const E=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map((y,b)=>{let A;return A=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:A,areaCode:zu(),serviceIds:[qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?qt.CLOUD_PROXY:qt.CLOUD_PROXY_FALLBACK]}}),C=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(y=>y.url)}),R=await Yu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to choose_server:"),y.url),vL(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R},u=async()=>{if(await yn(1e3),a!==null)return a;const E=N("WEBCS_DOMAIN_BACKUP_LIST").map((y,b)=>{let A;return A=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:A,areaCode:zu(),serviceIds:[qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?qt.CLOUD_PROXY:qt.CLOUD_PROXY_FALLBACK]}}),C=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(y=>y.url)}),R=await Yu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:y=>(T.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),y.url),vL(y,e,t,n)),allFailedhandler:y=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R};let p,_,m;try{({gatewayInfo:p,proxyInfo:_,url:m}=await Zd([l(),u()]))}catch(E){throw E[0]}if(d.length&&d.forEach(E=>E.cancel&&typeof E.cancel=="function"&&E.cancel()),!p||!_)throw new G(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=m,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&m){const E=/^https?:\/\/(.+?)(\/.*)?$/.exec(m)[1];oe(i).call(i,E)&&(e.proxyServer=E,T.setProxyServer(E),Se.setProxyServer(E))}return a={gatewayInfo:p,proxyInfo:await Q1(_,p.uid)},a}async function qq(e,t,n){const r=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=r.map(s=>function(a,d,l,u){const p={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:hi,cname:d.cname,uid:d.uid.toString(),requestId:rR,seq:rR};rR+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(p)};return fo(async()=>{const m=await So(a,{data:_,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(m.code!==0){const C=new G(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+m.code,{retry:!0});throw T.error(C.toString()),C}const E=JSON.parse(m.json_body);if(E.code!==200){const C=new G(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(E.code,", reason: ").concat(E.reason));throw T.error(C.toString()),C}if(!E.servers||E.servers.length===0){const C=new G(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(C.toString()),C}return{vid:E.vid,workerToken:E.workerToken,addressList:(N("CHANNEL_MEDIA_RELAY_SERVERS")||E.servers).map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(C.wss))}},void 0,m=>!!(m.code!==O.OPERATION_ABORTED&&m.code!==O.UNEXPECTED_RESPONSE||m.data&&m.data.retry),u)}(s,e,t,n));try{const s=await Zd(i);return i.forEach(a=>a.cancel()),s}catch(s){throw s[0]}}async function Xq(e,t,n){let r=null;const i=[],s=async a=>{const d=N(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return a&&(await yn(1e3),r!==null)?r:await Yu({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:l=>(T.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),l),function(u,p,_,m){const[E]=Hq(p,[qt.CHOOSE_SERVER]);let C=Yt.networkState;return fo(async()=>{C&&Yt.networkState===xr.OFFLINE&&Yt.onlineWaiter&&await de.race([Yt.onlineWaiter,yn(m&&m.maxRetryTimeout||Qt.maxRetryTimeout)]),C=Yt.networkState;const R=await So(u,{data:E,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return Wq(R,u)},()=>!1,R=>R.code!==O.OPERATION_ABORTED&&(R.code===O.UPDATE_TICKET_FAILED?R.data.retry:(T.warning("[".concat(p.clientId,"] update ticket network error, retry"),R),!0)),m)}(l,e,t,n)),allFailedhandler:l=>{throw l[0]},promisesCollector:i})};try{return r=await Zd([s(!1),s(!0)]),i.length&&i.forEach(a=>a.cancel&&typeof a.cancel=="function"&&a.cancel()),r}catch(a){throw a[0]}}function bL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function aR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Jq extends Lt{get isSuccess(){return!!this.configs}constructor(t,n){super(),w(this,"configs",void 0),w(this,"store",void 0),w(this,"joinInfo",void 0),w(this,"cancelToken",void 0),w(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),w(this,"interval",void 0),w(this,"mutex",void 0),w(this,"mutableParamsRead",!1),w(this,"configCache",{}),w(this,"limit_bitrate",void 0),this.mutex=new xn("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),N("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},N("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Se.reportApiInvoke(null,{options:void 0,name:Wt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Dt.TRACER}).onSuccess(JSON.stringify(_o))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await Yq(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(i){var s;const a=Qa(s=Object.keys(i).filter(u=>/^webrtc_ng_global_parameter/.test(u))).call(s);for(let u=0;u<a.length;u++)for(let p=a.length-1;p>u;p--){const _=a[p],m=i[_].value;if(typeof m.__priority=="number"){const E=m.__priority,C=a[p-1],R=i[C].value;if(typeof R.__priority=="number"){if(!(E>R.__priority))continue;{const y=_;a[p]=a[p-1],a[p-1]=y}}else{const y=_;a[p]=a[p-1],a[p-1]=y}}}const d=Date.now();let l={};return a.forEach(u=>{const p=i[u].value.__expires;p&&p<=d||(l[u]=i[u])}),l}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new G(O.NETWORK_RESPONSE_ERROR,r);T.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){B1(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Fu.UPDATE_BITRATE_LIMIT,t):this.emit(Fu.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&aR({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),i=[];r.forEach(s=>{const a=t[s].value;n[s]=a;const d=a.__id;if(d&&this.configCache[s]&&this.configCache[s].__id===d)return;const l=a.__type,u=t[s].value,p=t[s].tag;let _=0;l?l===lP.REALTIME&&(_=1):Object.keys(u).some(m=>Object.prototype.hasOwnProperty.call(lv,m)||!xv()&&Object.prototype.hasOwnProperty.call(t_,m)?(_=1,!0):void 0),i.push({tag:p,isApplied:_,feature:s,params:JSON.stringify(a)})}),i.forEach(s=>{let{tag:a,feature:d,params:l,isApplied:u}=s;this.store.sessionId&&Se.abTest(this.store.sessionId,{intSucc:1,isApplied:u,tag:a,feature:d,params:l,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){T.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(i){const s={};return Object.keys(i).forEach(a=>{const d=i[a].value,l=d.__expires,u=d.__type;Object.keys(d).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=aR(aR({value:d[p]},l&&{expires:l}),u&&{type:u}))})}),s}(t);try{var r;const i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&B1(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(d){try{const l=Date.now();Object.keys(d).forEach(u=>{const{value:p,type:_,expires:m}=d[u];m&&m<=l||((_===lP.REALTIME||Object.prototype.hasOwnProperty.call(lv,u))&&(_o[u]=p,Ot[u]=p,T.debug("Update realtime parameters from config distribute",u,p)),_||xv()||!Object.prototype.hasOwnProperty.call(t_,u)||(_o[u]=p,Ot[u]=p,T.debug("Update gateway parameters from config distribute",u,p)))})}catch(l){T.error("Error update config immediately: ".concat(d),l.message)}}(n);const s=JSON.stringify(n),a=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",a),T.debug("Caching global parameters ".concat(s))}catch(i){T.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ot,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;(function(a,d){try{return typeof a=="object"&&typeof d=="object"&&JSON.stringify(a)===JSON.stringify(d)}catch{return!1}})(Ot[r],i)||(_o[r]=i,Ot[r]=i,this.emit(Fu.UPDATE_CLIENT_ROLE_OPTIONS,i),T.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(n){T.error("Error handling global parameter config:",n.message)}}}class Qq extends Lt{constructor(){super(...arguments),w(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(N("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?N("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var a;const d=oe(a=i.result).call(a,!0);i.isPrevNormal&&!d&&this.emit("exception",cR[t],t,n),!i.isPrevNormal&&d&&this.emit("exception",cR[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=d,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof rn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Vr(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||oe(n=N("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof rn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const cR={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},jn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function OL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function gc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?OL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class qu{constructor(t){w(this,"store",void 0),w(this,"onStatsException",void 0),w(this,"onUploadPublishDuration",void 0),w(this,"onStatsChanged",void 0),w(this,"onVideoCodecChanged",void 0),w(this,"localStats",new Map),w(this,"remoteStats",new Map),w(this,"updateStatsInterval",void 0),w(this,"trafficStats",void 0),w(this,"trafficStatsPeerList",[]),w(this,"uplinkStats",void 0),w(this,"exceptionMonitor",void 0),w(this,"p2pChannel",void 0),w(this,"scalabilityMode",e_.L1T1),w(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Qq,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ee.LocalAudioTrack)||gc({},mv)}getLocalVideoTrackStats(){return this.localStats.get(ee.LocalVideoTrack)||gc({},Ev)}getRemoteAudioTrackStats(t){const n=(s,a)=>{if(!this.trafficStats)return a;const d=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return d&&(a.publishDuration=d.B_ppad+(Date.now()-this.trafficStats.timestamp)),a},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[a,{audioStats:d}]=s;d&&(r[a]=n(a,d))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:a}]=i;a&&(n[s]=a)});return n}getRemoteVideoTrackStats(t){const n=(s,a)=>{if(!this.trafficStats)return a;const d=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return d&&(a.publishDuration=d.B_ppvd+(Date.now()-this.trafficStats.timestamp)),a},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[a,{videoStats:d}]=s;d&&(r[a]=n(a,d))});return r}getRTCStats(){let t=0,n=0,r=0,i=0;const s=this.localStats.get(ee.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const a=this.localStats.get(ee.LocalVideoTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const d=this.localStats.get(ee.LocalVideoLowTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate),this.remoteStats.forEach(u=>{let{audioStats:p,videoStats:_}=u;p&&(r+=p.receiveBytes,i+=p.receiveBitrate),_&&(r+=_.receiveBytes,i+=_.receiveBitrate)});let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?jn.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,a=i!=null&&i.audioSSRC?jn.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>a?s:a),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case ee.LocalVideoTrack:case ee.LocalVideoLowTrack:{const d=i,l=gc({},Ev),u=t.getStats(),p=t.getLocalMedia(r);if(u){const _=u.videoSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){const m=t.getLocalVideoSize(),E=t.getEncoderConfig(ee.LocalVideoTrack);var s;(_.codec==="H264"||_.codec==="H265"||_.codec==="VP8"||_.codec==="VP9"||_.codec==="AV1X"||_.codec==="AV1")&&(l.codecType=_.codec,(d==null?void 0:d.codecType)!==_.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,_.codec.toLocaleLowerCase()))),l.sendBytes=_.bytes,l.sendBitrate=d?8*Math.max(0,l.sendBytes-d.sendBytes):0,_.inputFrame?(l.captureFrameRate=_.inputFrame.frameRate,l.captureResolutionHeight=_.inputFrame.height,l.captureResolutionWidth=_.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),_.sentFrame?(l.sendFrameRate=_.sentFrame.frameRate,l.sendResolutionHeight=_.sentFrame.height,l.sendResolutionWidth=_.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),_.avgEncodeMs&&(l.encodeDelay=_.avgEncodeMs),E&&E.bitrateMax?l.targetSendBitrate=1e3*E.bitrateMax:_.targetBitrate&&(l.targetSendBitrate=_.targetBitrate),l.sendPackets=_.packets,l.sendPacketsLost=_.packetsLost,l.sendJitterMs=_.jitterMs,l.sendRttMs=_.rttMs,l.totalDuration=d?d.totalDuration+1:1,l.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(l.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(r,l),((d==null?void 0:d.sendResolutionWidth)!==l.sendResolutionWidth||(d==null?void 0:d.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,l);break}case ee.LocalAudioTrack:{const d=i,l=gc({},mv),u=t.getStats(),p=t.getLocalMedia(r);if(u){const _=u.audioSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(l.codecType=_.codec),_.inputLevel)l.sendVolumeLevel=Math.round(32767*_.inputLevel);else{const m=t.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=_.bytes,l.sendPackets=_.packets,l.sendPacketsLost=_.packetsLost,l.sendJitterMs=_.jitterMs,l.sendRttMs=_.rttMs,l.sendBitrate=d?8*Math.max(0,l.sendBytes-d.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ee.LocalAudioTrack,l),l&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[s,{videoStats:a,audioStats:d,videoPcStats:l}]=n;const u=d,p=a,_=l,m=gc({},vP),E=gc({},RP),C=gc({},L7),{audioTrack:R,videoTrack:y,audioSSRC:b,videoSSRC:A}=t.getRemoteMedia(s);let D;D=this.store.useP2P?t.getStats(!0):t.getStats();const V=(r=D)===null||r===void 0?void 0:r.audioRecv.find(q=>q.ssrc===b),x=(i=D)===null||i===void 0?void 0:i.videoRecv.find(q=>q.ssrc===A),k=this.trafficStats&&this.trafficStats.peer_delay.find(q=>q.peer_uid===s);if(V&&(V.codec!=="opus"&&V.codec!=="aac"&&V.codec!=="PCMU"&&V.codec!=="PCMA"&&V.codec!=="G722"||(m.codecType=V.codec),V.outputLevel?m.receiveLevel=Math.round(32767*V.outputLevel):R&&(m.receiveLevel=Math.round(32767*R.getVolumeLevel())),m.receiveBytes=V.bytes,m.receivePackets=V.packets,m.receivePacketsLost=V.packetsLost,m.receivePacketsDiscarded=V.packetsDiscarded,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.receiveBitrate=u?8*Math.max(0,m.receiveBytes-u.receiveBytes):0,m.totalDuration=u?u.totalDuration+1:1,m.totalFreezeTime=u?u.totalFreezeTime:0,m.freezeRate=m.totalFreezeTime/m.totalDuration,m.receiveDelay=V.jitterBufferMs,m.totalDuration>10&&qu.isRemoteAudioFreeze(R)&&(m.totalFreezeTime+=1)),x){var B;x.codec!=="H264"&&x.codec!=="H265"&&x.codec!=="VP8"&&x.codec!=="VP9"&&x.codec!=="AV1X"&&x.codec!=="AV1"||(E.codecType=x.codec),E.receiveBytes=x.bytes,E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.decodeFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,E.renderFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,x.outputFrame&&(E.renderFrameRate=x.outputFrame.frameRate),x.receivedFrame?(E.receiveFrameRate=x.receivedFrame.frameRate,E.receiveResolutionHeight=x.receivedFrame.height,E.receiveResolutionWidth=x.receivedFrame.width):y&&(E.receiveResolutionHeight=y._videoHeight||0,E.receiveResolutionWidth=y._videoWidth||0),x.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(x.framesRateFirefox)),E.receivePackets=x.packets,E.receivePacketsLost=x.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost);const q=p?p.totalFreezeTime:0,Z=p?p.totalDuration:0;E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=(B=x.totalFreezesDuration)!==null&&B!==void 0?B:q||0,E.receiveDelay=x.jitterBufferMs||0;const te=!!A&&t.getRemoteVideoIsReady(A);x.totalFreezesDuration===void 0&&y&&te&&qu.isRemoteVideoFreeze(y,x,_)&&(E.totalFreezeTime+=1),E.freezeRate=Math.max(0,Math.min((E.totalFreezeTime-q)/(E.totalDuration-Z),1))}k&&(m.end2EndDelay=k.B_ad,E.end2EndDelay=k.B_vd,m.transportDelay=k.B_ed,E.transportDelay=k.B_ed,m.currentPacketLossRate=k.B_ealr4/100,E.currentPacketLossRate=k.B_evlr4/100,C.uplinkNetworkQuality=k.B_punq?k.B_punq:0,C.downlinkNetworkQuality=k.B_pdnq?k.B_pdnq:0),this.remoteStats.set(s,{audioStats:m,videoStats:E,videoPcStats:x,networkStats:C}),R&&this.exceptionMonitor.setRemoteAudioStats(R,m),y&&this.exceptionMonitor.setRemoteVideoStats(y,E)})}}class NL{constructor(){w(this,"destChannelMediaInfos",new Map),w(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){V1(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){V1(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){T_(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function DL(e){if(!(e instanceof NL))return new G(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new G(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new G(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class ha{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){w(this,"uid",void 0),w(this,"_uintid",void 0),w(this,"_trust_in_room_",!0),w(this,"_trust_audio_enabled_state_",!0),w(this,"_trust_video_enabled_state_",!0),w(this,"_trust_audio_mute_state_",!0),w(this,"_trust_video_mute_state_",!0),w(this,"_audio_muted_",!1),w(this,"_video_muted_",!1),w(this,"_audio_enabled_",!0),w(this,"_video_enabled_",!0),w(this,"_audio_added_",!1),w(this,"_video_added_",!1),w(this,"_is_pre_created",!1),w(this,"_video_pre_subscribed",!1),w(this,"_audio_pre_subscribed",!1),w(this,"_trust_video_stream_added_state_",!0),w(this,"_trust_audio_stream_added_state_",!0),w(this,"_audioTrack",void 0),w(this,"_videoTrack",void 0),w(this,"_dataChannels",[]),w(this,"_audioSSRC",void 0),w(this,"_videoSSRC",void 0),w(this,"_audioOrtc",void 0),w(this,"_videoOrtc",void 0),w(this,"_cname",void 0),w(this,"_rtxSsrcId",void 0),w(this,"_videoMid",void 0),w(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function PL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function dR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const M_="9",lR=2e4,U_=4e4;function kL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ts(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var $d=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}($d||{});const x_=new Map;function LL(e,t,n,r){let{scale:i}=e;if(i===0&&r===$d.UP||i>=t.length-1&&r===$d.DOWN)return e;let s=Ts(Ts({},e),{},{scale:r===$d.DOWN?++i:--i});switch(n){case"maintain-framerate":s=Ts(Ts({},s),t[i].motion);break;case"maintain-resolution":s=Ts(Ts({},s),t[i].detail);break;case"balanced":s=Ts(Ts({},s),t[i].balanced)}return s}function ML(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:UL(t)};x_.set(e,n)}else x_.delete(e)}function UL(e){const t=Ts({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:d,MAX_SCALE:l,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:m,PERF_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_UP_THRESHOLD:C,BALANCE_BITRATE_FACTOR:R,BALANCE_FRAMERATE_FACTOR:y,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:A,MOTION_BITRATE_FACTOR:D,DETAIL_FRAMERATE_FACTOR:V,DETAIL_BITRATE_FACTOR:x}=cv,k=Math.min(t.frameRate,d),B=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(m,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(E,1)*k),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let q=1;q<=l;q++){const Z={bwe_up:Math.round(Math.pow(_,q)*n),bwe_down:Math.round(Math.pow(m,q+1)*n),fps_up:Math.round(Math.pow(C,q)*k),fps_down:Math.round(Math.pow(E,q+1)*k)},te={scaleResolutionDownBy:i/Math.pow(b,q),frameRate:Math.max(Math.round(Math.pow(y,q)*r),a),bitrateMax:Math.max(Math.round(Math.pow(R,q)*n),p),bitrateMin:Math.max(Math.round(Math.pow(R,q)*s),u)},Fe={scaleResolutionDownBy:i/Math.pow(A,q),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(D,q)*n),p),bitrateMin:Math.max(Math.round(Math.pow(D,q)*s),u)},Ge={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(V,q)*r),a),bitrateMax:Math.max(Math.round(Math.pow(x,q)*n),p),bitrateMin:Math.max(Math.round(Math.pow(x,q)*s),u)};B.push({scale:q,threshold:Z,balanced:te,motion:Fe,detail:Ge})}return B}function Zq(e,t,n,r,i,s){const a=x_.get(e)||{overUse:0,underUse:0,adaptationList:UL(i)},{adaptationList:d}=a;x_.set(e,a);const{OVERUSE_TIMES_THRESHOLD:l,UNDERUSE_TIMES_THRESHOLD:u}=cv,{scale:p}=r;let _,m;return typeof t=="number"&&t>0&&function(E,C,R,y){if(C>=R.length)return!1;let{threshold:{fps_down:b}}=R[C];return N("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=R[0].threshold.fps_down),E<b}(t,p,d,s)&&(a.overUse++,m=Du.CPU,a.overUse>l)||typeof n=="number"&&n>0&&function(E,C,R){if(C>=R.length)return!1;const{threshold:{bwe_down:y}}=R[C];return E<y}(n,p,d)&&(a.overUse++,m=Du.BANDWIDTH,a.overUse>l)?(a.overUse=0,a.underUse=0,_=LL(r,d,s,$d.DOWN),[_,m]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(E,C,R,y){if(C===0)return;let{threshold:{fps_up:b}}=R[C];return N("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=R[1].threshold.fps_up),E>b}(t,p,d,s)&&function(E,C,R){if(C===0)return;const{threshold:{bwe_up:y}}=R[C];return E>y}(n,p,d)&&(a.underUse++,a.underUse>u&&(a.overUse=0,a.underUse=0,_=LL(r,d,s,$d.UP),_.scale===0&&(m=Du.NONE))),[_,m])}function xL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function uR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const V_=new Map;function F_(e,t){const n=V_.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),V_.delete(e)}t.qualityLimitationReason=Du.NONE,ML(e)}function $q(e,t){var n;let r;switch(t){case ee.LocalAudioTrack:r=at.Audio;break;case ee.LocalVideoTrack:r=oe(n=e._hints).call(n,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:r=at.Low}return r}function hR(e){const t=Ze();if(e.some(n=>n._bypassWebAudio))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function pR(e,t){hR(e);const n=t||new rn;return e.forEach(r=>n.addAudioTrack(r)),n}const eX=!Ze().supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&_s();function B_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return eX?(n={spec:t,store:e},Ss("PlanBConnection").create(n)):new Ei(t,e)}function fR(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function VL(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(bu(e.turnServer.servers))return!1;if(N("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Xe;function FL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function To(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Ei=(Xe=class kc extends G1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return oe(n=Object.keys(ku)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"id",St(5,"connection-")),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"forceTurn",!1),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"transportEventReceiver",void 0),w(this,"statsFilter",void 0),w(this,"extension",{useXR:N("USE_XR")}),w(this,"localCapabilities",void 0),w(this,"remoteCodecs",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"isPreallocation",!1),w(this,"preMediaMap",new Map),w(this,"dataStreamChannelMap",new Map),w(this,"establishPromise",void 0),w(this,"recoveredDataChannelIds",[]),w(this,"currentDataChannelId",1),w(this,"supportAV1RtpSpec",!1),w(this,"mutex",void 0),w(this,"qualityLimitationReason",Du.NONE),w(this,"isFirstConnected",!1),this.store=n,this.forceTurn=VL(t),this.mutex=new xn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(kc.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=ov(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,Ut()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ca(r.sdp),s=await aL({filterRTX:!N("USE_PUB_RTX")&&!N("USE_SUB_RTX"),filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterVideoCodec:N("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:N("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:N("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=N_(s),this.initialOffer=r,N("ENABLE_SVC")&&this.store.codec=="av1"){const d=await async function(){try{const l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:e_.L1T3}]});const u=await l.createOffer();if(!u.sdp)return void l.close();const p=yr(u.sdp).mediaDescriptions[0];if(!p)return;const _=p.attributes.extmaps.find(m=>m.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return l.close(),_}catch{return}}();var t;d&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(d))}let a;return r.sdp&&uL(r.sdp)&&(a=Pt(s),(n=a).send&&(qd(he.VIDEO,n.send.videoExtensions),qd(he.AUDIO,n.send.audioExtensions)),n.recv&&(qd(he.VIDEO,n.recv.videoExtensions),qd(he.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(qd(he.VIDEO,n.sendrecv.videoExtensions),qd(he.AUDIO,n.sendrecv.audioExtensions))),To(To({},i),{},{rtpCapabilities:a||s,offerSDP:r.sdp})}catch(r){throw new Y(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&uL(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(A_(he.VIDEO,n.send.videoExtensions,r.send.videoExtensions),A_(he.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(A_(he.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),A_(he.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Pt(this._localCapabilities)}get rtpCapabilities(){return Pt(this._rtpCapabilities)}get candidates(){return Pt(this._candidates)}get iceParameters(){return Pt(this._iceParameters)}get dtlsParameters(){return Pt(this._dtlsParameters)}constructor(l){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1],p=arguments.length>2&&arguments[2]!==void 0&&arguments[2];w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_originCandidates",void 0),w(this,"_iceParameters",void 0),w(this,"_isUseExtmapAllowMixed",void 0),w(this,"_isUseLocalCodecs",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),w(this,"useLocalCodecsMids",[]),w(this,"preloadSsrcs",[]),w(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=u,this._isUseLocalCodecs=p,l=Pt(l);const{iceParameters:_,dtlsParameters:m,candidates:E,rtpCapabilities:C,setup:R,localCapabilities:y,cname:b}=l;this._rtpCapabilities=C,this._candidates=E,this._originCandidates=Pt(E),this._iceParameters=_,this._dtlsParameters=m,this._localCapabilities=y,this.setup=R,this.cname=b,[this.sessionDesc]=this.updateRemoteRTPCapabilities(C),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(l){return l.length===this.preloadSsrcs.length&&l.every(u=>{var p;return oe(p=this.preloadSsrcs).call(p,u)})}preloadRemoteMedia(l){let u=0;const p=[],_=[];for(;l>0;){const m=[dR({ssrcId:U_+u},N("USE_SUB_RTX")?{rtx:U_+u+1}:{})],E="".concat(U_+u,"_").concat(lR+u),{ssrcs:C,ssrcGroups:R}=Hu(m,this.cname,N("SYNC_GROUP")?E:void 0),y=this.preCreateOrRecycleSendMedia("video",C,R,void 0),b=[{ssrcId:lR+u}],A="".concat(U_+u,"_").concat(lR+u),{ssrcs:D,ssrcGroups:V}=Hu(b,this.cname,N("SYNC_GROUP")?A:void 0),x=this.preCreateOrRecycleSendMedia("audio",D,V,void 0);l--,u+=2,p.push(y,x),_.push(C[0].ssrcId,D[0].ssrcId)}return this.useLocalCodecsMids.push(...p),this.preloadSsrcs=_,{mids:p,preSSRCs:_,isAvailable:!0}}preCreateOrRecycleSendMedia(l,u,p,_){const m=this.rtpCapabilities.send.videoCodecs,E=this._isUseLocalCodecs||m.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;T.debug("create or recycle send media without remote rtp capabilities, ssrcs ",u[0].ssrcId);const C=l===he.VIDEO?E.videoCodecs:E.audioCodecs,R=l===he.VIDEO?E.videoExtensions:E.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let b={media:{mediaType:l,port:M_,protos:["UDP","TLS","RTP","SAVPF"],fmts:C.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:C,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};return b=this.mungSendMediaDesc(b,_),this.sessionDesc.mediaDescriptions.push(b),this.updateBundleMids(),y}toString(){return na(this.sessionDesc)}send(l,u,p,_){const{ssrcs:m,ssrcGroups:E}=Hu(u,this.cname,N("SYNC_GROUP")?p:void 0),C=this.findPreloadMediaDesc(m);if(C){if(Ut()&&this.firefoxSsrcMidMap.set(m[0].ssrcId,C.attributes.mid),_&&(_.twcc||_.remb)){const R=this.sessionDesc.mediaDescriptions.indexOf(C);return this.sessionDesc.mediaDescriptions[R]=this.mungSendMediaDesc(C,_),{mid:C.attributes.mid,needExchangeSDP:!0}}return{mid:C.attributes.mid,needExchangeSDP:!1}}{const R=this.findAvailableMediaIndex(l,m);let y;return R===-1||R===1&&(Nn()||function(){const b=qe();return!(b.name!==tt.CHROME||!b.osVersion)&&Number(b.version)<=90}()||N("ENABLE_ENCODED_TRANSFORM")&&fs())||R===0&&!function(b){const A=qe();return!(A.name!==tt.FIREFOX||!A.osVersion)&&Number(A.version)===b}(138)&&N("USE_SUB_RTX")||LD()?(y=this.createOrRecycleSendMedia(l,m,E,"sendonly",_),this.updateBundleMids()):(y=Pt(this.sessionDesc.mediaDescriptions[R]),y.attributes.direction="sendonly",y.attributes.ssrcs=m,y.attributes.ssrcGroups=E,this.sessionDesc.mediaDescriptions[R]=this.mungSendMediaDesc(y,_)),Ut()&&this.firefoxSsrcMidMap.set(m[0].ssrcId,y.attributes.mid),{mid:y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:l,needExchangeSDP:u}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:l.attributes.mid,needExchangeSDP:u}}batchSend(l){const u=l.map(m=>{let{kind:E,ssrcMsg:C,mslabel:R}=m;return this.send(E,C,R)}),p=[];let _=!1;return u.forEach(m=>{let{mid:E,needExchangeSDP:C}=m;C&&(_=!0),p.push(E)}),{mids:p,needExchangeSDP:_}}stopSending(l){const u=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&l.indexOf(p.attributes.mid)!==-1);if(u.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");u.forEach(p=>{p.attributes.mid==="0"||Ut()||LD()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")}),this.updateBundleMids()}mute(l){const u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===l);if(!u)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));u.attributes.direction="inactive"}unmute(l){const u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===l);if(!u)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));u.attributes.direction="sendonly"}muteRemote(l){const u=this.sessionDesc.mediaDescriptions.filter(p=>oe(l).call(l,p.attributes.mid||""));if(u.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");u.forEach(p=>{p.attributes.direction="inactive"})}unmuteRemote(l){const u=this.sessionDesc.mediaDescriptions.filter(p=>oe(l).call(l,p.attributes.mid||""));if(u.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");u.forEach(p=>{p.attributes.direction="recvonly"})}receive(l,u,p,_){l.forEach((m,E)=>{this.createOrRecycleRecvMedia(m,[],"recvonly",u,p,_[E])}),this.updateBundleMids()}stopReceiving(l){const u=this.sessionDesc.mediaDescriptions.filter(p=>l.indexOf(p.attributes.mid)!==-1);if(u.length!==l.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");u.forEach(p=>{p.media.port="0",p.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(l){const u=this.sessionDesc||yr((p=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(p?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var p;this._rtpCapabilities=l;let _=!1;const m=this.rtpCapabilities.send,E=this.localCapabilities.send,C=this.localCapabilities.recv,R=C.videoCodecs,y=C.audioCodecs,b=C.videoExtensions,A=C.audioExtensions;for(const k of u.mediaDescriptions){var D;if(k.attributes.direction!=="sendonly"||typeof k.attributes.mid!="string"||!oe(D=this.useLocalCodecsMids).call(D,k.attributes.mid)){if(_=!0,k.attributes.iceUfrag=this._iceParameters.iceUfrag,k.attributes.icePwd=this._iceParameters.icePwd,k.attributes.fingerprints=this._dtlsParameters.fingerprints,k.attributes.candidates=this._candidates,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video")if(this._isUseLocalCodecs&&k.attributes.direction==="sendonly"){var V;k.media.fmts=R.map(q=>q.payloadType.toString(10)),k.attributes.payloads=R,k.attributes.extmaps=b;const B=k.attributes.mid;typeof B!="string"||oe(V=this.useLocalCodecsMids).call(V,B)||this.useLocalCodecsMids.push(B)}else if(m.videoCodecs.length===0){const B=E.videoCodecs.filter(q=>{var Z,te;return(Z=q.rtpMap)===null||Z===void 0?void 0:oe(te=Z.encodingName.toLowerCase()).call(te,"vp8")})||[E.videoCodecs[0]];k.media.fmts=B.map(q=>q.payloadType.toString(10)),k.attributes.payloads=B,k.attributes.extmaps=[]}else k.media.fmts=m.videoCodecs.map(B=>B.payloadType.toString(10)),k.attributes.payloads=m.videoCodecs,k.attributes.extmaps=m.videoExtensions;if(k.media.mediaType==="audio")if(this._isUseLocalCodecs&&k.attributes.direction==="sendonly"){var x;k.media.fmts=y.map(q=>q.payloadType.toString(10)),k.attributes.payloads=y,k.attributes.extmaps=A;const B=k.attributes.mid;typeof B!="string"||oe(x=this.useLocalCodecsMids).call(x,B)||this.useLocalCodecsMids.push(B)}else if(m.audioCodecs.length===0){const B=E.audioCodecs.filter(q=>{var Z,te;return(Z=q.rtpMap)===null||Z===void 0?void 0:oe(te=Z.encodingName.toLowerCase()).call(te,"opus")})||[E.audioCodecs[0]];k.media.fmts=B.map(q=>q.payloadType.toString(10)),k.attributes.payloads=B,k.attributes.extmaps=[]}else k.media.fmts=m.audioCodecs.map(B=>B.payloadType.toString(10)),k.attributes.payloads=m.audioCodecs,k.attributes.extmaps=m.audioExtensions,Jd(k)}}return this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1,[this.sessionDesc,_]}updateCandidates(l){const u=this._originCandidates.filter(_=>_.transport==="udp"),p=[];if(u.forEach(_=>{p.push(dR(dR({},_),{},{foundation:"tcpcandidate",priority:Number(_.priority)-1+"",transport:"tcp",port:Number(_.port)+90+""}))}),u.length!==0){switch(l){case Bn.TCP_RELAY:this._candidates=p;break;case Bn.UDP_TCP_RELAY:case Bn.RELAY:this._candidates=[...u,...p];break;default:this._candidates=u}for(const _ of this.sessionDesc.mediaDescriptions)_.attributes.candidates=this.candidates}}restartICE(l){l=Pt(l),this._iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(u=>{u.attributes.iceUfrag=l.iceUfrag,u.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const u=[];for(let p=0;p<l;p++)u.push((this.currentMidIndex+p+1).toString(10));return u}findAvailableMediaIndex(l,u){return this.sessionDesc.mediaDescriptions.findIndex(p=>{const _=p.media.mediaType===l&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(Ut()){if(_){const m=this.firefoxSsrcMidMap.get(u[0].ssrcId);return!(m||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!m||m!==p.attributes.mid)}return!1}return _})}createOrRecycleDataChannel(){for(const p of this.sessionDesc.mediaDescriptions)if(p.media.mediaType==="application")return{mediaDesc:p,needExchangeSDP:!1};this.currentMidIndex+=1;const l="".concat(this.currentMidIndex),u={media:{mediaType:"application",port:M_,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(l),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(u),{mediaDesc:u,needExchangeSDP:!0}}createOrRecycleRecvMedia(l,u,p,_,m,E){const C=l._mediaStreamTrack.kind,R=this.rtpCapabilities.recv,y=Ku(C,R,this.localCapabilities.send,C===he.VIDEO?_:m),b=C===he.VIDEO?R.videoExtensions:R.audioExtensions;this.currentMidIndex+=1;const A="".concat(this.currentMidIndex);let D={media:{mediaType:C,port:M_,protos:["UDP","TLS","RTP","SAVPF"],fmts:y.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:b,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};D=this.mungRecvMediaDsec(D,l,E);const V=this.findFirstClosedMedia(C);if(V){const x=this.sessionDesc.mediaDescriptions.indexOf(V);this.sessionDesc.mediaDescriptions[x]=D}else this.sessionDesc.mediaDescriptions.push(D);return D}updateRemoteDtlsParameters(l){const u=new Set(this._dtlsParameters.fingerprints.map(m=>m.fingerprint)),p=new Set(l.map(m=>m.fingerprint));let _=!1;u.size!==p.size&&(_=!0);for(const m of u)p.has(m)||(_=!0);return _}updateRemoteCodec(l,u,p){const _=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(D=>D.rtpMap&&D.rtpMap.encodingName.toLowerCase()||"").filter(D=>{var V;return oe(V=Object.keys(ku)).call(V,D)}))],m=new Set(u);if(_.every(D=>m.has(D)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(u)),!1;const E=this._rtpCapabilities.recv.videoCodecs.filter(D=>u.some(V=>{var x;return oe(x=D.rtpMap&&D.rtpMap.encodingName.toLowerCase()||"").call(x,V)}));if(E.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(_," codecs: ").concat(u)),!1;const C=[...new Set(E.map(D=>D.rtpMap&&D.rtpMap.encodingName.toLowerCase()||""))];let R;if(T.debug("updateRemoteCodec, from ".concat(_," to ").concat(C)),l.length===0)R=this.sessionDesc.mediaDescriptions.filter(D=>D.media.mediaType==="video"&&D.attributes.direction==="recvonly");else if(R=this.sessionDesc.mediaDescriptions.filter(D=>D.attributes.mid&&D.media.mediaType==="video"&&oe(l).call(l,D.attributes.mid)&&D.attributes.direction==="recvonly"),R.length!==l.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(l,", codecs: ").concat(u)),!1;if(N("USE_PUB_RTX")||N("USE_SUB_RTX")){const D=da(E,this.rtpCapabilities.recv.videoCodecs);E.push(...D)}this._rtpCapabilities.recv.videoCodecs=E;const y=this.localCapabilities.send,b=this.rtpCapabilities.recv,A=Ku(he.VIDEO,b,y,p);return R.forEach(D=>{const V=A.map(x=>x.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(D.attributes.mid,", from"),D.attributes.payloads,"to",A),D.attributes.payloads=A,D.media.fmts=V}),!0}createOrRecycleSendMedia(l,u,p,_,m){const E=this.rtpCapabilities.send.videoCodecs,C=this._isUseLocalCodecs||E.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,R=l===he.VIDEO?C.videoCodecs:C.audioCodecs,y=l===he.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let A={media:{mediaType:l,port:M_,protos:["UDP","TLS","RTP","SAVPF"],fmts:R.map(V=>V.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:R,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};A=this.mungSendMediaDesc(A,m);const D=this.findFirstClosedMedia(l);if(D){const V=this.sessionDesc.mediaDescriptions.indexOf(D);this.sessionDesc.mediaDescriptions[V]=A}else this.sessionDesc.mediaDescriptions.push(A);return A}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(l=>l.media.port!=="0").map(l=>l.attributes.mid)}mungRecvMediaDsec(l,u,p){const _=Pt(l);return Jv(_),Xd(_,u),Qv(_,u),oL(_),O_(_,p,this.localCapabilities.send),_}mungSendMediaDesc(l,u){const p=Pt(l);return O_(p,u,this.localCapabilities.recv),Jd(p),p}updateRecvMedia(l,u){const p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===l);if(p!==-1){const _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],u);this.sessionDesc.mediaDescriptions[p]=_}}bumpMid(l){this.currentMidIndex+=l}findFirstClosedMedia(l){return this.sessionDesc.mediaDescriptions.find(u=>Ut()?u.media.port==="0"&&u.media.mediaType===l:u.media.port==="0")}findPreloadMediaDesc(l){return this.sessionDesc.mediaDescriptions.find(u=>{var p;return((p=u.attributes)===null||p===void 0||(p=p.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===l[0].ssrcId})}getSSRC(l){var u;return(u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===l))===null||u===void 0?void 0:u.attributes.ssrcs}}(To(To({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!N("ENABLE_PRE_SUB_WITH_PRE_PC")||!N("PRE_USE_LOCAL_CODECS"))&&pv(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=dL(this.initialOffer.sdp,this.extension),a=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),a==null||a(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const d=this.peerConnection.getTransceivers()[0];if(d!=null&&d.receiver&&this.tryBindTransportEvents(d.receiver),pv(this.store))if(t.preallocation&&N("ENABLE_PRE_SUB_WITH_PRE_PC")){const l=N("PRE_SUB_NUM"),{mids:u,preSSRCs:p}=this.remoteSDP.preloadRemoteMedia(l);await la(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(p)),this.presetMedia(u,p)}else{const{preSSRCs:l=[]}=t,u=l.map(_=>_.ssrcMsg[0].ssrcId);if(l.length===0)return;const{mids:p}=this.remoteSDP.batchSend(l.map(_=>Object.assign({},_)));await la(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(p,u)}}catch(i){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var n,r}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const a=s.receiver.track;let d;a.kind==="video"&&N("ENABLE_PRE_RENDER")&&(d=new wv({trackId:"track-".concat(a.kind,"-unknown-").concat(this.store.clientId,"_").concat(St(5,""))},!0),d.updateVideoTrack(a),d.onFirstVideoFrameRender=()=>{var l;const u=this.preMediaMap.get(n[i]);u&&(u.firstVideoRender=Date.now()),(l=this.onFirstVideoRender)===null||l===void 0||l.call(this,n[i])},d.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:a,player:d,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const a=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||a}const{preSSRCs:i=[]}=t,s=i.map(a=>a.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const a=[],d=[];if(Array.from(this.preMediaMap.entries()).every(l=>{let[u,{mid:p,player:_,track:m}]=l;return a.push(p),d.push(u),this.preMediaMap.delete(u),_&&_.destroy(),!0}),a.length>0&&(this.remoteSDP.stopSending(a),await la(this.peerConnection,this.remoteSDP,this.extension),T.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(d)),Se.reportApiInvoke(this.store.sessionId,{name:Wt.PRELOAD_MEDIA_FAILED,options:[i,d],tag:Dt.TRACER}).onSuccess()),i.length>0){const{mids:l}=this.remoteSDP.batchSend(i.map(u=>Object.assign({},u)));await la(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(l,s)}}n?(await la(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):T.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return ui(function*(){const s=yield Qe(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=[],d=w_();t.forEach(y=>{const b=i.peerConnection.addTransceiver(y._mediaStreamTrack,To({direction:"sendonly"},y.trackMediaType==="video"&&i.supportAV1RtpSpec&&d?{sendEncodings:[{scalabilityMode:d}]}:{}));a.push(b),y._updateRtpTransceiver(b)}),Ut()&&N("SIMULCAST")===!0&&(yield Qe(i.applySimulcastForFirefox(a,t)));const l=yield Qe(i.peerConnection.createOffer()),u=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(l.sdp,t,u),_=yr(p),m=u.map(y=>{const b=_.mediaDescriptions.find(A=>A.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return nL(b,N("USE_PUB_RTX"))});let E;try{E=yield m}catch(y){E=[],i.remoteSDP.receive(t,n,r,E);const b=i.remoteSDP.toString();throw yield Qe(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Qe(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Qe(i.stopSending(u,!0)),y}i.remoteSDP.receive(t,n,r,E);const C=i.remoteSDP.toString(),R=i.logSDPExchange(p,"offer","local","send");return yield Qe(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Qe(i.applySimulcastEncodings(a,t)),yield Qe(i.applySendEncodings(a,t)),R==null||R(C),yield Qe(i.peerConnection.setRemoteDescription({type:"answer",sdp:C})),a.map((y,b)=>{const A=u[b];return{localSSRC:m[b],id:A,transceiver:y}})}catch(a){throw a instanceof Y?a:new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{s()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:N("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Y?r:new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof Y?n:new Y(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(l=>{var u;F_(this.id+l.mid,this),l.direction="inactive",(u=l.stop)===null||u===void 0||u.call(l)});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=this.remoteSDP.send(t,n,r,i);a&&(await la(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const d=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:s,transceiver:d}}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await la(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(a=>a.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(a=>{let[d,{mid:l,player:u}]=a;if(l===s)return this.preMediaMap.delete(d),u&&u.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(a=>{a.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(a,d)=>{a.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ui(function*(){const r=yield Qe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ze().supportPCSetConfiguration,s=N("FORCE_TURN_TCP")||n.forceTurn;if(t===Bn.RELAY&&!i)return;if(i&&!s){const _=t===Bn.RELAY?"relay":"all",m=n.peerConnection.getConfiguration();m.iceTransportPolicy!==_&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}n.remoteSDP.updateCandidates(t);const a=yield Qe(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=ca(a.sdp),{remoteIceParameters:l}=yield d.iceParameters;n.remoteSDP.restartICE(l);const u=n.remoteSDP.toString(),p=n.logSDPExchange(a.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Qe(n.peerConnection.setLocalDescription(a)),p==null||p(u),yield Qe(n.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Bn.TCP_RELAY),await la(this.peerConnection,this.remoteSDP,this.extension)}catch(n){T.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{F_(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return To(To({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new Y(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Ut()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:To(To({},jo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:To(To({},jo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=Ec(t.url||"");T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(bu(t.turnServer.servers)?n.iceServers=t.turnServer.servers:N("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(N("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...kc.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...kc.newTurnServerConfigToIceServers(t.turnServer.servers)),N("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...kc.turnServerConfigToIceServers(t.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...kc.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),N("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&Ze().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(sa(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!N("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const i=N("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(sa(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(sa(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const a=i.address+":"+i.port,d=s.address+":"+s.port;T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ec(a)),", remote ").concat(JSON.stringify(Ec(d))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ze().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const d=function(R,y){return R.getTransceivers().find(b=>b.sender.track===y||b.receiver.track===y)}(this.peerConnection,t._mediaStreamTrack),l=F7(t);if(function(R){var y;return!(!N("ENABLE_AG_ADAPTATION")||!(R instanceof d_||oe(y=R._hints).call(y,mt.CUSTOM_TRACK))||!N("FORCE_SUPPORT_AG_ADAPTATION")&&!(PD(14,0,!1)&&kD(17,4,!0)||DD(14)&&GT(17,4,!0)))}(t)&&d&&n&&l&&this.getLocalVideoStats&&oe(r=["vp8","vp9"]).call(r,this.store.codec)){var u;const R=s.degradationPreference||(oe(u=t._hints).call(u,mt.CUSTOM_TRACK)?N("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(y,b,A,D,V,x){if(F_(y,A),V(b),D!=="balanced"&&D!=="maintain-framerate"&&D!=="maintain-resolution")return;let k=-1;ML(y,b);const B=window.setInterval(()=>{const Z=V_.get(y);if(!N("ENABLE_AG_ADAPTATION")||!Z)return F_(y,A),void V(b);const te=x();if(te.sendPackets>0&&te.OutgoingAvailableBandwidth>0){if(k===-1)return void(k=Date.now());if(Date.now()-k<1e3)return;const Fe=te.sendFrameRate,Ge=te.OutgoingAvailableBandwidth,[Oe,it]=Zq(y,Fe,Ge,Z.adaptationConfig,b,D);it&&(A.qualityLimitationReason=it),Oe&&Z.adaptationConfig.scale!==Oe.scale&&(T.debug("[".concat(y,"] applyAdaptation: ").concat(A.qualityLimitationReason,`
           sendFps `).concat(Fe,", bwe ").concat(Ge,", switch from ").concat(Z.adaptationConfig.scale," to ").concat(Oe.scale," ")),Z.adaptationConfig=uR(uR({},Z.adaptationConfig),Oe),V(Oe))}},N("CHECK_LOCAL_STATS_INTERVAL")),q=uR({},b);V_.set(y,{timer:B,adaptationConfig:q,originConfig:b,adaptationFunc:V}),T.debug("[".concat(y,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(D))})(this.id+d.mid,l,this,R,y=>{n&&this.updateAdaptation(n,y)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var p;const{bitrateMax:R,frameRate:y,scaleResolutionDownBy:b}=t._encoderConfig;R&&(a.maxBitrate=1e3*R),(oe(p=t._hints).call(p,mt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(y&&(a.maxFramerate=Vr(y)),b&&b>=1&&(a.scaleResolutionDownBy=b))}const{maxFramerate:_}=N("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,_):_),N("DSCP_TYPE")&&_s()){var m;const R=N("DSCP_TYPE");oe(m=["very-low","low","medium","high"]).call(m,R)&&(a.networkPriority=R)}const E=n.getParameters(),C=(i=E.encodings)===null||i===void 0?void 0:i[0];Ut()&&!C&&(s.encodings=[a]),C&&Object.assign(C,a),Object.assign(E,s),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(E.encodings))),await n.setParameters(E),await async function(R,y,b){try{var A;if(!Ze().supportSetRtpSenderParameters||!function(B){return B==="vp9"||B==="av1"}(R)||!N("ENABLE_SVC"))return;const D={},V={},x=y.getParameters(),k=(A=x.encodings)===null||A===void 0?void 0:A[0];V.scalabilityMode=w_(b),k&&Object.assign(k,V),Object.assign(x,D),await y.setParameters(x),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(x.encodings)))}catch(D){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",D)}}(this.store.codec,n,N("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return T.debug("[updateAdaptation] no rtpSender found");if(!Ze().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:a,frameRate:d,scaleResolutionDownBy:l}=n;a&&(s.maxBitrate=1e3*a),d&&(s.maxFramerate=Vr(d)),l&&l>=1&&oe(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=l);const u=t.getParameters(),p=(i=u.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,s),Object.assign(u,{});try{await t.setParameters(u),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u.encodings)))}catch(_){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof Ct&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=yr(t);return n.forEach((s,a)=>{const d=r[a],l=i.mediaDescriptions.find(u=>u.attributes.mid===d);l&&(Xd(l,s),sL(l,s,this.store.codec))}),na(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,a,d;const u=t[l],p=n[l];if(p instanceof Ct&&!oe(r=p._hints).call(r,mt.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=p._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,_))}}}async applySimulcastEncodings(t,n){if(!Ut()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof Ct&&this.isVP8Simulcast(i)){const s=t[r],a={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var n,r,i,s,a;return!!(t instanceof Ct&&N("SIMULCAST")&&this.store.codec==="vp8"&&!oe(n=t._hints).call(n,mt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(N("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=kc.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},me(Xe.prototype,"updateRemoteRTPCapabilities",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"updateRemoteRTPCapabilities"),Xe.prototype),me(Xe.prototype,"connect",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"connect"),Xe.prototype),me(Xe.prototype,"updateRemoteConnect",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"updateRemoteConnect"),Xe.prototype),me(Xe.prototype,"createDataChannels",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"createDataChannels"),Xe.prototype),me(Xe.prototype,"receive",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"receive"),Xe.prototype),me(Xe.prototype,"batchReceive",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"batchReceive"),Xe.prototype),me(Xe.prototype,"stopReceiving",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"stopReceiving"),Xe.prototype),me(Xe.prototype,"muteRemote",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"muteRemote"),Xe.prototype),me(Xe.prototype,"unmuteRemote",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"unmuteRemote"),Xe.prototype),me(Xe.prototype,"muteLocal",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"muteLocal"),Xe.prototype),me(Xe.prototype,"unmuteLocal",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"unmuteLocal"),Xe.prototype),me(Xe.prototype,"close",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"close"),Xe.prototype),me(Xe.prototype,"updateEncoderConfig",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"updateEncoderConfig"),Xe.prototype),me(Xe.prototype,"updateSendParameters",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"updateSendParameters"),Xe.prototype),me(Xe.prototype,"replaceTrack",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"replaceTrack"),Xe.prototype),me(Xe.prototype,"updateAdaptation",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"updateAdaptation"),Xe.prototype),me(Xe.prototype,"getRemoteSSRC",[_r],Object.getOwnPropertyDescriptor(Xe.prototype,"getRemoteSSRC"),Xe.prototype),Xe);function _r(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}function _R(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Vr(t.width),r.height=Vr(t.height);const i=Vr(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const a=r.getContext("2d");if(!a)throw new G(O.UNEXPECTED_ERROR,"can not get canvas context");const d=Ze(),l=r.captureStream(d.supportRequestFrame?0:i).getVideoTracks()[0];l.canvas||(l.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,_=n.videoHeight/p,m=r.width*_;Math.abs(m-r.height)>=2&&(T.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(m)),r.height=m)}a.drawImage(n,0,0,r.width,r.height),l.requestFrame&&l.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=Tv(()=>r.startCapture&&r.startCapture(),i);const u=l.stop;return l.stop=()=>{u.call(l),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),T.debug("clean low stream renderer")},l}var BL=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(BL||{}),vo=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(vo||{}),ke=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(ke||{}),wn=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(wn||{}),mr=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(mr||{}),j_=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(j_||{});const Sc=1e3,G_=6,Xu=3,tX=Math.max(G_,Xu,60);function ye(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function jL(e){const t={[mr.CONN_TYPE]:0,[mr.RTT]:e.rtt,[mr.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[mr.CONN_TYPE]=1),n==="tcp"&&(t[mr.CONN_TYPE]=3),n==="tls"&&(t[mr.CONN_TYPE]=4);break}case"srflx":t[mr.CONN_TYPE]=2;break;case"unknown":t[mr.CONN_TYPE]=5;break;default:t[mr.CONN_TYPE]=0}return t}function GL(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class WL extends Lt{constructor(t){super(),w(this,"store",void 0),w(this,"uploadWRTCStatsTimer",void 0),w(this,"uploadOutboundDenoiserStatsTimer",void 0),w(this,"uploadExtStatsTimer",void 0),w(this,"uploadExtUsageStatsTimer",void 0),w(this,"uploadInboundExtStatsTimer",void 0),w(this,"requestStats",void 0),w(this,"requestTransportStats",void 0),w(this,"requestLocalMedia",void 0),w(this,"requestRemoteMedia",void 0),w(this,"requestAllTracks",void 0),w(this,"requestVideoIsReady",void 0),w(this,"requestUploadStats",void 0),w(this,"requestUpload",void 0),w(this,"uploadOutboundStarted",!1),w(this,"uploadInboundStarted",!1),w(this,"uploadTransportStarted",!1),w(this,"uploadBaseStatsStarted",!1),w(this,"uploadExtensionUsageStarted",!1),w(this,"lastRecvStats",void 0),w(this,"lastSendStats",void 0),w(this,"lastRefRecvStats",void 0),w(this,"lastRefSendStats",void 0),w(this,"lastNormalRecvStats",void 0),w(this,"lastNormalSendStats",void 0),w(this,"lastExtendStats",{}),w(this,"needUploadStats",{}),w(this,"needUploadRenderFreezeTime",!0),w(this,"lastUploadCompensateTime",-1),w(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%Xu==0,r=t%G_==0,i=t%60==0;let s,a;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),s||a){var d;const l={};if(this.uploadTransportStarted&&s){const p=this.getTransportStats(s,a,n);p&&(l.misc=[p])}if(this.uploadOutboundStarted&&s){const p=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);p&&(l.outbound=[p])}if(this.uploadInboundStarted&&a){this.uploadCompensateStats(t);const p=this.getInboundStats(a,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);p&&(l.inbound=p)}const u=(d=this.requestTransportStats)===null||d===void 0?void 0:d.call(this).connectState;u&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[j_.RTC_PEER_CONNECTION_STATE]=iv[u]):l.misc=[{addition:{[j_.RTC_PEER_CONNECTION_STATE]:iv[u]}}]),this.needUploadStats.sendType&&(Array.isArray(l.outbound)&&l.outbound[0]&&l.outbound[0].high&&(l.outbound[0].high[BL.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(l)}this.lastRecvStats=a,this.lastSendStats=s,r&&(this.lastNormalRecvStats=a,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=a,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[j_.RTC_PEER_CONNECTION_STATE]:iv[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===tX+1&&(t=1)},Sc)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%Xu==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const a={};if(this.uploadInboundStarted&&s){const d=this.requestRemoteMedia()||[],l=[];d.forEach(u=>{let[p,_]=u;const m={peer:p.uid};if(p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)&&_.has(he.VIDEO)&&p.videoTrack){const E=function(C,R,y){if(!R.videoRecv.find(A=>A.ssrc===C))return;const b={};if(y&&y._player){const A=y._player,{renderFreezeAccTime2:D,videoElementStatus:V}=A;if(Ho.visibility==="visible"&&V===Vn.PLAYING&&Ze().supportRequestVideoFrameCallback){const x=Math.min(6e3,D);A.renderFreezeAccTime2=Math.max(0,D-x),ye(b,vo.Video_Render_Freeze_Time_Render2,x),N("USE_NEW_RENDER_FREEZE_TIME")&&ye(b,vo.Video_Render_Freeze_Time_Render,x)}}return b}(p._videoSSRC,s,p.videoTrack);E&&(m.video=E)}m.video&&l.push(m)}),l.length>0&&(a.inbound=l,this.requestUploadStats(a))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[mr.RTT]:t.rtt,[mr.CONN_TYPE]:void 0,[mr.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const i=jL(t);if(this.store.useP2P){if(n){const s=jL(n);i[mr.CONN_TYPE]+=s[mr.CONN_TYPE]<<3}i[mr.CONN_TYPE]+=110}else i[mr.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const a=this.requestLocalMedia();if(!a||a.length===0)return;let d,l,u;return a.forEach(p=>{let[_,{track:m,ssrcs:E}]=p;switch(_){case ee.LocalVideoLowTrack:case ee.LocalVideoTrack:if(_===ee.LocalVideoTrack){var C;const R=function(D,V,x,k,B,q){const Z=V.videoSend.find(Oe=>Oe.ssrc===D);if(!Z)return;const te={},{sentFrame:Fe,inputFrame:Ge}=Z;if(k&&(ye(te,vo.Video_Send_Qp_Sum,Z.qpSumPerFrame),Ge&&Fe)){const Oe=Ge.frameRate,it=Fe.frameRate;te[vo.Video_Send_Freeze]=function(nt,Gn){let Q=!0;return Q=!(nt<=5)&&(nt<=10?Gn<3:nt<=20?Gn<4:Gn<5),Q}(Oe,it)?1:0}if(B){switch(Fe&&(ye(te,ke.Video_Send_Height,Fe.height),ye(te,ke.Video_Send_Width,Fe.width),ye(te,ke.Video_Send_Frame_Rate,Fe.frameRate)),te[ke.Video_Send_Disabled]=x._originMediaStreamTrack&&!x._originMediaStreamTrack.enabled||x._mediaStreamTrack&&!x._mediaStreamTrack.enabled?1:0,Z.adaptionChangeReason){case"none":te[ke.Video_Send_Adaptation]=0;break;case"cpu":te[ke.Video_Send_Adaptation]=1;break;case"bandwidth":te[ke.Video_Send_Adaptation]=2;break;case"other":te[ke.Video_Send_Adaptation]=3}let Oe=0;Z.adaptionChangeReason&&(Oe+=GL(Z.adaptionChangeReason)),V.qualityLimitationReason&&(Oe+=GL(V.qualityLimitationReason)<<3),te[ke.Video_Send_Adaptation]=Oe,te[ke.Video_Send_Player_Status]=gv[x._player?x._player.videoElementStatus:"uninit"],ye(te,ke.Video_Send_Nacks,Z.nacksCount),ye(te,ke.Video_Send_Plis,Z.plisCount),ye(te,ke.Video_Send_Firs,Z.firsCount),ye(te,ke.Video_Send_Avg_Encode,Z.avgEncodeMs),ye(te,ke.Video_Send_Huge_Frame_Sent,Z.hugeFramesSent),ye(te,ke.Video_Send_Bytes_Retransmit,Z.retransmittedBytesSent),ye(te,ke.Video_Send_Packages_Retransmit,Z.retransmittedPacketsSent),ye(te,ke.Video_Send_Key_Frames_Encoded,Z.keyFramesEncoded);const it=B.videoSend.find(nt=>nt.ssrc===D);if(it){let nt=Sc*Xu;it.timestamp&&Z.timestamp&&(nt=Z.timestamp-it.timestamp),it.packets!=null&&Z.packets!=null&&ye(te,ke.Video_Send_Package_Rate,1e3*(Z.packets-it.packets)/nt),Z.packetsLost!=null&&it.packetsLost!=null&&ye(te,ke.Video_Send_Package_Lost,Z.packetsLost-it.packetsLost),it.bytes!=null&&Z.bytes!=null&&ye(te,ke.Video_Send_Bitrate,8*(Z.bytes-it.bytes)/nt)}}return te}(E[0].ssrcId,t,m,n,r),y=m.__className__==="CameraVideoTrack"?3:oe(C=m._hints).call(C,mt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==y||s)&&(this.needUploadStats={sendType:y},this.lastExtendStats.sendType=y);const b=m&&function(D,V,x,k){const B=V.videoSend.find(Z=>Z.ssrc===D);if(!B)return null;const q={};if(k){const Z=B.inputFrame,te=Z&&Z.height||x.videoHeight||0,Fe=Z&&Z.width||x.videoWidth||0,Ge=Z&&Z.frameRate||0;ye(q,ke.Video_Capture_Height,te),ye(q,ke.Video_Capture_Width,Fe),ye(q,ke.Video_Capture_Frame_Rate,Ge)}return q}(E[0].ssrcId,t,m,!!r),A=function(D,V){const x={};return V&&(ye(x,ke.Video_Send_Retransmit,D.bitrate.retransmit),ye(x,ke.Video_Send_Target_Encoded,D.bitrate.targetEncoded),ye(x,ke.Video_Send_Actual_Encoded,D.bitrate.actualEncoded),ye(x,ke.Video_Send_Transmit,D.bitrate.transmit),ye(x,ke.Video_Send_Bandwidth,D.sendBandwidth)),x}(t,!!r);l=Object.assign({},R,b,A)}else u=function(R,y,b,A,D){const V=y.videoSend.find(k=>k.ssrc===R);if(!V)return;const x={};if(A){const k=V.sentFrame;k&&(ye(x,ke.Video_Send_Low_Height,k.height),ye(x,ke.Video_Send_Low_Width,k.width),ye(x,ke.Video_Send_Low_Frame_Rate,k.frameRate));const B=A.videoSend.find(q=>q.ssrc===R);if(B){let q=Sc*G_;B.timestamp&&V.timestamp&&(q=V.timestamp-B.timestamp),B.packets!=null&&V.packets!=null&&ye(x,ke.Video_Send_Low_Package_Rate,1e3*(V.packets-B.packets)/q),V.packetsLost!=null&&B.packetsLost!=null&&ye(x,ke.Video_Send_Low_Package_Lost,V.packetsLost-B.packetsLost),B.bytes!=null&&V.bytes!=null&&ye(x,ke.Video_Send_Low_Bitrate,8*(V.bytes-B.bytes)/q)}}return x}(E[0].ssrcId,t,0,r);break;case ee.LocalAudioTrack:d=m&&function(R,y,b,A,D,V){const x=y.audioSend.find(B=>B.ssrc===R);if(!x)return;const k={};if(D){k[ke.Audio_Send_Disabled]=b._originMediaStreamTrack&&!b._originMediaStreamTrack.enabled||b._mediaStreamTrack&&!b._mediaStreamTrack.enabled?1:0;const B=100*b._source.getAccurateVolumeLevel(),q=x.inputLevel;if(q!=null){const te=Math.ceil(50*Math.log10(100*q+1));ye(k,ke.Audio_Send_Level,te)}ye(k,ke.Audio_Capture_PCM_Level,B),ye(k,ke.Audio_Send_AEC_Return_Loss,x.aecReturnLoss),ye(k,ke.Audio_Send_AEC_Return_Loss_Enhancement,x.aecReturnLossEnhancement),ye(k,ke.Audio_Send_Bytes_Retransmit,x.retransmittedBytesSent),ye(k,ke.Audio_Send_Packages_Retransmit,x.retransmittedPacketsSent),k[ke.Audio_Send_Freeze]=0;const Z=D.audioSend.find(te=>te.ssrc===R);if(Z){let te=Sc*G_;Z.timestamp&&x.timestamp&&(te=x.timestamp-Z.timestamp),Z.bytes!=null&&x.bytes!=null&&ye(k,ke.Audio_Send_Bitrate,8*(x.bytes-Z.bytes)/te),Z.packets!=null&&x.packets!=null&&ye(k,ke.Audio_Send_Package_Rate,1e3*(x.packets-Z.packets)/te)}}return k}(E[0].ssrcId,t,m,0,r)}}),{high:l,low:u,audio:d}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],a=[];return s.forEach(d=>{let[l,u]=d;const p={peer:l.uid};if(u.has(he.VIDEO)&&l.videoTrack){const _=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,m=l.videoTrack?function(E,C,R,y,b,A,D,V){const x=C.videoRecv.find(Oe=>Oe.ssrc===E);if(!x)return;const k={},{receivedFrame:B,outputFrame:q,decodeFrameRate:Z}=x;ye(k,wn.Video_Render_Frame_Rate_Decode,Z),x.framesRateFirefox&&ye(k,wn.Video_Recv_Frame_Rate,x.framesRateFirefox),B&&ye(k,wn.Video_Recv_Frame_Rate,B.frameRate),ye(k,wn.Video_Recv_Frame_Dropped,x.framesDroppedCount),ye(k,wn.Video_Recv_Bytes_Retransmit,x.retransmittedBytesReceived),ye(k,wn.Video_Recv_Packages_Retransmit,x.retransmittedPacketsReceived),ye(k,wn.Video_Recv_Packages_Discarded,x.packetsDiscarded),ye(k,wn.Video_Recv_Avg_Decode,x.avgDecodeMs),ye(k,wn.Video_Recv_Avg_Processing_Delay,x.avgProcessingDelayMs),ye(k,wn.Video_Recv_Avg_Assembly_Time,x.avgFramesAssembledFromMultiplePacketsMs),ye(k,wn.Video_Recv_Avg_Inter_Frame_Delay,x.avgInterFrameDelayMs),ye(k,wn.Video_Recv_Key_Frames_Decoded,x.keyFramesDecoded);const te=V&&V.videoRecv.find(Oe=>Oe.ssrc===E);if(te){const Oe=C.timestamp-V.timestamp||Sc;x.packetsLost!=null&&te.packetsLost!=null&&ye(k,wn.Video_Recv_Package_Lost,x.packetsLost-te.packetsLost),te.bytes!=null&&x.bytes!=null&&ye(k,wn.Video_Recv_Bitrate,8*(x.bytes-te.bytes)/Oe),te.packets!=null&&x.packets!=null&&ye(k,wn.Video_Recv_Package_Rate,1e3*(x.packets-te.packets)/Oe)}const Fe=A&&A.videoRecv.find(Oe=>Oe.ssrc===E);if(Fe&&(ye(k,vo.Video_Recv_Qp_Sum,x.qpSumPerFrame),k[vo.Video_Recv_Freeze]=y&&qu.isRemoteVideoFreeze(R,x,Fe)?1:0),D){var Ge;const Oe=D.videoRecv.find(nt=>nt.ssrc===E);B?(ye(k,ke.Video_Recv_Height,B.height),ye(k,ke.Video_Recv_Width,B.width)):R&&(ye(k,ke.Video_Recv_Height,R._videoHeight||0),ye(k,ke.Video_Recv_Width,R._videoWidth||0)),q&&ye(k,ke.Video_Recv_Frame_Rate_Output,q.frameRate);const it=(Ge=R._player)===null||Ge===void 0?void 0:Ge.rendFrameRate.toFixed(0);if(it&&ye(k,ke.Video_Render_Frame_Rate_Render,+it),ye(k,ke.Video_Recv_Jitter_Buffer,x.jitterBufferMs),ye(k,ke.Video_Recv_Current_Delay,x.currentDelayMs),ye(k,ke.Video_Recv_Firs,x.firsCount),ye(k,ke.Video_Recv_Nacks,x.nacksCount),ye(k,ke.Video_Recv_Plis,x.plisCount),R){k[ke.Video_Recv_Disabled]=R._originMediaStreamTrack.enabled&&R._mediaStreamTrack.enabled?0:1;const nt=R._player;if(nt){const{freezeTimeCounterList:Gn,renderFreezeAccTime:Q,renderFreezeAccTime2:ie,videoElementStatus:fe}=nt;if(Gn&&Gn.length>0&&ye(k,vo.Video_Render_Freeze_Time,Gn.splice(0,1)[0]),b&&Ho.visibility==="visible"&&fe===Vn.PLAYING&&Ze().supportRequestVideoFrameCallback){const $=Math.min(6e3,ie);nt.renderFreezeAccTime2=Math.max(0,ie-$),ye(k,vo.Video_Render_Freeze_Time_Render2,$);const v=Math.min(6e3,Q);nt.renderFreezeAccTime=Math.max(0,Q-v),ye(k,vo.Video_Render_Freeze_Time_Render,N("USE_NEW_RENDER_FREEZE_TIME")?$:v)}if(typeof x.totalFreezesDuration=="number"){const $=Oe&&Oe.totalFreezesDuration?x.totalFreezesDuration-Oe.totalFreezesDuration:x.totalFreezesDuration;ye(k,ke.Video_Render_Freeze_Duration,1e3*$)}}}if(k[ke.Video_Recv_Player_Status]=gv[R._player?R._player.videoElementStatus:"uninit"],Oe&&x.totalInterFrameDelay!==void 0&&x.totalSquaredInterFrameDelay!==void 0&&Oe.totalInterFrameDelay!==void 0&&Oe.totalSquaredInterFrameDelay!==void 0){const nt=x.totalInterFrameDelay-Oe.totalInterFrameDelay,Gn=x.totalSquaredInterFrameDelay-Oe.totalSquaredInterFrameDelay,Q=x.framesDecodeCount-Oe.framesDecodeCount,ie=nt/Q*1e3,fe=Math.round(1e3*Math.sqrt((Gn-Math.pow(nt,2)/Q)/Q));!isNaN(fe)&&ie+fe>Math.max(3*ie,ie+150)&&(k[ke.Video_Recv_I_Frame_Delay]=fe)}}return k}(l._videoSSRC,t,l.videoTrack,_===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;m&&(p.video=m)}if(u.has(he.AUDIO)&&l.audioTrack){const _=l.audioTrack?function(m,E,C,R,y,b){const A=E.audioRecv.find(k=>k.ssrc===m);if(!A)return;const D={};ye(D,wn.Audio_Recv_Jitter,A.jitterMs),ye(D,wn.Audio_Recv_Bytes_Retransmit,A.retransmittedBytesReceived),ye(D,wn.Audio_Recv_Packages_Retransmit,A.retransmittedPacketsReceived),ye(D,wn.Audio_Recv_Packages_Discarded,A.packetsDiscarded),ye(D,wn.Audio_Recv_Avg_Processing_Delay,A.avgProcessingDelayMs);const V=b&&b.audioRecv.find(k=>k.ssrc===m);if(V){const k=Sc;A.packets!=null&&V.packets!=null&&ye(D,wn.Audio_Recv_Package_Rate,1e3*(A.packets-V.packets)/k),A.packetsLost!=null&&V.packetsLost!=null&&ye(D,wn.Audio_Recv_Package_Lost,A.packetsLost-V.packetsLost)}if(R){const{receivedFrames:k,droppedFrames:B}=A;k!=null&&B!=null&&(D[vo.Audio_Recv_Freeze]=(x=k)===0||100*B/x>20?1:0)}var x;if(y){const k=100*C._source.getAccurateVolumeLevel(),B=A.outputLevel;if(B!=null){const Z=Math.ceil(50*Math.log10(100*B+1));ye(D,ke.Audio_Render_Level,Z)}ye(D,ke.Audio_Recv_PCM_Level,k),C&&(D[ke.Audio_Recv_Disabled]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1),ye(D,ke.Audio_Recv_Jitter_Buffer,A.jitterBufferMs),ye(D,ke.Audio_Recv_Current_Delay,A.jitterBufferMs),D[ke.Audio_Recv_Player_Status]=gv[fr.getPlayerState(C.getTrackId())];const q=y.audioRecv.find(Z=>Z.ssrc===m);if(q){q.bytes!=null&&A.bytes!=null&&ye(D,ke.Audio_Recv_Bitrate,8*(A.bytes-q.bytes)/(Sc*Xu));const Z=A.concealedSamples-q.concealedSamples;Z>0&&ye(D,ke.Audio_Recv_Concealed_Samples,Z);const te=A.totalSamplesReceived-q.totalSamplesReceived;te>0&&ye(D,ke.Audio_Recv_Total_Samples_Received,te);const Fe=A.freezeSamples80-q.freezeSamples80;Fe>0&&ye(D,ke.Audio_Render_Freeze_Samples_80ms,Fe);const Ge=A.freezeSamples200-q.freezeSamples200;Ge>0&&ye(D,ke.Audio_Render_Freeze_Samples_200ms,Ge);const Oe=A.freezeMs80-q.freezeMs80;ye(D,ke.Audio_Render_Freeze_Time_80ms,Oe<0?0:Oe);const it=A.freezeMs200-q.freezeMs200;ye(D,ke.Audio_Render_Freeze_Time_200ms,it<0?0:it)}}return D}(l._audioSSRC,t,l.audioTrack,n,r,i):void 0;_&&(p.audio=_)}(p.video||p.audio)&&a.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof Uu);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Vu.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(he.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(he.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const u of s)!u.muted&&u.enabled&&(i=i.concat(await u.getProcessorUsage()));const a=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[u,p]of a)p.has(he.VIDEO)&&u.videoTrack&&(i=i.concat(await u.videoTrack.getProcessorUsage())),p.has(he.AUDIO)&&u.audioTrack&&(i=i.concat(await u.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(u,p){const _={};for(const{id:R,value:y,level:b,direction:A}of u){var m;const D=(m=p.get(R))!==null&&m!==void 0?m:0,V=y===2?D+N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:D;var E,C;p.set(R,V),_[R]?(y===2&&(_[R].value=y),b>_[R].level&&(_[R].level=b),A==="remote"&&(_[R].remoteUidCount+=1),_[R].totalTs=(E=p.get(R))!==null&&E!==void 0?E:0):_[R]={value:y,level:b,remoteUidCount:A==="local"?0:1,totalTs:(C=p.get(R))!==null&&C!==void 0?C:0}}return Object.keys(_).map(R=>{const{level:y,value:b,totalTs:A}=_[R];return{id:R,level:y,value:b,totalTs:A}})}(i,t);const d=Date.now(),l=d>n?d:n+1;this.requestUpload&&this.requestUpload(Vu.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:l})},N("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const nX=N("ICE_RESTART_INTERVAL");let W_=new Map,el=new Map,pa=[Bn.UDP_TCP_RELAY,Bn.TCP_RELAY,Bn.RELAY],mR=N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ze().supportPCSetConfiguration;function HL(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=W_.get(e.id);n&&(window.clearTimeout(n),W_.delete(e.id));const r=el.get(e.id);t&&r&&r.index===pa.length-1&&(T.debug("[".concat(e.id,"] reset ICE restart policy")),el.delete(e.id))}function KL(e,t,n){if(W_.size===0&&el.size===0&&(Array.isArray(N("RESTART_SEQUENCE"))&&N("RESTART_SEQUENCE").length>0&&!function(d,l){if(d.length!==l.length)return!1;for(let u=0;u<d.length;u+=1){const p=d[u];if(d.filter(_=>_===p).length!==l.filter(_=>_===p).length)return!1}return!0}(pa,N("RESTART_SEQUENCE"))&&(pa=N("RESTART_SEQUENCE").filter(d=>{var l;if(oe(l=Object.values(Bn)).call(l,d))return!0}),T.debug("use reconnection policy from config distribution, queues: ".concat(pa.join(" => ")))),mR=N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ze().supportPCSetConfiguration),pa.length===0)return void n();let r,{index:i=0,type:s}=el.get(e.id)||{};if(mR&&s===Bn.RELAY)return void n();let a=s&&i>=pa.length-1;if(mR)s=Bn.RELAY;else{if(a)return void n();s?(i++,s=pa[i]):(s=pa[0],i=0)}T.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),el.set(e.id,{index:i,type:s}),r=window.setTimeout(()=>KL(e,t,n),nX),W_.set(e.id,r)}var He;function zL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function qo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function YL(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=NT,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new H_(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function H_(e){function t(n){if(Object(n)!==n)return de.reject(new TypeError(n+" is not an object."));var r=n.done;return de.resolve(n.value).then(function(i){return{value:i,done:r}})}return H_=function(n){this.s=n,this.n=n.next},H_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?de.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?de.reject(n):t(r.apply(this.s,arguments))}},new H_(e)}let Ju=(He=class extends Lt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Te.StateChange,t,this._state)}constructor(e,t){super(),w(this,"isPlanB",void 0),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"connection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"remoteDataChannelMap",new Map),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"pendingLocalDataChannels",[]),w(this,"pendingRemoteDataChannels",[]),w(this,"statsCollector",void 0),w(this,"shouldForwardP2PCreation",void 0),w(this,"iceFailedCount",0),w(this,"dtlsFailedCount",0),w(this,"mutex",void 0),w(this,"_state",st.Disconnected),w(this,"_pcStatsUploadType",N("NEW_ICE_RESTART")?gs.FIRST_CONNECTION:gs.OLD_FIRST_CONNECTION),w(this,"_isStartRestartIce",!1),w(this,"_restartTimer",void 0),w(this,"_isTryConnecting",!1),w(this,"_iceError",null),w(this,"_forceTurn",!1),w(this,"_isWaitPcToRePub",!1),w(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==st.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const a=this.filterTobeMutedTracks(n);if(a.length===0)return void r();const d=a.find(u=>u[0]==="videoLowTrack");if(d){const u=d[1];this.store.enableInstantMuteRestore?(u.track._originMediaStreamTrack.enabled=!1,T.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):u.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?T.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(a.map(u=>{let[,{id:p}]=u;return p}));const l=this.createMuteMessage(a);await gt(this,Te.RequestMuteLocal,l),r()}catch(a){i(a)}finally{s()}}),w(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==st.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const a=this.filterTobeUnmutedTracks(n);if(a.length===0)return void r();const d=a.find(u=>u[0]==="videoLowTrack");if(d){const u=d[1];if(this.store.enableInstantMuteRestore)u.track._originMediaStreamTrack.enabled=!0,T.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(u.track._originMediaStreamTrack.stop(),!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p}else{const p=_R(n,Ou(this,Te.RequestLowStreamParameter));u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p}await new de((p,_)=>{this.handleReplaceTrack(u.track,p,_,!0)})}}this.store.enableInstantMuteRestore?T.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(a.map(u=>{let[,{id:p}]=u;return p}));const l=this.createUnmuteMessage(a);await gt(this,Te.RequestUnmuteLocal,l),r()}catch(a){i(a)}finally{s()}}),w(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let a;s||(a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(ee.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==st.Connected)return void r();const{id:u,track:p}=l;await this.connection.updateSendParameters(u,p),await this.connection.updateEncoderConfig(u,p),this.emit(Te.UpdateVideoEncoder,p),r()}catch(l){i(l)}finally{var d;(d=a)===null||d===void 0||d()}}),w(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const a=this.localTrackMap.get(ee.LocalVideoTrack);if(!this.connection||!a||a.track!==n||this.state!==st.Connected)return void r();const{id:d,track:l}=a;await this.connection.updateSendParameters(d,l),r()}catch(a){i(a)}finally{s()}}),w(this,"handleReplaceMixingTrack",async(n,r,i,s)=>{if(!this.connection||this.state!==st.Connected)return void r();const a=pR([n]);let d;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(a.getTrackId(),"]")),typeof s=="boolean"&&s||(d=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,a),r()}catch(u){i(u)}finally{var l;(l=d)===null||l===void 0||l()}}),w(this,"handleReplaceTrack",async(n,r,i,s)=>{let a;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(a=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var d;const u=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.connection||!u||this.state!==st.Connected)return void r();if(await((d=this.connection)===null||d===void 0?void 0:d.replaceTrack(n,u[1].id)),this.isPlanB){const p=u[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(u[0],p)}if(u[0]===ee.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const p=this.localTrackMap.get(ee.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new de((m,E)=>{this.handleReplaceTrack(p.track,m,E,!0)})}}r()}catch(u){i(u)}finally{var l;(l=a)===null||l===void 0||l()}}),w(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new WL(this.store),this.bindStatsUploaderEvents(),this.mutex=new xn("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ze().supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&_s(),this.shouldForwardP2PCreation=N("FORWARD_P2P_CREATION")&&Ze().supportPCSetConfiguration&&KT(),this.shouldForwardP2PCreation&&(this.connection=B_(this.store),this.emit(Te.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=st.New,this._forceTurn=VL(e),T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=B_(this.store,e),this.emit(Te.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=N("NEW_ICE_RESTART")?gs.FIRST_CONNECTION:gs.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===st.Connected){if(this.connection instanceof Ei&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Se.reportApiInvoke(this.store.sessionId,{name:Wt.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Dt.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Te.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=st.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[a]=i;return oe(s=[ee.LocalVideoLowTrack,ee.LocalVideoTrack]).call(s,a)}),n=t.map(i=>{let[,{id:s}]=i;return s}),r=t.map(i=>{let[s]=i;return s});if(this.connection instanceof Ei){if(Se.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!oe(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>oe(e).call(e,s));i&&(this.store.codec=i,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ei&&this.connection.peerConnectionState!=="closed"&&oe(e=[st.New,st.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==st.Connected){if(this.state===st.Disconnected)throw new Y(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;oe(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var r=this;return ui(function*(){const i=yield Qe(r.mutex.lock("From P2PChannel.publish"));try{var s;const a=r.connection&&oe(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==st.Connected||a){if(r.state===st.Disconnected)throw new Y(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const l=e.filter(u=>r.pendingLocalTracks.indexOf(u)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(l),void(a&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,jn.markPublishStart(r.store.clientId,r.store.pubId);const d=r.filterTobePublishedTracks(e,t,n);if(d.length===0)return void(yield Qe(r.tryToUnmuteAudio(e)));yield*Uf(YL(r.doPublish(r.connection,d)))}finally{i()}})()}doPublish(e,t){var n=this;return ui(function*(){t.forEach(m=>{let{track:E,type:C}=m;const R=Date.now();n.store.publish(E.getTrackId(),C===ee.LocalAudioTrack?"audio":"video",R)}),n.bindLocalTrackEvents(t);const r=t.map(m=>{let{track:E}=m;return E}),i=yield Qe(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield Qe(i.next())).value,a=n.createGatewayPublishMessage(t,s);let d;try{d=yield a}catch(m){throw i.throw(m),(m==null?void 0:m.code)===O.WS_ABORT&&t.forEach(E=>{let{track:C}=E;n.pendingLocalTracks.indexOf(C)===-1&&n.pendingLocalTracks.push(C)}),n.unbindLocalTrackEvents(t),m}const l=n.mapPubResToRemoteConfig(a,d,r),u=(yield Qe(i.next(l))).value;if(n.state===st.Disconnected)throw new Y(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");N("ENABLE_VIDEO_SEI");const p=N("ENABLE_ENCODED_TRANSFORM"),_=N("ENABLE_AUDIO_METADATA");r.forEach(async m=>{const E=m.getRTCRtpTransceiver();if(!E||!p)return;const{interceptLocalVideoFrame:C,interceptLocalAudioFrame:R}=D_();m.trackMediaType===he.VIDEO?await C(E.sender,m):m.trackMediaType===he.AUDIO&&await R(E.sender,{metadata:_?()=>{const y=m.metadata.shift();return y&&y.value}:void 0})}),t.forEach(m=>{let{type:E}=m;n.statsCollector.addLocalStats(E)}),n.assignLocalTracks(t,u),n.statsUploader.startUploadOutboundStats(),t.forEach(m=>{let{track:E,type:C}=m;const R=Date.now();n.store.publish(E.getTrackId(),C===ee.LocalAudioTrack?"audio":"video",void 0,R)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof Ct))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(s,a){const d={};return s.height&&s.width&&(d.scaleResolutionDownBy=Xv(s,a)),d.maxFramerate=s.framerate?Vr(s.framerate):void 0,d.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,d}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==ee.LocalVideoLowTrack||!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return T.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(a,d){const l=a.canvas;d.width&&(l.width=Vr(d.width)),d.height&&(l.height=Vr(d.height)),d.framerate&&(l.stopCapture&&l.stopCapture(),l.stopCapture=Tv(()=>{!l.startCapture&&l.stopCapture&&l.stopCapture(),l.startCapture&&l.startCapture()},Vr(d.framerate)))})(s,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),T.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return ui(function*(){if(!t.connection||t.state!==st.Connected)return;const n=yield Qe(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(ee.LocalVideoTrack);if(!i)throw new Y(O.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ee.LocalVideoLowTrack))throw new Y(O.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:ee.LocalVideoLowTrack}];if(yield*Uf(YL(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var r;const a=(r=t.localTrackMap.get(ee.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;a!==void 0&&(yield Qe(t.connection.muteLocal([a])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Pn(this,Te.RequestRePublish,this.pendingLocalTracks),this.emit(Te.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Pn(this,Te.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==he.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==he.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Pn(this,Te.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===he.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Te.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==st.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==st.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==st.Connected)return;const e=this.localTrackMap.get(ee.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ee.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:s}]=r;return{type:i,track:s}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==st.Connected)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex(a=>{let{user:d,id:l}=a;return d.uid===e.uid&&l===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==st.Connected)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let a,d,l,u;const p=this.connection.getPreMedia(n);if(p)T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),l=p.transceiver,a=p.track,d=p.mid,u=p.player,p.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:p.firstVideoRender});else if(i){const E=i.find(R=>{let{stream_type:y}=R;return y===t});if(!E)throw new Y(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const C=await this.connection.receive(t,E.ssrcs,String(e._uintid),E.attributes);this.connection instanceof Ei&&(l=C.transceiver),a=C.track,d=C.id}else{const E=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof Ei&&(l=E.transceiver),a=E.track,d=E.id}if(t===he.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new jd(a,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new Bd(a,e.uid,e._uintid,this.store,u),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(fi.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(fi.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),u?e._videoTrack.once(fi.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(fi.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack)),l&&N("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:E,interceptRemoteAudioFrame:C}=D_();t==he.VIDEO?await E(l.receiver,{onSei:N("ENABLE_VIDEO_SEI")&&(R=>{var y;return(y=e._videoTrack)===null||y===void 0?void 0:y._onSei(R)})}):t==he.AUDIO&&await C(l.receiver,{enableTopn:!!N("ENABLE_AUDIO_TOPN"),enableMetadata:!!N("ENABLE_AUDIO_METADATA"),enablePts:!!N("ENABLE_AUDIO_PTS"),onMetadata:R=>{this.safeEmit(Te.AudioMetadata,R)},onPts:R=>{this.safeEmit(Te.AudioPts,R)}})}const _=this.remoteUserMap.get(e);_?_.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex(E=>{let{user:C,kind:R}=E;return C.uid===e.uid&&t===R});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Te.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==st.Connected)throw new Y(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var s;let{user:a,mediaType:d}=i;return!((s=this.remoteUserMap.get(a))!==null&&s!==void 0&&s.has(d))});const t=[],n=new Map;e.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);if(s){const{track:a,mid:d,transceiver:l,player:u}=s;n.set(i.ssrcId,{track:a,id:d,transceiver:l,player:u})}else t.push(i)});const r=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:a,ssrcId:d,rtxSsrcId:l}=i;return{kind:a,ssrcMsg:[{ssrcId:d,rtx:l}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{n.set(i.ssrcId,r[s])});for(const{user:i,mediaType:s,ssrcId:a}of e){const d=n.get(a);if(!d)return void T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(a));const{track:l,id:u,transceiver:p,player:_}=d;if(p&&N("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:R}=D_();s==he.VIDEO?await C(p.receiver,{onSei:N("ENABLE_VIDEO_SEI")&&(y=>{var b;return(b=i._videoTrack)===null||b===void 0?void 0:b._onSei(y)})}):s==he.AUDIO&&await R(p.receiver,{enableTopn:!!N("ENABLE_AUDIO_TOPN"),enableMetadata:!!N("ENABLE_AUDIO_METADATA"),enablePts:!!N("ENABLE_AUDIO_PTS"),onMetadata:y=>{this.safeEmit(Te.AudioMetadata,y)},onPts:y=>{this.safeEmit(Te.AudioPts,y)}})}if(s===he.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(l):(i._audioTrack=new jd(l,i.uid,i._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),p&&i._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(l):(i._videoTrack=new Bd(l,i.uid,i._uintid,this.store,_),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),p&&i._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._videoTrack)),N("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:R}=D_();s==he.VIDEO?await C(p.receiver,{onSei:y=>{var b;(b=i._videoTrack)===null||b===void 0||b._onSei(y)}}):s==he.AUDIO&&await R(p.receiver)}const m=this.remoteUserMap.get(i);m?m.set(s,u):this.remoteUserMap.set(i,new Map([[s,u]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(C=>{let{user:R,kind:y}=C;return R.uid===i.uid&&s===y});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Te.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(a=>{let{user:d,kind:l}=a;return t!==void 0?d.uid===e.uid&&t===l:d.uid===e.uid});if(r.forEach(a=>{const d=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(d,1)}),this.connection&&this.state===st.Connected||n||r.forEach(a=>{let{kind:d}=a;var l;if(d===he.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(d===he.VIDEO){var u;(u=e._videoTrack)===null||u===void 0||u._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==st.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:d}]=a;return d}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(a=>{let[d,{kind:l}]=a;var u,p;if(l===he.VIDEO&&d._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),l===he.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((p=d._videoTrack)===null||p===void 0||p._destroy(),d._videoTrack=void 0);else if(l===he.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(a=>a.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const a=this.pendingRemoteTracks.filter(d=>{let{user:l,kind:u}=d;return s!==void 0?l.uid===i.uid&&s===u:l.uid===i.uid});a.forEach(d=>{const l=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(l,1)}),t=t.concat(a)}if(!this.connection||this.state!==st.Connected)return void t.forEach(i=>{let{user:s,kind:a}=i;var d;if(a===he.AUDIO)(d=s._audioTrack)===null||d===void 0||d._destroy(),s._audioTrack=void 0;else if(a===he.VIDEO){var l;(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0}});const n=Di(e).call(e,(i,s)=>{let{user:a,mediaType:d}=s;const l=this.filterTobeUnSubscribedTracks(a,d);return i.concat(l)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:s}]=i;return s}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[s,{kind:a}]=i;var d,l;if(a===he.VIDEO&&s._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),a===he.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0;else if(a===he.AUDIO){var u;this.unbindRemoteTrackEvents(s._audioTrack),(u=s._audioTrack)===null||u===void 0||u._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==st.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===he.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ee.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ee.LocalAudioTrack);if((t==null?void 0:t.track)instanceof rn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==ee.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===ee.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ee.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const a=this.localTrackMap.get(ee.LocalAudioTrack),d=r?this.localTrackMap.get(ee.LocalVideoLowTrack):this.localTrackMap.get(ee.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:jn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(mt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const a=n.find(l=>l instanceof Gt),d=r?(s=this.localTrackMap.get(ee.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof Ct);Se.publish(this.store.sessionId,{eventElapse:jn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(mt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===he.VIDEO?n._videoSSRC:n._audioSSRC;i&&Se.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===he.VIDEO,audio:r===he.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:jn.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new xn("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=B_(this.store),this.emit(Te.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ee.LocalAudioTrack);if((e==null?void 0:e.track)instanceof rn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=st.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ee.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ee.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ct||t&&t.track instanceof Gt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Cr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ee.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Qa(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=st.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=B_(this.store),this.emit(Te.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case ee.LocalVideoTrack:oe(t=r._hints).call(t,mt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ee.LocalAudioTrack:r instanceof rn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ee.LocalVideoLowTrack:}}),this.emit(Te.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Cr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Te.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Cr(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof ha?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof ha?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ui(function*(){if(!t.connection||t.state!==st.Connected)return;const n=yield Qe(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Qe(t.connection.restartICE(e));const s=yield Qe(r.next());if(s.done)return;const a=s.value,d=yield a;switch(fR(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Bn.UDP_TCP_RELAY:t._pcStatsUploadType=gs.UDP_TCP_RESTART;break;case Bn.TCP_RELAY:t._pcStatsUploadType=gs.TCP_RESTART;break;case Bn.RELAY:t._pcStatsUploadType=gs.RELAY_RESTART;break;default:t._pcStatsUploadType=gs.OLD_RESTART}t._isTryConnecting=!0,r.next(d)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ee.LocalVideoTrack),n=this.localTrackMap.get(ee.LocalAudioTrack),r=e.videoSend.find(E=>E.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(E=>E.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const s=Yr(this,Te.NeedSignalRTT),a=r?r.rttMs:void 0,d=i?i.rttMs:void 0,l=a&&d?(a+d)/2:a||d,u=(l&&s?(l+s)/2:l||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*u/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=t==null?void 0:t.track;if(m&&m._encoderConfig&&m._hints.indexOf(mt.SCREEN_TRACK)===-1){const E=m._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(E&&C){const R=(1e3*E-C)/(1e3*E);return k1[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,a=e.audioRecv.find(C=>C.ssrc===i),d=e.videoRecv.find(C=>C.ssrc===s);if(!a&&!d)return void(t+=1);const l=Yr(this,Te.NeedSignalRTT),u=e.rtt,p=(u&&l?(u+l)/2:u||l)||0,_=a?a.jitterMs:void 0,m=e.recvPacketLossRate;let E=.7*m*100/50+.3*p/1500;_&&(E=.6*m*100/50+.2*p/1500+.2*_/400),t+=E<.1?1:E<.17?2:E<.36?3:E<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new de((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==st.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:a}]=s;return e===a});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===ee.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding){const s=this.localTrackMap.get(ee.LocalVideoLowTrack);if(s){const a=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=a,s.track._originMediaStreamTrack=a,await new de((d,l)=>{this.handleReplaceTrack(s.track,d,l,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=Ad(e=e.filter(l=>i.indexOf(l)===-1));let s,a=!1;const d=this.localTrackMap.get(ee.LocalAudioTrack);for(const l of e){if(l instanceof Ct&&(this.localTrackMap.has(ee.LocalVideoTrack)||a?new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:ee.LocalVideoTrack}),a=!0),t)){const u=this.getLowVideoTrack(l,n);r.push({track:u,type:ee.LocalVideoLowTrack})}if(l instanceof Gt)if(d){const u=d.track;if(u instanceof rn)hR([l]),u.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0);else{const p=pR([u,l]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(u,p)}}else s instanceof rn?(hR([l]),s.addAudioTrack(l)):s||!l._useAudioElement&&Ze().webAudioMediaStreamDest&&!l._bypassWebAudio?s=pR(s?[l,s]:[l]):s=l}return s&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:ee.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Ad(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Gt){const i=this.localTrackMap.get(ee.LocalAudioTrack);if(!i)continue;i.track instanceof rn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ee.LocalAudioTrack,i]),i.track.close())):t.push([ee.LocalAudioTrack,i])}if(r instanceof Ct){const i=this.localTrackMap.get(ee.LocalVideoTrack);if(!i)continue;t.push([ee.LocalVideoTrack,i]);const s=this.localTrackMap.get(ee.LocalVideoLowTrack);s&&t.push([ee.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Ad(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ad(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ee.LocalVideoTrack:n.addListener(_e.GET_STATS,this.handleGetLocalVideoStats),n.addListener(_e.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(_e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ee.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof rn?e.trackList.forEach(n=>{n.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_e.GET_STATS,this.handleGetLocalAudioStats),n.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(_e.GET_STATS,this.handleGetLocalAudioStats),e.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(_e.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ee.LocalVideoTrack:n.off(_e.GET_STATS,this.handleGetLocalVideoStats),n.off(_e.GET_RTC_STATS,this.handleGetRTCStats),n.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(_e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(_e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ee.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof rn?e.trackList.forEach(t=>{t.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(_e.GET_STATS,this.handleGetLocalAudioStats),t.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(_e.GET_STATS,this.handleGetLocalAudioStats),e.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(_e.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Bd&&t.addListener(_e.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof jd&&t.addListener(_e.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(_e.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(he.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(he.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,a,{track:d,type:l}=n;switch(l){case ee.LocalAudioTrack:s=at.Audio,a={dtx:d instanceof Uu&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ee.LocalVideoTrack:s=oe(i=d._hints).call(i,mt.SCREEN_TRACK)?at.Screen:at.High,a=qo(qo({},X1(d)),{},{codec:this.store.codec,svc_mode:w_()});break;case ee.LocalVideoLowTrack:s=at.Low,a=qo(qo({},X1(d)),{},{codec:this.store.codec,svc_mode:w_()})}return{stream_type:s,attributes:a,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ee.LocalVideoTrack:r=oe(n=s._hints).call(n,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalAudioTrack:r=at.Audio;break;case ee.LocalVideoLowTrack:r=at.Low}return{stream_type:r,ssrcs:a,mid:d}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Te.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ei&&!Ut()&&N("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},N("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ei&&HL(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=gs.DISCONNECTED_OR_FAILED,Yr(this,Te.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));Se.reportApiInvoke(this.store.sessionId,{name:Wt.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:Dt.TRACER}).onSuccess(),this.republish()}if(N("NEW_ICE_RESTART")&&e instanceof Ei&&!Ut()&&!this._forceTurn){if(oe(W1).call(W1,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=i=>{fR(e)&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Yr(this,Te.QueryClientConnectionState)==="CONNECTED"&&this.emit(Te.RequestRestartICE,i))},r=()=>{fR(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Te.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{KL(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&N("ICE_RESTART")&&Yr(this,Te.QueryClientConnectionState)==="CONNECTED"&&this.emit(Te.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Te.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Te.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Dt.TRACER}).onSuccess(),this.emit(Te.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Cr(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(fi.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,dn.FIRST_AUDIO_DECODE,Nt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Cr(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Se.firstRemoteFrame(this.store.sessionId,dn.FIRST_AUDIO_RECEIVED,Nt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;const s=Array.from(Cr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;const r=Array.from(Cr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Cr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),Se.firstRemoteFrame(this.store.sessionId,dn.FIRST_VIDEO_RECEIVED,Nt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Te.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(aa(n))," -> ").concat(JSON.stringify(aa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(aa(n))," -> ").concat(JSON.stringify(aa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return qo(qo({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ei&&function(t){el.delete(t.id),HL(t)}(e),e.close(),this.emit(Te.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ee.LocalAudioTrack);if(e instanceof Gt&&(n==null?void 0:n.track)instanceof rn)return n.track.isActive||t.push([ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===ee.LocalVideoTrack)){const i=this.localTrackMap.get(ee.LocalVideoLowTrack);i&&t.push([ee.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ee.LocalAudioTrack);if(e instanceof Gt&&(n==null?void 0:n.track)instanceof rn)return n.track.isActive&&t.push([ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===ee.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ee.LocalVideoLowTrack);i&&t.push([ee.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ee.LocalAudioTrack:r=at.Audio;break;case ee.LocalVideoTrack:r=oe(n=s._hints).call(n,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:r=at.Low}return{stream_type:r,ssrcs:a,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ee.LocalAudioTrack:r=at.Audio;break;case ee.LocalVideoTrack:r=oe(n=s._hints).call(n,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:r=at.Low}return{stream_type:r,ssrcs:a,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,a]=i;n.push([e,{kind:s,id:a}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case he.VIDEO:return void(r._videoSSRC&&t.push({stream_type:he.VIDEO,ssrcId:r._videoSSRC}));case he.AUDIO:return void(r._audioSSRC&&t.push({stream_type:he.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let s=t.get(r);i===he.VIDEO?s|=pn.Video:s|=pn.Audio,t.set(r,s)}else i===he.VIDEO?t.set(r,pn.Video):t.set(r,pn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ee.LocalVideoTrack),n=this.localTrackMap.get(ee.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new de((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new de((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Ei&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Ei&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((r,i)=>{var s;let{stream_type:a}=r;const d=(s=t.find(l=>{let{stream_type:u}=l;return a===u}))===null||s===void 0?void 0:s.attributes;if(d&&N("DISABLE_SCREEN_SHARE_REMB")){const l=n[i]._hints;(oe(l).call(l,mt.SCREEN_TRACK)||oe(l).call(l,mt.SCREEN_LOW_TRACK))&&(d.remb=!1,T.debug("disable remb for screen share, hints:",l))}return d})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Gt){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(s=>{let[,{id:a}]=s;return a})));const i=this.createUnmuteMessage(r);return void await gt(this,Te.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Te.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Te.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yn($T(this.dtlsFailedCount,Qt)),this.emit(Te.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Pn(this,Te.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Te.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ee.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ct)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ct).length>1)throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Gt).length>1&&(e.some(t=>t instanceof Gt&&t._bypassWebAudio)||!Ze().webAudioMediaStreamDest))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ct&&this.pendingLocalTracks.some(n=>n instanceof Ct))throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Gt&&this.pendingLocalTracks.some(n=>n instanceof Gt)&&(!Ze().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Gt&&n._bypassWebAudio)))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding,i=qo(qo({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():_R(e,i);const a=St(8,"track-low-"),d=new Ct(s,qo(qo({},r&&{scaleResolutionDownBy:Xv(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return d.on(lc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,Ld.LOW_STREAM)}),d._hints.push(mt.LOW_STREAM),oe(n=e._hints).call(n,mt.SCREEN_TRACK)&&d._hints.push(mt.SCREEN_LOW_TRACK),e.on("sei-to-send",l=>{d.emit("sei-to-send",l)}),e.addListener(_e.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ei){var i,s,a,d;const l=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:p,peerConnectionState:_}=this.connection,{local:m,remote:E}=await this.connection.getSelectedCandidatePair();Se.pcStats(this.store.sessionId,{startTime:l,eventElapse:e-l||0,iceconnectionsate:u,dtlsstate:p,connectionstate:_,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=m==null?void 0:m.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=m.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(m.address,":").concat(m.port),selectedRemoteCandidateProtocol:(a=E.protocol)!==null&&a!==void 0?a:"",selectedRemoteCandidateType:(d=E.candidateType)!==null&&d!==void 0?d:"",selectedRemoteCandidateAddress:"".concat(E.address,":").concat(E.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(p=>p.userId===e.uid);if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:a,peerPublishDuration:d,peerPubStatusMs:l}=n;let{firstRender:u=0}=n;if(s&&(u||a)&&d&&l){n.isInternalUpload=!0;const{playEnd:p}=n;p&&(n.isExternalUpload=!0);const{firstPreRender:_=0}=n;u=_||u;const m=e.videoTrack,E={peer:e._uintid,width:(m==null?void 0:m._videoWidth)||0,height:(m==null?void 0:m._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:d,peerPubStatusMs:l,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:_||0,firstRender:p?Math.max(u,p):Math.max(u,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:SP(this.store)};Se.firstXLAPeerFirstVideoFrame(this.store.sessionId,E)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Cr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const a=this.store.keyMetrics,d=a.subscribe.find(l=>l.userId===s.uid&&l.type==="video");Se.firstRemoteVideoDecode(this.store.sessionId,dn.FIRST_VIDEO_DECODE,Nt.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:r?1:0,firstFrame:(d==null?void 0:d.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ee.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Ld.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},me(He.prototype,"startP2PConnection",[$n],Object.getOwnPropertyDescriptor(He.prototype,"startP2PConnection"),He.prototype),me(He.prototype,"connect",[$n],Object.getOwnPropertyDescriptor(He.prototype,"connect"),He.prototype),me(He.prototype,"updateRemoteRTPCapabilities",[$n],Object.getOwnPropertyDescriptor(He.prototype,"updateRemoteRTPCapabilities"),He.prototype),me(He.prototype,"publishDataChannel",[$n],Object.getOwnPropertyDescriptor(He.prototype,"publishDataChannel"),He.prototype),me(He.prototype,"unpublish",[$n],Object.getOwnPropertyDescriptor(He.prototype,"unpublish"),He.prototype),me(He.prototype,"unpublishDataChannel",[$n],Object.getOwnPropertyDescriptor(He.prototype,"unpublishDataChannel"),He.prototype),me(He.prototype,"unpublishLowStream",[$n],Object.getOwnPropertyDescriptor(He.prototype,"unpublishLowStream"),He.prototype),me(He.prototype,"subscribeDataChannel",[$n],Object.getOwnPropertyDescriptor(He.prototype,"subscribeDataChannel"),He.prototype),me(He.prototype,"subscribe",[$n],Object.getOwnPropertyDescriptor(He.prototype,"subscribe"),He.prototype),me(He.prototype,"massSubscribe",[$n],Object.getOwnPropertyDescriptor(He.prototype,"massSubscribe"),He.prototype),me(He.prototype,"unsubscribe",[$n],Object.getOwnPropertyDescriptor(He.prototype,"unsubscribe"),He.prototype),me(He.prototype,"unsubscribeDataChannel",[$n],Object.getOwnPropertyDescriptor(He.prototype,"unsubscribeDataChannel"),He.prototype),me(He.prototype,"massUnsubscribe",[$n],Object.getOwnPropertyDescriptor(He.prototype,"massUnsubscribe"),He.prototype),me(He.prototype,"muteRemote",[$n],Object.getOwnPropertyDescriptor(He.prototype,"muteRemote"),He.prototype),me(He.prototype,"unmuteRemote",[$n],Object.getOwnPropertyDescriptor(He.prototype,"unmuteRemote"),He.prototype),me(He.prototype,"hasRemoteMediaWithLock",[$n],Object.getOwnPropertyDescriptor(He.prototype,"hasRemoteMediaWithLock"),He.prototype),me(He.prototype,"disconnectForReconnect",[$n],Object.getOwnPropertyDescriptor(He.prototype,"disconnectForReconnect"),He.prototype),me(He.prototype,"updateBitrateLimit",[$n],Object.getOwnPropertyDescriptor(He.prototype,"updateBitrateLimit"),He.prototype),me(He.prototype,"remoteMediaSsrcChanged",[$n],Object.getOwnPropertyDescriptor(He.prototype,"remoteMediaSsrcChanged"),He.prototype),He);function $n(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}function qL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function XL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const rX=Date.now(),iX=20,ER=new Map,K_=new Map;async function JL(e){const t=ER.get(e),n=Array.isArray(t)&&t[t.length-1],r=K_.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,a=s-(Date.now()-r.firstRecvTs);a>0&&(r.firstRecvTs=Date.now()-s);let d=n.mediaDelay+a;d<=0?(t.pop(),QL(n.context,i),d=0):d=Math.min(d,iX),setTimeout(()=>t.length&&JL(e),d)}function QL(e,t){e.safeEmit(Ke.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function oX(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return QL(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=ER.get(r)||[],s=i.findIndex(u=>e.sendTs>=u.sendTs),a=XL(XL({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(a):i.splice(s,0,a),ER.set(r,i);let d=!1;var l;K_.has(r)?d=!((l=K_.get(r))===null||l===void 0||!l.isSyncing):K_.set(r,{isSyncing:d,firstRecvTs:0,firstSendTs:0}),d||JL(r)}const sX=qe().name;function ZL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function $L(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZL(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const tl="websdk_ng_cache_parameter",aX=N("MAX_PRELOAD_ASYNC_LENGTH"),cX=1e4,Tc=new Map,vc=[];let gR=null,SR=0,TR=0;const z_=new Map,dX=function(e,t){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,a=new Array(s),d=0;d<s;d++)a[d]=arguments[d];return new de(async(l,u)=>{n.push(async()=>{try{const p=await e(...a);l(p)}catch(p){u(p)}}),r<t&&(r++,i())})}}(eM,aX),vR=pr.CancelToken.source();async function eM(e,t,n,r,i,s){try{if(!N("ENABLE_PRELOAD"))return;if(!Ze().supportWebCrypto)return void ea(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new Y(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Rn(n,"token",1,2047),Rn(e,"appid",1,2047),T_(t),r&&v_(r);const a=cc();T.debug("preload channel ".concat(t,", uid is ").concat(r));const d={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:a,proxyServer:i};let l,u;typeof r=="string"?(d.stringUid=r,[u,l]=await de.all([zq(r,{sid:a,appId:e},vR.token),wL($L($L({},d),{},{token:n||e,uid:0}),vR.token)]),d.uid=u.uid,l.gatewayInfo.uid=d.uid,l.gatewayInfo.res.uid=d.uid):(s&&(d.stringUid=s),l=await wL(d,vR.token));const p={sid:a,appId:e,cname:t,token:n||e,uid:d.stringUid||r,intUid:d.uid||l.gatewayInfo.uid,stringUid:d.stringUid,ts:Date.now(),sua:u,ap:l};await async function(_){let m;try{_.uid&&nM({appId:_.appId,cname:_.cname,token:_.token,uid:_.uid,stringUid:_.stringUid});const E=sM(_),C=await async function(y,b){try{const A=await window.crypto.subtle.importKey("raw",zD(b),"AES-GCM",!1,["encrypt"]),D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},A,ac(window.btoa(JSON.stringify(y))));return ta(new Uint8Array(D))}catch{return}}(_,_.token||_.appId);if(!C)return;m=oM(tl);const R=m?JSON.parse(m):[];R.push({[E]:C}),R.length>N("AP_CACHE_NUM")&&R.shift(),Y_(tl,JSON.stringify(R))}catch(E){T.warn("Error caching server parameters:",E.message),Y_(tl,"")}}(p),SR++}catch(a){throw TR++,function(d){gR||(gR=window.setTimeout(()=>{let u="";z_.forEach((p,_)=>{u+="".concat(_,": ").concat(p," ;")}),Se.reportApiInvoke(null,{name:Wt.PRELOAD,options:{success:SR,failed:TR,err:u}}).onError(d),SR=0,TR=0,z_.clear(),gR=null},cX));const l=z_.get(d.code)||0;z_.set(d.code,l+1)}(a),a}}async function tM(e){try{if(N("AP_REQUEST_DETAIL")||N("ENABLE_ROLE_SELECT_EDGE"))return;const t=nM(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",zD(i),"AES-GCM",!1,["decrypt"]),a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,ac(r));return JSON.parse(window.atob(ta(new Uint8Array(a))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<N("AP_CACHE_LIFETIME"))return n}catch(t){T.warn("Error get preloadInfo",t.message)}}function nM(e){let t;try{if(t=oM(tl),!t)return;const n=JSON.parse(t),r=sM(e),i=function(a,d){for(let l=a.length-1;l>=0;l--)if(d(a[l]))return l;return-1}(n,a=>r in a);if(i===-1)return;const s=n.splice(i,1)[0];return Y_(tl,JSON.stringify(n)),s[r]}catch(n){T.warn("Error delete preload info: ".concat(t),n.message),Y_(tl,"")}}function RR(e){if(e){let t=Tc.get(e);t&&(window.clearTimeout(t),t=null,Tc.delete(e)),oe(vc).call(vc,e)||e.cloudProxyServer!=="disabled"||vc.push(e)}if(Tc.size<N("AP_CACHE_NUM")&&vc.length>0){const t=vc.shift();Tc.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:a,proxyServer:d}=t;try{await dX(n,r,i,a,d,s),Tc.has(t)&&RR(t)}catch(l){T.warn("update preload failed",l.message),rM(t)}},N("AP_UPDATE_INTERVAL")))}}function rM(e){const t=vc.indexOf(e);t!==-1&&vc.splice(t,1);let n=Tc.get(e);n&&(window.clearTimeout(n),n=null,Tc.delete(e),RR())}function iM(e,t){const n=e.sua,r=e.ap;t&&n&&Se.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Se.reportResourceTiming(e.ap.url,e.sid),Se.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[qt.CHOOSE_SERVER,qt.CLOUD_PROXY_FALLBACK].toString()}),Se.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[qt.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function oM(e){return window.atob(window.localStorage.getItem(e)||"")}function Y_(e,t){window.localStorage.setItem(e,window.btoa(t))}function sM(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),$D(t)}function lX(e){let t=function(){const n=pX.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(Xt(r,10),fa(r,i));let s=n.cid;s!==void 0&&(Xt(r,16),Xt(r,s));let a=n.cname;a!==void 0&&(Xt(r,26),fa(r,a));let d=n.deviceId;d!==void 0&&(Xt(r,34),fa(r,d));let l=n.elapse;l!==void 0&&(Xt(r,40),_a(r,l));let u=n.fileSize;u!==void 0&&(Xt(r,48),_a(r,nl(u)));let p=n.height;p!==void 0&&(Xt(r,56),_a(r,nl(p)));let _=n.jpg;_!==void 0&&(Xt(r,66),Xt(r,_.length),cM(r,_));let m=n.networkType;m!==void 0&&(Xt(r,72),_a(r,nl(m)));let E=n.osType;E!==void 0&&(Xt(r,80),_a(r,nl(E)));let C=n.requestId;C!==void 0&&(Xt(r,90),fa(r,C));let R=n.sdkVersion;R!==void 0&&(Xt(r,98),fa(r,R));let y=n.sequence;y!==void 0&&(Xt(r,104),_a(r,nl(y)));let b=n.sid;b!==void 0&&(Xt(r,114),fa(r,b));let A=n.timestamp;A!==void 0&&(Xt(r,120),_a(r,A));let D=n.uid;D!==void 0&&(Xt(r,128),Xt(r,D));let V=n.vid;V!==void 0&&(Xt(r,136),Xt(r,V));let x=n.width;x!==void 0&&(Xt(r,144),_a(r,nl(x)));let k=n.service;k!==void 0&&(Xt(r,152),Xt(r,k));let B=n.callbackData;B!==void 0&&(Xt(r,162),Xt(r,B.length),cM(r,B));let q=n.ticket;q!==void 0&&(Xt(r,170),fa(r,q));let Z=n.vendorConfigs;Z!==void 0&&(Xt(r,178),fa(r,Z))}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function uX(e){return function(n){let r={};e:for(;!fX(n);){let i=Qu(n);switch(i>>>3){case 0:break e;case 1:r.code=Qu(n);break;case 2:r.msg=dM(n,Qu(n));break;case 3:r.requestId=dM(n,Qu(n));break;case 4:r.timestamp=_X(n,!1);break;default:hX(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function hX(e,t){switch(t){case 0:for(;128&zi(e););break;case 2:yR(e,Qu(e));break;case 5:yR(e,4);break;case 1:yR(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function nl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let pX=[];function yR(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function fX(e){return e.offset>=e.limit}function q_(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let a=new Uint8Array(2*s);a.set(n),e.bytes=a}return e.offset=s,s>i&&(e.limit=s),r}function aM(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function cM(e,t){let n=q_(e,t.length);e.bytes.set(t,n)}function dM(e,t){let n=aM(e,t),r=String.fromCharCode,i=e.bytes,s="",a="";for(let d=0;d<t;d++){let l,u,p,_,m=i[d+n];128&m?(224&m)==192?d+1>=t?a+=s:(l=i[d+n+1],(192&l)!=128?a+=s:(_=(31&m)<<6|63&l,_<128?a+=s:(a+=r(_),d++))):(240&m)==224?d+2>=t?a+=s:(l=i[d+n+1],u=i[d+n+2],(49344&(l|u<<8))!=32896?a+=s:(_=(15&m)<<12|(63&l)<<6|63&u,_<2048||_>=55296&&_<=57343?a+=s:(a+=r(_),d+=2))):(248&m)==240?d+3>=t?a+=s:(l=i[d+n+1],u=i[d+n+2],p=i[d+n+3],(12632256&(l|u<<8|p<<16))!=8421504?a+=s:(_=(7&m)<<18|(63&l)<<12|(63&u)<<6|63&p,_<65536||_>1114111?a+=s:(_-=65536,a+=r(55296+(_>>10),56320+(1023&_)),d+=3))):a+=s:a+=r(m)}return a}function fa(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),r+=d<128?1:d<2048?2:d<65536?3:4}Xt(e,r);let i=q_(e,r),s=e.bytes;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),d<128?s[i++]=d:(d<2048?s[i++]=d>>6&31|192:(d<65536?s[i++]=d>>12&15|224:(s[i++]=d>>18&7|240,s[i++]=d>>12&63|128),s[i++]=d>>6&63|128),s[i++]=63&d|128)}}function zi(e){return e.bytes[aM(e,1)]}function lM(e,t){let n=q_(e,1);e.bytes[n]=t}function Qu(e){let t,n=0,r=0;do t=zi(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Xt(e,t){for(t>>>=0;t>=128;)lM(e,127&t|128),t>>>=7;lM(e,t)}function _X(e,t){let n,r=0,i=0,s=0;return n=zi(e),r=127&n,128&n&&(n=zi(e),r|=(127&n)<<7,128&n&&(n=zi(e),r|=(127&n)<<14,128&n&&(n=zi(e),r|=(127&n)<<21,128&n&&(n=zi(e),i=127&n,128&n&&(n=zi(e),i|=(127&n)<<7,128&n&&(n=zi(e),i|=(127&n)<<14,128&n&&(n=zi(e),i|=(127&n)<<21,128&n&&(n=zi(e),s=127&n,128&n&&(n=zi(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function _a(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=q_(e,s),d=e.bytes;switch(s){case 10:d[a+9]=i>>>7&1;case 9:d[a+8]=s!==9?128|i:127&i;case 8:d[a+7]=s!==8?r>>>21|128:r>>>21&127;case 7:d[a+6]=s!==7?r>>>14|128:r>>>14&127;case 6:d[a+5]=s!==6?r>>>7|128:r>>>7&127;case 5:d[a+4]=s!==5?128|r:127&r;case 4:d[a+3]=s!==4?n>>>21|128:n>>>21&127;case 3:d[a+2]=s!==3?n>>>14|128:n>>>14&127;case 2:d[a+1]=s!==2?n>>>7|128:n>>>7&127;case 1:d[a]=s!==1?128|n:127&n}}const uM={},hM={},X_=4294967296,pM=X_*X_,fM=pM/2,CR=mM(0,!0),_M=mM(0),mX=rl(0,-2147483648,!1),EX=rl(-1,2147483647,!1),gX=rl(-1,-1,!0);function mM(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=hM[e],r)?r:(n=rl(e,0,!0),i&&(hM[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=uM[e],r)?r:(n=rl(e,e<0?-1:0,!1),i&&(uM[e]=n),n)}function rl(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function EM(e,t){if(isNaN(e))return t?CR:_M;if(t){if(e<0)return CR;if(e>=pM)return gX}else{if(e<=-fM)return mX;if(e+1>=fM)return EX}return e<0?t?CR:_M:rl(e%X_|0,e/X_|0,t)}function gM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class IR extends Lt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(go.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),w(this,"name","AgoraRTCImageModeration"),w(this,"_connectionState",mi.CONNECTING),w(this,"_sequence",0),w(this,"_moderationStartTime",void 0),w(this,"_workerConnection",void 0),w(this,"_workerMessageLengthLimit",void 0),w(this,"_qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",pr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"_moderationInterval",void 0),w(this,"_moderationTimer",null),w(this,"_moderationMode",1),w(this,"_quality",1),w(this,"_qualityTimer",null),w(this,"_ticket",void 0),w(this,"_moderationIntervalMinimum",void 0),w(this,"_uploadFailedNum",0),w(this,"_uploadNum",0),w(this,"_uploadTimer",null),w(this,"_extraInfo",void 0),w(this,"_vendor",""),w(this,"_encoder",new TextEncoder),w(this,"_moderationId",void 0),w(this,"inspectImage",()=>{if(this.connectionState!==mi.CONNECTED)throw new G(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===mi.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=St(5,"image-moderation-"),this._workerMessageLengthLimit=N("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=N("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=N("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new ju("worker-"+this._moderationId,Qt),this.on(go.STATE_CHANGE,(r,i)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Kd[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(go.STATE_CHANGE,Kd.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new de((i,s)=>{this.on(go.CONNECTION_STATE_CHANGE,(a,d)=>{a===mi.CONNECTED&&i()}),this.requestAP(t,r,n).then(a=>{this.connectWorker(a)}).catch(a=>{s(a)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===mi.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=N("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,u,p,_){let{appId:m,areaCode:E,cname:C,sid:R,token:y,uid:b}=u;Qd++;const A="moderation_plugin",D={service_name:A,json_body:JSON.stringify({appId:m,areaCode:E,cname:C,command:"allocateEdge",requestId:Qd,seq:Qd,sid:R,appToken:y,ts:Date.now(),uid:b+""})};let V,x,k=l[0];return fo(async()=>{V=Date.now();const B=await So(k,{data:D,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(x=Date.now()-V,B.code!==0){const te=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+B.code,{retry:!0,responseTime:x});throw T.error(te.toString()),te}const q=JSON.parse(B.json_body);if(q.code!==200){const te=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(q.code,", reason: ").concat(q.reason),{code:q.code,responseTime:x});throw T.error(te.toString()),te}if(!q.servers||!Array.isArray(q.servers)||q.servers.length===0){const te=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:q.code,responseTime:x});throw T.error(te.toString()),te}if(!q.servers.some(te=>!!te.wss)){const te=new G(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:q.code,responseTime:x});throw T.error(te.toString()),te}const Z=N("IMAGE_MODERATION_WORKER_HOST");return{addressList:q.servers.map(te=>{let{address:Fe,wss:Ge}=te;if(Fe&&Ge)return"wss://".concat(Fe.replace(/\./g,"-"),".").concat(Z,":").concat(Ge,"/moderation")}).filter(te=>!!te),workerToken:q.workerToken,vid:q.vid,ticket:q.appTicket,responseTime:x}},(B,q)=>(Se.apworkerEvent(R,{success:!0,sc:200,serviceName:A,responseDetail:JSON.stringify(B.addressList),firstSuccess:q===0,responseTime:x,serverIp:l[q%l.length]}),!1),(B,q)=>(Se.apworkerEvent(R,{success:!1,sc:B.data&&B.data.code||200,serviceName:A,responseTime:x,serverIp:l[q%l.length]}),!!(B.code!==O.OPERATION_ABORTED&&B.code!==O.UNEXPECTED_RESPONSE||B.data&&B.data.retry)&&(k=l[(q+1)%l.length],!0)),_)}(i,t,n,r);this.emit(go.STATE_CHANGE,Kd.AP_CONNECTED);const{addressList:a,ticket:d}=s;return this._ticket=d,a}async connectWorker(t){this.emit(go.STATE_CHANGE,Kd.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ue.CONNECTED,async()=>{this.emit(go.STATE_CHANGE,Kd.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=mi.CONNECTED}),this._workerConnection.on(Ue.CLOSED,()=>{this.connectionState=mi.CLOSED}),this._workerConnection.on(Ue.FAILED,()=>{this.connectionState=mi.CLOSED}),this._workerConnection.on(Ue.RECONNECTING,()=>{this.connectionState=this.connectionState===mi.CONNECTED?mi.RECONNECTING:mi.CONNECTING}),this._workerConnection.on(Ue.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=uX(new Uint8Array(t.data));N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Se.reportApiInvoke(this._connectInfo.sid||null,{name:Wt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Dt.TRACER}).onError(new G(O.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},N("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ue.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(Ue.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Yr(this,go.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l}=n;const u=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await GP(p,r,i),m=this._sequence+"-"+s+"-"+l+"-"+u+"-"+St(12,""),E={appId:r,cid:s,cname:i,deviceId:"",elapse:IR.intToLong(Number(u-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:m,sdkVersion:"4.24.0",sequence:this._sequence,sid:d,timestamp:EM(u),uid:l,vid:a,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete E.callbackData;const C=lX(E);if(C.byteLength<this._workerMessageLengthLimit){if(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const R=function(y){for(var b=1;b<arguments.length;b++){var A=arguments[b]!=null?arguments[b]:{};b%2?gM(Object(A),!0).forEach(function(D){w(y,D,A[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(A)):gM(Object(A)).forEach(function(D){Object.defineProperty(y,D,Object.getOwnPropertyDescriptor(A,D))})}return y}({},E);delete R.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(R))}return C}{const R=this.quality*this._qualityRatio;return this.quality=R,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=mi.CLOSED,this.emit(go.STATE_CHANGE,Kd.CLOSED)}}function SM(e){if(_t(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new G(O.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new G(O.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const SX={name:"ImageModeration",create:function(e){let{config:t}=e;return SM(t),new IR(t)}};var TM,vM,RM,yM,CM,IM,wM,AM,bM,OM,NM,DM,PM,kM,LM,MM,UM,xM,VM,FM,BM,jM,GM,WM,HM,KM,zM,YM,qM,XM,JM,QM,ZM,$M,e2,t2,n2,r2,i2,o2,s2,ue;function a2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Yi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?a2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}xn.setLogger(T);let TX=(TM=Ce(),vM=Ce({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof xd))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),RM=Ce({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Ud.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),yM=Ce({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),CM=Ce({argsMap:(e,t,n)=>[t,n]}),IM=Ce({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r==null?void 0:r.uid,i]})}),wM=Ce({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),AM=Ce({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r==null?void 0:r.uid,mediaType:i}})}),bM=Ce(),OM=Ce(),NM=Ce(),DM=Ce(),PM=Ce(),kM=Ce(),LM=Ce(),MM=Ce(),UM=Ce(),xM=Ce(),VM=Ce(),FM=Ce(),BM=Ce(),jM=Ce(),GM=Ce(),WM=Ce({argsMap:(e,t)=>[t]}),HM=Ce(),KM=Ce(),zM=Ce(),YM=Ce(),qM=Ce(),XM=Ce(),JM=Ce(),QM=Ce(),ZM=Ce({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),$M=Ce(),e2=Ce(),t2=Ce(),n2=Ce(),r2=Ce(),i2=Ce(),o2=Ce({reportResult:!0}),s2=Ce(),ue=class extends Lt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),w(this,"store",void 0),w(this,"_uid",void 0),w(this,"_channelName",void 0),w(this,"_uintUid",void 0),w(this,"_users",[]),w(this,"_config",void 0),w(this,"_clientId",void 0),w(this,"_appId",void 0),w(this,"_sessionId",null),w(this,"_key",void 0),w(this,"_rtmConfig",{}),w(this,"_joinInfo",void 0),w(this,"_gateway",void 0),w(this,"_statsCollector",void 0),w(this,"_configDistribute",void 0),w(this,"_leaveMutex",void 0),w(this,"_publishMutex",void 0),w(this,"_renewTokenMutex",void 0),w(this,"_subscribeMutex",void 0),w(this,"_encryptionMode","none"),w(this,"_encryptionSecret",null),w(this,"_encryptionSalt",null),w(this,"_encryptDataStream",!1),w(this,"_encryptDataStreamKey",null),w(this,"_encryptDataStreamIv",null),w(this,"_proxyServer",void 0),w(this,"_turnServer",{servers:[],mode:"auto"}),w(this,"_cloudProxyServerMode","disabled"),w(this,"_isDualStreamEnabled",!1),w(this,"_defaultStreamFallbackType",void 0),w(this,"_lowStreamParameter",void 0),w(this,"_streamFallbackTypeCacheMap",new Map),w(this,"_remoteStreamTypeCacheMap",new Map),w(this,"_axiosCancelSource",pr.CancelToken.source()),w(this,"_audioVolumeIndicationInterval",void 0),w(this,"_networkQualityInterval",void 0),w(this,"_userOfflineTimeout",void 0),w(this,"_streamRemovedTimeout",void 0),w(this,"_liveTranscodeStreamingClient",void 0),w(this,"_liveRawStreamingClient",void 0),w(this,"_channelMediaRelayClient",void 0),w(this,"_networkQualitySensitivity","normal"),w(this,"_p2pChannel",void 0),w(this,"_useLocalAccessPoint",!1),w(this,"_setLocalAPVersion",void 0),w(this,"_joinAndNotLeaveYet",!1),w(this,"_numberOfJoinCount",0),w(this,"_joinResponse",null),w(this,"_remoteDefaultVideoStreamType",void 0),w(this,"_inspect",void 0),w(this,"_moderation",void 0),w(this,"_license",void 0),w(this,"_pendingPublishedUsers",[]),w(this,"ntpAlignErrorCount",0),w(this,"remoteInboundOffset",0),w(this,"_peerConnectionState",void 0),w(this,"_handleLocalTrackEnable",(i,s,a)=>{this.publish(i,!1).then(s).catch(a)}),w(this,"_handleLocalTrackDisable",(i,s,a)=>{this.unpublish(i).then(s).catch(a)}),w(this,"_handleUserOnline",i=>{if(N("BLOCK_LOCAL_CLIENT")&&mc(i.uid,this.channelName))return void T.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(a=>a.uid===i.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Ke.USER_JOINED,s));else{const a=new ha(i.uid,i.uint_id||i.uid);this._users.push(a),T.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(a.uid,{userJoinNotify:Date.now()}),this.safeEmit(Ke.USER_JOINED,a)}}),w(this,"_handleUserOffline",i=>{if(N("BLOCK_LOCAL_CLIENT")&&mc(i.uid,this.channelName))return;const s=this._users.find(a=>a.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:Xf(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),T.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Ke.USER_LEAVED,s,i.reason))}),w(this,"_handleAddAudioOrVideoStream",(i,s,a,d,l,u,p,_)=>{if(N("BLOCK_LOCAL_CLIENT")&&mc(s,this.channelName))return;const m=this._users.find(C=>C.uid===s);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(m.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(m.uid,{videoAddNotify:Date.now()});const E=i==="audio"?m.hasAudio:m.hasVideo;if(m._uintid||(m._uintid=u||s),i==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,i==="audio"?(m._audio_added_=!0,a!==void 0&&(m._audioSSRC=a),d!==void 0&&(m._cname=d),p&&(m._audioOrtc=p)):(m._video_added_=!0,a!==void 0&&(m._videoSSRC=a),d!==void 0&&(m._cname=d),_!==void 0&&(m._rtxSsrcId=_),p&&(m._videoOrtc=p)),(i==="audio"?m.hasAudio:m.hasVideo)&&!E&&(T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(i)),this.safeEmit(Ke.USER_PUBLISHED,m,i)),i==="video"?Se.onGatewayStream(this._sessionId,dn.ON_ADD_VIDEO_STREAM,Nt.ON_ADD_VIDEO_STREAM,{peer:u||s,ssrc:m._videoSSRC}):Se.onGatewayStream(this._sessionId,dn.ON_ADD_AUDIO_STREAM,Nt.ON_ADD_AUDIO_STREAM,{peer:u||s,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,i,a).then(C=>{if(C&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ju))return this._p2pChannel.unsubscribe(m,i,!0).then(()=>this._subscribe(m,i,!0).catch(R=>{T.error("[".concat(this._clientId,"] resubscribe error"),R.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,i)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,i,!0).catch(C=>{T.error("[".concat(this._clientId,"] resubscribe error"),C.toString())})),i==="video"&&!Nn()&&!Yn()){const C=this._getEncodingName(l);(C==null?void 0:C.toLocaleLowerCase())==ku.av1&&Kq().then(R=>{R||this._gateway.downgradeCodec(C)})}}),w(this,"_handleRemoveStream",i=>{if(N("BLOCK_LOCAL_CLIENT")&&mc(i.uid,this.channelName))return;const s=this._users.find(d=>d.uid===i.uid);if(!s)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let a=()=>{};s.hasAudio&&s.hasVideo?a=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Ke.USER_UNPUBLISHED,s,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Ke.USER_UNPUBLISHED,s,"video")}:s.hasVideo?a=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Ke.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(a=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Ke.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Ju&&this._p2pChannel.unsubscribe(s).then(d=>{if(d)return this._gateway.unsubscribe(d,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Se.onGatewayStream(this._sessionId,dn.ON_REMOVE_STREAM,Nt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),a()}),w(this,"_handleSetStreamLocalEnable",(i,s,a)=>{if(N("BLOCK_LOCAL_CLIENT")&&mc(s,this.channelName))return;const d=this._users.find(p=>p.uid===s);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(a?"enabled":"disabled"," with uid ").concat(s));const l=i==="audio"?d.hasAudio:d.hasVideo;if(i==="audio"){d._trust_audio_enabled_state_=!0;const p=d._audio_enabled_;if(d._audio_enabled_=a,d._audio_enabled_===p)return;{const _=d._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Ke.USER_INFO_UPDATED,s,_)}}else{d._trust_video_enabled_state_=!0;const p=d._video_enabled_;if(d._video_enabled_=a,d._video_enabled_===p)return;{const _=d._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Ke.USER_INFO_UPDATED,s,_)}}const u=i==="audio"?d.hasAudio:d.hasVideo;return l!==u?!l&&u?(T.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(Ke.USER_PUBLISHED,d,i)):(i==="video"&&d._videoTrack&&d._videoTrack._destroy(),i==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,i),T.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(Ke.USER_UNPUBLISHED,d,i)):void 0}),w(this,"_handleMuteStream",(i,s,a)=>{if(N("BLOCK_LOCAL_CLIENT")&&mc(i,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),i,s,a);const d=this._users.find(p=>p.uid===i);if(!d)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const l=s==="audio"?d.hasAudio:d.hasVideo;if(s==="audio"){d._trust_audio_mute_state_=!0;const p=d._audio_muted_;if(d._audio_muted_=a,d._audio_muted_===p)return;{const _=d._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(_)),this.safeEmit(Ke.USER_INFO_UPDATED,i,_)}}else{d._trust_video_mute_state_=!0;const p=d._video_muted_;if(d._video_muted_=a,d._video_muted_===p)return;{const _=d._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(_)),this.safeEmit(Ke.USER_INFO_UPDATED,i,_)}}const u=s==="audio"?d.hasAudio:d.hasVideo;if(l!==u){if(!l&&u)return(s==="audio"?d._audioSSRC:d._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(Ke.USER_PUBLISHED,d,s)):void T.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&d._videoTrack&&!d._video_pre_subscribed&&d._videoTrack._destroy(),s==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,s),T.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(Ke.USER_UNPUBLISHED,d,s)}}),w(this,"_handleP2PLost",async i=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),w(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ke.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),w(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),w(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ke.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ke.NETWORK_QUALITY,i)}),w(this,"_handleP2PAddAudioOrVideoStream",(i,s,a,d)=>{const l=this._users.find(p=>p.uid===s);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(l.uid,i,void 0,void 0,void 0,Date.now());const u=i==="audio"?l.hasAudio:l.hasVideo;i==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,i==="audio"?(l._audio_added_=!0,a!==void 0&&(l._audioSSRC=a),d!==void 0&&(l._audioMid=d)):(l._video_added_=!0,a!==void 0&&(l._videoSSRC=a),d!==void 0&&(l._videoMid=d)),(i==="audio"?l.hasAudio:l.hasVideo)&&!u&&(T.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(i)),this.safeEmit(Ke.USER_PUBLISHED,l,i)),this._p2pChannel.hasPendingRemoteMedia(l,i)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,i,!0).catch(p=>{T.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=e,this._clientId=t||St(5,"client-"),this.store=new class{constructor(i,s,a,d){De(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:a,clientId:d,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:dc.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=function(s,a){switch(a.type){case Pe.SET_SESSION_ID:return ne(ne({},s),{},{sessionId:a.sessionId});case Pe.SET_P2P_ID:return ne(ne({},s),{},{p2pId:a.p2pId});case Pe.SET_UID:return ne(ne({},s),{},{uid:a.uid});case Pe.SET_INT_UID:return ne(ne({},s),{},{intUid:a.intUid});case Pe.SET_PUB_ID:return ne(ne({},s),{},{pubId:a.pubId});case Pe.KEY_METRIC_CLIENT_CREATED:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{clientCreated:a.metric})});case Pe.KEY_METRIC_JOIN_START:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{joinStart:a.metric})});case Pe.KEY_METRIC_PRELOAD_START:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{preloadStart:a.metric})});case Pe.KEY_METRIC_PRELOAD_END:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{preloadEnd:a.metric})});case Pe.KEY_METRIC_JOIN_END:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{joinEnd:a.metric})});case Pe.KEY_METRIC_REQUEST_AP_START:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{requestAPStart:a.metric})});case Pe.KEY_METRIC_REQUEST_AP_END:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{requestAPEnd:a.metric})});case Pe.KEY_METRIC_REQUEST_SUA_END:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{requestSUAEnd:a.metric})});case Pe.KEY_METRIC_BEFORE_CONNECT:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{beforeConnect:a.metric})});case Pe.KEY_METRIC_PEER_RECEIVER:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{peerReceiver:a.metric})});case Pe.KEY_METRIC_SIGNAL_CONNECTED:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{signalConnected:a.metric})});case Pe.KEY_METRIC_JOIN_REQ:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{joinReq:a.metric})});case Pe.KEY_METRIC_JOIN_REP:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{joinRep:a.metric})});case Pe.KEY_METRIC_JOIN_GATEWAY_START:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{joinGatewayStart:a.metric})});case Pe.KEY_METRIC_JOIN_GATEWAY_END:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{joinGatewayEnd:a.metric})});case Pe.KEY_METRIC_PEER_CONNECTION_START:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{peerConnectionStart:a.metric})});case Pe.KEY_METRIC_PEER_CONNECTION_END:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{peerConnectionEnd:a.metric})});case Pe.KEY_METRIC_DESCRIPTION_START:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{descriptionStart:a.metric})});case Pe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{signalChannelOpen:a.metric})});case Pe.KEY_METRIC_ICE_CONNECTION_END:return ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{iceConnectionEnd:a.metric})});case Pe.KEY_METRIC_PUBLISH:{const d=s.keyMetrics.publish,l=d.findIndex(u=>u.trackId===a.metric.trackId);return l!==-1?(d[l]=ne(ne({},d[l]),a.metric),ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{publish:[...d]})})):ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,a.metric]})})}case Pe.KEY_METRIC_SUBSCRIBE:{const d=s.keyMetrics.subscribe,l=d.findIndex(u=>u.userId===a.metric.userId&&u.type===a.metric.type);return l!==-1?(d[l]=ne(ne({},d[l]),a.metric),ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{subscribe:[...d]})})):ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,a.metric]})})}case Pe.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const d=s.keyMetrics.firstVideoFrameDecoded,l=d.findIndex(u=>u.userId===a.metric.userId);return l!==-1?(d[l]=ne(ne({},d[l]),a.metric),ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{firstVideoFrameDecoded:[...d]})})):ne(ne({},s),{},{keyMetrics:ne(ne({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,a.metric]})})}case Pe.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case Pe.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=a.mode,s;case Pe.RECORD_JOIN_CHANNEL_SERVICE:return typeof a.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,a.record]:(s.joinChannelServiceRecords[a.index]=ne(ne({},s.joinChannelServiceRecords[a.index]),a.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case Pe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case Pe.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case Pe.SET_USE_P2P:return ne(ne({},s),{},{useP2P:a.val});case Pe.SET_TRANSPORT_TYPE:return ne(ne({},s),{},{p2pTransport:a.val});default:return s}}(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:Pe.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:Pe.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:Pe.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:Pe.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:Pe.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:Pe.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:Pe.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:Pe.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:Pe.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Pe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Pe.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Pe.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Pe.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Pe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Pe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Pe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Pe.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Pe.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Pe.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Pe.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Pe.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Pe.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Pe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Pe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Pe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Pe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:Pe.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ne({userId:i},s)})}descriptionStart(){this.dispatch({type:Pe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Pe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Pe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,a,d){this.dispatch({type:Pe.KEY_METRIC_PUBLISH,metric:ne(ne({trackId:i,type:s},a&&{publishStart:a}),d&&{publishEnd:d})})}subscribe(i,s,a,d,l,u,p){this.dispatch({type:Pe.KEY_METRIC_SUBSCRIBE,metric:ne(ne(ne(ne(ne({userId:i,type:s},a&&{subscribeStart:a}),d&&{subscribeEnd:d}),l&&{firstFrame:l}),u&&{streamAdded:u}),p&&{firstDecoded:p})})}massSubscribe(i,s,a,d){i.forEach(l=>{this.dispatch({type:Pe.KEY_METRIC_SUBSCRIBE,metric:ne(ne(ne({userId:l.userId,type:l.type},s&&{subscribeStart:s}),a&&{subscribeEnd:a}),d&&{firstFrame:d})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:Pe.RECORD_JOIN_CHANNEL_SERVICE,record:ne(ne({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Pe.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Pe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Pe.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Pe.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new xn("client-leave",this._clientId),this._publishMutex=new xn("client-publish",this._clientId),this._renewTokenMutex=new xn("client-renewtoken",this._clientId),this._subscribeMutex=new xn("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(hi," build: ").concat(dv,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{JT(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){T.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new qu(this.store),this._statsCollector.onStatsException=(i,s,a)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(a)),i===cR.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(d=>{d instanceof d_&&N("ENABLE_ENCODE_EXCEPTION")&&d.findClosestProfile()}),this.safeEmit(Ke.EXCEPTION,{code:i,msg:s,uid:a})},this._statsCollector.onUploadPublishDuration=(i,s,a,d)=>{const l=this._users.find(u=>u.uid===i);l&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(l._uintid,{peerPublishDuration:a,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(l)),Se.peerPublishStatus(this._sessionId,{subscribeElapse:d,audioPublishDuration:s,videoPublishDuration:a,peer:l._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(N("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const s=this.localTracks.find(a=>a instanceof Ct);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?N("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Fq(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Qt,httpRetryConfig:e.httpRetryConfig||Qt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Jq(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},Ss("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Ju(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],a=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ht("JOIN_GATEWAY_USE_443PORT_ONLY",s),ht("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const d=this._gateway.signal.websocket;return d instanceof Yv&&(d.use443PortOnly=s,d.tryDoubleDomain=a),async function(l,u,p){Hf.get(l)||Hf.set(l,[]),Kf.get(l)||Kf.set(l,u),Fo.get(l)||Fo.set(l,0);const _=Hf.get(l),m=Kf.get(l);if(!_||!m)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Fo.get(l)===m){const b=Cu();_.push(b),await b.promise}Fo.set(l,Fo.get(l)+1);for(var E=arguments.length,C=new Array(E>3?E-3:0),R=3;R<E;R++)C[R-3]=arguments[R];const y=await p(...C);return Fo.set(l,Fo.get(l)-1),Fo.get(l)===m-1&&_.length>0&&(_[0].resolve(),_.shift()),Fo.get(l)===0&&(Hf.set(l,[]),Kf.set(l,0),Fo.set(l,0)),y}("client.join",N("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const a=(Zf||Zf||(Zf=(window.location.protocol.split(":")[0]||"").toUpperCase(),Zf))==="HTTPS",d=nP()?window.isSecureContext:"Browser Not Support";if(!nP()&&!a||!window.isSecureContext){const y="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";T.warning(y)}let l;Se.setAppId(e);try{if(!n&&n!==null)throw new G(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Rn(n,"token",1,2047),Rn(e,"appid",1,2047),T_(t),r&&v_(r),i)if(typeof i=="string")Rn(i,"optionalInfo",1,256),l=i;else{if(typeof i!="object")throw new G(O.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:y,enableInstantMuteRestore:b}=i;y&&(po(y,"autoSubscribe"),T.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(y)),this.store.autoSubscribe=y),b&&(po(b,"enableInstantMuteRestore"),T.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(b)),this.store.enableInstantMuteRestore=b)}}}catch(y){throw Se.reportApiInvoke(cc(),{name:Wt.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:d},tag:Dt.TRACER}).onError(y),y}if(this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const y=new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Se.reportApiInvoke(cc(),{name:Wt.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:d},tag:Dt.TRACER}).onError(y),y}this._gateway.state="CONNECTING",this.store.preloadStart();const u=await tM({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const p=(u==null?void 0:u.sid)||cc();T.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);const _=Se.reportApiInvoke(p,{id:this._clientId,name:Wt.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:d},tag:Dt.TRACER}),m=Yi(Yi(Yi({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:N("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(m.stringUid=r,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async y=>{const b=function(x){const k=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),B=new Uint8Array(new ArrayBuffer(k.length));for(let q=0;q<k.length;q+=1)B[q]=k.charCodeAt(q);return B}(),A=await window.crypto.subtle.importKey("spki",b,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),D=qT(y),V=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},A,D);return function(x){let k="";for(let B=0;B<x.length;B+=1)k+=String.fromCharCode(x[B]);return window.btoa(k)}(new Uint8Array(V))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const y=new TextEncoder,b=N("USE_PURE_ENCRYPTION_MASTER_KEY")?y.encode(m.appId+this._encryptionSecret+this._encryptionSecret):y.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(A,D,V){const x=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),k=A==="aes-128-gcm2"?128:256,B=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:hP,hash:"SHA-256",salt:V},x,k+_7);return new Uint8Array(B).subarray(k/8)}(this._encryptionMode,b,ac(this._encryptionSalt)),this._encryptDataStreamKey=await async function(A,D,V){const x=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),k=A==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:hP,hash:"SHA-256",salt:V},x,{name:"AES-GCM",length:k},!0,["encrypt","decrypt"])}(this._encryptionMode,b,ac(this._encryptionSalt))}else d?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:m.stringUid});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&Se.joinChannelTimeout(this._sessionId,5)},5e3);try{var C;let y;const b=m.cloudProxyServer;if(oe(C=["proxy3","proxy4","proxy5"]).call(C,b)){const k=N("PROXY_SERVER_TYPE3");Array.isArray(k)?m.proxyServer=k[0]:m.proxyServer=k}if(Se.setProxyServer(m.proxyServer),T.setProxyServer(m.proxyServer),this.store.requestAPStart(),u){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(u.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=u.intUid),y={gatewayInfo:u.ap.gatewayInfo},N("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const k=(await Q1(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(B=>({turnServerURL:B.address,tcpport:B.tcpport||kn.tcpport,udpport:B.udpport||kn.udpport,username:B.username||kn.username,password:B.password||kn.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:k}}iM(u,m.stringUid)}else{if(m.stringUid&&!m.uid){let k;[k,y]=await de.all([IL(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||Qt,this.store).finally(()=>{this.store.requestSUAEnd()}),CL(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Qt,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(k)),m.uid=k,y.gatewayInfo.uid=k,y.gatewayInfo.res.uid=k}else y=await CL(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Qt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(Fu.UPDATE_BITRATE_LIMIT,k=>{this._p2pChannel.updateBitrateLimit(k)}),this._configDistribute.on(Fu.UPDATE_CLIENT_ROLE_OPTIONS,k=>{this._setClientRoleOptions(k)})},0),this._key=n||e;const A=y.gatewayInfo,D=m.uid?m.uid:A.uid;this._joinInfo=Yi(Yi({},m),{},{cid:A.cid,uid:D,vid:A.vid,apResponse:A.res,apGatewayAddress:A.apGatewayAddress,uni_lbs_ip:A.uni_lbs_ip,gatewayAddrs:A.gatewayAddrs}),this.store.intUid=D,this.store.cid=A.cid;const V=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_.onSuccess(V),this._appId=e,this._channelName=m.cname,this._uid=V,this.store.uid=V,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Nn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const x=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(x)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),R=this,oe(_c).call(_c,R)||_c.push(R),this._cloudProxyServerMode==="disabled"&&Ze().supportWebCrypto&&N("ENABLE_PRELOAD")&&RR(this._joinInfo),V}catch(y){const b=Array.isArray(y)?y[0]:y;throw b&&b.code===O.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),b):T.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),b),b.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),_.onError(b),b}var R}_joinGateway(){if(!this._joinInfo||!this._key)throw new G(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!N("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Nn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=_c.indexOf(t);n!==-1&&_c.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",ot.LEAVE),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof xd))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new G(O.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new G(O.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof xd))throw new G(O.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new G(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof Ct&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw T.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new G(O.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));_t(e.id,"id",0,65535,!0),po(e.ordered,"ordered"),Rn(e.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new G(O.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new G(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return _L(i,!1)}(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new G(O.CREATE_DATACHANNEL_ERROR);try{await de.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==O.DISCONNECT_P2P)throw i}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof xd))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Kt.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw T.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof ha)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new G(O.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(cn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new G(O.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===he.AUDIO,r=t===he.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:a,rtxSsrcId:d,cname:l,uint_id:u}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new G(O.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(m=>m.uid===e);p||(p=new ha(e,u||e),p._is_pre_created=!0,this._users.push(p)),l&&(p._cname=l),p._uintid||(p._uintid=u||e),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,a&&(p._audioOrtc=a)),r&&(p._videoSSRC=s,p._video_pre_subscribed=!0,a&&(p._videoOrtc=a),d!=null&&(p._rtxSsrcId=d)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,t,s,d,a);const _=n?p._audioTrack:p._videoTrack;if(!_)throw new G(O.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),r&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),_}catch(s){throw T.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var n;if(_t(t,"channelId",0,65535,!0),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new G(O.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new G(O.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(d=>d.id===t);if(!i)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new G(O.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const d=await this._p2pChannel.subscribeDataChannel(e,[i]);if(d&&oe(d).call(d,i.id))try{var a;if(typeof i._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new G(O.CREATE_DATACHANNEL_ERROR);const l={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(a=i.metadata)!==null&&a!==void 0?a:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await i._waitTillOpen()}catch(l){if((l==null?void 0:l.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),l;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(cn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){const s=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new G(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const a=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,a,d)}catch(a){throw a}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(a=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),a)});const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new G(O.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(cn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new G(O.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const u=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),u}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?he.AUDIO:he.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const l=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const p=t==="audio"?e._audioSSRC:e._videoSSRC;p!==void 0&&p!==i&&(i=p,s=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?he.AUDIO:he.VIDEO,ssrcId:i}),jn.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,d,!0)}catch(_){if((_==null?void 0:_.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),_;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,e,t),p}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const u=t==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new G(O.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),u}catch(u){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{l()}}async massSubscribe(e){if(ms(e,"subscribeList"),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(d=>{let{user:l,mediaType:u}=d;return"user: ".concat(l==null?void 0:l.uid,", mediaType: ").concat(u)}).join("; ")));const i=(e=[...e]).map(d=>{let{user:l,mediaType:u}=d;return{user:l,mediaType:u}}),s=await this._p2pChannel.globalLock();try{var a;for(let l=e.length-1;l>=0;l--){const u=e[l],{user:p,mediaType:_}=u;if(cn(_,"mediaType",["audio","video"]),!p){const R=new G(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),R}if(!this._users.find(R=>R===p)){const R=new G(O.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),i[l].error=R,e.splice(l,1);continue}if(_==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||_==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const R=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(_,", remote user is not published")),i[l].error=R,e.splice(l,1);continue}const E=pn.Video|pn.LwoVideo,C=n.get(p);if(C){if(_==="video"?C&E:C&pn.Audio){e.splice(l,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(_," twice"));continue}n.set(p,C|(_==="video"?E:pn.Audio))}else n.set(p,_==="video"?E:pn.Audio)}for(let l=e.length-1;l>=0;l--){const u=e[l],{user:p,mediaType:_}=u,m=pn.Video|pn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,_)){await this._p2pChannel.unmuteRemoteNoLock(p,_);const E=n.get(p);n.set(p,_==="video"?E^m:E^pn.Audio),e.splice(l,1)}}this.store.massSubscribe(e.map(l=>({userId:l.user.uid,type:l.mediaType})),t);let d=Di(a=Array.from(n.entries())).call(a,(l,u)=>{let[p,_]=u;if(_===0)return l;const m={stream_id:p.uid,stream_type:_};return _&pn.Audio&&(m.audio_ssrc=p._audioSSRC),_&pn.Video&&(m.video_ssrc=p._videoSSRC),l.push(m),l},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(u=>{let{user:p,mediaType:_}=u;return{user:p,mediaType:_,ssrcId:_===he.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:_===he.VIDEO?p._rtxSsrcId:void 0}}));const l=new Map;if(d=d.filter(u=>u.video_ssrc&&!this._p2pChannel.isPreSubScribe(u.video_ssrc)||u.audio_ssrc&&!this._p2pChannel.isPreSubScribe(u.audio_ssrc)||!u.video_ssrc&&!u.audio_ssrc),d.length>0){const u=await this._gateway.subscribeAll(d,!0);((u==null?void 0:u.users)||[]).forEach(p=>{let{stream_id:_,video_error_code:m,audio_error_code:E,error_code:C}=p;(m||E||C)&&l.set(_,{video_error_code:m,audio_error_code:E,error_code:C})})}if(Array.from(l.entries()).length>0){const u=[];Array.from(l.entries()).forEach(p=>{let[_,m]=p;const E=this.remoteUsers.find(C=>C.uid===_);if(E){let C;m.error_code||m.video_error_code&&m.audio_error_code?C=void 0:m.video_error_code?C=he.VIDEO:m.audio_error_code&&(C=he.AUDIO),u.push({user:E,mediaType:C})}}),u.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u)}for(const u of i){const p=l.get(u.user.uid);if(p){const _=p.error_code||u.mediaType==="audio"&&p.audio_error_code||u.mediaType==="video"&&p.video_error_code;if(_){const m=Bu(_);T.error("user:".concat(u.user.uid," mediaType:").concat(u.mediaType," has massSubscribe error ").concat(m.desc)),u.error=new G(O.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(m.desc))}}u.error||(u.mediaType==="video"?u.track=u.user.videoTrack:u.track=u.user.audioTrack)}return this.store.massSubscribe(i.filter(u=>!u.error).map(u=>({userId:u.user.uid,type:u.mediaType})),void 0,Date.now()),i.forEach(u=>{var p;Se.subscribe(this.store.sessionId,{succ:!!u.error,ec:((p=u.error)===null||p===void 0?void 0:p.code)||null,video:u.mediaType===he.VIDEO,audio:u.mediaType===he.AUDIO,peerid:u.user.uid,subscribeRequestid:u.mediaType===he.VIDEO?u.user._videoSSRC:u.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(u.user._videoSSRC)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(u=>{let{user:p,mediaType:_}=u;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_)}).join("; "))),i}catch(l){throw await this._p2pChannel.massUnsubscribeNoLock(e),l}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof ha)){const s=this.remoteUsers.find(a=>a.uid===e);if(!s)throw new G(O.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&cn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Xf(this._users,e),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&_t(t,"id",0,65535,!0),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new G(O.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(s=>s.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new G(O.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===O.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(ms(e,"unsubscribeList"),!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const d=new G(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(cn(i,"mediaType",["video","audio",void 0]),!this._users.find(d=>d===r)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const a=pn.Video|pn.LwoVideo;if(t.has(r)){const d=t.get(r);let l;switch(i){case"video":l=d&a;break;case"audio":l=d&pn.Audio;break;default:l=d&(pn.Audio|a)}if(l){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,d|pn.Audio):i==="video"&&t.set(r,d|a):t.set(r,d|pn.Audio|a)}else i?i==="audio"?t.set(r,pn.Audio):i==="video"&&t.set(r,a):t.set(r,pn.Audio|a)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===O.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new Y(O.INVALID_PARAMS);xt(n.width)||zT(n.width,"streamParameter.width"),xt(n.height)||zT(n.height,"streamParameter.height"),xt(n.framerate)||zT(n.framerate,"streamParameter.framerate"),xt(n.bitrate)||_t(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ee.LocalVideoLowTrack)}async enableDualStream(){if(!Ze().supportDualStream)throw Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new G(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new G(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ee.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Se.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){cn(r,"role",["audience","host"])}(e),t&&JT(t),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new G(O.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new G(O.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new G(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&N("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Dn.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),T.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&JT(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{T.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Rn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Se.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(O.INVALID_OPERATION,"You have already set the proxy")}if(bu(e))return this._turnServer={servers:e,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>HD(n)),this._turnServer={servers:e,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"you should set license before join channel");if(Rn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new G(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,T.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new G(O.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new G(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new G(O.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new G(O.INVALID_OPERATION,"Stop proxy server after leave channel");Se.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new G(O.INVALID_PARAMS,"accessPoints is required.");ms(e.accessPoints.serverList,"accessPoints.serverList"),Rn(e.accessPoints.domain,"accessPoints.domain");const t=(m,E)=>{_t(m,E,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");N("CLOSE_AFB_FOR_LOCAL_AP")&&(ht("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ht("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map(m=>r.test(m)?"".concat(m.replace(/\./g,"-"),".").concat(i):m),a=s.map(m=>"".concat(m,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ht("WEBCS_DOMAIN",a),ht("WEBCS_DOMAIN_BACKUP_LIST",a),ht("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ms(e.report.hostname,"report.hostname"),ht("EVENT_REPORT_DOMAIN",e.report.hostname[0]),ht("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(ht("EVENT_REPORT_DOMAIN",s[0]),ht("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let d=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),d=e.report.port),ht("STATS_COLLECTOR_PORT",d),e.report?ht("ENABLE_EVENT_REPORT",!0):ht("ENABLE_EVENT_REPORT",!1);let l="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ms(e.log.hostname,"log.hostname"),l=e.log.hostname[0]):l=s[0];let u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),ht("LOG_UPLOAD_SERVER","".concat(l,":").concat(u));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ms(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=s;let _=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),_=e.cds.port),ht("CDS_AP",p.map(m=>"".concat(m,":").concat(_))),e.cds?ht("ENABLE_CONFIG_DISTRIBUTE",!0):ht("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ms(e,"serverList"),Rn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ht("WEBCS_DOMAIN",e),ht("WEBCS_DOMAIN_BACKUP_LIST",e),ht("GATEWAY_DOMAINS",[t]),ht("EVENT_REPORT_DOMAIN",e[0]),ht("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),ht("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(cn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){cn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){cn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(s){cn(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Rn(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(oe(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new G(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new G(O.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(po(r,"encryptDataStream"),!oe(i).call(i,e))throw new G(O.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=ta(n))}async renewToken(e){if(Rn(e,"token",1,2047),!this._key||!this._joinInfo)throw new G(O.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(N("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await Xq(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Qt);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,T.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Ke.VOLUME_INDICATOR,e)},N("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new G(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new G(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new G(O.LIVE_STREAMING_TASK_CONFLICT);const n=t?Ko.TRANSCODE:Ko.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Ko.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new G(O.INVALID_PARAMS,"can not find live streaming url to stop");await de.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){DL(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){DL(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Ju&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&oe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,s,a){var d;const l=Di(d=Array.from(a)).call(d,(R,y)=>R+y,0),u={serverTs:0,seq:m7++,length:a.length,checkSum:l},p=new Uint8Array(ZD(l,2)),_=new ArrayBuffer(Dd),m=new DataView(_);m.setUint32(0,u.serverTs),m.setUint16(4,u.seq),m.setUint16(6,u.length),m.setUint16(8,u.checkSum);const E=16-a.length%16;a=YD(a,new Uint8Array(E));const C=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:uP,additionalData:p},s,a);return YD(new Uint8Array(_),new Uint8Array(C))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new G(O.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ae.DATA_STREAM,{payload:ta(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-rX},!n)}sendMetadata(e){if(!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new G(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ae.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ta(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(I7),!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not send custom report, not joined");await Se.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(N("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{oe(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){cn(t.spatialLayer,"spatialLayer",[0,1,2,3]),cn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(po(t,"apRTM"),_t(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Wd.indexOf(e);t!==-1&&Wd.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=pr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&rM(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Se.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new xn("client-publish",this._clientId),this._subscribeMutex=new xn("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||cc();e?T.debug("[".concat(this._clientId,"] new Session ").concat(r)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,Se.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};Se.sessionInit(this._sessionId,Yi({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new G(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Kt.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof Ct&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(s=>{T.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new G(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new G(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Ss("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{Se.reportApiInvoke(this._sessionId,{name:Wt.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Dt.TRACER}).onSuccess(),this.safeEmit(Ke.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{Se.reportApiInvoke(this._sessionId,{name:Wt.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Dt.TRACER}).onSuccess(),this.safeEmit(Ke.LIVE_STREAMING_WARNING,i,s)},n.on(Hv.REQUEST_WORKER_MANAGER_LIST,(i,s,a)=>{if(!this._joinInfo)return a(new G(O.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(d,l,u,p){const _=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(m=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(m+"/api/v1?action=uap"):"https://".concat(m,"/api/v1?action=uap"));return await Gq(_,d,l,u,p)})(i,this._joinInfo,this._axiosCancelSource.token,Qt).then(s).catch(a)}),n};return e===Ko.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new G(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Ss("ChannelMediaRelay").create(e));r.on("state",i=>{i===Ir.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Ke.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Ke.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var a;i==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const s=[];this._users.forEach(a=>{a._dataChannels.forEach(d=>{n.every(l=>l.uid!==a._uintid||l.stream_id!==d.id)&&s.push({uid:a._uintid,stream_id:d.id,ordered:d.ordered,max_retrans_times:d.maxRetransmits,metadata:d.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:a,stream_id:d,ordered:l,max_retrans_times:u,metadata:p}=s,_=this._users.find(m=>m._uintid===a);if(!_)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(a)),oe(i).call(i,_)||i.push(_),_._uintid||(_._uintid=a),_._dataChannels.findIndex(m=>m.id===s.stream_id)===-1){const m={id:d,ordered:!!l,maxRetransmits:u,metadata:p},E=function(C){return _L(C,!0)}(m);_._dataChannels.push(E),T.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),t||this.safeEmit(Ke.USER_PUBLISHED,_,"datachannel",m)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch(m=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),m.toString())}))}),t&&(this.safeEmit(Ke.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:a,stream_id:d}=s,l=this._users.find(p=>p._uintid===a);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const u=l._dataChannels.find(p=>p.id===s.stream_id);u&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(a)),this._p2pChannel.unsubscribeDataChannel(l,[u]).then(p=>{if(l._dataChannels=l._dataChannels.filter(_=>_!==u),p)return this._gateway.unsubscribeDataChannel(p,l.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished datachannel ,id:").concat(u.id)),this.safeEmit(Ke.USER_UNPUBLISHED,l,"datachannel",u._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return i==null||(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Ke.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(mn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{const{value:i,type:s,expires:a}=t[r];a&&a<=n||s||xv()||!Object.prototype.hasOwnProperty.call(t_,r)||(_o[r]=i,Ot[r]=i,T.debug("Update gateway parameters from config distribute",r,i))})}catch(t){T.error("Error update config from local cache",t.message)}})()}),this._gateway.on(mn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(mn.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===ot.FALLBACK)return;const i=()=>{this.safeEmit(Ke.CONNECTION_STATE_CHANGE,e,t,n)};if(Se.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Wt.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Dt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(a=>{a._trust_in_room_=!1,a._trust_audio_enabled_state_=!1,a._trust_video_enabled_state_=!1,a._trust_audio_mute_state_=!1,a._trust_video_mute_state_=!1,a._trust_audio_stream_added_state_=!1,a._trust_video_stream_added_state_=!1,a._is_pre_created||(a._audio_pre_subscribed||(a._audioSSRC=void 0,a._audioOrtc=void 0),a._video_pre_subscribed||(a._videoSSRC=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),a._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((a,d)=>{this._gateway.setStreamFallbackOption(d,a).catch(l=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),l)})}),this._remoteStreamTypeCacheMap.forEach((a,d)=>{this._gateway.setRemoteVideoStreamType(d,a).catch(l=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),l)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(a=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(a))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(a=>!a._trust_in_room_).forEach(a=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(a.uid)),this._handleUserOffline({uid:a.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(a=>{a._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,he.AUDIO,!1)),a._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,he.VIDEO,!1)),a._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(a.uid)),this._handleSetStreamLocalEnable("audio",a.uid,!0)),a._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(a.uid)),this._handleSetStreamLocalEnable("video",a.uid,!0)),a._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(a.uid)),this._handleResetAddStream(a,"video")),a._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(a.uid)),this._handleResetAddStream(a,"audio")),a._video_added_||a._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(a.uid)),this._handleRemoveStream({uid:a.uid,uint_id:a._uintid}))}))},1e3))}i()}),this._gateway.on(mn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new G(O.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await tM(Yi(Yi({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,iM(r),this._joinInfo.preload=!0):(n=await sR(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Qt,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:a}=s;const[d,l]=a.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:d,port:l}):i.push({host:d,port:l})}),e(i)}catch(n){t(n)}}),this._gateway.on(mn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ke.NETWORK_QUALITY,e)}),this._gateway.on(mn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Ke.STREAM_TYPE_CHANGED,e,t),Se.reportApiInvoke(this._sessionId,{name:Wt.STREAM_TYPE_CHANGE,options:[e,t],tag:Dt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(mn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(mn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}}),this._gateway.on(mn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const r=rL(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(mn.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:a}=this._joinInfo.apResponse,d="".concat(a,"_").concat(s);if(d.length<4||d.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(s),icePwd:"".concat(a,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=N("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(l){l.code&&l.code===O.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ze.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ze.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ze.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(ze.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(ze.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(ze.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ze.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ze.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ze.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,he.AUDIO,!0)),this._gateway.signal.on(ze.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,he.AUDIO,!1)),this._gateway.signal.on(ze.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,he.VIDEO,!0)),this._gateway.signal.on(ze.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,he.VIDEO,!1)),this._gateway.signal.on(ze.RECEIVE_METADATA,e=>{const t=ac(e.metadata);this.safeEmit(Ke.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(ze.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=ac(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&oe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Dd)throw new G(O.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Dd));n=await async function(s,a,d){const l=d.subarray(0,Dd),u=l.slice(8,Dd),p=(u[0]<<8)+u[1],_=(l[6]<<8)+l[7],m=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:uP,additionalData:new Uint8Array(ZD(p,2))},a,d.subarray(Dd));return new Uint8Array(m).subarray(0,_)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(d=>d.uid===e.uid),a=i==null?void 0:i.audioRecv.find(d=>d.ssrc===(s==null?void 0:s._audioSSRC));r=a==null?void 0:a.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),oX(Yi(Yi({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ze.ON_CRYPT_ERROR,()=>{ea(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ke.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ze.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,ot.TOKEN_EXPIRE),this.safeEmit(Ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ze.ON_STREAM_FALLBACK_UPDATE,e=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Ke.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ze.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(ze.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(ze.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ne.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ae.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const s=i.some(l=>{let{stream_type:u}=l;return u===at.Audio}),a=i.some(l=>{let{stream_type:u}=l;return u!==at.Audio}),d=i.some(l=>{let{stream_type:u}=l;return u===at.Screen||u===at.ScreenLow});t.state==="offer"&&Se.publish(this._joinInfo.sid,{eventElapse:jn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:s,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:d,audioName:s?(n=i.find(l=>{let{stream_type:u}=l;return u===at.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:a?(r=i.find(l=>{let{stream_type:u}=l;return u!==at.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Ae.SUBSCRIBE:t&&Se.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:t.stream_type===he.AUDIO,video:t.stream_type===he.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:jn.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(ze.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(ze.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;N("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!mc(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let i=this._users.find(p=>p._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new ha(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Ke.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Ke.USER_JOINED,i)));const s=pn.Audio&r.stream_type,a=(pn.Video|pn.LwoVideo)&r.stream_type,d=(65280&r.stream_type)!=0,l=s&&i.hasAudio,u=a&&i.hasVideo;a&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!l&&this.getListeners(Ke.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Ke.USER_PUBLISHED,i,"audio")),a&&!u&&this.getListeners(Ke.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Ke.USER_PUBLISHED,i,"video")),(s&&!l||a&&!u||d)&&t.push(i),a&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Ke.PUBLISHED_USER_LIST).length>0?N("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Ke.PUBLISHED_USER_LIST,t)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(ze.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Ju&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return oe(r=Object.keys(ku)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(ze.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Kt.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(i=>{const{kind:s,ssrcs:a,mid:d,isMuted:l}=i;this._handleP2PAddAudioOrVideoStream(s,r,a[0].ssrcId,d);const u=this._users.find(p=>p.uid===r);return u&&this.store.useP2P?this._p2pChannel.mockSubscribe(u,s,a[0].ssrcId,d).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,s,!!l)})}),this._gateway.signal.on(Kt.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}}),this._gateway.signal.on(Ne.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Kt.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find(a=>a.uid===i);if(!s)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async a=>{let{stream_type:d}=a;const l=d===at.Audio?he.AUDIO:he.VIDEO;await this._p2pChannel.unsubscribe(s,l),this._handleMuteStream(i,l,!0)}),t()}catch(a){n(a)}}}),this._gateway.signal.on(Kt.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case oa.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,he.VIDEO,!0);break;case oa.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,he.AUDIO,!0);break;case oa.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,he.VIDEO,!1);break;case oa.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,he.AUDIO,!1)}}),this._gateway.signal.on(Kt.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==sr.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Kt.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Te.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Kt.RESTART_ICE,e,r===sr.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(Te.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Kt.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Te.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Kt.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(Te.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Te.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Te.StateChange,(e,t)=>{t===st.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Te.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Ke.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Te.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Te.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===O.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Te.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Te.RequestRePublishDataChannel,(e,t,n)=>{de.all(e.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}})).then(t).catch(n)}),this._p2pChannel.on(Te.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===he.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(Te.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Te.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Te.MediaReconnectStart,e=>{this.safeEmit(Ke.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Te.MediaReconnectEnd,e=>{this.safeEmit(Ke.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Te.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Te.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(a){return void t.throw(a)}const{iceParameters:s}=function(a){const d=a.iceParameters;return{iceParameters:{iceUfrag:d.iceUfrag,icePwd:d.icePwd}}}(i);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(Te.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Te.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),a=rL(i,s);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Te.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Te.P2PLost,()=>{this.safeEmit(Ke.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Te.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Te.ConnectionTypeChange,e=>{this.safeEmit(Ke.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Te.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Te.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Te.AudioMetadata,e=>{this.safeEmit(Ke.AUDIO_METADATA,e)}),this._p2pChannel.on(Te.AudioPts,e=>{this.safeEmit(Ke.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Ss("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:a,uid:d,cid:l,vid:u}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:a,uid:d,cid:l,vid:u?Number(u):0},Qt)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(En.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ke.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Wi.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ke.CONTENT_INSPECT_ERROR,new G(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(En.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Ke.CONTENT_INSPECT_RESULT,t,n)}),e.on(En.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(po(e,"enabled"),e){if(!t)throw new G(O.INVALID_PARAMS,"config is required");if(SM(t),!this._joinInfo)throw new G(O.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},Ss("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:a,token:d,uid:l,cid:u,vid:p}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:a,token:d,uid:l,cid:u,vid:p?Number(p):0},Qt)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new G(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(go.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ke.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===mi.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new G(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(go.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){cn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new G(O.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){po(e,"enabled"),ht("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},me(ue.prototype,"leave",[TM],Object.getOwnPropertyDescriptor(ue.prototype,"leave"),ue.prototype),me(ue.prototype,"publish",[vM],Object.getOwnPropertyDescriptor(ue.prototype,"publish"),ue.prototype),me(ue.prototype,"unpublish",[RM],Object.getOwnPropertyDescriptor(ue.prototype,"unpublish"),ue.prototype),me(ue.prototype,"subscribe",[yM],Object.getOwnPropertyDescriptor(ue.prototype,"subscribe"),ue.prototype),me(ue.prototype,"presubscribe",[CM],Object.getOwnPropertyDescriptor(ue.prototype,"presubscribe"),ue.prototype),me(ue.prototype,"massSubscribe",[IM],Object.getOwnPropertyDescriptor(ue.prototype,"massSubscribe"),ue.prototype),me(ue.prototype,"unsubscribe",[wM],Object.getOwnPropertyDescriptor(ue.prototype,"unsubscribe"),ue.prototype),me(ue.prototype,"massUnsubscribe",[AM],Object.getOwnPropertyDescriptor(ue.prototype,"massUnsubscribe"),ue.prototype),me(ue.prototype,"setLowStreamParameter",[bM],Object.getOwnPropertyDescriptor(ue.prototype,"setLowStreamParameter"),ue.prototype),me(ue.prototype,"enableDualStream",[OM],Object.getOwnPropertyDescriptor(ue.prototype,"enableDualStream"),ue.prototype),me(ue.prototype,"disableDualStream",[NM],Object.getOwnPropertyDescriptor(ue.prototype,"disableDualStream"),ue.prototype),me(ue.prototype,"setClientRole",[DM],Object.getOwnPropertyDescriptor(ue.prototype,"setClientRole"),ue.prototype),me(ue.prototype,"_setClientRoleOptions",[PM],Object.getOwnPropertyDescriptor(ue.prototype,"_setClientRoleOptions"),ue.prototype),me(ue.prototype,"setProxyServer",[kM],Object.getOwnPropertyDescriptor(ue.prototype,"setProxyServer"),ue.prototype),me(ue.prototype,"setTurnServer",[LM],Object.getOwnPropertyDescriptor(ue.prototype,"setTurnServer"),ue.prototype),me(ue.prototype,"setLicense",[MM],Object.getOwnPropertyDescriptor(ue.prototype,"setLicense"),ue.prototype),me(ue.prototype,"startProxyServer",[UM],Object.getOwnPropertyDescriptor(ue.prototype,"startProxyServer"),ue.prototype),me(ue.prototype,"stopProxyServer",[xM],Object.getOwnPropertyDescriptor(ue.prototype,"stopProxyServer"),ue.prototype),me(ue.prototype,"setLocalAccessPointsV2",[VM],Object.getOwnPropertyDescriptor(ue.prototype,"setLocalAccessPointsV2"),ue.prototype),me(ue.prototype,"setLocalAccessPoints",[FM],Object.getOwnPropertyDescriptor(ue.prototype,"setLocalAccessPoints"),ue.prototype),me(ue.prototype,"setRemoteDefaultVideoStreamType",[BM],Object.getOwnPropertyDescriptor(ue.prototype,"setRemoteDefaultVideoStreamType"),ue.prototype),me(ue.prototype,"setRemoteVideoStreamType",[jM],Object.getOwnPropertyDescriptor(ue.prototype,"setRemoteVideoStreamType"),ue.prototype),me(ue.prototype,"setStreamFallbackOption",[GM],Object.getOwnPropertyDescriptor(ue.prototype,"setStreamFallbackOption"),ue.prototype),me(ue.prototype,"setEncryptionConfig",[WM],Object.getOwnPropertyDescriptor(ue.prototype,"setEncryptionConfig"),ue.prototype),me(ue.prototype,"renewToken",[HM],Object.getOwnPropertyDescriptor(ue.prototype,"renewToken"),ue.prototype),me(ue.prototype,"enableAudioVolumeIndicator",[KM],Object.getOwnPropertyDescriptor(ue.prototype,"enableAudioVolumeIndicator"),ue.prototype),me(ue.prototype,"startLiveStreaming",[zM],Object.getOwnPropertyDescriptor(ue.prototype,"startLiveStreaming"),ue.prototype),me(ue.prototype,"setLiveTranscoding",[YM],Object.getOwnPropertyDescriptor(ue.prototype,"setLiveTranscoding"),ue.prototype),me(ue.prototype,"stopLiveStreaming",[qM],Object.getOwnPropertyDescriptor(ue.prototype,"stopLiveStreaming"),ue.prototype),me(ue.prototype,"startChannelMediaRelay",[XM],Object.getOwnPropertyDescriptor(ue.prototype,"startChannelMediaRelay"),ue.prototype),me(ue.prototype,"updateChannelMediaRelay",[JM],Object.getOwnPropertyDescriptor(ue.prototype,"updateChannelMediaRelay"),ue.prototype),me(ue.prototype,"stopChannelMediaRelay",[QM],Object.getOwnPropertyDescriptor(ue.prototype,"stopChannelMediaRelay"),ue.prototype),me(ue.prototype,"sendCustomReportMessage",[ZM],Object.getOwnPropertyDescriptor(ue.prototype,"sendCustomReportMessage"),ue.prototype),me(ue.prototype,"pickSVCLayer",[$M],Object.getOwnPropertyDescriptor(ue.prototype,"pickSVCLayer"),ue.prototype),me(ue.prototype,"setRTMConfig",[e2],Object.getOwnPropertyDescriptor(ue.prototype,"setRTMConfig"),ue.prototype),me(ue.prototype,"enableContentInspect",[t2],Object.getOwnPropertyDescriptor(ue.prototype,"enableContentInspect"),ue.prototype),me(ue.prototype,"disableContentInspect",[n2],Object.getOwnPropertyDescriptor(ue.prototype,"disableContentInspect"),ue.prototype),me(ue.prototype,"setImageModeration",[r2],Object.getOwnPropertyDescriptor(ue.prototype,"setImageModeration"),ue.prototype),me(ue.prototype,"setP2PTransport",[i2],Object.getOwnPropertyDescriptor(ue.prototype,"setP2PTransport"),ue.prototype),me(ue.prototype,"getJoinChannelServiceRecords",[o2],Object.getOwnPropertyDescriptor(ue.prototype,"getJoinChannelServiceRecords"),ue.prototype),me(ue.prototype,"setPublishAudioFilterEnabled",[s2],Object.getOwnPropertyDescriptor(ue.prototype,"setPublishAudioFilterEnabled"),ue.prototype),ue);class Zu{constructor(t,n){w(this,"id",0),w(this,"element",void 0),w(this,"peerPair",void 0),w(this,"context",void 0),w(this,"audioPlayerElement",void 0),w(this,"audioTrack",void 0),Zu.count+=1,this.id=Zu.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new de(a=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&a(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new G(O.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new G(O.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new G(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var c2,J_;w(Zu,"count",0);const vX=window.AudioContext||window.webkitAudioContext,RX=new(c2=Ce({report:Se}),me((J_=class{constructor(){w(this,"units",[]),w(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new vX);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Zu(e,this.context),this.units.push(t)),t.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qe().name!==tt.SAFARI}}).prototype,"processExternalMediaAEC",[c2],Object.getOwnPropertyDescriptor(J_.prototype,"processExternalMediaAEC"),J_.prototype),J_);function d2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function l2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d2(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const wR=window||document;function u2(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!wR)return;const n=Zt._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(Zt.onSecurityPolicyViolation||Zt.getListeners(zo.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;N("CSP_DETECTED_HOSTNAME_LIST").some(a=>oe(s).call(s,a))&&(Zt.onSecurityPolicyViolation&&typeof Zt.onSecurityPolicyViolation=="function"&&Zt.onSecurityPolicyViolation(i),Zt.getListeners(zo.SECURITY_POLICY_VIOLATION).length>0&&Zt.safeEmit(zo.SECURITY_POLICY_VIOLATION,i))};n&&wR.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Zt.getListeners(zo.SECURITY_POLICY_VIOLATION).length>0)&&wR.addEventListener("securitypolicyviolation",r),Zt._cspEventHandlerPointer=r}var yX=J,CX=zN,h2=RegExp.prototype,IX=function(e){return e===h2||yX(h2,e)?CX(e):e.flags},er=g(IX);function il(e){let t=e.length;for(;--t>=0;)e[t]=0}const AR=256,p2=286,$u=30,eh=15,bR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Q_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),wX=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),f2=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vs=new Array(576);il(vs);const th=new Array(60);il(th);const nh=new Array(512);il(nh);const rh=new Array(256);il(rh);const OR=new Array(29);il(OR);const Z_=new Array($u);function NR(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let _2,m2,E2;function DR(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}il(Z_);const g2=e=>e<256?nh[e]:nh[256+(e>>>7)],ih=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ri=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,ih(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Xo=(e,t,n)=>{ri(e,n[2*t],n[2*t+1])},S2=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},T2=(e,t,n)=>{const r=new Array(16);let i,s,a=0;for(i=1;i<=eh;i++)a=a+n[i-1]<<1,r[i]=a;for(s=0;s<=t;s++){let d=e[2*s+1];d!==0&&(e[2*s]=S2(r[d]++,d))}},v2=e=>{let t;for(t=0;t<p2;t++)e.dyn_ltree[2*t]=0;for(t=0;t<$u;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},R2=e=>{e.bi_valid>8?ih(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},y2=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},PR=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&y2(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!y2(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},C2=(e,t,n)=>{let r,i,s,a,d=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+d++],r+=(255&e.pending_buf[e.sym_buf+d++])<<8,i=e.pending_buf[e.sym_buf+d++],r===0?Xo(e,i,t):(s=rh[i],Xo(e,s+AR+1,t),a=bR[s],a!==0&&(i-=OR[s],ri(e,i,a)),r--,s=g2(r),Xo(e,s,n),a=Q_[s],a!==0&&(r-=Z_[s],ri(e,r,a)));while(d<e.sym_next);Xo(e,256,t)},kR=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let a,d,l,u=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<s;a++)n[2*a]!==0?(e.heap[++e.heap_len]=u=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=u<2?++u:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=u,a=e.heap_len>>1;a>=1;a--)PR(e,n,a);l=s;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],PR(e,n,1),d=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=d,n[2*l]=n[2*a]+n[2*d],e.depth[l]=(e.depth[a]>=e.depth[d]?e.depth[a]:e.depth[d])+1,n[2*a+1]=n[2*d+1]=l,e.heap[1]=l++,PR(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((p,_)=>{const m=_.dyn_tree,E=_.max_code,C=_.stat_desc.static_tree,R=_.stat_desc.has_stree,y=_.stat_desc.extra_bits,b=_.stat_desc.extra_base,A=_.stat_desc.max_length;let D,V,x,k,B,q,Z=0;for(k=0;k<=eh;k++)p.bl_count[k]=0;for(m[2*p.heap[p.heap_max]+1]=0,D=p.heap_max+1;D<573;D++)V=p.heap[D],k=m[2*m[2*V+1]+1]+1,k>A&&(k=A,Z++),m[2*V+1]=k,V>E||(p.bl_count[k]++,B=0,V>=b&&(B=y[V-b]),q=m[2*V],p.opt_len+=q*(k+B),R&&(p.static_len+=q*(C[2*V+1]+B)));if(Z!==0){do{for(k=A-1;p.bl_count[k]===0;)k--;p.bl_count[k]--,p.bl_count[k+1]+=2,p.bl_count[A]--,Z-=2}while(Z>0);for(k=A;k!==0;k--)for(V=p.bl_count[k];V!==0;)x=p.heap[--D],x>E||(m[2*x+1]!==k&&(p.opt_len+=(k-m[2*x+1])*m[2*x],m[2*x+1]=k),V--)}})(e,t),T2(n,u,e.bl_count)},I2=(e,t,n)=>{let r,i,s=-1,a=t[1],d=0,l=7,u=4;for(a===0&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++d<l&&i===a||(d<u?e.bl_tree[2*i]+=d:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):d<=10?e.bl_tree[34]++:e.bl_tree[36]++,d=0,s=i,a===0?(l=138,u=3):i===a?(l=6,u=3):(l=7,u=4))},w2=(e,t,n)=>{let r,i,s=-1,a=t[1],d=0,l=7,u=4;for(a===0&&(l=138,u=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++d<l&&i===a)){if(d<u)do Xo(e,i,e.bl_tree);while(--d!=0);else i!==0?(i!==s&&(Xo(e,i,e.bl_tree),d--),Xo(e,16,e.bl_tree),ri(e,d-3,2)):d<=10?(Xo(e,17,e.bl_tree),ri(e,d-3,3)):(Xo(e,18,e.bl_tree),ri(e,d-11,7));d=0,s=i,a===0?(l=138,u=3):i===a?(l=6,u=3):(l=7,u=4)}};let A2=!1;const b2=(e,t,n,r)=>{ri(e,0+(r?1:0),3),R2(e),ih(e,n),ih(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var AX=e=>{A2||((()=>{let t,n,r,i,s;const a=new Array(16);for(r=0,i=0;i<28;i++)for(OR[i]=r,t=0;t<1<<bR[i];t++)rh[r++]=i;for(rh[r-1]=i,s=0,i=0;i<16;i++)for(Z_[i]=s,t=0;t<1<<Q_[i];t++)nh[s++]=i;for(s>>=7;i<$u;i++)for(Z_[i]=s<<7,t=0;t<1<<Q_[i]-7;t++)nh[256+s++]=i;for(n=0;n<=eh;n++)a[n]=0;for(t=0;t<=143;)vs[2*t+1]=8,t++,a[8]++;for(;t<=255;)vs[2*t+1]=9,t++,a[9]++;for(;t<=279;)vs[2*t+1]=7,t++,a[7]++;for(;t<=287;)vs[2*t+1]=8,t++,a[8]++;for(T2(vs,287,a),t=0;t<$u;t++)th[2*t+1]=5,th[2*t]=S2(t,5);_2=new NR(vs,bR,257,p2,eh),m2=new NR(th,Q_,0,$u,eh),E2=new NR(new Array(0),wX,0,19,7)})(),A2=!0),e.l_desc=new DR(e.dyn_ltree,_2),e.d_desc=new DR(e.dyn_dtree,m2),e.bl_desc=new DR(e.bl_tree,E2),e.bi_buf=0,e.bi_valid=0,v2(e)},bX=(e,t,n,r)=>{let i,s,a=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(d=>{let l,u=4093624447;for(l=0;l<=31;l++,u>>>=1)if(1&u&&d.dyn_ltree[2*l]!==0)return 0;if(d.dyn_ltree[18]!==0||d.dyn_ltree[20]!==0||d.dyn_ltree[26]!==0)return 1;for(l=32;l<AR;l++)if(d.dyn_ltree[2*l]!==0)return 1;return 0})(e)),kR(e,e.l_desc),kR(e,e.d_desc),a=(d=>{let l;for(I2(d,d.dyn_ltree,d.l_desc.max_code),I2(d,d.dyn_dtree,d.d_desc.max_code),kR(d,d.bl_desc),l=18;l>=3&&d.bl_tree[2*f2[l]+1]===0;l--);return d.opt_len+=3*(l+1)+5+5+4,l})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&t!==-1?b2(e,t,n,r):e.strategy===4||s===i?(ri(e,2+(r?1:0),3),C2(e,vs,th)):(ri(e,4+(r?1:0),3),((d,l,u,p)=>{let _;for(ri(d,l-257,5),ri(d,u-1,5),ri(d,p-4,4),_=0;_<p;_++)ri(d,d.bl_tree[2*f2[_]+1],3);w2(d,d.dyn_ltree,l-1),w2(d,d.dyn_dtree,u-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),C2(e,e.dyn_ltree,e.dyn_dtree)),v2(e),r&&R2(e)},OX=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(rh[n]+AR+1)]++,e.dyn_dtree[2*g2(t)]++),e.sym_next===e.sym_end),NX=e=>{ri(e,2,3),Xo(e,256,vs),(t=>{t.bi_valid===16?(ih(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},DX={_tr_init:AX,_tr_stored_block:b2,_tr_flush_block:bX,_tr_tally:OX,_tr_align:NX},oh=(e,t,n,r)=>{let i=65535&e|0,s=e>>>16&65535|0,a=0;for(;n!==0;){a=n>2e3?2e3:n,n-=a;do i=i+t[r++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0};const PX=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var cr=(e,t,n,r)=>{const i=PX,s=r+n;e^=-1;for(let a=r;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},Rc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ol={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:kX,_tr_stored_block:LR,_tr_flush_block:LX,_tr_tally:ma,_tr_align:MX}=DX,{Z_NO_FLUSH:Ea,Z_PARTIAL_FLUSH:UX,Z_FULL_FLUSH:xX,Z_FINISH:qi,Z_BLOCK:O2,Z_OK:Er,Z_STREAM_END:N2,Z_STREAM_ERROR:Jo,Z_DATA_ERROR:VX,Z_BUF_ERROR:MR,Z_DEFAULT_COMPRESSION:FX,Z_FILTERED:BX,Z_HUFFMAN_ONLY:$_,Z_RLE:jX,Z_FIXED:GX,Z_DEFAULT_STRATEGY:WX,Z_UNKNOWN:HX,Z_DEFLATED:em}=ol,UR=286,KX=30,zX=19,YX=2*UR+1,qX=15,yc=258,Qo=262,sl=42,Cc=113,sh=666,Ic=(e,t)=>(e.msg=Rc[t],t),D2=e=>2*e-(e>4?9:0),ga=e=>{let t=e.length;for(;--t>=0;)e[t]=0},XX=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let Sa=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const gi=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Si=(e,t)=>{LX(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,gi(e.strm)},Ht=(e,t)=>{e.pending_buf[e.pending++]=t},ah=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},xR=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=oh(e.adler,t,i,n):e.state.wrap===2&&(e.adler=cr(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},P2=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,a=e.prev_length,d=e.nice_match;const l=e.strstart>e.w_size-Qo?e.strstart-(e.w_size-Qo):0,u=e.window,p=e.w_mask,_=e.prev,m=e.strstart+yc;let E=u[s+a-1],C=u[s+a];e.prev_length>=e.good_match&&(i>>=2),d>e.lookahead&&(d=e.lookahead);do if(n=t,u[n+a]===C&&u[n+a-1]===E&&u[n]===u[s]&&u[++n]===u[s+1]){s+=2,n++;do;while(u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&s<m);if(r=yc-(m-s),s=m-yc,r>a){if(e.match_start=t,a=r,r>=d)break;E=u[s+a-1],C=u[s+a]}}while((t=_[t&p])>l&&--i!=0);return a<=e.lookahead?a:e.lookahead},al=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Qo)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),XX(e),r+=t),e.strm.avail_in===0)break;if(n=xR(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Sa(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Sa(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Qo&&e.strm.avail_in!==0)},k2=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,d=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&t!==qi||t===Ea||n!==r+e.strm.avail_in)))break;a=t===qi&&n===r+e.strm.avail_in?1:0,LR(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,gi(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(xR(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(a===0);return d-=e.strm.avail_in,d&&(d>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=d&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-d,e.strm.next_in),e.strstart),e.strstart+=d,e.insert+=d>e.w_size-e.insert?e.w_size-e.insert:d),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==Ea&&t!==qi&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(xR(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===qi)&&t!==Ea&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,a=t===qi&&e.strm.avail_in===0&&n===r?1:0,LR(e,e.block_start,n,a),e.block_start+=n,gi(e.strm)),a?3:1)},VR=(e,t)=>{let n,r;for(;;){if(e.lookahead<Qo){if(al(e),e.lookahead<Qo&&t===Ea)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Sa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Qo&&(e.match_length=P2(e,n)),e.match_length>=3)if(r=ma(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Sa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Sa(e,e.ins_h,e.window[e.strstart+1]);else r=ma(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Si(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===qi?(Si(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Si(e,!1),e.strm.avail_out===0)?1:2},cl=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Qo){if(al(e),e.lookahead<Qo&&t===Ea)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Sa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Qo&&(e.match_length=P2(e,n),e.match_length<=5&&(e.strategy===BX||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=ma(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Sa(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Si(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=ma(e,0,e.window[e.strstart-1]),r&&Si(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=ma(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===qi?(Si(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Si(e,!1),e.strm.avail_out===0)?1:2};function Zo(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const ch=[new Zo(0,0,0,0,k2),new Zo(4,4,8,4,VR),new Zo(4,5,16,8,VR),new Zo(4,6,32,32,VR),new Zo(4,4,16,16,cl),new Zo(8,16,32,32,cl),new Zo(8,16,128,128,cl),new Zo(8,32,128,256,cl),new Zo(32,128,258,1024,cl),new Zo(32,258,258,4096,cl)];function JX(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=em,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*YX),this.dyn_dtree=new Uint16Array(2*(2*KX+1)),this.bl_tree=new Uint16Array(2*(2*zX+1)),ga(this.dyn_ltree),ga(this.dyn_dtree),ga(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(qX+1),this.heap=new Uint16Array(2*UR+1),ga(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*UR+1),ga(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==sl&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Cc&&t.status!==sh?1:0},L2=e=>{if(dh(e))return Ic(e,Jo);e.total_in=e.total_out=0,e.data_type=HX;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?sl:Cc,e.adler=t.wrap===2?0:1,t.last_flush=-2,kX(t),Er},M2=e=>{const t=L2(e);return t===Er&&(n=>{n.window_size=2*n.w_size,ga(n.head),n.max_lazy_match=ch[n.level].max_lazy,n.good_match=ch[n.level].good_length,n.nice_match=ch[n.level].nice_length,n.max_chain_length=ch[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},U2=(e,t,n,r,i,s)=>{if(!e)return Jo;let a=1;if(t===FX&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==em||r<8||r>15||t<0||t>9||s<0||s>GX||r===8&&a!==1)return Ic(e,Jo);r===8&&(r=9);const d=new JX;return e.state=d,d.strm=e,d.status=sl,d.wrap=a,d.gzhead=null,d.w_bits=r,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=i+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<i+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=3*(d.lit_bufsize-1),d.level=t,d.strategy=s,d.method=n,M2(e)};var QX=(e,t)=>{if(dh(e)||t>O2||t<0)return e?Ic(e,Jo):Jo;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===sh&&t!==qi)return Ic(e,e.avail_out===0?MR:Jo);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(gi(e),e.avail_out===0)return n.last_flush=-1,Er}else if(e.avail_in===0&&D2(t)<=D2(r)&&t!==qi)return Ic(e,MR);if(n.status===sh&&e.avail_in!==0)return Ic(e,MR);if(n.status===sl&&n.wrap===0&&(n.status=Cc),n.status===sl){let i=em+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=$_||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,ah(n,i),n.strstart!==0&&(ah(n,e.adler>>>16),ah(n,65535&e.adler)),e.adler=1,n.status=Cc,gi(e),n.pending!==0)return n.last_flush=-1,Er}if(n.status===57){if(e.adler=0,Ht(n,31),Ht(n,139),Ht(n,8),n.gzhead)Ht(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Ht(n,255&n.gzhead.time),Ht(n,n.gzhead.time>>8&255),Ht(n,n.gzhead.time>>16&255),Ht(n,n.gzhead.time>>24&255),Ht(n,n.level===9?2:n.strategy>=$_||n.level<2?4:0),Ht(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Ht(n,255&n.gzhead.extra.length),Ht(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=cr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Ht(n,0),Ht(n,0),Ht(n,0),Ht(n,0),Ht(n,0),Ht(n,n.level===9?2:n.strategy>=$_||n.level<2?4:0),Ht(n,3),n.status=Cc,gi(e),n.pending!==0)return n.last_flush=-1,Er}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let d=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+d),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=cr(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=d,gi(e),n.pending!==0)return n.last_flush=-1,Er;i=0,s-=d}let a=new Uint8Array(n.gzhead.extra);n.pending_buf.set(a.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(e.adler=cr(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=cr(e.adler,n.pending_buf,n.pending-s,s)),gi(e),n.pending!==0)return n.last_flush=-1,Er;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Ht(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=cr(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=cr(e.adler,n.pending_buf,n.pending-s,s)),gi(e),n.pending!==0)return n.last_flush=-1,Er;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Ht(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=cr(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(gi(e),n.pending!==0))return n.last_flush=-1,Er;Ht(n,255&e.adler),Ht(n,e.adler>>8&255),e.adler=0}if(n.status=Cc,gi(e),n.pending!==0)return n.last_flush=-1,Er}if(e.avail_in!==0||n.lookahead!==0||t!==Ea&&n.status!==sh){let i=n.level===0?k2(n,t):n.strategy===$_?((s,a)=>{let d;for(;;){if(s.lookahead===0&&(al(s),s.lookahead===0)){if(a===Ea)return 1;break}if(s.match_length=0,d=ma(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,d&&(Si(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===qi?(Si(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Si(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===jX?((s,a)=>{let d,l,u,p;const _=s.window;for(;;){if(s.lookahead<=yc){if(al(s),s.lookahead<=yc&&a===Ea)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(u=s.strstart-1,l=_[u],l===_[++u]&&l===_[++u]&&l===_[++u])){p=s.strstart+yc;do;while(l===_[++u]&&l===_[++u]&&l===_[++u]&&l===_[++u]&&l===_[++u]&&l===_[++u]&&l===_[++u]&&l===_[++u]&&u<p);s.match_length=yc-(p-u),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(d=ma(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(d=ma(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),d&&(Si(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===qi?(Si(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Si(s,!1),s.strm.avail_out===0)?1:2})(n,t):ch[n.level].func(n,t);if(i!==3&&i!==4||(n.status=sh),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Er;if(i===2&&(t===UX?MX(n):t!==O2&&(LR(n,0,0,!1),t===xX&&(ga(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),gi(e),e.avail_out===0))return n.last_flush=-1,Er}return t!==qi?Er:n.wrap<=0?N2:(n.wrap===2?(Ht(n,255&e.adler),Ht(n,e.adler>>8&255),Ht(n,e.adler>>16&255),Ht(n,e.adler>>24&255),Ht(n,255&e.total_in),Ht(n,e.total_in>>8&255),Ht(n,e.total_in>>16&255),Ht(n,e.total_in>>24&255)):(ah(n,e.adler>>>16),ah(n,65535&e.adler)),gi(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Er:N2)},ZX=(e,t)=>{let n=t.length;if(dh(e))return Jo;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==sl||r.lookahead)return Jo;if(i===1&&(e.adler=oh(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(ga(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(t.subarray(n-r.w_size,n),0),t=l,n=r.w_size}const s=e.avail_in,a=e.next_in,d=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,al(r);r.lookahead>=3;){let l=r.strstart,u=r.lookahead-2;do r.ins_h=Sa(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--u);r.strstart=l,r.lookahead=2,al(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=d,e.avail_in=s,r.wrap=i,Er},lh={deflateInit:(e,t)=>U2(e,t,em,15,8,WX),deflateInit2:U2,deflateReset:M2,deflateResetKeep:L2,deflateSetHeader:(e,t)=>dh(e)||e.state.wrap!==2?Jo:(e.state.gzhead=t,Er),deflate:QX,deflateEnd:e=>{if(dh(e))return Jo;const t=e.state.status;return e.state=null,t===Cc?Ic(e,VX):Er},deflateSetDictionary:ZX,deflateInfo:"pako deflate (from Nodeca project)"};const $X=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var tm={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)$X(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let a=e[r];n.set(a,i),i+=a.length}return n}};let x2=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{x2=!1}const uh=new Uint8Array(256);for(let e=0;e<256;e++)uh[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;uh[254]=uh[254]=1;var hh={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,s,a=e.length,d=0;for(i=0;i<a;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<a&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),d+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(d),s=0,i=0;s<d;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<a&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let a=e[r++];if(a<128){s[i++]=a;continue}let d=uh[a];if(d>4)s[i++]=65533,r+=d-1;else{for(a&=d===2?31:d===3?15:7;d>1&&r<n;)a=a<<6|63&e[r++],d--;d>1?s[i++]=65533:a<65536?s[i++]=a:(a-=65536,s[i++]=55296|a>>10&1023,s[i++]=56320|1023&a)}}return((a,d)=>{if(d<65534&&a.subarray&&x2)return String.fromCharCode.apply(null,a.length===d?a:a.subarray(0,d));let l="";for(let u=0;u<d;u++)l+=String.fromCharCode(a[u]);return l})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+uh[e[n]]>t?n:t}},V2=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const F2=Object.prototype.toString,{Z_NO_FLUSH:eJ,Z_SYNC_FLUSH:tJ,Z_FULL_FLUSH:nJ,Z_FINISH:rJ,Z_OK:nm,Z_STREAM_END:iJ,Z_DEFAULT_COMPRESSION:oJ,Z_DEFAULT_STRATEGY:sJ,Z_DEFLATED:aJ}=ol;function ph(e){this.options=tm.assign({level:oJ,method:aJ,chunkSize:16384,windowBits:15,memLevel:8,strategy:sJ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new V2,this.strm.avail_out=0;let n=lh.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==nm)throw new Error(Rc[n]);if(t.header&&lh.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?hh.string2buf(t.dictionary):F2.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=lh.deflateSetDictionary(this.strm,r),n!==nm)throw new Error(Rc[n]);this._dict_set=!0}}function FR(e,t){const n=new ph(t);if(n.push(e,!0),n.err)throw n.msg||Rc[n.err];return n.result}ph.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?rJ:eJ,typeof e=="string"?n.input=hh.string2buf(e):F2.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===tJ||s===nJ)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=lh.deflate(n,s),i===iJ)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=lh.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===nm;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},ph.prototype.onData=function(e){this.chunks.push(e)},ph.prototype.onEnd=function(e){e===nm&&(this.result=tm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var cJ={Deflate:ph,deflate:FR,deflateRaw:function(e,t){return(t=t||{}).raw=!0,FR(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,FR(e,t)},constants:ol};const rm=16209;var dJ=function(e,t){let n,r,i,s,a,d,l,u,p,_,m,E,C,R,y,b,A,D,V,x,k,B,q,Z;const te=e.state;n=e.next_in,q=e.input,r=n+(e.avail_in-5),i=e.next_out,Z=e.output,s=i-(t-e.avail_out),a=i+(e.avail_out-257),d=te.dmax,l=te.wsize,u=te.whave,p=te.wnext,_=te.window,m=te.hold,E=te.bits,C=te.lencode,R=te.distcode,y=(1<<te.lenbits)-1,b=(1<<te.distbits)-1;e:do{E<15&&(m+=q[n++]<<E,E+=8,m+=q[n++]<<E,E+=8),A=C[m&y];t:for(;;){if(D=A>>>24,m>>>=D,E-=D,D=A>>>16&255,D===0)Z[i++]=65535&A;else{if(!(16&D)){if(!(64&D)){A=C[(65535&A)+(m&(1<<D)-1)];continue t}if(32&D){te.mode=16191;break e}e.msg="invalid literal/length code",te.mode=rm;break e}V=65535&A,D&=15,D&&(E<D&&(m+=q[n++]<<E,E+=8),V+=m&(1<<D)-1,m>>>=D,E-=D),E<15&&(m+=q[n++]<<E,E+=8,m+=q[n++]<<E,E+=8),A=R[m&b];n:for(;;){if(D=A>>>24,m>>>=D,E-=D,D=A>>>16&255,!(16&D)){if(!(64&D)){A=R[(65535&A)+(m&(1<<D)-1)];continue n}e.msg="invalid distance code",te.mode=rm;break e}if(x=65535&A,D&=15,E<D&&(m+=q[n++]<<E,E+=8,E<D&&(m+=q[n++]<<E,E+=8)),x+=m&(1<<D)-1,x>d){e.msg="invalid distance too far back",te.mode=rm;break e}if(m>>>=D,E-=D,D=i-s,x>D){if(D=x-D,D>u&&te.sane){e.msg="invalid distance too far back",te.mode=rm;break e}if(k=0,B=_,p===0){if(k+=l-D,D<V){V-=D;do Z[i++]=_[k++];while(--D);k=i-x,B=Z}}else if(p<D){if(k+=l+p-D,D-=p,D<V){V-=D;do Z[i++]=_[k++];while(--D);if(k=0,p<V){D=p,V-=D;do Z[i++]=_[k++];while(--D);k=i-x,B=Z}}}else if(k+=p-D,D<V){V-=D;do Z[i++]=_[k++];while(--D);k=i-x,B=Z}for(;V>2;)Z[i++]=B[k++],Z[i++]=B[k++],Z[i++]=B[k++],V-=3;V&&(Z[i++]=B[k++],V>1&&(Z[i++]=B[k++]))}else{k=i-x;do Z[i++]=Z[k++],Z[i++]=Z[k++],Z[i++]=Z[k++],V-=3;while(V>2);V&&(Z[i++]=Z[k++],V>1&&(Z[i++]=Z[k++]))}break}}break}}while(n<r&&i<a);V=E>>3,n-=V,E-=V<<3,m&=(1<<E)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),te.hold=m,te.bits=E};const im=15,lJ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),uJ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),hJ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),pJ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var fh=(e,t,n,r,i,s,a,d)=>{const l=d.bits;let u,p,_,m,E,C,R=0,y=0,b=0,A=0,D=0,V=0,x=0,k=0,B=0,q=0,Z=null;const te=new Uint16Array(16),Fe=new Uint16Array(16);let Ge,Oe,it,nt=null;for(R=0;R<=im;R++)te[R]=0;for(y=0;y<r;y++)te[t[n+y]]++;for(D=l,A=im;A>=1&&te[A]===0;A--);if(D>A&&(D=A),A===0)return i[s++]=20971520,i[s++]=20971520,d.bits=1,0;for(b=1;b<A&&te[b]===0;b++);for(D<b&&(D=b),k=1,R=1;R<=im;R++)if(k<<=1,k-=te[R],k<0)return-1;if(k>0&&(e===0||A!==1))return-1;for(Fe[1]=0,R=1;R<im;R++)Fe[R+1]=Fe[R]+te[R];for(y=0;y<r;y++)t[n+y]!==0&&(a[Fe[t[n+y]]++]=y);if(e===0?(Z=nt=a,C=20):e===1?(Z=lJ,nt=uJ,C=257):(Z=hJ,nt=pJ,C=0),q=0,y=0,R=b,E=s,V=D,x=0,_=-1,B=1<<D,m=B-1,e===1&&B>852||e===2&&B>592)return 1;for(;;){Ge=R-x,a[y]+1<C?(Oe=0,it=a[y]):a[y]>=C?(Oe=nt[a[y]-C],it=Z[a[y]-C]):(Oe=96,it=0),u=1<<R-x,p=1<<V,b=p;do p-=u,i[E+(q>>x)+p]=Ge<<24|Oe<<16|it|0;while(p!==0);for(u=1<<R-1;q&u;)u>>=1;if(u!==0?(q&=u-1,q+=u):q=0,y++,--te[R]==0){if(R===A)break;R=t[n+a[y]]}if(R>D&&(q&m)!==_){for(x===0&&(x=D),E+=b,V=R-x,k=1<<V;V+x<A&&(k-=te[V+x],!(k<=0));)V++,k<<=1;if(B+=1<<V,e===1&&B>852||e===2&&B>592)return 1;_=q&m,i[_]=D<<24|V<<16|E-s|0}}return q!==0&&(i[E+q]=R-x<<24|64<<16|0),d.bits=D,0};const{Z_FINISH:B2,Z_BLOCK:fJ,Z_TREES:om,Z_OK:wc,Z_STREAM_END:_J,Z_NEED_DICT:mJ,Z_STREAM_ERROR:Xi,Z_DATA_ERROR:j2,Z_MEM_ERROR:G2,Z_BUF_ERROR:EJ,Z_DEFLATED:W2}=ol,sm=16180,am=16190,Rs=16191,BR=16192,jR=16194,cm=16199,dm=16200,GR=16206,gn=16209,H2=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function gJ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ac=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<sm||t.mode>16211?1:0},K2=e=>{if(Ac(e))return Xi;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=sm,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,wc},z2=e=>{if(Ac(e))return Xi;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,K2(e)},Y2=(e,t)=>{let n;if(Ac(e))return Xi;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Xi:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,z2(e))},q2=(e,t)=>{if(!e)return Xi;const n=new gJ;e.state=n,n.strm=e,n.window=null,n.mode=sm;const r=Y2(e,t);return r!==wc&&(e.state=null),r};let WR,HR,X2=!0;const SJ=e=>{if(X2){WR=new Int32Array(512),HR=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(fh(1,e.lens,0,288,WR,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;fh(2,e.lens,0,32,HR,0,e.work,{bits:5}),X2=!1}e.lencode=WR,e.lenbits=9,e.distcode=HR,e.distbits=5},J2=(e,t,n,r)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var TJ=(e,t)=>{let n,r,i,s,a,d,l,u,p,_,m,E,C,R,y,b,A,D,V,x,k,B,q=0;const Z=new Uint8Array(4);let te,Fe;const Ge=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ac(e)||!e.output||!e.input&&e.avail_in!==0)return Xi;n=e.state,n.mode===Rs&&(n.mode=BR),a=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,d=e.avail_in,u=n.hold,p=n.bits,_=d,m=l,B=wc;e:for(;;)switch(n.mode){case sm:if(n.wrap===0){n.mode=BR;break}for(;p<16;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(2&n.wrap&&u===35615){n.wbits===0&&(n.wbits=15),n.check=0,Z[0]=255&u,Z[1]=u>>>8&255,n.check=cr(n.check,Z,2,0),u=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=gn;break}if((15&u)!==W2){e.msg="unknown compression method",n.mode=gn;break}if(u>>>=4,p-=4,k=8+(15&u),n.wbits===0&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=gn;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:Rs,u=0,p=0;break;case 16181:for(;p<16;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(n.flags=u,(255&er(n))!==W2){e.msg="unknown compression method",n.mode=gn;break}if(57344&er(n)){e.msg="unknown header flags set",n.mode=gn;break}n.head&&(n.head.text=u>>8&1),512&er(n)&&4&n.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,n.check=cr(n.check,Z,2,0)),u=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}n.head&&(n.head.time=u),512&er(n)&&4&n.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,Z[2]=u>>>16&255,Z[3]=u>>>24&255,n.check=cr(n.check,Z,4,0)),u=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&er(n)&&4&n.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,n.check=cr(n.check,Z,2,0)),u=0,p=0,n.mode=16184;case 16184:if(1024&er(n)){for(;p<16;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}n.length=u,n.head&&(n.head.extra_len=u),512&er(n)&&4&n.wrap&&(Z[0]=255&u,Z[1]=u>>>8&255,n.check=cr(n.check,Z,2,0)),u=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&er(n)&&(E=n.length,E>d&&(E=d),E&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+E),k)),512&er(n)&&4&n.wrap&&(n.check=cr(n.check,r,E,s)),d-=E,s+=E,n.length-=E),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&er(n)){if(d===0)break e;E=0;do k=r[s+E++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k));while(k&&E<d);if(512&er(n)&&4&n.wrap&&(n.check=cr(n.check,r,E,s)),d-=E,s+=E,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&er(n)){if(d===0)break e;E=0;do k=r[s+E++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k));while(k&&E<d);if(512&er(n)&&4&n.wrap&&(n.check=cr(n.check,r,E,s)),d-=E,s+=E,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&er(n)){for(;p<16;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=gn;break}u=0,p=0}n.head&&(n.head.hcrc=er(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Rs;break;case 16189:for(;p<32;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}e.adler=n.check=H2(u),u=0,p=0,n.mode=am;case am:if(n.havedict===0)return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=d,n.hold=u,n.bits=p,mJ;e.adler=n.check=1,n.mode=Rs;case Rs:if(t===fJ||t===om)break e;case BR:if(n.last){u>>>=7&p,p-=7&p,n.mode=GR;break}for(;p<3;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}switch(n.last=1&u,u>>>=1,p-=1,3&u){case 0:n.mode=16193;break;case 1:if(SJ(n),n.mode=cm,t===om){u>>>=2,p-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=gn}u>>>=2,p-=2;break;case 16193:for(u>>>=7&p,p-=7&p;p<32;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=gn;break}if(n.length=65535&u,u=0,p=0,n.mode=jR,t===om)break e;case jR:n.mode=16195;case 16195:if(E=n.length,E){if(E>d&&(E=d),E>l&&(E=l),E===0)break e;i.set(r.subarray(s,s+E),a),d-=E,s+=E,l-=E,a+=E,n.length-=E;break}n.mode=Rs;break;case 16196:for(;p<14;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(n.nlen=257+(31&u),u>>>=5,p-=5,n.ndist=1+(31&u),u>>>=5,p-=5,n.ncode=4+(15&u),u>>>=4,p-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=gn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}n.lens[Ge[n.have++]]=7&u,u>>>=3,p-=3}for(;n.have<19;)n.lens[Ge[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,te={bits:n.lenbits},B=fh(0,n.lens,0,19,n.lencode,0,n.work,te),n.lenbits=te.bits,B){e.msg="invalid code lengths set",n.mode=gn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;q=n.lencode[u&(1<<n.lenbits)-1],y=q>>>24,b=q>>>16&255,A=65535&q,!(y<=p);){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(A<16)u>>>=y,p-=y,n.lens[n.have++]=A;else{if(A===16){for(Fe=y+2;p<Fe;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(u>>>=y,p-=y,n.have===0){e.msg="invalid bit length repeat",n.mode=gn;break}k=n.lens[n.have-1],E=3+(3&u),u>>>=2,p-=2}else if(A===17){for(Fe=y+3;p<Fe;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}u>>>=y,p-=y,k=0,E=3+(7&u),u>>>=3,p-=3}else{for(Fe=y+7;p<Fe;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}u>>>=y,p-=y,k=0,E=11+(127&u),u>>>=7,p-=7}if(n.have+E>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=gn;break}for(;E--;)n.lens[n.have++]=k}}if(n.mode===gn)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=gn;break}if(n.lenbits=9,te={bits:n.lenbits},B=fh(1,n.lens,0,n.nlen,n.lencode,0,n.work,te),n.lenbits=te.bits,B){e.msg="invalid literal/lengths set",n.mode=gn;break}if(n.distbits=6,n.distcode=n.distdyn,te={bits:n.distbits},B=fh(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,te),n.distbits=te.bits,B){e.msg="invalid distances set",n.mode=gn;break}if(n.mode=cm,t===om)break e;case cm:n.mode=dm;case dm:if(d>=6&&l>=258){e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=d,n.hold=u,n.bits=p,dJ(e,m),a=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,d=e.avail_in,u=n.hold,p=n.bits,n.mode===Rs&&(n.back=-1);break}for(n.back=0;q=n.lencode[u&(1<<n.lenbits)-1],y=q>>>24,b=q>>>16&255,A=65535&q,!(y<=p);){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(b&&!(240&b)){for(D=y,V=b,x=A;q=n.lencode[x+((u&(1<<D+V)-1)>>D)],y=q>>>24,b=q>>>16&255,A=65535&q,!(D+y<=p);){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}u>>>=D,p-=D,n.back+=D}if(u>>>=y,p-=y,n.back+=y,n.length=A,b===0){n.mode=16205;break}if(32&b){n.back=-1,n.mode=Rs;break}if(64&b){e.msg="invalid literal/length code",n.mode=gn;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(Fe=n.extra;p<Fe;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;q=n.distcode[u&(1<<n.distbits)-1],y=q>>>24,b=q>>>16&255,A=65535&q,!(y<=p);){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(!(240&b)){for(D=y,V=b,x=A;q=n.distcode[x+((u&(1<<D+V)-1)>>D)],y=q>>>24,b=q>>>16&255,A=65535&q,!(D+y<=p);){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}u>>>=D,p-=D,n.back+=D}if(u>>>=y,p-=y,n.back+=y,64&b){e.msg="invalid distance code",n.mode=gn;break}n.offset=A,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(Fe=n.extra;p<Fe;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=gn;break}n.mode=16204;case 16204:if(l===0)break e;if(E=m-l,n.offset>E){if(E=n.offset-E,E>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=gn;break}E>n.wnext?(E-=n.wnext,C=n.wsize-E):C=n.wnext-E,E>n.length&&(E=n.length),R=n.window}else R=i,C=a-n.offset,E=n.length;E>l&&(E=l),l-=E,n.length-=E;do i[a++]=R[C++];while(--E);n.length===0&&(n.mode=dm);break;case 16205:if(l===0)break e;i[a++]=n.length,l--,n.mode=dm;break;case GR:if(n.wrap){for(;p<32;){if(d===0)break e;d--,u|=r[s++]<<p,p+=8}if(m-=l,e.total_out+=m,n.total+=m,4&n.wrap&&m&&(e.adler=n.check=er(n)?cr(n.check,i,m,a-m):oh(n.check,i,m,a-m)),m=l,4&n.wrap&&(er(n)?u:H2(u))!==n.check){e.msg="incorrect data check",n.mode=gn;break}u=0,p=0}n.mode=16207;case 16207:if(n.wrap&&er(n)){for(;p<32;){if(d===0)break e;d--,u+=r[s++]<<p,p+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=gn;break}u=0,p=0}n.mode=16208;case 16208:B=_J;break e;case gn:B=j2;break e;case 16210:return G2;default:return Xi}return e.next_out=a,e.avail_out=l,e.next_in=s,e.avail_in=d,n.hold=u,n.bits=p,(n.wsize||m!==e.avail_out&&n.mode<gn&&(n.mode<GR||t!==B2))&&J2(e,e.output,e.next_out,m-e.avail_out),_-=e.avail_in,m-=e.avail_out,e.total_in+=_,e.total_out+=m,n.total+=m,4&n.wrap&&m&&(e.adler=n.check=er(n)?cr(n.check,i,m,e.next_out-m):oh(n.check,i,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Rs?128:0)+(n.mode===cm||n.mode===jR?256:0),(_===0&&m===0||t===B2)&&B===wc&&(B=EJ),B},ys={inflateReset:z2,inflateReset2:Y2,inflateResetKeep:K2,inflateInit:e=>q2(e,15),inflateInit2:q2,inflate:TJ,inflateEnd:e=>{if(Ac(e))return Xi;let t=e.state;return t.window&&(t.window=null),e.state=null,wc},inflateGetHeader:(e,t)=>{if(Ac(e))return Xi;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,wc):Xi},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return Ac(e)?Xi:(r=e.state,r.wrap!==0&&r.mode!==am?Xi:r.mode===am&&(i=1,i=oh(i,t,n,0),i!==r.check)?j2:(s=J2(e,t,n,n),s?(r.mode=16210,G2):(r.havedict=1,wc)))},inflateInfo:"pako inflate (from Nodeca project)"},vJ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Q2=Object.prototype.toString,{Z_NO_FLUSH:RJ,Z_FINISH:yJ,Z_OK:_h,Z_STREAM_END:KR,Z_NEED_DICT:zR,Z_STREAM_ERROR:CJ,Z_DATA_ERROR:Z2,Z_MEM_ERROR:IJ}=ol;function mh(e){this.options=tm.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new V2,this.strm.avail_out=0;let n=ys.inflateInit2(this.strm,t.windowBits);if(n!==_h)throw new Error(Rc[n]);if(this.header=new vJ,ys.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=hh.string2buf(t.dictionary):Q2.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=ys.inflateSetDictionary(this.strm,t.dictionary),n!==_h)))throw new Error(Rc[n])}function YR(e,t){const n=new mh(t);if(n.push(e),n.err)throw n.msg||Rc[n.err];return n.result}mh.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,d;if(this.ended)return!1;for(a=t===~~t?t:t===!0?yJ:RJ,Q2.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=ys.inflate(n,a),s===zR&&i&&(s=ys.inflateSetDictionary(n,i),s===_h?s=ys.inflate(n,a):s===Z2&&(s=zR));n.avail_in>0&&s===KR&&n.state.wrap>0&&e[n.next_in]!==0;)ys.inflateReset(n),s=ys.inflate(n,a);switch(s){case CJ:case Z2:case zR:case IJ:return this.onEnd(s),this.ended=!0,!1}if(d=n.avail_out,n.next_out&&(n.avail_out===0||s===KR))if(this.options.to==="string"){let l=hh.utf8border(n.output,n.next_out),u=n.next_out-l,p=hh.buf2string(n.output,l);n.next_out=u,n.avail_out=r-u,u&&n.output.set(n.output.subarray(l,l+u),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==_h||d!==0){if(s===KR)return s=ys.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},mh.prototype.onData=function(e){this.chunks.push(e)},mh.prototype.onEnd=function(e){e===_h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=tm.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var wJ={Inflate:mh,inflate:YR,inflateRaw:function(e,t){return(t=t||{}).raw=!0,YR(e,t)},ungzip:YR,constants:ol};const{Deflate:yte,deflate:AJ,deflateRaw:Cte,gzip:Ite}=cJ,{Inflate:wte,inflate:bJ,inflateRaw:Ate,ungzip:bte}=wJ;var OJ=AJ,NJ=bJ,$2=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}($2||{});class DJ{constructor(){w(this,"_sequence",0),w(this,"_startTime",Date.now()),w(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const d=new Uint8Array(4);d.set([1,0,0,0]);const l={id:0,length:4,data:d.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};n.commonPacketHeader.extension=1,n.extension=u,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;N("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let a=0;if(s.setUint16(a,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),a+=2,s.setUint32(a,n.commonPacketHeader.sequence,!0),a+=4,s.setUint16(a,n.commonStreamHeader,!0),a+=2,n.extension){const d=this.serializeExtension(n.extension);i.set(new Uint8Array(d),a),a+=d.byteLength}if(i.set(new Uint8Array(n.payload),a),a+=n.payload.byteLength,a!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let a,d;if(r+=4,N("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){d=this.deserializeExtension(t.slice(r)),r+=2+d.length,a=t.slice(r);let l=!1;if(d.datas.length>0){const u=d.datas.find(p=>p.id===0);u&&(l=(1&new DataView(u.data).getUint32(0,!0))==1)}a=l?this.decompress(a):a}else a=t.slice(8);return a}serializeExtension(t){const{profile:n,length:r,datas:i}=t,s=new ArrayBuffer(r+2),a=new Uint8Array(s),d=new DataView(s);let l=0;if(d.setUint8(l++,n),d.setUint8(l++,r),i.forEach(u=>{n?(d.setUint8(l++,u.id),d.setUint8(l++,u.length),a.set(new Uint8Array(u.data),l),l+=u.data.byteLength):(d.setUint8(l++,u.id|u.length<<4),a.set(new Uint8Array(u.data),l),l+=u.data.byteLength)}),l!==r+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(r+2));return s}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const a=i===$2.TWO_BYTE,d=[],l=new DataView(t,2);let u=0;for(;u<s;){let p=0,_=0,m=new ArrayBuffer(0);a?(p=l.getUint8(u),u++,_=l.getUint8(u),u++):(p=15&l.getUint8(u),_=l.getUint8(u)>>4,u++),_>0&&(m=l.buffer.slice(u+2,u+2+_),u+=m.byteLength),d.push({id:p,length:_,data:m})}if(u!==s)throw Error("parse error");return{profile:i,length:s,datas:d}}decompress(t){return NJ(new Uint8Array(t))}compress(t){return OJ(new Uint8Array(t))}}const PJ={name:"DataStream",create:(e,t)=>{const n=t?new G7(e):new W7(e);return n.useDataStream(new DJ),n}};class kJ extends Lt{constructor(t,n,r){super(),w(this,"ws",void 0),w(this,"requestId",1),w(this,"heartBeatTimer",void 0),w(this,"joinInfo",void 0),w(this,"clientId",void 0),w(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),w(this,"onClose",i=>{this.emit("close"),this.dispose()}),w(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=n,this.ws=new ju("cross-channel-".concat(this.clientId),r),this.ws.on(Ue.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ue.CONNECTED,this.onOpen),this.ws.on(Ue.ON_MESSAGE,this.onMessage),this.ws.on(Ue.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new de((n,r)=>{const i=window.setTimeout(()=>{r(new G(O.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new G(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new G(O.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new G(O.WS_DISCONNECT);const n=()=>new de((a,d)=>{this.ws.once(Ue.CLOSED,()=>d(new G(O.WS_ABORT))),this.ws.once(Ue.CONNECTED,a)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new de((a,d)=>{const l=()=>{d(new G(O.WS_ABORT))};this.ws.once(Ue.RECONNECTING,l),this.ws.once(Ue.CLOSED,l),this.once("req_".concat(r),a),yn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Ue.RECONNECTING,l),this.ws.off(Ue.CLOSED,l),d(new G(O.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new G(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(Ue.REQUEST_NEW_URLS),this.ws.on(Ue.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class LJ extends Lt{set state(t){t!==this._state&&(t!==Ir.RELAY_STATE_FAILURE&&(this.errorCode=Hd.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,s){super(),w(this,"joinInfo",void 0),w(this,"sid",void 0),w(this,"clientId",void 0),w(this,"cancelToken",pr.CancelToken.source()),w(this,"workerToken",void 0),w(this,"requestId",0),w(this,"signal",void 0),w(this,"prevChannelMediaConfig",void 0),w(this,"httpRetryConfig",void 0),w(this,"_resolution",void 0),w(this,"_state",Ir.RELAY_STATE_IDLE),w(this,"errorCode",Hd.RELAY_OK),w(this,"onStatus",a=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(a))),a&&a.command&&(a.command==="onAudioPacketReceived"&&this.emit("event",Es.PACKET_RECEIVED_AUDIO_FROM_SRC),a.command==="onVideoPacketReceived"&&this.emit("event",Es.PACKET_RECEIVED_VIDEO_FROM_SRC),a.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Hd.SRC_TOKEN_EXPIRED,this.state=Ir.RELAY_STATE_FAILURE),a.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Hd.DEST_TOKEN_EXPIRED,this.state=Ir.RELAY_STATE_FAILURE))}),w(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Es.NETWORK_DISCONNECTED),this.state=Ir.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(a=>{this.state!==Ir.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",a.toString()),this.errorCode=Hd.SERVER_CONNECTION_LOST,this.state=Ir.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=cc(),this.signal=new kJ(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==Ir.RELAY_STATE_IDLE)throw new G(O.INVALID_OPERATION);this.state=Ir.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new G(O.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new G(O.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new G(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ir.RELAY_STATE_RUNNING)throw new G(O.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ir.RELAY_STATE_RUNNING)throw new G(O.INVALID_OPERATION);const n=this.genMessage(ar.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ir.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=pr.CancelToken.source(),this.state=Ir.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await qq(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Es.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(ar.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(ar.SetSdkProfile,t);await this.signal.request(r),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(ar.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Es.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(ar.SetSourceUserId,t);await this.signal.request(s),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const a=this.genMessage(ar.SetDestChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Es.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const d=this.genMessage(ar.StartPacketTransfer,t);await this.signal.request(d),this.emit("event",Es.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ir.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(ar.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Es.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(ar.StopPacketTransfer);await this.signal.request(t),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],s=[];this.requestId+=1;const a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:hi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};a.sdkVersion==="4.24.0"&&(a.sdkVersion="0.0.1");let d=null,l=null;switch(t){case ar.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case ar.SetSourceChannel:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new G(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},a;case ar.SetSourceUserId:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new G(O.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:l.uid+""},a;case ar.SetDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new G(O.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(u=>{r.push(u.channelName),i.push(u.uid+""),s.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},a;case ar.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case ar.Reconnect:return a.clientRequest={command:"Reconnect"},a;case ar.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case ar.UpdateDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new G(O.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(u=>{r.push(u.channelName),i.push(u.uid+""),s.push(u.token||this.joinInfo.appId)}),a.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},a;case ar.SetVideoProfile:a.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return a}}const MJ={name:"ChannelMediaRelay",create:function(e){return new LJ(e.joinInfo,e.clientId,e.websocketRetryConfig||Qt,e.httpRetryConfig||Qt,e.resolution)}};function eU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Eh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eU(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class UJ extends Lt{constructor(t,n,r,i){super(),w(this,"spec",void 0),w(this,"token",void 0),w(this,"websocket",void 0),w(this,"pingpongTimer",void 0),w(this,"reconnectMode","retry"),w(this,"serviceMode",void 0),w(this,"reqId",0),w(this,"commandReqId",0),w(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),w(this,"handleWebSocketMessage",s=>{if(!s.data)return;const a=JSON.parse(s.data);a.requestId?this.emit("@".concat(a.requestId,"-").concat(a.sid),a):(Se.workerEvent(this.spec.sid,{actionType:"status",serverCode:a.code,workerType:this.serviceMode===Ko.TRANSCODE?1:2}),this.emit(ia.PUBLISH_STREAM_STATUS,a))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new ju("live-streaming",r),this.websocket.on(Ue.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ue.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ue.REQUEST_NEW_URLS,(s,a)=>{Pn(this,ia.REQUEST_NEW_ADDRESS).then(s).catch(a)}),this.websocket.on(Ue.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,a=this.reqId;if(!a||!this.websocket)throw new G(O.UNEXPECTED_ERROR);const d=Eh({command:t,sdkVersion:hi==="4.24.0"?"0.0.1":hi,seq:a,requestId:a,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new G(O.WS_DISCONNECT);const l=()=>new de((m,E)=>{this.websocket.once(Ue.CLOSED,()=>E(new G(O.WS_ABORT))),this.websocket.once(Ue.CONNECTED,m)});this.websocket.state!=="connected"&&await l(),d.clientRequest&&(d.clientRequest.workerToken=this.token);const u=new de((m,E)=>{const C=()=>{E(new G(O.WS_ABORT))};this.websocket.once(Ue.RECONNECTING,C),this.websocket.once(Ue.CLOSED,C),this.once("@".concat(a,"-").concat(this.spec.sid),R=>{m(R)})});i&&Se.workerEvent(this.spec.sid,Eh(Eh({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(d);let _=null;try{_=await u}catch(m){if(this.websocket.state==="closed")throw m;return await l(),await this.request(t,n,r)}return i&&Se.workerEvent(this.spec.sid,Eh(Eh({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-p})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=hi==="4.24.0"?"0.0.1":hi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case on.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case on.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case on.LIVE_STREAM_RESPONSE_BAD_STREAM:case on.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new G(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case on.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case on.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new G(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case on.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new G(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ia.WARNING,n,t.serverResponse.url)}case on.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new G(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ia.WARNING,n,t.serverResponse.url)}case on.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case on.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new G(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case on.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new G(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ia.WARNING,n,t.serverResponse.url)}case on.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case on.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case on.LIVE_STREAM_RESPONSE_WORKER_LOST:case on.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case on.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case on.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case on.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case on.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case on.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new G(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Qf)},6e3)}}function tU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tU(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class xJ extends Lt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qt,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Qt;super(),w(this,"onLiveStreamWarning",void 0),w(this,"onLiveStreamError",void 0),w(this,"spec",void 0),w(this,"retryTimeout",1e4),w(this,"connection",void 0),w(this,"httpRetryConfig",void 0),w(this,"wsRetryConfig",void 0),w(this,"streamingTasks",new Map),w(this,"isStartingStreamingTask",!1),w(this,"taskMutex",new xn("live-streaming")),w(this,"cancelToken",pr.CancelToken.source()),w(this,"transcodingConfig",void 0),w(this,"uapResponse",void 0),w(this,"lastTaskId",1),w(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=wr(wr({},wq),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(a=>wr(wr(wr({},Iq),a),{},{zOrder:a.zOrder?a.zOrder+1:1}))),function(a){xt(a.width)||_t(a.width,"config.width",0,1e4),xt(a.height)||_t(a.height,"config.height",0,1e4),xt(a.videoBitrate)||_t(a.videoBitrate,"config.videoBitrate",1,1e6),xt(a.videoFrameRate)||_t(a.videoFrameRate,"config.videoFrameRate"),xt(a.lowLatency)||po(a.lowLatency,"config.lowLatency"),xt(a.audioSampleRate)||cn(a.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),xt(a.audioBitrate)||_t(a.audioBitrate,"config.audioBitrate",1,128),xt(a.audioChannels)||cn(a.audioChannels,"config.audioChannels",[1,2,3,4,5]),xt(a.videoGop)||_t(a.videoGop,"config.videoGop"),xt(a.videoCodecProfile)||cn(a.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),xt(a.userCount)||_t(a.userCount,"config.userCount",0,17),xt(a.backgroundColor)||_t(a.backgroundColor,"config.backgroundColor",0,16777215),xt(a.userConfigExtraInfo)||Rn(a.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),a.transcodingUsers&&!xt(a.transcodingUsers)&&(ms(a.transcodingUsers,"config.transcodingUsers"),a.transcodingUsers.forEach((d,l)=>{v_(d.uid),xt(d.x)||_t(d.x,"transcodingUser[".concat(l,"].x"),0,1e4),xt(d.y)||_t(d.y,"transcodingUser[".concat(l,"].y"),0,1e4),xt(d.width)||_t(d.width,"transcodingUser[".concat(l,"].width"),0,1e4),xt(d.height)||_t(d.height,"transcodingUser[".concat(l,"].height"),0,1e4),xt(d.zOrder)||_t(d.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),xt(d.alpha)||_t(d.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),xt(a.watermark)||Wv(a.watermark,"watermark"),xt(a.backgroundImage)||Wv(a.backgroundImage,"backgroundImage"),a.images&&!xt(a.images)&&(ms(a.images,"config.images"),a.images.forEach((d,l)=>{Wv(d,"images[".concat(l,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(a=>wr(wr(wr({},Gv),a),{},{zOrder:255}))),n.backgroundImage&&(r.push(wr(wr(wr({},Gv),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(wr(wr(wr({},Gv),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(a=>wr({},a)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(a=>typeof a.uid=="number"?de.resolve(a.uid):IL(a.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await de.all(i)).forEach((a,d)=>{n.userConfigs&&n.userConfigs[d]&&(n.userConfigs[d].uid=a)}),this.transcodingConfig=n,this.connection)try{var s;const a=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Lr(s=this.streamingTasks).call(s)).map(d=>d.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(a.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(a){if(!a.data||!a.data.retry)throw a;a.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(d=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),a.toString(),"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,a).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(d.url," success"))}).catch(l=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),d.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,l)})})}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===Ko.TRANSCODE)throw new G(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new G(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(d){throw s(),d}switch(n){case Ko.TRANSCODE:i.transcodingConfig=wr({},this.transcodingConfig);case Ko.RAW:}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const a=this.lastTaskId++;try{const d=new de((u,p)=>{yn(this.retryTimeout).then(()=>{if(r)return p(r);const _=this.statusError.get(t);return _?(this.statusError.delete(t),p(_)):void 0})}),l=await de.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===Ko.TRANSCODE?1:2,requestByUser:!r,tid:a.toString()}),d]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:a}),s()}catch(d){if(s(),this.isStartingStreamingTask=!1,!d.data||!d.data.retry||r)throw d;return d.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,d)):await this.startLiveStreamingTask(t,n,d)}}stopLiveStreamingTask(t){return new de((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new G(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===Ko.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(a=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(a.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;const n=Array.from(Lr(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=pr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new G(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Pn(this,Hv.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new UJ(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ia.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(ia.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(ia.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new G(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));Pn(this,Hv.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case on.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case on.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case on.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case on.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const a=new G(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return T.error(a.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,a);if(!this.isStartingStreamingTask)return;this.statusError.set(n,a)}case on.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const a=new G(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,a)}case on.LIVE_STREAM_RESPONSE_WORKER_LOST:case on.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const a=Array.from(Lr(s=this.streamingTasks).call(s));for(const d of a)d.abortTask?d.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,new G(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),d.url)}).catch(l=>{T.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,l)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const VJ={name:"LiveStreaming",create:function(e){return new xJ(e.joinInfo,e.websocketRetryConfig||Qt,e.httpRetryConfig||Qt)}};function FJ(e){let t=iU();return function(n,r){let i=n.appId;i!==void 0&&(ut(r,10),$o(r,i));let s=n.cid;s!==void 0&&(ut(r,16),ut(r,s));let a=n.cname;a!==void 0&&(ut(r,26),$o(r,a));let d=n.deviceId;d!==void 0&&(ut(r,34),$o(r,d));let l=n.elapse;l!==void 0&&(ut(r,40),Ta(r,l));let u=n.fileSize;u!==void 0&&(ut(r,48),Ta(r,dl(u)));let p=n.height;p!==void 0&&(ut(r,56),Ta(r,dl(p)));let _=n.jpg;_!==void 0&&(ut(r,66),ut(r,_.length),function(Gn,Q){let ie=ll(Gn,Q.length);Gn.bytes.set(Q,ie)}(r,_));let m=n.networkType;m!==void 0&&(ut(r,72),Ta(r,dl(m)));let E=n.osType;E!==void 0&&(ut(r,80),Ta(r,dl(E)));let C=n.requestId;C!==void 0&&(ut(r,90),$o(r,C));let R=n.sdkVersion;R!==void 0&&(ut(r,98),$o(r,R));let y=n.sequence;y!==void 0&&(ut(r,104),Ta(r,dl(y)));let b=n.sid;b!==void 0&&(ut(r,114),$o(r,b));let A=n.timestamp;A!==void 0&&(ut(r,120),Ta(r,A));let D=n.uid;D!==void 0&&(ut(r,128),ut(r,D));let V=n.vid;V!==void 0&&(ut(r,136),ut(r,V));let x=n.width;x!==void 0&&(ut(r,144),Ta(r,dl(x)));let k=n.service;k!==void 0&&(ut(r,152),ut(r,k));let B=n.callbackData;B!==void 0&&(ut(r,162),$o(r,B));let q=n.jpgEncryption;q!==void 0&&(ut(r,168),ut(r,q));let Z=n.requestType;Z!==void 0&&(ut(r,176),ut(r,Z));let te=n.scorePorn;te!==void 0&&(ut(r,185),ZR(r,te));let Fe=n.scoreSexy;Fe!==void 0&&(ut(r,193),ZR(r,Fe));let Ge=n.scoreNeutral;Ge!==void 0&&(ut(r,201),ZR(r,Ge));let Oe=n.scene;Oe!==void 0&&(ut(r,208),ut(r,Oe));let it=n.ossFilePrefix;it!==void 0&&(ut(r,218),$o(r,it));let nt=n.serviceVendor;if(nt!==void 0)for(let Gn of nt){ut(r,226);let Q=iU();GJ(Gn,Q),ut(r,Q.limit),zJ(r,Q),KJ(Q)}}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function BJ(e){return function(n){let r={};e:for(;!oU(n);){let i=es(n);switch(i>>>3){case 0:break e;case 1:r.code=es(n);break;case 2:r.msg=sU(n,es(n));break;case 3:{let s=WJ(n);r.data=jJ(n),n.limit=s;break}default:nU(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function jJ(e){let t={};e:for(;!oU(e);){let n=es(e);switch(n>>>3){case 0:break e;case 1:t.requestId=sU(e,es(e));break;case 2:t.requestType=es(e)>>>0;break;case 3:t.scorePorn=QR(e);break;case 4:t.scoreSexy=QR(e);break;case 5:t.scoreNeutral=QR(e);break;case 6:t.requestScene=es(e)>>>0;break;case 7:t.scene=es(e)>>>0;break;default:nU(e,7&n)}}return t}function GJ(e,t){let n=e.service;n!==void 0&&(ut(t,8),ut(t,n));let r=e.vendor;r!==void 0&&(ut(t,16),ut(t,r));let i=e.token;i!==void 0&&(ut(t,26),$o(t,i));let s=e.callbackUrl;s!==void 0&&(ut(t,34),$o(t,s))}function WJ(e){let t=es(e),n=e.limit;return e.limit=e.offset+t,n}function nU(e,t){switch(t){case 0:for(;128&aU(e););break;case 2:XR(e,es(e));break;case 5:XR(e,4);break;case 1:XR(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let HJ=new Float32Array(1);new Uint8Array(HJ.buffer);let qR=new Float64Array(1),Ar=new Uint8Array(qR.buffer);function dl(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let rU=[];function iU(){const e=rU.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function KJ(e){rU.push(e)}function XR(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function oU(e){return e.offset>=e.limit}function ll(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let a=new Uint8Array(2*s);a.set(n),e.bytes=a}return e.offset=s,s>i&&(e.limit=s),r}function JR(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function sU(e,t){let n=JR(e,t),r=String.fromCharCode,i=e.bytes,s="",a="";for(let d=0;d<t;d++){let l,u,p,_,m=i[d+n];128&m?(224&m)==192?d+1>=t?a+=s:(l=i[d+n+1],(192&l)!=128?a+=s:(_=(31&m)<<6|63&l,_<128?a+=s:(a+=r(_),d++))):(240&m)==224?d+2>=t?a+=s:(l=i[d+n+1],u=i[d+n+2],(49344&(l|u<<8))!=32896?a+=s:(_=(15&m)<<12|(63&l)<<6|63&u,_<2048||_>=55296&&_<=57343?a+=s:(a+=r(_),d+=2))):(248&m)==240?d+3>=t?a+=s:(l=i[d+n+1],u=i[d+n+2],p=i[d+n+3],(12632256&(l|u<<8|p<<16))!=8421504?a+=s:(_=(7&m)<<18|(63&l)<<12|(63&u)<<6|63&p,_<65536||_>1114111?a+=s:(_-=65536,a+=r(55296+(_>>10),56320+(1023&_)),d+=3))):a+=s:a+=r(m)}return a}function $o(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),r+=d<128?1:d<2048?2:d<65536?3:4}ut(e,r);let i=ll(e,r),s=e.bytes;for(let a=0;a<n;a++){let d=t.charCodeAt(a);d>=55296&&d<=56319&&a+1<n&&(d=(d<<10)+t.charCodeAt(++a)-56613888),d<128?s[i++]=d:(d<2048?s[i++]=d>>6&31|192:(d<65536?s[i++]=d>>12&15|224:(s[i++]=d>>18&7|240,s[i++]=d>>12&63|128),s[i++]=d>>6&63|128),s[i++]=63&d|128)}}function zJ(e,t){let n=ll(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,a=t.limit;s<a;s++)r[s+n]=i[s]}function aU(e){return e.bytes[JR(e,1)]}function cU(e,t){let n=ll(e,1);e.bytes[n]=t}function QR(e){let t=JR(e,8),n=e.bytes;return Ar[0]=n[t++],Ar[1]=n[t++],Ar[2]=n[t++],Ar[3]=n[t++],Ar[4]=n[t++],Ar[5]=n[t++],Ar[6]=n[t++],Ar[7]=n[t++],qR[0]}function ZR(e,t){let n=ll(e,8),r=e.bytes;qR[0]=t,r[n++]=Ar[0],r[n++]=Ar[1],r[n++]=Ar[2],r[n++]=Ar[3],r[n++]=Ar[4],r[n++]=Ar[5],r[n++]=Ar[6],r[n++]=Ar[7]}function es(e){let t,n=0,r=0;do t=aU(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function ut(e,t){for(t>>>=0;t>=128;)cU(e,127&t|128),t>>>=7;cU(e,t)}function Ta(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=ll(e,s),d=e.bytes;switch(s){case 10:d[a+9]=i>>>7&1;case 9:d[a+8]=s!==9?128|i:127&i;case 8:d[a+7]=s!==8?r>>>21|128:r>>>21&127;case 7:d[a+6]=s!==7?r>>>14|128:r>>>14&127;case 6:d[a+5]=s!==6?r>>>7|128:r>>>7&127;case 5:d[a+4]=s!==5?128|r:127&r;case 4:d[a+3]=s!==4?n>>>21|128:n>>>21&127;case 3:d[a+2]=s!==3?n>>>14|128:n>>>14&127;case 2:d[a+1]=s!==2?n>>>7|128:n>>>7&127;case 1:d[a]=s!==1?128|n:127&n}}function dU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const YJ=new Map([["moderation",1],["supervise",2]]);class qJ extends Lt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(En.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Di(n=t.map(r=>YJ.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),w(this,"name","AgoraRTCVideoContentInspect"),w(this,"_connectionState",Wi.CONNECTING),w(this,"_innerConnectionState",void 0),w(this,"sequence",0),w(this,"inspectStartTime",void 0),w(this,"workerManagerConnection",void 0),w(this,"workerConnection",void 0),w(this,"workerMessageLengthLimit",void 0),w(this,"inspectIntervalMinimum",void 0),w(this,"qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",pr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"wmSequence",0),w(this,"inspectInterval",void 0),w(this,"inspectTimer",null),w(this,"ossFilePrefix",void 0),w(this,"extraInfo",void 0),w(this,"_inspectType",void 0),w(this,"_inspectMode",void 0),w(this,"_quality",1),w(this,"qualityTimer",null),w(this,"_inspectId",void 0),w(this,"_needWorkUrlOnly",!1),w(this,"inspectImage",()=>{if(this.connectionState!==Wi.CONNECTED)throw new G(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Wi.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=St(5,"inspect-"),this.workerMessageLengthLimit=N("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=N("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=N("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ju("worker-manager-"+this._inspectId,Qt),this.on(En.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Hi[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ju("worker-"+this._inspectId,Qt),this.handleWorkerEvents()}async init(t,n){this.emit(En.STATE_CHANGE,Hi.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new de((i,s)=>{this.on(En.CONNECTION_STATE_CHANGE,(a,d)=>{d===Wi.CONNECTED&&i()}),this.requestAP(t,r,n).then(a=>{this.connectWorkerManager(a)}).catch(a=>{s(a)})})}async requestAP(t,n,r){const i=N("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await function(d,l,u,p){let{appId:_,areaCode:m,cname:E,sid:C,token:R,uid:y}=l;Qd++;const b="image_moderation_api",A={service_name:b,json_body:JSON.stringify({appId:_,areaCode:m,cname:E,command:"allocateEdge",requestId:Qd,seq:Qd,sid:C,token:R,ts:Date.now(),uid:y+""})};let D,V,x=d[0];return fo(async()=>{D=Date.now();const k=await So(x,{data:A,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(V=Date.now()-D,k.code!==0){const te=new G(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+k.code,{retry:!0,responseTime:V});throw T.error(te.toString()),te}const B=JSON.parse(k.json_body);if(B.code!==200){const te=new G(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(B.code,", reason: ").concat(B.reason),{code:B.code,responseTime:V});throw T.error(te.toString()),te}if(!B.servers||!Array.isArray(B.servers)||B.servers.length===0){const te=new G(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:B.code,responseTime:V});throw T.error(te.toString()),te}const q=N("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Z=N("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:B.servers.map(te=>{let{address:Fe,wss:Ge}=te;if(Fe&&Ge)return"wss://".concat(Fe.replace(/\./g,"-"),".").concat(q,":").concat(Z||Ge)}).filter(te=>!!te),workerToken:B.workerToken,vid:B.vid,responseTime:V}},(k,B)=>(Se.apworkerEvent(C,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(k.addressList),firstSuccess:B===0,responseTime:V,serverIp:d[B%d.length]}),!1),(k,B)=>(Se.apworkerEvent(C,{success:!1,sc:k.data&&k.data.code||200,serviceName:b,responseTime:V,serverIp:d[B%d.length]}),!!(k.code!==O.OPERATION_ABORTED&&k.code!==O.UNEXPECTED_RESPONSE||k.data&&k.data.retry)&&(x=d[(B+1)%d.length],!0)),p)}(i,t,n,r);this.emit(En.STATE_CHANGE,Hi.AP_CONNECTED);const{addressList:a}=s;return this.wmSequence++,a}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(En.STATE_CHANGE,Hi.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ue.CONNECTED,async()=>{this.emit(En.STATE_CHANGE,Hi.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ue.CLOSED,()=>{this._innerConnectionState<Hi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ue.FAILED,()=>{this._innerConnectionState<Hi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ue.RECONNECTING,()=>{this._innerConnectionState<Hi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ue.ON_MESSAGE,async t=>{this.emit(En.STATE_CHANGE,Hi.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new G(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new G(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=N("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(En.STATE_CHANGE,Hi.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(En.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(Ue.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(Ue.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Ue.CONNECTED,async()=>{this.emit(En.STATE_CHANGE,Hi.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Wi.CONNECTED}),this.workerConnection.on(Ue.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=BJ(new Uint8Array(t.data));if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(En.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Di(n=Object.keys(i)).call(n,(d,l)=>i[d]>i[l]?d:l,"porn"),a=Object.keys(i).find(d=>d===s);this.emit(En.INSPECT_RESULT,a)}else this.emit(En.INSPECT_RESULT,void 0,new G(O.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(En.INSPECT_RESULT,void 0,new G(O.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(En.INSPECT_RESULT,void 0,new G(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ue.CLOSED,()=>{this.connectionState=Wi.CLOSED}),this.workerConnection.on(Ue.FAILED,()=>{this.connectionState=Wi.CLOSED}),this.workerConnection.on(Ue.RECONNECTING,()=>{this.connectionState=this.connectionState===Wi.CONNECTED?Wi.RECONNECTING:Wi.CONNECTING}),this.workerConnection.on(Ue.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(Ue.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(En.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const t=Yr(this,En.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(En.INSPECT_RESULT,void 0,new G(O.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(En.INSPECT_RESULT,void 0,new G(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l}=n;const u=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await GP(p,r,i),m=this.sequence+"-"+s+"-"+l+"-"+u+"-"+St(12,""),E={appId:r,cid:s,cname:i,deviceId:"",elapse:(C=Number(u-this.inspectStartTime),{low:C|=0,high:C>>31,unsigned:C>=0}),fileSize:_.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:m,sdkVersion:"4.24.0",sequence:this.sequence,sid:d,timestamp:EM(u),uid:l,vid:a,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var C;this.extraInfo===void 0&&delete E.callbackData,this.ossFilePrefix===void 0&&delete E.ossFilePrefix;const R=FJ(E);if(R.byteLength<this.workerMessageLengthLimit){if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const y=function(b){for(var A=1;A<arguments.length;A++){var D=arguments[A]!=null?arguments[A]:{};A%2?dU(Object(D),!0).forEach(function(V){w(b,V,D[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(D)):dU(Object(D)).forEach(function(V){Object.defineProperty(b,V,Object.getOwnPropertyDescriptor(D,V))})}return b}({},E);delete y.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(y))}return R}{const y=this.quality*this.qualityRatio;return this.quality=y,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:a,sid:d,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Wi.CLOSED,this.emit(En.STATE_CHANGE,Hi.CLOSED)}}const XJ={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new G(O.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new G(O.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var s;if(!oe(s=["supervise","moderation"]).call(s,i))throw new G(O.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new G(O.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new qJ(t)}};var lU=g(di.Object.getOwnPropertySymbols),JJ=lt,QJ=ng.indexOf,ZJ=Tp,$R=ge([].indexOf),uU=!!$R&&1/$R([1],1,-0)<0;JJ({target:"Array",proto:!0,forced:uU||!ZJ("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return uU?$R(this,e,t)||0:QJ(this,e,t)}});var $J=Ni("Array","indexOf"),eQ=J,tQ=$J,ey=Array.prototype,nQ=function(e){var t=e.indexOf;return e===ey||eQ(ey,e)&&t===ey.indexOf?tQ:t},hU=g(nQ);function rQ(e,t){if(e==null)return{};var n,r,i=function(a,d){if(a==null)return{};var l={};for(var u in a)if({}.hasOwnProperty.call(a,u)){if(hU(d).call(d,u)!==-1)continue;l[u]=a[u]}return l}(e,t);if(lU){var s=lU(e);for(r=0;r<s.length;r++)n=s[r],hU(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let pU=class{get localCapabilities(){return Pt(this._localCapabilities)}get rtpCapabilities(){return Pt(this._rtpCapabilities)}get candidates(){return Pt(this._candidates)}get iceParameters(){return Pt(this._iceParameters)}get dtlsParameters(){return Pt(this._dtlsParameters)}constructor(e){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname","o/i14u9pJrxRKAsu"),w(this,"firefoxSsrcMidMap",new Map),e=Pt(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:a,setup:d,videoCodec:l,audioCodec:u}=e;let p;this.setup=d,p=a===sr.RECEIVE_ONLY?yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const _=a===sr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,m=a===sr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,E=a===sr.RECEIVE_ONLY?i.send.videoCodecs:Ku(he.VIDEO,_,m,l),C=a===sr.RECEIVE_ONLY?i.send.audioCodecs:Ku(he.AUDIO,_,m,u);for(const R of p.mediaDescriptions)R.attributes.iceUfrag=t.iceUfrag,R.attributes.icePwd=t.icePwd,R.attributes.fingerprints=n.fingerprints,R.attributes.candidates=r,R.attributes.setup=this.setup,R.media.mediaType==="application"&&(R.attributes.sctpPort="5000"),R.media.mediaType==="video"&&(R.media.fmts=E.map(y=>y.payloadType.toString(10)),R.attributes.payloads=E,R.attributes.extmaps=_.videoExtensions),R.media.mediaType==="audio"&&(R.media.fmts=C.map(y=>y.payloadType.toString(10)),R.attributes.payloads=C,R.attributes.extmaps=_.audioExtensions,Jd(R));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return na(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:a}=Hu(t,this.cname,N("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(s);if(d){if(Ut()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,d.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(d,i),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(e,s,r);let u;return l===-1?(u=this.createOrRecycleSendMedia(e,s,a,"sendonly",r,i),this.updateBundleMids()):(u=Pt(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="sendonly",u.attributes.ssrcs=s,u.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(u,i)),Ut()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,u.attributes.mid),{needExchangeSDP:!0,mid:u.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(i=>{const s=i._mediaStreamTrack.kind,a=this.findAvailableRecvMediaIndex(s);let d,l=!1;a===-1?(l=!0,d=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(d=Pt(this.sessionDesc.mediaDescriptions[a]),d.attributes.direction="recvonly"),r.push({mid:d.attributes.mid,needCreateTransceiver:l})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:a,relatedPort:d,priority:l}=new RTCIceCandidate(e),u={foundation:t??"",componentId:"1",transport:n??"",priority:l?l+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:a??"",relPort:d?d+"":"",extension:{}};this.candidates.some(p=>p.priority===u.priority&&p.connectionAddress===u.connectionAddress&&p.port===u.port)||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,d=Ku(s,a,this.localCapabilities.send,s===he.AUDIO?i:r),l=s===he.VIDEO?a.videoExtensions:a.audioExtensions,u="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};p=this.mungRecvMediaDsec(p,e);const _=this.findFirstClosedMedia(s);if(_){const m=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[m]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>oe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>oe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Ut()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Pt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,s){const a=this.rtpCapabilities.send,d=e===he.VIDEO?a.videoCodecs:a.audioCodecs,l=e===he.VIDEO?a.videoExtensions:a.audioExtensions;Ut()&&(i="".concat(++this.currentMidIndex));let u={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,s);const p=this.findFirstClosedMedia(e);if(p){const _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(e,t,n){const r=Pt(e);return Jv(r),Xd(r,t),Qv(r,t),oL(r),O_(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Pt(e);return O_(n,t,this.localCapabilities.recv),Jd(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Ut()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const iQ=["sdp"];var It;function fU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function va(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fU(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let _U=(It=class pl extends j1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),w(this,"direction",void 0),w(this,"name",void 0),w(this,"store",void 0),w(this,"spec",void 0),w(this,"peerConnection",void 0),w(this,"initialOffer",void 0),w(this,"transport",void 0),w(this,"statsFilter",void 0),w(this,"localCandidateCount",0),w(this,"_isInRestartIce",!1),w(this,"mutex",void 0),w(this,"onLocalCandidate",void 0),w(this,"remoteSDP",void 0),w(this,"pendingCandidates",[]),w(this,"localCapabilities",void 0),w(this,"isReady",!1),w(this,"restartCnt",0),w(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new xn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(pl.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??sr.SEND_ONLY,this.name=this.direction===sr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=ov(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,Ut()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await aL();if(this.localCapabilities=N_(n),t){const{sdp:r}=t,i=rQ(t,iQ),s=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=Wu(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ki(_,p,"videoExtensions",m,E,C),Ki(_,p,"videoCodecs",m,E,C),Ki(_,p,"audioExtensions",m,E,C),Ki(_,p,"audioCodecs",m,E,C),N("RAISE_H264_BASELINE_PRIORITY")){const R=C.videoCodecs.findIndex(y=>y.rtpMap&&y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&y.fmtp&&y.fmtp.parameters["profile-level-id"]==="42001f");if(R!==-1){const y=C.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(y<R){T.debug("raising H264 baseline profile priority");const b=C.videoCodecs[R];C.videoCodecs.splice(R,1),C.videoCodecs.splice(y,0,b)}y!==-1&&N("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:m,recv:E,sendrecv:C}}({},{},r);this.remoteSDP=new pU({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const a=await this.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const d=ca(a.sdp);await this.peerConnection.setLocalDescription(a);const l=await cL({},{},a.sdp);this.localCapabilities=N_(l);const u=this.peerConnection.getTransceivers()[0];return u!=null&&u.receiver&&u.receiver.transport&&this.tryBindTransportEvents(u.receiver.transport),va(va({},d),{},{sdp:a.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ca(r.sdp);return this.initialOffer=r,va(va({},i),{},{sdp:r.sdp})}}catch(n){throw new Y(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,s=await cL({},{},n);this.remoteSDP=new pU({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const a=this.peerConnection.getTransceivers()[0];a!=null&&a.sender&&a.sender.transport&&this.tryBindTransportEvents(a.sender.transport)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new Y(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return ui(function*(){const s=yield Qe(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=[],d=i.remoteSDP.receive(t,n,r);t.forEach((y,b)=>{if(d[b].needCreateTransceiver){const A=i.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});a.push(A),y._updateRtpTransceiver(A)}else{const A=i.peerConnection.getTransceivers().find(D=>D.mid===d[b].mid);if(!A)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(d[b].mid));a.push(A),y._updateRtpTransceiver(A)}}),Ut()&&N("SIMULCAST")===!0&&(yield Qe(i.applySimulcastForFirefox(a,t)));const l=d.map(y=>y.mid),u=yield Qe(i.peerConnection.createOffer()),p=i.mungSendOfferSDP(u.sdp,t,l),_=yr(p),m=l.map(y=>{const b=_.mediaDescriptions.find(A=>A.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return nL(b,N("USE_PUB_RTX"))}),E=a.map((y,b)=>{const A=l[b];return{localSSRC:m[b],id:A}});yield Qe(i.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield E}catch(y){const b=i.remoteSDP.toString();throw yield Qe(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Qe(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Qe(i.stopSending(l,!0)),y}yield Qe(i.applySimulcastEncodings(a,t)),yield Qe(i.applySendEncodings(a,t));const C=i.remoteSDP.toString(),R=i.logSDPExchange(p,"offer","local","send");return R==null||R(C),yield Qe(i.setRemoteDescription({type:"answer",sdp:C})),a.map((y,b)=>{const A=l[b];return{localSSRC:m[b],id:A}})}catch(a){throw a instanceof Y?a:new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{s()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(l=>{var u;l.direction="inactive",(u=l.stop)===null||u===void 0||u.call(l)});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();a==null||a(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=this.remoteSDP.send(t,n,r,i);if(a){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,s,t);u==null||u(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const d=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!d||d.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,mid:d.mid,transceiver:d}}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=this.remoteSDP.send(t,n,r,i);if(a){const d=this.remoteSDP.toString(),l=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const u=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(u.sdp,s,t);l==null||l(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===dc.Auto&&(this.store.p2pTransport=dc.SdRtn,Ze().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pl.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ze().supportPCSetConfiguration&&this.peerConnection.setConfiguration(pl.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=ca(n.sdp);return this.store.descriptionStart(),this.direction===sr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===sr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=ca(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),a=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new Y(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Ut()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:va(va({},jo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:va(va({},jo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;oe(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(bu(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...pl.turnServerConfigToIceServers(t.turnServer.servers,n,r)),N("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...pl.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),oe(s=[dc.Relay,dc.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),N("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(i.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&Ze().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter(d=>d.tcpport);T.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const a=s.length>r?s[r]:s[0];switch(n){case dc.SdRtn:const d=t.filter(u=>{var p;return oe(p=u.username).call(p,"glb:")&&u.turnServerURL==u.turnServerURL}),l=d.length>r?d[r]:d[0];l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(sa(l.turnServerURL),":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(sa(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;case dc.Relay:a&&(i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(sa(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(sa(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),i.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){const s=r.address+":"+r.port,a=i.address+":"+i.port;T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ec(s)),", remote ").concat(JSON.stringify(Ec(a))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ze().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var a;const{bitrateMax:p,frameRate:_,scaleResolutionDownBy:m}=t._encoderConfig;p&&(s.maxBitrate=1e3*p),oe(a=t._hints).call(a,mt.LOW_STREAM)&&(_&&(s.maxFramerate=Vr(_)),m&&m>=1&&(s.scaleResolutionDownBy=m))}if(N("DSCP_TYPE")&&_s()){var d;const p=N("DSCP_TYPE");oe(d=["very-low","low","medium","high"]).call(d,p)&&(s.networkPriority=p)}const l=n.getParameters(),u=(r=l.encodings)===null||r===void 0?void 0:r[0];Ut()&&!u&&(i.encodings=[s]),u&&Object.assign(u,s),Object.assign(l,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof Ct&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=yr(t);return n.forEach((s,a)=>{const d=r[a],l=i.mediaDescriptions.find(u=>u.attributes.mid===d);l&&(Xd(l,s),sL(l,s,this.store.codec))}),na(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,a,d;const u=t[l],p=n[l];if(p instanceof Ct&&!oe(r=p._hints).call(r,mt.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=p._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=p._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const E=u.sender.getParameters();await u.sender.setParameters(Object.assign(E,_))}}}async applySimulcastEncodings(t,n){if(!Ut()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof Ct&&this.isVP8Simulcast(i)){const s=t[r],a={},d={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,a))}}}isVP8Simulcast(t){var n,r,i,s,a;return!!(t instanceof Ct&&N("SIMULCAST")&&this.store.codec==="vp8"&&!oe(n=t._hints).call(n,mt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((a=t._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(N("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(a=>{a.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(a=>a.mid&&t.indexOf(a.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async a=>{a.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const s=(i=yr(n).mediaDescriptions.find(a=>a.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return s==null?void 0:s[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),oe(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=yr(t),s=i.mediaDescriptions.find(a=>a.attributes.mid===n);return s&&r===he.AUDIO&&s.media.mediaType==="audio"&&Jd(s),na(i)}},me(It.prototype,"establish",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"establish"),It.prototype),me(It.prototype,"connect",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),me(It.prototype,"receive",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"receive"),It.prototype),me(It.prototype,"mockReceive",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"mockReceive"),It.prototype),me(It.prototype,"stopReceiving",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"stopReceiving"),It.prototype),me(It.prototype,"restartICE",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"restartICE"),It.prototype),me(It.prototype,"close",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),me(It.prototype,"updateEncoderConfig",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"updateEncoderConfig"),It.prototype),me(It.prototype,"updateSendParameters",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"updateSendParameters"),It.prototype),me(It.prototype,"replaceTrack",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),me(It.prototype,"muteLocal",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"muteLocal"),It.prototype),me(It.prototype,"unmuteLocal",[Ji],Object.getOwnPropertyDescriptor(It.prototype,"unmuteLocal"),It.prototype),It);function Ji(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}let Ro=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var mU,EU,gU,SU,TU,vU,RU,yU,CU,IU,wU,kt;function AU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function lm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AU(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let oQ=(mU=yo(Ro.SEND_ONLY),EU=yo(Ro.SEND_ONLY),gU=yo(),SU=yo(Ro.RECEIVE_ONLY),TU=yo(Ro.RECEIVE_ONLY),vU=yo(Ro.RECEIVE_ONLY),RU=yo(Ro.RECEIVE_ONLY),yU=yo(Ro.RECEIVE_ONLY),CU=yo(Ro.RECEIVE_ONLY),IU=yo(),wU=yo(Ro.RECEIVE_ONLY),kt=class extends Lt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Te.StateChange,t,this._state)}constructor(e,t){super(),w(this,"isPlanB",!1),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"sendConnection",void 0),w(this,"recvConnection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"statsCollector",void 0),w(this,"dtlsFailedCount",0),w(this,"sendMutex",void 0),w(this,"recvMutex",void 0),w(this,"_state",st.Disconnected),w(this,"_restartStates",["disconnected","failed"]),w(this,"reconnectInterval",void 0),w(this,"uploadUnplinkStarted",!1),w(this,"uploadDownlinkStarted",!1),w(this,"uplinkStateUploadInterval",void 0),w(this,"downlinkStatsUploadInterval",void 0),w(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==st.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void r();const u=l.find(E=>E[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(l.map(E=>{let[,{id:C}]=E;return C}));let p=!1;var a,d;n.trackMediaType==="video"?p=!((a=this.localTrackMap.get(ee.LocalAudioTrack))===null||a===void 0||!a.track._muted):p=((d=this.localTrackMap.get(ee.LocalVideoTrack))===null||d===void 0?void 0:d.id)===void 0;const _=this.createMuteMessage(l);await gt(this,Te.RequestMuteLocal,_);const m=n.trackMediaType==="video"?oa.MUTE_LOCAL_VIDEO:oa.MUTE_LOCAL_AUDIO;await gt(this,Te.RequestP2PMuteLocal,{action:m,message:_,isMuteAll:p}),r()}catch(l){i(l)}finally{s()}}),w(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==st.Connected)return void i(new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const a=this.filterTobeUnmutedTracks(n);if(a.length===0)return void r();await this.sendConnection.unmuteLocal(a.map(u=>{let[,{id:p}]=u;return p}));const d=this.createUnmuteMessage(a),l=n.trackMediaType==="video"?oa.UNMUTE_LOCAL_VIDEO:oa.UNMUTE_LOCAL_AUDIO;await gt(this,Te.RequestP2PMuteLocal,{action:l,message:d}),r()}catch(a){i(a)}finally{s()}}),w(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let a;typeof s=="boolean"&&s||(a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(ee.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==st.Connected)return void r();const{id:u,track:p}=l;u&&(await this.sendConnection.updateSendParameters(u,p),await this.sendConnection.updateEncoderConfig(u,p),this.emit(Te.UpdateVideoEncoder,p)),r()}catch(l){i(l)}finally{var d;(d=a)===null||d===void 0||d()}}),w(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const a=this.localTrackMap.get(ee.LocalVideoTrack);if(!this.sendConnection||!a||a.track!==n||this.state!==st.Connected)return void r();const{id:d,track:l}=a;d&&await this.sendConnection.updateSendParameters(d,l),r()}catch(a){i(a)}finally{s()}}),w(this,"handleReplaceTrack",async(n,r,i,s)=>{let a;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(a=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var d;const u=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.sendConnection||!u||u[1].id===void 0||this.state!==st.Connected)return void r();if(await((d=this.sendConnection)===null||d===void 0?void 0:d.replaceTrack(n,u[1].id)),u[0]===ee.LocalVideoTrack&&Ze().supportDualStreamEncoding){const p=this.localTrackMap.get(ee.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new de((m,E)=>{this.handleReplaceTrack(p.track,m,E,!0)})}}r()}catch(u){i(u)}finally{var l;(l=a)===null||l===void 0||l()}}),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new WL(e),this.bindStatsUploaderEvents(),this.sendMutex=new xn("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new xn("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},N("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new _U(e,this.store,sr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=st.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new _U(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=st.Connected}async addRemoteCandidate(e,t){if(t===sr.RECEIVE_ONLY){if(!this.sendConnection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Y(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return ui(function*(){const i=yield Qe(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==st.Connected){r.throwIfTrackTypeNotMatch(e);const u=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(u))}r.store.pubId=r.store.pubId+1,jn.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield Qe(r.tryToUnmuteAudio(e)));s.forEach(u=>{let{track:p,type:_}=u;const m=Date.now();r.store.publish(p.getTrackId(),_===ee.LocalAudioTrack?"audio":"video",m)}),r.bindLocalTrackEvents(s);const a=yield Qe(r.sendConnection.send(s.map(u=>{let{track:p}=u;return p}),r.store.codec,r.store.audioCodec)),d=(yield Qe(a.next())).value,l=r.createGatewayPublishMessage(s,d);try{yield l}catch(u){throw a.throw(u),(u==null?void 0:u.code)===O.WS_ABORT&&s.forEach(p=>{let{track:_}=p;r.pendingLocalTracks.indexOf(_)===-1&&r.pendingLocalTracks.push(_)}),r.unbindLocalTrackEvents(s),u}yield Qe(a.next()),s.forEach(u=>{let{type:p}=u;r.statsCollector.addLocalStats(p)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,d),s.forEach(u=>{let{track:p,type:_}=u;const m=Date.now();r.store.publish(p.getTrackId(),_===ee.LocalAudioTrack?"audio":"video",void 0,m)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==st.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!oe(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:a}]=i;return{type:s,track:a}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===st.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s,ssrcs:a}]=r;const d={stream_type:$q(s,i),ssrcs:a};s._muted||!s._enabled?t.push(d):n.push(d)}),t.length>0&&t.forEach(r=>{gt(this,Te.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{gt(this,Te.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ui(function*(){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Pn(this,Te.RequestRePublish,this.pendingLocalTracks),this.emit(Te.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:a,transceiver:d}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===he.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new jd(s,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Bd(s,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u=this.pendingRemoteTracks.findIndex(p=>{let{user:_,kind:m}=p;return _.uid===e.uid&&t===m});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit(Te.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new Y(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:a,kind:d}=s;return t!==void 0?a.uid===e.uid&&t===d:a.uid===e.uid});if(r.forEach(s=>{const a=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(a,1)}),this.recvConnection||n||r.forEach(s=>{let{kind:a}=s;var d;if(a===he.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(a===he.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:a}]=s;return a})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[a,{kind:d}]=s;var l,u;if(d===he.VIDEO&&a._videoSSRC&&((l=this.recvConnection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),d===he.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),n||((u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0);else if(d===he.AUDIO){var p;this.unbindRemoteTrackEvents(a._audioTrack),!n&&((p=a._audioTrack)===null||p===void 0||p._destroy(),a._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:a}]=s;gt(this,Te.RequestP2PMuteRemote,a)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[he.VIDEO,he.AUDIO].forEach(r=>{n.has(r)?gt(this,Te.RequestP2PUnmuteRemote,r):gt(this,Te.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Y(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===he.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ee.LocalAudioTrack);if((t==null?void 0:t.track)instanceof rn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==ee.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===ee.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ee.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){const a=this.localTrackMap.get(ee.LocalAudioTrack),d=r?this.localTrackMap.get(ee.LocalVideoLowTrack):this.localTrackMap.get(ee.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:jn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(mt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const a=n.find(l=>l instanceof Gt),d=r?(s=this.localTrackMap.get(ee.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof Ct);Se.publish(this.store.sessionId,{eventElapse:jn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:a==null?void 0:a.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(mt.SCREEN_TRACK))!==-1,audio:!!a,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===he.VIDEO?n._videoSSRC:n._audioSSRC;i&&Se.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===he.VIDEO,audio:r===he.AUDIO,peerid:n.uid,subscribeRequestid:r===he.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:jn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new xn("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new xn("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ee.LocalAudioTrack);if((e==null?void 0:e.track)instanceof rn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=st.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ee.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ee.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ct||t&&t.track instanceof Gt?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Cr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ee.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Qa(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=st.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case ee.LocalVideoTrack:oe(t=r._hints).call(t,mt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case ee.LocalAudioTrack:r instanceof rn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case ee.LocalVideoLowTrack:}}),this.emit(Te.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Cr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Te.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof ha?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===sr.SEND_ONLY){if(!this.sendConnection)throw new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new Y(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await Pn(this,Te.RequestP2PRestartICE,{direction:sr.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ee.LocalVideoTrack),n=this.localTrackMap.get(ee.LocalAudioTrack),r=e.videoSend.find(E=>{var C;return E.ssrc===(t==null||(C=t.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)}),i=e.audioSend.find(E=>{var C;return E.ssrc===(n==null||(C=n.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)});if(!r||!i)return 1;const s=Yr(this,Te.NeedSignalRTT),a=r?r.rttMs:void 0,d=i?i.rttMs:void 0,l=a&&d?(a+d)/2:a||d,u=(l&&s?(l+s)/2:l||s)||0,p=100*e.sendPacketLossRate*.7/50+.3*u/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=t==null?void 0:t.track;if(m&&m._encoderConfig&&m._hints.indexOf(mt.SCREEN_TRACK)===-1){const E=m._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(E&&C){const R=(1e3*E-C)/(1e3*E);return k1[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,a=e.audioRecv.find(C=>C.ssrc===i),d=e.videoRecv.find(C=>C.ssrc===s);if(!a&&!d)return void(t+=1);const l=Yr(this,Te.NeedSignalRTT),u=e.rtt,p=(u&&l?(u+l)/2:u||l)||0,_=a?a.jitterMs:void 0,m=e.recvPacketLossRate;let E=.7*m*100/50+.3*p/1500;_&&(E=.6*m*100/50+.2*p/1500+.2*_/400),t+=E<.1?1:E<.17?2:E<.36?3:E<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new de((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=Ze(),s=this.getAllTracks();e=Ad(e=e.filter(l=>s.indexOf(l)===-1));let a=!1,d=!1;for(const l of e){if(l instanceof Ct&&(this.localTrackMap.has(ee.LocalVideoTrack)||a?new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:ee.LocalVideoTrack}),a=!0),t)){const u=this.getLowVideoTrack(l,n);r.push({track:u,type:ee.LocalVideoLowTrack})}if(l instanceof Gt){const u=this.localTrackMap.get(ee.LocalAudioTrack);if(u){if(!(u.track instanceof rn))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u.track.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0)}else if(d){const p=r.find(_=>{let{type:m}=_;return m===ee.LocalAudioTrack});if(!(p.track instanceof rn))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(l)}else{if(!i.webAudioMediaStreamDest||l instanceof rn||l._bypassWebAudio)r.push({track:l,type:ee.LocalAudioTrack});else{const p=new rn;p.addAudioTrack(l),r.push({track:p,type:ee.LocalAudioTrack})}d=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Ad(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Gt){const i=this.localTrackMap.get(ee.LocalAudioTrack);if(!i)continue;i.track instanceof rn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([ee.LocalAudioTrack,i]),i.track.close())):t.push([ee.LocalAudioTrack,i])}if(r instanceof Ct){const i=this.localTrackMap.get(ee.LocalVideoTrack);if(!i)continue;t.push([ee.LocalVideoTrack,i]);const s=this.localTrackMap.get(ee.LocalVideoLowTrack);s&&t.push([ee.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ee.LocalVideoTrack:n.addListener(_e.GET_STATS,this.handleGetLocalVideoStats),n.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(_e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ee.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof rn?e.trackList.forEach(n=>{n.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_e.GET_STATS,this.handleGetLocalAudioStats),n.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(_e.GET_STATS,this.handleGetLocalAudioStats),e.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ee.LocalVideoTrack:n.off(_e.GET_STATS,this.handleGetLocalVideoStats),n.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(_e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(_e.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ee.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ee.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof rn?e.trackList.forEach(t=>{t.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(_e.GET_STATS,this.handleGetLocalAudioStats),t.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(_e.GET_STATS,this.handleGetLocalAudioStats),e.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Bd&&t.addListener(_e.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof jd&&t.addListener(_e.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(_e.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(he.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(he.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,{track:a,type:d}=n;switch(d){case ee.LocalAudioTrack:s=at.Audio;break;case ee.LocalVideoTrack:s=oe(i=a._hints).call(i,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:s=at.Low}return{kind:d===ee.LocalAudioTrack?he.AUDIO:he.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:a.muted||!a.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ee.LocalVideoTrack:r=oe(n=s._hints).call(n,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalAudioTrack:r=at.Audio;break;case ee.LocalVideoLowTrack:r=at.Low}return{stream_type:r,ssrcs:a,mid:d}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Te.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),oe(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await yn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Dt.TRACER}).onSuccess(),this.emit(Te.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Cr(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(fi.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,dn.FIRST_AUDIO_DECODE,Nt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Cr(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Se.firstRemoteFrame(this.store.sessionId,dn.FIRST_AUDIO_RECEIVED,Nt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Cr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&Se.firstRemoteFrame(this.store.sessionId,dn.FIRST_VIDEO_RECEIVED,Nt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Te.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(aa(n))," -> ").concat(JSON.stringify(aa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(aa(n))," -> ").concat(JSON.stringify(aa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Te.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===sr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===sr.SEND_ONLY?this.restartICE(e):Pn(this,Te.RequestP2PRestartICE,{direction:sr.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ee.LocalAudioTrack);if(e instanceof Gt&&(n==null?void 0:n.track)instanceof rn)return n.track.isActive||t.push([ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===ee.LocalVideoTrack)){const i=this.localTrackMap.get(ee.LocalVideoLowTrack);i&&t.push([ee.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ee.LocalAudioTrack);if(e instanceof Gt&&(n==null?void 0:n.track)instanceof rn)return n.track.isActive&&t.push([ee.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===ee.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(ee.LocalVideoLowTrack);i&&t.push([ee.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ee.LocalAudioTrack:r=at.Audio;break;case ee.LocalVideoTrack:r=oe(n=s._hints).call(n,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:r=at.Low}return{stream_type:r,ssrcs:a,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:a,id:d}]=t;switch(i){case ee.LocalAudioTrack:r=at.Audio;break;case ee.LocalVideoTrack:r=oe(n=s._hints).call(n,mt.SCREEN_TRACK)?at.Screen:at.High;break;case ee.LocalVideoLowTrack:r=at.Low}return{stream_type:r,ssrcs:a,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,a]=i;n.push([e,{kind:s,id:a}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case he.VIDEO:return void(r._videoSSRC&&t.push({stream_type:he.VIDEO,ssrcId:r._videoSSRC}));case he.AUDIO:return void(r._audioSSRC&&t.push({stream_type:he.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ee.LocalVideoTrack),n=this.localTrackMap.get(ee.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new de((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new de((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Gt){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await gt(this,Te.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Te.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Te.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yn($T(this.dtlsFailedCount,Qt)),this.emit(Te.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ee.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ct)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ct).length>1)throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Gt).length>1&&(e.some(t=>t instanceof Gt&&t._bypassWebAudio)||!Ze().webAudioMediaStreamDest))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ct&&this.pendingLocalTracks.some(n=>n instanceof Ct))throw new Y(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Gt&&this.pendingLocalTracks.some(n=>n instanceof Gt)&&(!Ze().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Gt&&n._bypassWebAudio)))throw new Y(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ze().supportDualStreamEncoding,r=lm(lm({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():_R(e,r);const s=St(8,"track-low-"),a=new Ct(i,lm(lm({},n&&{scaleResolutionDownBy:Xv(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return a.on(lc.TRANSCEIVER_UPDATED,d=>{e._updateRtpTransceiver(d,Ld.LOW_STREAM)}),a._hints.push(mt.LOW_STREAM),e.addListener(_e.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Cr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const a=this.store.keyMetrics,d=a.subscribe.find(l=>l.userId===s.uid&&l.type==="video");Se.firstRemoteVideoDecode(this.store.sessionId,dn.FIRST_VIDEO_DECODE,Nt.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:jn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:a.requestAPEnd||0,apStart:a.requestAPStart||0,joinGwEnd:a.joinGatewayEnd||0,joinGwStart:a.joinGatewayStart||0,pcEnd:a.peerConnectionEnd||0,pcStart:a.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Y(O.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Y(O.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Y(O.NOT_SUPPORTED)}async preConnect(e){throw new Y(O.NOT_SUPPORTED)}getEstablishParams(){throw new Y(O.NOT_SUPPORTED)}async reSubscribe(e){throw new Y(O.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new Y(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ee.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Ld.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},me(kt.prototype,"p2pConnect",[mU],Object.getOwnPropertyDescriptor(kt.prototype,"p2pConnect"),kt.prototype),me(kt.prototype,"unpublish",[EU],Object.getOwnPropertyDescriptor(kt.prototype,"unpublish"),kt.prototype),me(kt.prototype,"unpublishLowStream",[gU],Object.getOwnPropertyDescriptor(kt.prototype,"unpublishLowStream"),kt.prototype),me(kt.prototype,"subscribe",[SU],Object.getOwnPropertyDescriptor(kt.prototype,"subscribe"),kt.prototype),me(kt.prototype,"mockSubscribe",[TU],Object.getOwnPropertyDescriptor(kt.prototype,"mockSubscribe"),kt.prototype),me(kt.prototype,"unsubscribe",[vU],Object.getOwnPropertyDescriptor(kt.prototype,"unsubscribe"),kt.prototype),me(kt.prototype,"muteRemote",[RU],Object.getOwnPropertyDescriptor(kt.prototype,"muteRemote"),kt.prototype),me(kt.prototype,"unmuteRemote",[yU],Object.getOwnPropertyDescriptor(kt.prototype,"unmuteRemote"),kt.prototype),me(kt.prototype,"hasRemoteMediaWithLock",[CU],Object.getOwnPropertyDescriptor(kt.prototype,"hasRemoteMediaWithLock"),kt.prototype),me(kt.prototype,"disconnectForReconnect",[IU],Object.getOwnPropertyDescriptor(kt.prototype,"disconnectForReconnect"),kt.prototype),me(kt.prototype,"remoteMediaSsrcChanged",[wU],Object.getOwnPropertyDescriptor(kt.prototype,"remoteMediaSsrcChanged"),kt.prototype),kt);function yo(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,a=new Array(s),d=0;d<s;d++)a[d]=arguments[d];switch(e){case Ro.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,a)}finally{l()}}case Ro.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,a)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n)),u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,a)}finally{l(),u()}}}},r}}class bc extends Lt{constructor(t,n){super(),w(this,"signal",void 0),w(this,"token",void 0),w(this,"tokenTimeout",void 0),w(this,"tokenInterval",void 0),w(this,"_sequence",0),w(this,"userMap",new Map),w(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===yt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*N("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,s){var a;if(this.userMap.size===0)return;const d=Array.from(Lr(a=this.userMap).call(a))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??St(6,""),s=s??this._sequence++;const l={_id:i,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(d)};N("SHOW_P2P_LOG")&&T.debug("send message",l,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(l)).forEach(p=>{this.signal.request(Ae.DATA_STREAM,{payload:ta(this.encoder.encode(p))})});const u=new de((p,_)=>{const m=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),E),this.off("res-@".concat(i),R),this.off(zd.ABORT,C),T.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?_(new Y(O.INVALID_REMOTE_USER)):_(new Y(O.TIMEOUT))},N("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),E=()=>{m&&window.clearTimeout(m),this.off(zd.ABORT,C),r&&p()},C=()=>{m&&window.clearTimeout(m),this.off("res-@".concat(i,"_ack"),E),this.off("res-@".concat(i),R),_(new Y(O.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(zd.ABORT,C),this.once("res-@".concat(i,"_ack"),E);const R=(b,A)=>{y=!0,m&&window.clearTimeout(m),this.off("res-@".concat(i,"_ack"),E),this.off(zd.ABORT,C),b==="success"?p(A):_(new Y(O.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let y=!1;r||(this.once("res-@".concat(i),R),yn(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{y||T.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(l))}))});try{return await u}catch(p){if(p.code===O.TIMEOUT)return await this.send(t,n,r,i,s);throw p}}onMessage(t){var n;const{_uid:r}=t;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Kt.CHECK)return;const{token:u}=t;i=new Map,s={uid:r,isStart:!0,token:u,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(ze.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var a;const{id:u,total:p}=t,_=(a=i.get(u))!==null&&a!==void 0?a:[];if(_.push(t),i.has(u)||i.set(u,_),_.length!==p)return;{const m=Qa(_).call(_,(E,C)=>E.index-C.index).map(E=>E.payload).join("");i.delete(u),(t=JSON.parse(m))._uid=r}}const{_type:d,token:l}=t;if(oe(n=[Kt.ACK,Kt.CHECK]).call(n,d))return d===Kt.CHECK&&this.handleCheckToken(s,l),void this.receiveMessage(t);l==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):T.debug('Receive unexpected message", '.concat(l,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:St(6,""),token:this.token,_type:Kt.CHECK};N("SHOW_P2P_LOG")&&T.debug("send message",t),this.signal.request(Ae.DATA_STREAM,{payload:ta(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Kt.ACK,token:this.token};N("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(Ae.DATA_STREAM,{payload:ta(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Kt.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(u=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:_}=u;for(;p.has(_);){const m=p.get(_);p.delete(_),this.receiveMessage(m),u.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:i}=t,s=this.userMap.get(r),{receivedMessagesMap:a,isStart:d,nextExpectedSequenceNumber:l}=s;if(i<l)return this.ack(t._id),void T.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));a.set(i,t),d&&i===l&&(this.receiveMessage(t),a.delete(l),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:s}=t;if(N("SHOW_P2P_LOG")&&T.debug("receive message",t),n){let a;switch(t._type!==Kt.ACK&&(i&&(a=JSON.parse(i)),this.ack(t._id)),t._type){case Kt.CANDIDATE:case Kt.CONTROL:this.signal.emit(r,a,s);break;case Kt.PUBLISH:case Kt.UNPUBLISH:case Kt.RESTART_ICE:case Kt.CALL:a.uid=s,Pn(this.signal,r,a).then(d=>{this.response(t._id,d)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Kt.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Kt.RESPONSE:{const{success:d,message:l}=a;this.emit("res-@".concat(n),d?"success":"failed",l);break}}}}splitMessage(t){if(t.length<bc.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=St(6,"");let s=0,a=800;const d=Math.ceil(t.length/a);for(;t.length>0;){s++;const l={id:i,index:s,total:d,payload:t.slice(0,a),token:"".concat(this.token,"_").concat(r)};JSON.stringify(l).length>bc.MAX_MESSAGE_SIZE?a-=50:(n.push(l),t=t.slice(a))}return n.map(l=>JSON.stringify(l))}handleCheckToken(t,n){return t.token!==n?(T.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(t.uid)},N("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Pn(this.signal,Kt.CALL,void 0),n=await this.send(Kt.CALL,t);this.signal.emit(Ne.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(zd.ABORT),this.signal.emit(ze.ON_USER_OFFLINE,{uid:r.uid,reason:Aq.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=St(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(zd.ABORT)}}w(bc,"MAX_SIZE",1),w(bc,"MAX_MESSAGE_SIZE",1024);class sQ extends Lt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===yt.CONNECTED?this.emit(Ne.WS_CONNECTED):t===yt.RECONNECTING?this.emit(Ne.WS_RECONNECTING,this._websocketReconnectReason):t===yt.CLOSED&&this.emit(Ne.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",yt.CLOSED),w(this,"reconnectToken",void 0),w(this,"p2pToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new tP(5)),w(this,"pingpongTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"_external_signal",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ne.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case ze.ON_DATA_STREAM:return void this.handleDataStream(i._message);case ze.MUTE_AUDIO:case ze.MUTE_VIDEO:case ze.ON_P2P_LOST:case ze.ON_USER_ONLINE:return;case ze.ON_USER_OFFLINE:const{uid:s}=i._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===ze.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ze.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(ot.UID_BANNED);break;case 15:this.close(ot.IP_BANNED);break;case 16:this.close(ot.CHANNEL_BANNED)}if(i._type===ze.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Re.ERR_LICENSE_MISSING:this.close(ot.LICENSE_MISSING);break;case Re.ERR_LICENSE_EXPIRED:this.close(ot.LICENSE_EXPIRED);break;case Re.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ot.LICENSE_MINUTES_EXCEEDED);break;case Re.ERR_LICENSE_PERIOD_INVALID:this.close(ot.LICENSE_PERIOD_INVALID);break;case Re.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ot.LICENSE_MULTIPLE_SDK_SERVICE);break;case Re.ERR_LICENSE_ILLEGAL:this.close(ot.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Yv("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yt.CONNECTED&&this.reconnect("retry",Dn.OFFLINE)}),this.p2pToken=St(6,""),this._external_signal=new bc(this,this.p2pToken)}async request(t,n,r,i){const s=St(6,""),a={_id:s,_type:t,_message:n},d=this.websocket.connectionID,l=()=>new de((C,R)=>{if(this.connectionState===yt.CONNECTED)return C();const y=()=>{this.off(Ne.WS_CLOSED,b),C()},b=()=>{this.off(Ne.WS_CONNECTED,y),R(new Y(O.WS_ABORT))};this.once(Ne.WS_CONNECTED,y),this.once(Ne.WS_CLOSED,b)});if(this.connectionState!==yt.CONNECTING&&this.connectionState!==yt.RECONNECTING||t===Ae.JOIN||t===Ae.REJOIN||await l(),this.websocket.sendMessage(a,!0),i)return;const u=new de((C,R)=>{let y=!1;const b=(D,V)=>{y=!0,C({isSuccess:D==="success",message:V||{}}),this.off(Ne.WS_CLOSED,A),this.off(Ne.WS_RECONNECTING,A),this.emit(Ne.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),b);const A=()=>{R(new Y(O.WS_ABORT,"type: ".concat(t))),this.off(Ne.WS_CLOSED,A),this.off(Ne.WS_RECONNECTING,A),this.off("res-@".concat(s),b)};this.once(Ne.WS_CLOSED,A),this.once(Ne.WS_RECONNECTING,A),yn(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||y||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ne.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await u}catch(C){if(this.connectionState===yt.CLOSED||t===Ae.LEAVE)throw new Y(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?C.throw():t===Ae.JOIN||t===Ae.REJOIN?null:(await l(),await this.request(t,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),m=Bu(_),E=new Y(O.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:m.desc});return m.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(m.desc,", action: ").concat(m.action)),_===Re.ERR_TOO_MANY_BROADCASTERS?((t===Ae.JOIN||t===Ae.REJOIN)&&(this.initError=E,this.close()),E.throw()):m.action==="failed"?E.throw():m.action==="quit"?(this.initError=E,this.close(),E.throw()):(_===Re.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Dn.MULTI_IP)):this.reconnect(m.action,Dn.SERVER_ERROR),t===Ae.JOIN||t===Ae.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new de(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Vu.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yt.CONNECTED)return;const a=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(a._type,a._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new de((n,r)=>{this.once(Ne.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ne.WS_CLOSED,()=>r(this.initError||new Y(O.WS_ABORT))),this.connectionState=yt.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||ot.LEAVE,this.connectionState=yt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=St(6,""),this._external_signal.clear(),this._external_signal=new bc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ne.ABORT_P2P_EXECUTION);const t=await Pn(this,Ne.REQUEST_JOIN_INFO),n=await this.request(Ae.JOIN,t);if(!n)return this.emit(Ne.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ne.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const r=ac(t.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||oe(n=Object.values(Kt)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(ze.ON_DATA_STREAM,t)}catch{this.emit(ze.ON_DATA_STREAM,t)}}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Bu(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ot.UID_BANNED),void this.close()):void this.reconnect(n.action,Dn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=N("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Dn.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),N("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Ue.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ne.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ue.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ue.CLOSED,()=>{this.connectionState=yt.CLOSED}),this.websocket.on(Ue.FAILED,()=>{this._disconnectedReason=ot.NETWORK_ERROR,this.connectionState=yt.CLOSED}),this.websocket.on(Ue.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===yt.CONNECTED?this.connectionState=yt.RECONNECTING:this.connectionState=yt.CONNECTING}),this.websocket.on(Ue.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(Ue.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Ne.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Y&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Re.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Dn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Dn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ue.REQUEST_NEW_URLS,(t,n)=>{Pn(this,Ne.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const aQ={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new oQ(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new sQ(n,t)}};function bU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function OU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bU(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class cQ{constructor(t){w(this,"sessionDesc",void 0),w(this,"localCapabilities",void 0),w(this,"rtpCapabilities",void 0),w(this,"candidates",void 0),w(this,"_originCandidates",void 0),w(this,"iceParameters",void 0),w(this,"dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),t=Pt(t);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:a,localCapabilities:d,sdkCodec:l,cname:u}=t,p=yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=Pt(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=a,this.localCapabilities=d,this.cname=u;for(let _=0;_<p.mediaDescriptions.length;_++){const m=p.mediaDescriptions[_];if(m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=r.fingerprints,m.attributes.candidates=i,m.attributes.setup=a,m.media.mediaType==="video"){m.media.fmts=s.videoCodecs.map(R=>R.payloadType.toString(10));const E=s.videoCodecs.filter(R=>{var y,b;return(y=R.rtpMap)===null||y===void 0?void 0:oe(b=y.encodingName.toLowerCase()).call(b,l)}),C=s.videoCodecs.filter(R=>!oe(E).call(E,R));m.attributes.payloads=[...E,...C],m.attributes.extmaps=s.videoExtensions}m.media.mediaType==="audio"&&(m.media.fmts=s.audioCodecs.map(E=>E.payloadType.toString(10)),m.attributes.payloads=s.audioCodecs,m.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[_]=this.mungMediaDesc(m)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return na(this.sessionDesc)}send(t,n,r){const{ssrcs:i,ssrcGroups:s}=Hu(n,this.cname),a=this.sessionDesc.mediaDescriptions.find(u=>t===he.VIDEO?u.media.mediaType==="video":u.media.mediaType==="audio"),d=i[0].attributes.label,l=i[0].attributes.mslabel;return a.attributes.ssrcs=a.attributes.ssrcs.concat(i),a.attributes.ssrcGroups=a.attributes.ssrcGroups.concat(s),{id:d,mslabel:l}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],i=[],s=[];n.attributes.ssrcs.forEach(a=>{oe(t).call(t,a.attributes.label||"")?s.push(a):r.push(a)}),n.attributes.ssrcGroups.forEach(a=>{var d;oe(d=s.map(l=>l.ssrcId)).call(d,a.ssrcIds[0])||i.push(a)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((i,s)=>{const a=i._mediaStreamTrack,d=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===a.kind),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],i);this.sessionDesc.mediaDescriptions[d]=l})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(n.forEach(i=>{r.push(OU(OU({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),n.length!==0){switch(t){case Bn.TCP_RELAY:this.candidates=r;break;case Bn.UDP_TCP_RELAY:case Bn.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Pt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Pt(t);return Xd(r,n),Qv(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const i=this.sessionDesc.mediaDescriptions.find(a=>t===he.VIDEO?a.attributes.mid==="video":a.attributes.mid==="audio");if(i){const a=i.attributes.ssrcs.find(d=>d.attributes.label===n);var s;a&&(a.attributes.label=r,(s=a.attributes.msid)===null||s===void 0||s.replace(n,r))}}mungMediaDesc(t){const n=Pt(t);return Jv(n),function(r){const i=r.attributes.extmaps.find(s=>b_(s.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(s=>{const a=s.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");a!==-1&&s.rtcpFeedbacks.splice(a,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var Tt;function NU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function um(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NU(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let dQ=(Tt=class Ph extends G1{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return oe(n=Object.keys(ku)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"statsFilter",void 0),w(this,"useRTX",!1),w(this,"localCapabilities",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"establishPromise",void 0),w(this,"mutex",void 0),this.store=n,this.mutex=new xn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Ph.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=ov(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,Ut()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=ca(t.sdp),r=Wu(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,um(um({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new Y(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new cQ(um(um({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new Y(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return ui(function*(){const i=yield Qe(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map(m=>r.peerConnection.addTrack(m._mediaStreamTrack)),a=yield Qe(r.peerConnection.createOffer()),d=yr(a.sdp),l=t.map(m=>{const E=m._mediaStreamTrack,C=d.mediaDescriptions.find(R=>R.attributes.mid===E.kind);if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return function(R,y,b){const A=R.attributes.ssrcs.filter(V=>V.attributes.label===y),D=R.attributes.ssrcGroups;if(A.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(D&&A.length>1){const V=D.find(x=>x.ssrcIds.indexOf(A[0].ssrcId)!==-1);return V?[{ssrcId:V.ssrcIds[0],rtx:b?V.ssrcIds[1]:void 0}]:[{ssrcId:A[0].ssrcId}]}return[{ssrcId:A[0].ssrcId}]}(C,E.id,r.useRTX)});let u;try{u=yield l}catch(m){throw s.forEach(E=>{Nn()&&E.replaceTrack(null),r.peerConnection.removeTrack(E)}),m}const p=r.mungSendOfferSDP(a.sdp,t);r.remoteSDP.receive(t,n,u);const _=r.remoteSDP.toString();return yield Qe(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Qe(r.applySendEncodings(s,t)),yield Qe(r.peerConnection.setRemoteDescription({type:"answer",sdp:_})),t.map((m,E)=>{const C=m._mediaStreamTrack.id;return{localSSRC:l[E],id:C}})}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var a;return t.indexOf(((a=s.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{Nn()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:a}=this.remoteSDP.send(t,n,i),d=new de((p,_)=>{const m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(s)))},1e4),E=C=>{const R=qe();if((R.name==="Safari"&&Number(R.version)===11||Yn())&&C.track.id!==s&&C.streams[0].id===a){var y;const b=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(t,s,C.track.id),this.peerConnection.removeEventListener("track",E),clearTimeout(m),void p(b)}if(C.track.id===s)return this.peerConnection.removeEventListener("track",E),clearTimeout(m),void p(C.track)};this.peerConnection.addEventListener("track",E)}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),{track:await d,id:s}}catch(s){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Nn()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(s=>s.active=!1),r.setParameters(i)}})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var a;return t.indexOf(((a=s.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(Nn()&&s.track)s.track.enabled=!0;else{const a=s.getParameters();a.encodings.forEach(d=>d.active=!0),await s.setParameters(a)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ui(function*(){const r=yield Qe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ze().supportPCSetConfiguration;if(t===Bn.RELAY&&!i)return;if(i){const u=n.peerConnection.getConfiguration(),p=t===Bn.RELAY?"relay":"all";u.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(p,"]")),u.iceTransportPolicy=p,n.peerConnection.setConfiguration(u))}t!==Bn.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield Qe(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=ca(s.sdp),{remoteIceParameters:d}=yield a.iceParameters;n.remoteSDP.restartICE(d);const l=n.remoteSDP.toString();yield Qe(n.peerConnection.setLocalDescription(s)),yield Qe(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new Y(O.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new Y(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Y(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(bu(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Ph.turnServerConfigToIceServers(t.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Ph.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(u=>{var p;return((p=u.track)===null||p===void 0?void 0:p.id)===t._mediaStreamTrack.id})),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ze().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof Ct)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(N("DSCP_TYPE")&&_s()){var a;const u=N("DSCP_TYPE");oe(a=["very-low","low","medium","high"]).call(a,u)&&(s.networkPriority=u)}const d=n.getParameters(),l=(r=d.encodings)===null||r===void 0?void 0:r[0];l&&Object.assign(l,s),Object.assign(d,i),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(t,n){try{if(!Ze().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=yr(t);return n.forEach((i,s)=>{const a=i._mediaStreamTrack,d=r.mediaDescriptions.find(l=>l.attributes.mid===a.kind);d&&Xd(d,i)}),na(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((s,a)=>{let{id:d,mslabel:l}=s;const{kind:u}=t[a];return new de((p,_)=>{const m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(d)))},1e4),E=C=>{const R=qe();if(R.name==="Safari"&&Number(R.version)===11&&C.track.id!==d&&C.streams[0].id===l){var y;const b=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(u,d,C.track.id),this.peerConnection.removeEventListener("track",E),clearTimeout(m),void p({track:b,id:d})}if(C.track.id===d)return this.peerConnection.removeEventListener("track",E),clearTimeout(m),void p({track:C.track,id:d})};this.peerConnection.addEventListener("track",E)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await de.all(n)}catch(n){throw new Y(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ze().supportPCSetConfiguration){const n=Ph.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},me(Tt.prototype,"connect",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"connect"),Tt.prototype),me(Tt.prototype,"stopSending",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"stopSending"),Tt.prototype),me(Tt.prototype,"receive",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"receive"),Tt.prototype),me(Tt.prototype,"stopReceiving",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"stopReceiving"),Tt.prototype),me(Tt.prototype,"muteRemote",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"muteRemote"),Tt.prototype),me(Tt.prototype,"unmuteRemote",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"unmuteRemote"),Tt.prototype),me(Tt.prototype,"muteLocal",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"muteLocal"),Tt.prototype),me(Tt.prototype,"unmuteLocal",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"unmuteLocal"),Tt.prototype),me(Tt.prototype,"close",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"close"),Tt.prototype),me(Tt.prototype,"updateEncoderConfig",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"updateEncoderConfig"),Tt.prototype),me(Tt.prototype,"updateSendParameters",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"updateSendParameters"),Tt.prototype),me(Tt.prototype,"replaceTrack",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"replaceTrack"),Tt.prototype),me(Tt.prototype,"getRemoteSSRC",[Ti],Object.getOwnPropertyDescriptor(Tt.prototype,"getRemoteSSRC"),Tt.prototype),Tt);function Ti(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];return await r.apply(this,d)}finally{s()}},n}const lQ={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new dQ(n,t)}},uQ={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(u_.has(e)||!e.track)return;const n={track:e.track};if(fs()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(a){return void T.error("create audio-encoded-streams error",a&&a.message)}const s=new TransformStream({transform(a,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=t.metadata&&t.metadata();l?function(u,p){const{chunk:_,controller:m}=p,E=ra.METADATA;_.data=function(C,R,y){const b=y.byteLength,A=b+Nv+I1,D=bv+Ov+A,V=new ArrayBuffer(C.byteLength+D),x=new DataView(V);x.setUint8(0,C1),x.setUint16(1,A),x.setUint8(3,R),x.setUint16(4,b);for(let B=0;B<b;B++)x.setUint8(6+B,y[B]);const k=new Uint8Array(x.buffer);return k.set(new Uint8Array(C),D),k.buffer}(_.data,E,u),m.enqueue(_)}(l,{sender:e,chunk:a,controller:d}):d.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Nn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=l_(),s=new MessageChannel;await new de(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=a,await new de(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),s.port1.onmessage=d=>{var l;if(d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id)T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(d.data.getMetadata){const u=t.metadata&&t.metadata();u&&s.port1.postMessage({metadata:u})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=u_.get(e);if(i){u_.delete(e);try{var s,a;(s=i.controller)===null||s===void 0||s.terminate(),(a=i.worker)===null||a===void 0||a.terminate()}catch(d){T.warning(d&&d.message)}}}u_.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(E_.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(fs()&&!Yn()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");FT(tt.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(a){return void T.error("create audio-encoded-streams error",a&&a.message)}const s=new TransformStream({transform(a,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(l,u,p){var _;const m=Dv(new DataView(u.data));if(!m)return p.enqueue(u);const E=l.track.id;q7.set(E,l.track);const C=(_=m.tlv.find(V=>V.tag===ra.AUDIO_LEVEL))===null||_===void 0?void 0:_.value;let R=0;typeof C=="number"&&(R=127-C);const y=Math.round(Math.pow(10,R/60)-1),{selected:b,speaker:A}=function(V,x){let k=Gd.get(V);if(k||(k=function(B){const q=new A1;return Gd.set(B,q),mo||(mo=new z7(N("TOPN_SILENCE_THRESHOLD")||500),mo.on("ActiveSpeakerChanged",Z=>{Z!=null&&(f_=Z)})),mo.addSpeakers([q]),q}(V)),Gd.size<=b1)return{selected:!0,speaker:k};if(!mo)throw new Error("no active speaker detector");return mo.levelChanged(k.id,x),fc=mo.loudest.map(B=>B.id),f_&&!oe(fc).call(fc,f_)&&fc.length>=b1&&fc.pop(),{selected:oe(fc).call(fc,k.id)||k.id===f_,speaker:k}}(l,y),D=function(V,x,k){const B=Eo.get(V)||new Y7(V,x);return B.score=k,Eo.set(V,B),function(q){if(__.set(q,!0),!m_)return void(m_=Date.now());const Z=Date.now();Z-m_>1e3&&(__.get(q)?__.set(q,!1):(O1(q),__.delete(q)),m_=Z)}(V),B}(E,l.track,A.energyScore);D.addSample(b),D.active&&(u.data=m.frame.buffer,p.enqueue(u))}(e,a,d):t.enableMetadata||t.enablePts?function(l,u,p,_){const m=new DataView(l.data),E=m.getUint8(0);let C;if(128&E&&E!==71){const b=function(A){if(A.byteLength<=0)return[];const D=[];let V=0;for(;V<A.byteLength;){const k=(128&A.getUint8(V))>>7,B=127&A.getUint8(V);if(!(k&&V+4<=A.byteLength)){V++;break}{const q=A.getUint32(V,!1),Z=(16776192&q)>>10,te=1023&q;D.push({pt:B,ts_offset:Z,length:te,data:new Uint8Array}),V+=4}}let x=A.byteLength-V;for(const k of D){if(k.length>x)return console.warn("Broken red payload"),[];k.length>0&&(k.data=new Uint8Array(A.buffer,A.byteOffset+V,k.length),V+=k.length,x-=k.length)}if(x>0){const k={pt:D.length>0?D[D.length-1].pt:0,ts_offset:0,length:x,data:new Uint8Array(A.buffer,A.byteOffset+V,x)};D.push(k)}return D}(m);if(b.length>0){const A=function(D){let V=0;for(let B=0;B<D.length;B++)V+=B<D.length-1?4:1,V+=D[B].length;const x=new Uint8Array(V);let k=0;for(let B=0;B<D.length;B++)if(B<D.length-1){const q=(2147483648|(127&D[B].pt)<<24|(262143&D[B].ts_offset)<<10|1023&D[B].length)>>>0;x[k++]=q>>24&255,x[k++]=q>>16&255,x[k++]=q>>8&255,x[k++]=255&q}else x[k++]=127&D[B].pt;for(const B of D)x.set(B.data,k),k+=B.length;return x}(b.map(D=>{const V=new Uint8Array(D.length);V.set(D.data);const x=Dv(new DataView(V.buffer));return x!=null&&x.frame&&(D.data=x==null?void 0:x.frame),C=x,D}));l.data=A.buffer}}else C=Dv(m),C&&(l.data=C.frame.buffer);if(u.enqueue(l),!C)return;const R=C.tlv.find(b=>b.tag===ra.METADATA);R&&p&&R.value instanceof Uint8Array&&p(R.value);const y=C.tlv.find(b=>b.tag===ra.AUDIO_64_BIT_PTS);y&&_&&y.value instanceof Uint8Array&&y.value.length==8&&_(new DataView(y.value.buffer).getBigUint64(0,!0))}(a,d,t.onMetadata,t.onPts):d.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=l_(),s=new MessageChannel;await new de(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=a,await new de(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),s.port1.onmessage=d=>{var l;d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(T.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):d.data.metadata&&n.onMetadata?n.onMetadata(d.data.metadata):d.data.pts&&n.onPts&&n.onPts(d.data.pts)},n.worker=i}function r(){e.track.removeEventListener("ended",r),function(i){const s=E_.get(i);if(s){(function(l){const u=Gd.get(l);u&&(Gd.delete(l),mo&&(mo.removeSpeakers([u]),Gd.size===0&&(mo.destroy(),mo=null)))})(i),O1(i.track.id),E_.delete(i);try{var a,d;(a=s.controller)===null||a===void 0||a.terminate(),(d=s.worker)===null||d===void 0||d.terminate()}catch(l){T.warning(l&&l.message)}}}(e)}E_.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(g_.has(e)||!e.track)return;const n={track:e.track};if(fs()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(d){return void T.error("create video-encoded-streams error",d&&d.message)}const s=[];t.on("sei-to-send",d=>{s.push(d)});const a=new TransformStream({transform(d,l){n.controller||(n.controller=l),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const u=P1(new Uint8Array(d.data)),p=s.shift();if(p){const _=function(m,E,C){switch(C){case Mv:return function(R,y){const b=D1(y),A=b.length,D=Math.floor(A/255),V=A%255,x=new Uint8Array(6+D+1+A+R.byteLength);x[0]=0,x[1]=0,x[2]=0,x[3]=1,x[4]=6,x[5]=101;let k=0;for(;k<D;)x[6+k]=255,k++;return x[6+k]=V,k++,x.set(b,6+k),x.set(new Uint8Array(R),6+k+A),x.buffer}(m,E);case Uv:return function(R,y){const b=D1(y),A=b.length,D=Math.floor(A/255),V=A%255,x=new Uint8Array(7+D+1+A+1+R.byteLength);x[0]=0,x[1]=0,x[2]=0,x[3]=1,x[4]=78,x[5]=1,x[6]=101;let k=0;for(;k<D;)x[7+k]=255,k++;return x[7+k]=V,k++,x.set(b,7+k),k+=A,x[7+k]=128,k++,x.set(new Uint8Array(R),7+k),x.buffer}(m,E);default:return null}}(d.data,p,u);_&&(d.data=_)}l.enqueue(d)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if(!Nn())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=l_(),s=new MessageChannel;await new de(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=a,await new de(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),t.on("sei-to-send",d=>{s.port1.postMessage({sei:d})}),s.port1.onmessage=d=>{var l;d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=g_.get(e);if(i){g_.delete(e);try{var s,a;(s=i.controller)===null||s===void 0||s.terminate(),(a=i.worker)===null||a===void 0||a.terminate()}catch(d){T.warning(d&&d.message)}}}g_.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ze().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!e.track)return;if(xu.has(e)){const i=xu.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(fs()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(a){return void T.error("create video-encoded-streams error",a&&a.message)}const s=new TransformStream({transform(a,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=function(u,p){switch(p){case Mv:return function(_){const m=new DataView(_.data);let E=0;for(;E+4<_.data.byteLength;){if(m.getUint8(E+0)===0&&m.getUint8(E+1)===0&&m.getUint8(E+2)===0&&m.getUint8(E+3)===1&&m.getUint8(E+4)===6){let C=E+6,R=0,y=0;for(;(y=m.getUint8(C++))===255;)R+=255;R+=y;const b=N1(_.data,C,R);return new Uint8Array(b)}E++}return null}(u);case Uv:return function(_){const m=new DataView(_.data);let E=0;for(;E+5<_.data.byteLength;){if(m.getUint8(E+0)===0&&m.getUint8(E+1)===0&&m.getUint8(E+2)===0&&m.getUint8(E+3)===1&&m.getUint8(E+4)===78&&m.getUint8(E+5)===1&&m.getUint8(E+6)===101){let C=E+7,R=0,y=0;for(;(y=m.getUint8(C++))===255;)R+=255;R+=y;const b=N1(_.data,C,R);return new Uint8Array(b)}E++}return null}(u);default:return null}}(a,P1(new Uint8Array(a.data)));l&&n.onSei&&n.onSei(l),d.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Nn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const i=l_(),s=new MessageChannel;await new de(d=>i.onmessage=l=>{l.data==="registered"&&d(void 0)});const a=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=a,await new de(d=>i.onmessage=l=>{l.data==="started"&&d(void 0)}),s.port1.onmessage=d=>{var l;d.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):d.data.sei&&n.onSei&&n.onSei(d.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const s=xu.get(i);if(s){xu.delete(i);try{var a,d;(a=s.controller)===null||a===void 0||a.terminate(),(d=s.worker)===null||d===void 0||d.terminate()}catch(l){T.warning(l&&l.message)}}})(e)}xu.set(e,n),e.track.addEventListener("ended",r)}},hQ={name:"InterceptFrame",create:()=>uQ};sv(),ht("PROCESS_ID","process-".concat(St(8,""),"-").concat(St(4,""),"-").concat(St(4,""),"-").concat(St(4,""),"-").concat(St(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();T.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Ot,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;_o[r]=i,Ot[r]=i}})}catch(t){T.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(_o.AREAS)&&_o.AREAS.length>0&&tR(_o.AREAS,!0);const DU=(e,t,n)=>{T.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),ht(e,t,n)};ua(MJ,!1),ua(VJ,!1),ua(SX,!1),ua(XJ,!1),ua(PJ,!1),ua(aQ,!1),ua(lQ,!1),ua(hQ,!1);const Zt=function(e){const t=new Lt,n=e,r={getListeners:t.getListeners.bind(t),on:(i,s)=>(function(a,d){a===zo.SECURITY_POLICY_VIOLATION&&u2(d,!0)}(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return l2(l2({},n),r)}({__TRACK_LIST__:kd,VERSION:hi,BUILD:dv,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:DU,getParameter:N,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let i;return Ze().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!n)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(t){throw new G(O.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=Se.reportApiInvoke(null,{name:Wt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Dt.TRACER});let t=!1;try{const s=window.RTCPeerConnection,a=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,d=window.WebSocket;t=!!(s&&a&&d),t&&KT()&&ND(75)&&new s().close()}catch(s){return T.error("check system requirement failed: ",s),!1}let n=!1;const r=qe();r.name===tt.CHROME&&Number(r.version)>=58&&(ho.engine.name!=="WebKit"||function(){const s=qe();if(Yf()){if(s.os===hn.MAC_OS)return!0;if(s.os===hn.IOS){const a=ho.os.version&&ho.os.version.split(".");if(a&&Number(a[0])===14&&a[1]&&Number(a[1])>=3||a&&Number(a[0])>14)return!0}}return!1}())&&(n=!0),(r.name===tt.FIREFOX&&Number(r.version)>=56||r.name===tt.OPERA&&Number(r.version)>=45||r.name===tt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Yn()||Vi())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||UD()||qe().name===tt.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return $r.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return $r.getRecordingDevices(e)},getCameras:function(e){return $r.getCamerasDevices(e)},getElectronScreenSources:NP,getPlaybackDevices:function(e){return $r.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=St(5,"client-"),r=Se.reportApiInvoke(null,{id:n,name:Wt.CREATE_CLIENT,options:[t],tag:Dt.TRACER});try{(function(i){cn(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),cn(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&cn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Rn(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&HD(i.turnServer),i.httpRetryConfig!==void 0&&WD(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&WD(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(kD(16,0,!0)||GT(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",T.debug("browser not support vp9, force use vp8")),ht("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new TX(Yi(Yi({forceWaitGatewayResponse:!0},t),{},{role:oe(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=N("CAMERA_CAPTURE_CONFIG"),n=St(8,"track-cam-"),r=Se.reportApiInvoke(null,{id:n,tag:Dt.TRACER,name:Wt.CREATE_CAM_VIDEO_TRACK,options:[Rt({},e),t]});t&&(e.encoderConfig=t);const i=c_(e);let s=null;T.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await Zr({video:i},n)).getVideoTracks()[0]||null}catch(d){throw r.onError(d),d}if(!s){const d=new Y(O.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(d),d.throw(T)}if(e.optimizationMode&&Av(n,s,e,ji(e.encoderConfig)),N("USE_STANDARD_BITRATE_DEFAULT")){const d=ji(e.encoderConfig);e.encoderConfig=d,delete d.bitrateMax,delete d.bitrateMin}const a=new d_(s,e,i,e.scalabiltyMode?i_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(a.getTrackId()),T.info("create camera video success, trackId:",n),a},createCustomVideoTrack:function(e){const t=St(8,"track-cus-"),n=Se.reportApiInvoke(null,{id:t,tag:Dt.TRACER,name:Wt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});N("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new Ct(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?i_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[mt.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),T.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(m){return BP(m)}(t):void 0;n&&(t="auto");const r=St(8,"track-scr-v-"),i=Se.reportApiInvoke(null,{id:r,tag:Dt.TRACER,name:Wt.CREATE_SCREEN_VIDEO_TRACK,options:[Rt({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=function(m){const E={};m.screenSourceType&&(E.mediaSource=m.screenSourceType),m.extensionId&&fs()&&(E.extensionId=m.extensionId);const{displaySurface:C,selfBrowserSurface:R,surfaceSwitching:y,systemAudio:b,preferCurrentTab:A}=m;(Cd(107)||BT(107)||WT(93))&&(C&&(cn(C,"displaySurface",["browser","window","monitor"]),E.displaySurface=C),R?(cn(R,"selfBrowserSurface",["exclude","include"]),E.selfBrowserSurface=R):E.selfBrowserSurface="include",y&&(cn(y,"surfaceSwitching",["exclude","include"]),E.surfaceSwitching=y)),(Cd(105)||BT(105)||WT(91))&&b&&(cn(b,"systemAudio",["exclude","include"]),E.systemAudio=b),(Cd(94)||BT(94)||WT(80))&&A&&(E.preferCurrentTab=!0),m.electronScreenSourceId&&(E.sourceId=m.electronScreenSourceId);const D=m.encoderConfig?_v(m.encoderConfig):null;return E.mandatory={chromeMediaSource:"desktop",maxWidth:D?D.width:void 0,maxHeight:D?D.height:void 0},D&&(D.frameRate&&(typeof D.frameRate=="number"?(E.mandatory.maxFrameRate=D.frameRate,E.mandatory.minFrameRate=D.frameRate):(E.mandatory.maxFrameRate=D.frameRate.max||D.frameRate.ideal||D.frameRate.exact||void 0,E.mandatory.minFrameRate=D.frameRate.min||D.frameRate.ideal||D.frameRate.exact||void 0),E.frameRate=D.frameRate),D.width&&(E.width=D.width),D.height&&(E.height=D.height)),E}(e);let a=null,d=null;const l=Ze();if(!l.supportShareAudio&&t==="enable"){const m=new Y(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(m),m.throw(T)}T.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const u=l.supportShareAudio&&t!=="disable";try{const m=await Zr({screen:s,screenAudio:u?n||!0:void 0},r);a=m.getVideoTracks()[0]||null,d=m.getAudioTracks()[0]||null}catch(m){throw i.onError(m),m}if(!a){const m=new Y(O.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(m),m.throw(T)}if(!d&&t==="enable"){a&&a.stop();const m=new Y(O.SHARE_AUDIO_NOT_ALLOWED);return i.onError(m),m.throw(T)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Av(r,a,e,e.encoderConfig&&_v(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new Ct(a,e.encoderConfig?_v(e.encoderConfig):{},e.scalabiltyMode?i_(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[mt.SCREEN_TRACK]);if(!d)return i.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const _=new Gt(d,void 0,St(8,"track-scr-a-"),!1);return i.onSuccess([p.getTrackId(),_.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",_.getTrackId()),[p,_]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=N("CAMERA_CAPTURE_CONFIG"),r=St(8,"track-mic-"),i=St(8,"track-cam-"),s=Se.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:Dt.TRACER,name:Wt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const a=c_(t),d=jP(e);let l=null,u=null;T.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const m=await Zr({audio:d,video:a},"".concat(r,"-").concat(i));l=m.getAudioTracks()[0],u=m.getVideoTracks()[0]}catch(m){throw s.onError(m),m}if(!l||!u){const m=new Y(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(m),m.throw(T)}if(t.optimizationMode&&Av(i,u,t,ji(t.encoderConfig)),N("USE_STANDARD_BITRATE_DEFAULT")){const m=ji(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const p=new Uu(l,e,d,r),_=new d_(u,t,a,t.scalabiltyMode?i_(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([p.getTrackId(),_.getTrackId()]),T.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[p,_]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=St(8,"track-mic-"),n=Se.reportApiInvoke(null,{id:t,tag:Dt.TRACER,name:Wt.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=jP(e);let i=null;T.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Zr({audio:r},t)).getAudioTracks()[0]||null}catch(a){throw n.onError(a),a}if(!i){const a=new Y(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(a),a.throw(T)}const s=new Uu(i,e,r,t);return n.onSuccess(s.getTrackId()),T.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=St(8,"track-cus-"),n=Se.reportApiInvoke(null,{id:t,tag:Dt.TRACER,name:Wt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Gt(e.mediaStreamTrack,e.encoderConfig?o_(e.encoderConfig):{},t,!1);return T.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},a=St(8,"track-buf-"),d=Se.reportApiInvoke(null,{id:a,tag:Dt.TRACER,name:Wt.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(N("DISABLE_WEBAUDIO"))throw new Y(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",a);const l=i;if(!(i instanceof AudioBuffer))try{i=await async function(_,m){let E=null;if(typeof _=="string"){const R=Ak.get(_);if(R)return T.debug("use cached audio resource: ",_),R;try{E=(await fo(()=>pr.get(_,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(y){throw new Y(O.FETCH_AUDIO_FILE_FAILED,y.toString())}}else E=await new de((y,b)=>{const A=new FileReader;A.onload=D=>{D.target?y(D.target.result):b(new Y(O.READ_LOCAL_AUDIO_FILE_ERROR))},A.onerror=()=>{b(new Y(O.READ_LOCAL_AUDIO_FILE_ERROR))},A.readAsArrayBuffer(_)});const C=await function(R){const y=Vd();return new de((b,A)=>{y.decodeAudioData(R,D=>{b(D)},D=>{A(new Y(O.DECODE_AUDIO_FILE_FAILED,D.toString()))})})}(E);return typeof _=="string"&&m&&Ak.set(_,C),C}(i,n)}catch(_){return d.onError(_),_.throw(T)}const u=new j7(i),p=new B7(l,u,r?o_(r):{},a);return T.info("create buffer source audio track success, trackId:",a),d.onSuccess(p.getTrackId()),p},setAppType:function(e){if(T.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw T.debug("Invalid appType"),new G(O.INVALID_PARAMS,"invalid app type",e);ht("APP_TYPE",Math.floor(e))},setLogLevel:function(e){T.setLogLevel(e)},enableLogUpload:function(){N("USE_NEW_LOG")?ht("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){N("USE_NEW_LOG")?ht("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new NL},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Se.reportApiInvoke(null,{tag:Dt.TRACER,name:Wt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Gt||e instanceof jd)){const l=new G(O.INVALID_TRACK,"the parameter is not a audio track");return n.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Gt?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,a=i;const d=Date.now();return new de(l=>{const u=setInterval(()=>{const p=e.getVolumeLevel();s=p>s?p:s,a=p<a?p:a;const _=s-a>1e-4,m=Date.now()-d;if(_||m>t){clearInterval(u);const E=_,C={duration:m,deviceLabel:r,maxVolumeLevel:s,result:E};T.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),n.onSuccess(C),l(E)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Se.reportApiInvoke(null,{tag:Dt.TRACER,name:Wt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ct||e instanceof Bd)){const _=new G(O.INVALID_TRACK,"the parameter is not a video track");return n.onError(_),_.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Ct?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Nn()||Yf())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const a=document.createElement("canvas");a.width=160,a.height=120;let d=0,l=0;try{const _=Date.now();d=await function(m,E,C,R){let y,b=0,A=null;return new de((D,V)=>{function x(){b>R&&y&&(y(),D(b));const k=C.getContext("2d");if(!k){const Z=new G(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(Z.toString()),void V(Z)}k.drawImage(m,0,0,160,120);const B=k.getImageData(0,0,C.width,C.height),q=Math.floor(B.data.length/3);if(A){for(let Z=0;Z<q;Z+=3)if(B.data[Z]!==A[Z])return b+=1,void(A=B.data);A=B.data}else A=B.data}setTimeout(()=>{y&&(y(),D(b))},E),y=Tv(()=>{x()},30)})}(s,t,a,4),l=Date.now()-_}catch(_){throw n.onError(_),_}sX===tt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const u=d>4,p={duration:l,changedPicNum:d,deviceLabel:r,result:u};return T.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),u},setArea:tR,audioElementPlayCenter:fr,resumeAudioContext:function(){fr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){RX.processExternalMediaAEC(e)},registerExtensions:function(e){const t=N("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!oe(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=T.extLog,r.reporter.hookApiInvoke=Se.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=N(i)})}),DU("PLUGIN_INFO",t)},ChannelMediaRelayError:Hd,ChannelMediaRelayEvent:Es,ChannelMediaRelayState:Ir,RemoteStreamFallbackType:k7,RemoteStreamType:P7,ConnectionDisconnectedReason:ot,AudienceLatencyLevelType:d7,AREAS:rt,preload:async function(e,t,n,r){return eM(e,t,n,r)}});return Object.defineProperties(Zt,{onAudioAutoplayFailed:{get:()=>ei.onAudioAutoplayFailed,set:e=>{ei.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ei.onAutoplayFailed,set:e=>{ei.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Zt._onSecurityPolicyViolation,set(e){Zt._onSecurityPolicyViolation=e,u2(e)}},__CLIENT_LIST__:{get:()=>N("SHOW_GLOBAL_CLIENT_LIST")?_c:[]}}),$r.on(uc.CAMERA_DEVICE_CHANGED,e=>{T.info("camera device changed",JSON.stringify(e)),Zt.onCameraChanged&&Zt.onCameraChanged(e),Zt.safeEmit(zo.CAMERA_CHANGED,e)}),$r.on(uc.RECORDING_DEVICE_CHANGED,e=>{T.info("microphone device changed",JSON.stringify(e)),Zt.onMicrophoneChanged&&Zt.onMicrophoneChanged(e),Zt.safeEmit(zo.MICROPHONE_CHANGED,e)}),$r.on(uc.PLAYOUT_DEVICE_CHANGED,e=>{T.debug("playout device changed",JSON.stringify(e)),Zt.onPlaybackDeviceChanged&&Zt.onPlaybackDeviceChanged(e),Zt.safeEmit(zo.PLAYBACK_DEVICE_CHANGED,e)}),fr.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),ei.onAudioAutoplayFailed&&ei.onAudioAutoplayFailed()},pt.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),ei.onAudioAutoplayFailed&&ei.onAudioAutoplayFailed(),Zt.safeEmit(zo.AUTOPLAY_FAILED)}),pt.on(In.STATE_CHANGE,(e,t)=>{T.info("audio context state changed: ".concat(t," => ").concat(e)),Zt.onAudioContextStateChanged&&Zt.onAudioContextStateChanged(e,t),Zt.safeEmit(zo.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Yt.on(wd.NETWORK_STATE_CHANGE,(e,t)=>{T.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Zt),Zt})})(AB);var vte=AB.exports;const fp=qx(vte);fp.setParameter("EXPERIMENTS",{enableAiClientMode:!0,enableStringuidCompatible:!0});fp.enableLogUpload();fp.setParameter("AUDIO_VOLUME_INDICATION_INTERVAL",1e3);const Mn=fp.createClient({mode:"live",codec:"vp8",role:"audience",audioCodec:"opus"});let ya;function Rte(){const[o]=_te(),[c,h]=le.useState(!1),[f,g]=le.useState(!1),[S,I]=le.useState(!1),[L,M]=le.useState(0),[F,X]=le.useState([]),[H,J]=le.useState(!1),ce=le.useRef("voice-chat-room"),se=le.useRef(""),pe=le.useRef(""),[we,z]=le.useState(!0),W=le.useRef(!1);le.useEffect(()=>{const ge=o.get("appid"),bt=o.get("token"),ct=o.get("channel");ge&&(se.current=ge),bt&&(pe.current=bt),ct&&(ce.current=ct),ge&&ct&&!W.current&&(W.current=!0,z(!1),setTimeout(()=>{K()},100))},[]),le.useEffect(()=>(Mn.on("user-joined",async()=>{M(ge=>ge+1)}),Mn.on("user-left",async ge=>{M(bt=>bt-1),X(bt=>bt.filter(ct=>ct.uid!==ge.uid));try{ge.audioTrack&&(await Mn.unsubscribe(ge,"audio"),console.log(` ${ge.uid} `))}catch(bt){console.error(` ${ge.uid} :`,bt)}}),Mn.on("user-published",async(ge,bt)=>{if(console.error("user-published----"),bt==="audio"){if(ge.audioTrack&&ge.audioTrack.isPlaying){console.log(`[]  ${ge.uid} track `),X(Hn=>Hn.map(en=>en.uid===ge.uid?{...en,isMuted:!1,isSpeaking:!1}:en));return}if(ge.audioTrack&&!ge.audioTrack.isPlaying){console.log(`[]  ${ge.uid} track `),ge.audioTrack.play(),X(Hn=>Hn.map(en=>en.uid===ge.uid?{...en,isMuted:!1,isSpeaking:!1}:en));return}console.log(`[]  ${ge.uid}  track`),await Mn.presubscribe(ge.uid,bt);const ct=ge.audioTrack;ct==null||ct.play(),X(Hn=>[...Hn,{uid:ge.uid,isMuted:!1,isSpeaking:!1}])}}),Mn.on("user-unpublished",async(ge,bt)=>{console.error("user-unpublished----"),bt==="audio"&&console.log(` ${ge.uid} `),X(ct=>ct.map(Hn=>Hn.uid===ge.uid?{...Hn,isMuted:!0,isSpeaking:!1}:Hn))}),Mn.enableAudioVolumeIndicator(),Mn.on("volume-indicator",ge=>{console.error(ge)}),()=>{Mn.removeAllListeners()}),[]);const K=async()=>{if(!se.current){alert(" App ID");return}if(Mn.connectionState==="CONNECTED"||Mn.connectionState==="CONNECTING"){console.log(""),I(!0),z(!1);return}try{await Mn.join(se.current,ce.current,pe.current||null,"random-user-"+Math.random().toString(36).substring(2,15)),I(!0),z(!1),M(Mn.remoteUsers.length+1)}catch(ge){console.error(":",ge),alert(""),z(!0),W.current=!1}},Ee=async()=>{c&&await Le(),await Mn.leave(),I(!1),M(0),X([]),z(!0),W.current=!1},Ie=async()=>{S||await K();try{await Mn.setClientRole("host"),ya=await fp.createMicrophoneAudioTrack(),await ya.setMuted(!1),await Mn.publish(ya),h(!0),g(!1),X(ge=>[...ge,{uid:Mn.uid,isMuted:!1,isSpeaking:!1}]),console.log("")}catch(ge){console.error(":",ge),alert("")}},Le=async()=>{try{ya&&(await Mn.unpublish(ya),ya.close()),await Mn.setClientRole("audience"),h(!1),g(!0),X(ge=>ge.filter(bt=>bt.uid!==Mn.uid)),console.log("")}catch(ge){console.error(":",ge)}},be=async()=>{if(!c||!ya)return;const ge=!f;await ya.setMuted(ge),g(ge),X(bt=>bt.map(ct=>ct.uid===Mn.uid?{...ct,isMuted:ge}:ct))},je=()=>{const ge=window.location.origin+window.location.pathname,bt=new URLSearchParams({appid:se.current,channel:ce.current});return pe.current&&bt.append("token",pe.current),`${ge}?${bt.toString()}`},Bt=()=>{const ge=je();navigator.clipboard.writeText(ge).then(()=>{alert(""),J(!1)})};return et.jsxs("div",{className:"voice-chat-container",children:[S&&et.jsxs("div",{className:"user-count",children:[et.jsx("span",{className:"count-icon",children:""}),et.jsx("span",{className:"count-number",children:L})]}),we&&et.jsxs("div",{className:"config-panel",children:[et.jsx("h2",{children:""}),et.jsxs("div",{className:"config-form",children:[et.jsx("input",{defaultValue:se.current,placeholder:" App ID",onChange:ge=>se.current=ge.target.value}),et.jsx("input",{defaultValue:pe.current,placeholder:" Token",onChange:ge=>pe.current=ge.target.value}),et.jsx("input",{defaultValue:ce.current,placeholder:"",onChange:ge=>ce.current=ge.target.value}),et.jsx("button",{onClick:K,className:"join-btn",children:""})]})]}),S&&et.jsxs(et.Fragment,{children:[et.jsxs("div",{className:"room-header",children:[et.jsxs("h1",{children:["",ce.current]}),et.jsx("button",{className:"share-button",onClick:()=>J(!0),children:" "})]}),et.jsx("div",{className:"speakers-container",children:F.length===0?et.jsx("div",{className:"empty-state",children:""}):et.jsx("div",{className:"speakers-grid",children:F.map(ge=>et.jsxs("div",{className:`speaker-card ${ge.isSpeaking?"speaking":""}`,children:[et.jsxs("div",{className:"speaker-avatar",children:[et.jsx("span",{className:"avatar-icon",children:""}),et.jsx("div",{className:`mic-status ${ge.isMuted?"muted":"unmuted"}`,children:ge.isMuted?"":""})]}),et.jsxs("div",{className:"speaker-info",children:[et.jsx("div",{className:"speaker-name",children:ge.uid===Mn.uid?"":` ${ge.uid}`}),et.jsx("div",{className:"speaker-status",children:ge.isSpeaking?et.jsx("span",{className:"status-speaking",children:" "}):ge.isMuted?et.jsx("span",{className:"status-muted",children:" "}):et.jsx("span",{className:"status-unmuted",children:" "})})]})]},ge.uid))})}),et.jsxs("div",{className:"control-bar",children:[c?et.jsxs("div",{className:"host-controls",children:[et.jsxs("button",{onClick:be,className:`mic-toggle-button ${f?"muted":"unmuted"}`,children:[et.jsx("span",{className:"button-icon",children:f?"":""}),et.jsx("span",{className:"button-text",children:f?"":""})]}),et.jsxs("button",{onClick:Le,className:"audience-button",children:[et.jsx("span",{className:"button-icon",children:""}),et.jsx("span",{className:"button-text",children:""})]})]}):et.jsxs("button",{onClick:Ie,className:"host-button",children:[et.jsx("span",{className:"button-icon",children:""}),et.jsx("span",{className:"button-text",children:""})]}),et.jsx("button",{onClick:Ee,className:"leave-button",children:""})]})]}),H&&et.jsx("div",{className:"modal-overlay",onClick:()=>J(!1),children:et.jsxs("div",{className:"modal-content",onClick:ge=>ge.stopPropagation(),children:[et.jsx("h3",{children:""}),et.jsx("div",{className:"share-link-container",children:et.jsx("input",{type:"text",value:je(),readOnly:!0,className:"share-link-input"})}),et.jsxs("div",{className:"modal-buttons",children:[et.jsx("button",{onClick:Bt,className:"copy-button",children:""}),et.jsx("button",{onClick:()=>J(!1),className:"cancel-button",children:""})]})]})})]})}Ny.createRoot(document.getElementById("root")).render(et.jsx(bQ.StrictMode,{children:et.jsx(lte,{children:et.jsx(Rte,{})})}));
